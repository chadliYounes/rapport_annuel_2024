"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function getFrameID(e){var t=document.getElementById(e);if(t){if(/^iframe$/i.test(t.tagName))return e;var n=t.getElementsByTagName("iframe");if(!n.length)return null;for(var i=0;i<n.length&&!/^https?:\/\/(?:www\.)?youtube(?:-nocookie)?\.com(\/|$)/i.test(n[i].src);i++);if(t=n[i],!t)return null;if(t.id)return t.id;do e+="-frame";while(document.getElementById(e));return t.id=e,e}return null}function onYouTubePlayerAPIReady(){YT_ready(!0)}function loadYouTubePlayerAPI(){return loadPromise?loadPromise:loadPromise=new Promise(function(e,t){var n=document.createElement("script"),i=document.getElementsByTagName("script")[0];n.onload=e,n.onerror=function(){console.error("Failed to load youtube player API",proxyUrl),t()},n.src=proxyUrl,i.parentNode.insertBefore(n,i)})}!function(e){function t(e){var n={};if(e.hasChildNodes()){for(var i,a,r,o="",s=e.childNodes.length,l=0;l<s;l++)i=e.childNodes.item(l),3===(i.nodeType-1|1)?o+=3===i.nodeType?i.nodeValue.trim():i.nodeValue:1!==i.nodeType||i.prefix||(a=i.nodeName,r=t(i),n.hasOwnProperty(a)?(n[a].constructor!==Array&&(n[a]=[n[a]]),n[a].push(r)):n[a]=r);o&&(n.keyValue=o)}if("undefined"!=typeof e.hasAttributes&&e.hasAttributes())for(var u,c=e.attributes.length,p=0;p<c;p++)u=e.attributes.item(p),n["@"+u.name]=u.value;return n}e.JXONTree=t}(webpublicationNamespace),function(e){function t(e){e=e.split("/");for(var t=[],n=1;n<e.length;n+=2)t[e[n]]=e[n+1];return t}function n(e){return e.split("/")[0]}e.API={debugDisable:function(){return e.Utils._assertDebug(!1)},debugEnable:function(){return e.Utils._assertDebug(!0)},debugGetState:function(){return e.Utils._assertDebug()},debugToggle:function(){return e.Utils._assertDebug(!e.Utils._assertDebug())},deviceType:function(){return e.Param.userAgent.device.type},lightboxClose:function(){e.Class.LightboxManagerNew.closeAll()},lightboxOpen:function(t){new e.Class.LightboxManagerNew({id:"api-iframe",title:t.title,header:"false"===t.header?"none":"visible",url:e.Utils.resolveVariable(decodeURIComponent(t.url))})},menuClose:function(){return e.Main.menuManager.hideMenu()},menuOpen:function(){return e.Main.menuManager.showMenu()},menuToggle:function(){return e.Main.menuManager.toggleMenu()},pageCount:function(){return e.Utils.prodTools.getPageLength()},pageLoad:function(t){if(t.number)return!!e.Utils._assertInteger(t.number,"[pageLoad] The number argument must be an integer")&&(e.Main.viewerManager.goToPage(t.number),!0);if(t.name){if("next"===t.name)e.Main.viewerManager.scrollFrame("next");else if("previous"===t.name||"prev"===t.name)e.Main.viewerManager.scrollFrame("prev");else if("first"===t.name)e.Main.viewerManager.goToPage(1);else{if("last"!==t.name)return!1;e.Main.viewerManager.goToPage(e.Utils.prodTools.getPageLength())}return!0}return e.Utils._assert(!1,"[pageLoad] The argument is missing or incorrect"),!1},broadcast:function(t){if(e.Utils._assertOneOf(t.mode,["all","others"],"Mode must be 'all' or 'others'")&&e.Utils._assertJson(t.data,"Data must be a valid json string")){var n="others"===t.mode&&this,i=JSON.parse(t.data);return i.type="broadcast",e.Main.linksManagerNew.linksBroadcast(t.mode,i,n),!0}return!1},linkClick:function(){var t=e.Main.xmlManager.get("common-configuration","config","pageCount");return function(n){return!(!e.Utils._assertInteger(n.page,"Page number must be an integer")||!e.Utils._assertInteger(n.index,"Link index must be an integer"))&&void(n.page>0&&n.page<=t&&n.index>=0&&e.Main.linksManagerNew.linkClick(n.page,{index:n.index}))}}(),welcomepageOpen:function(){var t=e.Main.startupManager.get("startup.welcomepage.url");return!!t&&(e.Main.trackerManager.trackPage({name:"welcomepage"}),new e.Class.LightboxManagerNew({animation:"none",header:"none",id:"startupPanel",url:e.Utils.resolveVariable(t)}),!0)},pdfDownload:function(){e.Main.pdfManager.download()},pdfPrint:function(){e.Main.pdfManager.print()},pdfGetUrl:function(t){return e.Param.pathRoot+"contents/pdfweb.pdf"},share:function(t){if("mail"===t.network||"email"===t.network){var n=e.Main.menuService.get("email_btn");return!!n&&(n.onload(),n.onclick(),!0)}return e.Main.shareManager.shareSocial(t.network,!0)},shareOpen:function(t){return e.Main.shareManager.open("home","share")},shareClose:function(t){return e.Main.shareManager.close()},searchOpen:function(){var t=e.Main.menuService.get("search_btn");return t.onload(),t.onclick(),!0},thumbnailOpen:function(){var t=e.Main.menuService.get("thumbnails_btn");return t.onload(),t.onclick(),!0},viewportGetScale:function(){return e.Starter.defaultViewportScale},menuButtonClick:function(t){return e.Main.menuManager.callButtonClick(t.name)},pageCurrent:function(){return e.Utils.getVisiblePages()}},window.addEventListener("message",function(i){if("string"==typeof i.data){var a=n(i.data),r=t(i.data);if(e.API.hasOwnProperty(a)){var o=e.API[a].call(i.source,r);i.source&&i.source.postMessage({method:a,arguments:r,result:o,queryId:r.queryId},i.origin)}}},!1)}(webpublicationNamespace),function(e){e.Class.CanvasViewerManager=function(){function t(e,t,n,i,a,r){if("undefined"==typeof r&&(r=5),"number"==typeof r)r={tl:r,tr:r,br:r,bl:r};else{var o={tl:0,tr:0,br:0,bl:0};for(var s in o)r[s]=r[s]||o[s]}e.beginPath(),e.moveTo(t+r.tl,n),e.lineTo(t+i-r.tr,n),e.quadraticCurveTo(t+i,n,t+i,n+r.tr),e.lineTo(t+i,n+a-r.br),e.quadraticCurveTo(t+i,n+a,t+i-r.br,n+a),e.lineTo(t+r.bl,n+a),e.quadraticCurveTo(t,n+a,t,n+a-r.bl),e.lineTo(t,n+r.tl),e.quadraticCurveTo(t,n,t+r.tl,n),e.closePath(),e.fill(),e.stroke()}function n(e,t){var n=e+P.deltaFrameInDOM;if("undefined"!=typeof g[n])if(g[n].backgroundColors=t,t!==!1)for(var i=t.length,a=((g[n].dom.width-b*i)/2,g[n].dom.width/i),r=null,o=null,s=0;s<i;s++)r=s*a,o=a,"transparent"!==t[s]?(g[n].ctx.fillStyle=t[s],g[n].ctx.fillRect(r,0,o,g[n].dom.height)):g[n].ctx.clearRect(r,0,o,g[n].dom.height);else g[n].ctx.fillStyle=P.pageBgColor,g[n].ctx.fillRect(0,0,g[n].dom.width,g[n].dom.height)}function i(e,t,n,i){var a=t+P.deltaFrameInDOM,r=1;0===t&&(P.pagesRetina&&(r*=P.maxZoom),i&&(r*=P.zoomScale)),g[a].ctx.drawImage(e,n*r,E*r,b*r,y*r)}function a(e,t){var n=t.coord.width,i=t.coord.height,a=t.width/t.height,r=n/i;a>r?i=n/a:n=i*a;var o;if("CANVAS"===e.tagName.toUpperCase())o=e.getContext("2d");else{var s=document.createElement("canvas");o=s.getContext("2d"),s.width=e.width,s.height=e.height,o.drawImage(e,0,0,s.width,s.height),s.pageNumber=e.pageNumber,e=s}var l=e.width/t.coord.container.width,u=e.height/t.coord.container.height;return o.globalAlpha=1,o.drawImage(t,S(t.coord.x*l),S(t.coord.y*u),S(n*l),S(i*u)),e}function r(n,i){var a;if("CANVAS"===n.tagName.toUpperCase())a=n.getContext("2d");else{var r=document.createElement("canvas");a=r.getContext("2d"),r.width=n.width,r.height=n.height,a.drawImage(n,0,0,r.width,r.height),r.pageNumber=n.pageNumber,n=r}var o=n.width/i.container.width,s=n.height/i.container.height;return a.globalAlpha=.2,a.fillStyle=e.Main.cssManager.getStyle("secondary","linkBackgroundColor"),a.strokeStyle=e.Main.cssManager.getStyle("secondary","linkColor"),"rect"===i.type?(a.fillRect(i.x*o,i.y*s,i.w*o,i.h*s),a.stroke()):"circle"===i.type?(a.beginPath(),a.ellipse(i.x*o,i.y*s,i.w*o/2,i.h*s/2,0,2*Math.PI,!0),a.closePath(),a.fill(),a.stroke()):"roundrect"===i.type?t(a,i.x*o,i.y*s,i.w*o,i.h*s,i.radius):"roundrectcomplex"===i.type&&t(a,i.x*o,i.y*s,i.w*o,i.h*s,{tl:i.tl_radius,tr:i.tr_radius,br:i.br_radius,bl:i.bl_radius}),n}function o(e){b=e.width,y=e.height,E=e.top,M=e.left}function s(){var t=1*P.zoomScale;P.pagesRetina&&(t*=P.maxZoom),g[P.deltaFrameInDOM].dom.width=d*t,g[P.deltaFrameInDOM].dom.height=f*t,g[P.deltaFrameInDOM].dom.style.width=d*t+"px",g[P.deltaFrameInDOM].dom.style.height=f*t+"px",n(0,g[P.deltaFrameInDOM].backgroundColors),e.Utils.scaleDom3d(g[P.deltaFrameInDOM].dom,1/t,0,0)}function l(){var t=1;P.pagesRetina&&(t*=P.maxZoom),g[P.deltaFrameInDOM].dom.width=d*t,g[P.deltaFrameInDOM].dom.height=f*t,g[P.deltaFrameInDOM].dom.style.width=d*t+"px",g[P.deltaFrameInDOM].dom.style.height=f*t+"px",n(0,g[P.deltaFrameInDOM].backgroundColors),e.Utils.scaleDom3d(g[P.deltaFrameInDOM].dom,1/t,0,0)}function u(){d=window.innerWidth,f=window.innerHeight;for(var t,n=g.length;n--;)t=g[n],P.verticalSlider?t.dom.style.top=n*f+"px":t.dom.style.left=n*d+"px",P.pagesRetina&&"webpub-viewer__canvas-0"===t.dom.id?(t.dom.width=d*P.maxZoom,t.dom.height=f*P.maxZoom,t.dom.style.width=d*P.maxZoom+"px",t.dom.style.height=f*P.maxZoom+"px",e.Utils.scaleDom3d(t.dom,1/P.maxZoom,0,0)):(t.dom.width=d,t.dom.height=f,t.dom.style.width=d+"px",t.dom.style.height=f+"px")}function c(){for(var e,t=-P.deltaFrameInDOM;t<=P.deltaFrameInDOM;)e=document.createElement("canvas"),e.className="webpub-viewer__canvas",e.id="webpub-viewer__canvas-"+t,P.container.appendChild(e),g[t+P.deltaFrameInDOM]={dom:e,ctx:e.getContext("2d")},t++}function p(e){d=window.innerWidth,f=window.innerHeight;var t;for(t in e)"undefined"!=typeof P[t]&&(P[t]=e[t]);P.zoomScale=Math.max(1,parseFloat(P.zoomScale,10)),P.maxZoom=Math.max(1,parseFloat(P.maxZoom,10));var n=1*P.zoomScale;P.pagesRetina&&(n*=P.maxZoom);var i=Math.max(d*n,f*n);i>4095&&(P.zoomScale=P.zoomScale/(i/4095)),v&&u()}function h(e){p(e||{}),c(),v=!0}var d=0,f=0,m=Math,g=[],v=!1,b=0,y=0,E=0,M=0,S=function(e,t){var n=t?m.pow(10,t):1;return m.round(e*n)/n},P={deltaFrameInDOM:1,pagesInFrame:1,pagesRetina:!0,pageShadowSize:0,maxZoom:2.5,zoomScale:1.5,pageBgColor:"rgb(240, 240, 240, 0)",useBgColorPerPage:!0,verticalSlider:!1,container:null};return{init:h,setConfig:p,clearDomFrame:n,addImageIntoPageDom:a,addLinkBoxIntoPageDom:r,visualizePageAtFrame:i,zoomIn:s,zoomOut:l,setPageSize:o,onResize:u}}}(webpublicationNamespace),function(e){function t(){n(this)}function n(e){NIApi.register("panels.summary",{toggle:function(t){e.toggle(!!t)}})}t.prototype.getPanelItems=function(t){if(t){var n=e.Main.xmlManager.get("common-ui","configs","chapters");return this.getChapters(n)}var i=e.Main.xmlManager.get("summary","xml");return this.getSummary(i.childNodes[0])},t.prototype.getChapters=function(t){return t.filter(function(e){return"tab"===e.type}).map(function(t){return{level:1,items:[],textContent:t.label,itemTextClass:"summary-content__chapter",gotopage:t.page,pageNumber:e.Utils.byOffsetIndex(t.page)}})},t.prototype.getSummary=function(e){return this.getSummaryNode(e,0).items},t.prototype.getSummaryNode=function(t,n){for(var i=t.childNodes,a={},r=i.length,o={level:n,items:[],textContent:"",itemTextClass:"",gotopage:null,pageNumber:null},s=0;s<r;s++)if(a=i[s],a&&a.nodeType!==a.TEXT_NODE)if("text"===a.localName){o.textContent=a.textContent,r>1&&(o.itemTextClass="summary-content__chapter");var l=t.getAttribute("p");l&&(o.gotopage=l,o.pageNumber=e.Utils.byOffsetIndex(l))}else"it"===a.localName&&o.items.push(this.getSummaryNode(a,n+1));return o},t.prototype.show=function(t){var n=function(t){if(t[0]){var n=t[0].querySelector("[data-section=content]");n.addEventListener(e.Param.eventClick,function(t){var n=e.Utils.getClosestByClass(t.target,"summary-content__link"),i=n.getAttribute("data-page");i&&(e.Main.trackerManager.trackEvent({name:"chapter",variables:{1:n.querySelector(".summary-content__chapter").innerText}}),e.API.pageLoad({number:i}),e.API.lightboxClose())})}},i=this.getPanelItems(t);new e.Class.LightboxManagerNew({id:"summary-manager",menuButton:!1,theme:"page",animation:"none",subtemplate:{url:e.Param.pathTemplate+"summary.html",params:{pageList:i}},onload:n}),e.Main.trackerManager.trackPage({name:"contents"})},t.prototype.toggle=function(e){var t=document.querySelector("#webpub-lightbox-summary-manager");return t?void NIApi.lightbox.closeAll():void this.show(e)},e.Class.ChapteringPanelManager=t}(webpublicationNamespace),function(e){e.Class.ConsentManager=function(){function t(e,t){return a().then(function(){return l(t),n(e)})}function n(t){var n=e.Main.templateManager.loadAppend(e.Param.pathTemplate+"consentBanner.html",t,{privacyUrl:y});n.then(h)}function i(e){return tarteaucitron.state[e]}function a(){return Promise.all([r("publication/mobile/libraries/tarteaucitron/tarteaucitron.js"),o("publication/mobile/libraries/tarteaucitron/css/custom.css")])}function r(e){return s("script","text/javascript","src",e)}function o(e){return s("link","text/css","href",e,"stylesheet")}function s(e,t,n,i,a){return new Promise(function(r,o){var s=document.createElement(e);s.onload=function(){r()},s.onerror=function(){console.error("Failed to load tarteaucitron script script",i),o()},a&&(s.rel=a),s.type=t,s[n]=i,document.body.appendChild(s)})}function l(e){u(e),d(),c(),p(),g=!0}function u(e){b=e.language,y=e.privacyUrl,E=e.services}function c(){b&&(window.tarteaucitronForceLanguage=b),tarteaucitron.init({privacyUrl:y,hashtag:"#tarteaucitron",cookieName:v,orientation:"bottom",showAlertSmall:!0,cookieslist:!1,showIcon:!1,adblocker:!1,AcceptAllCta:!0,DenyAllCta:!0,highPrivacy:!0,handleBrowserDNTRequest:!1,removeCredit:!0,moreInfoLink:!1,useExternalCss:!1,readmoreLink:y}),tarteaucitron.services.webpublicationStats={key:"webpublicationStats",type:"analytic",name:e.Main.xmlManager.get("locale","audience_measurement_service"),uri:"https://support.google.com/analytics/answer/6004245",needConsent:!0,cookies:["_ga","_gat","_gid","__utma","__utmb","__utmc","__utmt","__utmz","_pk_ref","_pk_cvar","_pk_id","_pk_ses","_pk_hsr","piwik_ignore","_pk_uid"],js:function(){setTimeout(function(){NIApi.stat.init()},500)}},tarteaucitron.services.webpublicationYoutube={key:"webpublicationYoutube",type:"video",name:"YouTube",uri:"https://policies.google.com/privacy",needConsent:!0,cookies:["VISITOR_INFO1_LIVE","YSC","PREF","GEUP"],js:function(){}},tarteaucitron.job=tarteaucitron.job||[],E.forEach(function(e){return tarteaucitron.job.push(e)})}function p(){tarteaucitron.load(),tarteaucitron.fallback(["tarteaucitronOpenPanel"],function(e){e.addEventListener("click",function(e){tarteaucitron.userInterface.openPanel(),e.preventDefault()},!1)},!0)}function h(e){M=e[0];var t=M.querySelector(".consentBanner-allowAll");t.addEventListener("click",function(){tarteaucitron.userInterface.respondAll(!0)});var n=M.querySelector(".consentBanner-personalize");n.addEventListener("click",function(){tarteaucitron.userInterface.openPanel()});var i=M.querySelector(".consentBanner-rejectAll");i.addEventListener("click",function(){tarteaucitron.userInterface.respondAll(!1)})}function d(){window.addEventListener("tac.close_alert",function(){f()}.bind(this)),window.addEventListener("tac.open_alert",function(){m()}.bind(this))}function f(){M.classList.add("closed")}function m(){M.classList.remove("closed")}var g=!1,v="tarteaucitron",b="",y="",E=[],M=null;return{init:t,getServiceConsent:i}}}(webpublicationNamespace),function(e){e.Class.EventEmul=function(){var t=function(){this.funcListStockCallBack={}},n=t.prototype;return n.callEvent=function(){var e=null;return function(t){if(!this.existEvent(t))return!1;var n=this.funcListStockCallBack[t+"CallBackList"];e=Array.prototype.slice.call(arguments,1);for(var i in n)n[i].apply(this,e);return!1}}(),n.unbindEvent=function(){var e=null;return function(t){if(e=t+"CallBackList",this.funcListStockCallBack[e]){for(var n in this.funcListStockCallBack[e])this.funcListStockCallBack[e][n]=null,delete this.funcListStockCallBack[e][n];delete this.funcListStockCallBack[e]}return!1}}(),n.unbindById=function(){return function(e,t){return methodCallbackName=e+"CallBackList",this.funcListStockCallBack[methodCallbackName]&&this.funcListStockCallBack[methodCallbackName][t]&&(this.funcListStockCallBack[methodCallbackName][t]=null,delete this.funcListStockCallBack[methodCallbackName][t]),!1}}(),n.existEvent=function(){return function(e){return!(!this.funcListStockCallBack[e+"CallBackList"]||!Object.keys(this.funcListStockCallBack[e+"CallBackList"]).length)}}(),n.listenEvent=function(){var t=null,n=null;return function(i,a){return t=i+"CallBackList",n=e.Utils.uniqueId(),this.funcListStockCallBack[t]||(this.funcListStockCallBack[t]={}),this.funcListStockCallBack[t][n]=a,n}}(),t}()}(webpublicationNamespace),function(e){e.Class.FavoriteStarsManager=function(){var t="favoriteStars.html",n={left:"left",right:"right"},i={left:"webpub-favoriteStars-left",right:"webpub-favoriteStars-right",favorited:"webpub-data-item--favorited",hide:"hide"},a=!1,r={left:null,right:null},o=function(t){if(void 0===t)return!1;e.Main.thumbnailListManager||(e.Main.thumbnailListManager=new e.Class.ThumbnailListManager);var n=e.Main.thumbnailListManager.getFavoritedThumbnails();return n.indexOf(t.toString())!==-1},s=function(e,t,n){t?e.classList.add(i.hide):e.classList.remove(i.hide),n?e.classList.add(i.favorited):e.classList.remove(i.favorited)},l=function(){NIApi.page.getVisiblePages().then(function(e){var t=e[0],n=o(t);s(r.left,!1,n);var i=e[1],a=void 0===i,l=o(i);s(r.right,a,l)})},u=function(t){r[t].classList.toggle(i.favorited),NIApi.page.getVisiblePages().then(function(i){var a=(t===n.left?i[0]:i[1]).toString();e.Main.thumbnailListManager.saveFavoritedThumbnails(a)})},c=function(t){for(var a=t.length;a--;)t[a].classList.contains(i.left)?r.left=t[a]:t[a].classList.contains(i.right)&&(r.right=t[a]);r.left.addEventListener(e.Param.eventStart,u.bind({},n.left)),r.right.addEventListener(e.Param.eventStart,u.bind({},n.right)),e.Main.pagesLoaderNew.addPageChangeCallback(l)},p=function(){return e.Utils.isFavoriteEnabled()},h=function(n){if(!a&&"undefined"!=typeof n){a=!0;var i=p();i&&e.Main.templateManager.loadAppend(e.Param.pathTemplate+t,n).then(c)}};return{addFavoriteStars:h}}}(webpublicationNamespace),function(e){function t(){e.Main.trackerManager.trackEvent({name:"fullScreenOn"})}function n(){this.config={isFullScreen:!1,hasFullScreen:a()},i(),this.fullScreenListeners()}function i(){if(!o)for(var e=0,t=u.length;e<t;e++)if("undefined"!=typeof document.documentElement[c[e]])return r=u[e],o=c[e],s=p[e],void(l=h[e])}function a(){return!(navigator.userAgent.toLowerCase().indexOf("samsung")>-1)&&!!(document.documentElement.requestFullscreen&&document.cancelFullScreen||document.documentElement.webkitRequestFullscreen&&document.webkitCancelFullScreen||document.documentElement.mozRequestFullScreen&&document.mozCancelFullScreen||document.documentElement.msRequestFullscreen&&document.msExitFullscreen||e.Main.urlManager.get("integration"))}var r,o,s,l,u=["fullscreenchange","MSFullscreenChange","mozfullscreenchange","webkitfullscreenchange"],c=["requestFullscreen","msRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen"],p=["cancelFullScreen","msCancelFullscreen","mozCancelFullScreen","webkitCancelFullScreen"],h=["fullScreen","msFullscreenElement","mozFullScreen","webkitIsFullScreen"];n.prototype.fullScreenListeners=function(){var e=this;void 0!==r&&document.addEventListener(r,function(t){e.config.isFullScreen=document[l]||!1},!1)},n.prototype.hasFullScreen=function(){return this.config.hasFullScreen},n.prototype.isFullScreen=function(){return this.config.isFullScreen},n.prototype.fullScreenOff=function(){this.config.isFullScreen&&(e.Main.urlManager.get("integration")?(parent.postMessage("wp.fullscreenOff","*"),this.config.isFullScreen=!1):s&&document[l]&&document[s]())},n.prototype.fullScreenOn=function(){this.config.hasFullScreen&&(e.Main.urlManager.get("integration")?(parent.postMessage("wp.fullscreenOn","*"),t(),this.config.isFullScreen=!0):o&&(0===o.indexOf("webkit")?document.documentElement[o](Element.ALLOW_KEYBOARD_INPUT):document.documentElement[o]()))},n.prototype.fullScreenToggle=function(){this.config.isFullScreen?this.fullScreenOff():this.fullScreenOn()},e.Class.FullScreenManager=n}(webpublicationNamespace),function(e){e.Class.HtmlViewerManager=function(){function t(e,t,n){var i=document.createElement("div");return i.style.width=e+"px",i.style.height=t+"px","undefined"==typeof n&&(n=5),"number"==typeof n?i.style.borderRadius=n+"px":"string"==typeof n?i.style.borderRadius=n:(i.style.borderTopLeftRadius=(n.tl||0)+"px",i.style.borderTopRightRadius=(n.tr||0)+"px",i.style.borderBottomRightRadius=(n.br||0)+"px",i.style.borderBottomLeftRadius=(n.bl||0)+"px"),i}function n(e,t){var n=v[e+P.deltaFrameInDOM];if("undefined"!=typeof n)if(n.innerHTML="",t===!1)n.style.background=P.pageBgColor;else if(1==t.length)n.style.background=t[0];else{var i=(parseInt(n.style.width)-t.length*y)/2,a="linear-gradient(90deg";for(var r in t){var o=r>0,s=r==t.length-1,l=r*y+(o?i:0),u=l+y+i+(s?i:0),c=t[r];a+=","+c+" "+l+"px",a+=","+c+" "+u+"px"}a+=")",n.style.background=a}}function i(t,n,i,a){!function(){var e=v[n+P.deltaFrameInDOM].querySelectorAll("[data-pageNumber='"+t.pageNumber+"']");if(e.length>0)for(var i=0;i<e.length;i++)e[i].parentNode.removeChild(e[i])}();var r=Math.round;e.Param.userAgent.browser.name===e.Param.userAgent.BROWSER.CHROME&&(r=Math.ceil),r=function(e){return e},t.style.left=r(i)+"px",t.style.top=Math.floor(M)+"px","IMG"===t.tagName.toUpperCase()?t.classList.add("webpub-viewer__page-img"):"DIV"===t.tagName.toUpperCase()&&t.classList.add("webpub-viewer__page-container");var o=1;if("svg"===t.tagName&&(o=e.Main.xmlManager.get("common-configuration","contents","swf","height")/parseFloat(t.getAttribute("height"),10)),0===n&&a){var s=e.Main.viewerManager.getScale()*P.zoomScale;e.Param.userAgent.browser.name===e.Param.userAgent.BROWSER.CHROME&&(s=1),t.style.width=r(o*y*s)+"px",t.style.height=r(E*s)+"px",t.classList.remove("not-zoomed"),e.Utils.scaleDom3d(t,1/s,1/s,0)}else t.style.width=r(o*y)+"px",t.style.height=r(E)+"px",t.classList.add("not-zoomed"),e.Utils.resetDomTransform(t);if("svg"===t.tagName){var l=t.querySelector("image");l.style.display="none";var u=document.createElement("img");u.src=l.getAttribute("xlink:href"),u.style.position="absolute",u.style.height=t.style.height,u.style.width=t.style.width,u.style.left=t.style.left,u.style.top=t.style.top,u.setAttribute("data-pageNumber",t.getAttribute("data-pageNumber")),v[n+P.deltaFrameInDOM].appendChild(u)}v[n+P.deltaFrameInDOM].appendChild(t)}function a(e){var t=v.filter(function(t){var n=Array.prototype.map.call(t.querySelectorAll("svg"),function(e){return parseInt(e.getAttribute("data-pageNumber"),10)});return JSON.stringify(n)===JSON.stringify(e)})[0];if("undefined"==typeof t)return!1;var n=v.filter(function(e){return"webpub-viewer__frame-0"===e.id})[0],i=t.id;t.id="webpub-viewer__frame-0",n.id=i,v=v.sort(function(e,t){var n=parseInt(e.id.replace("webpub-viewer__frame-",""),10),i=parseInt(t.id.replace("webpub-viewer__frame-",""),10);return n-i});for(var a=0;v[a]!==t;)t.parentNode.insertBefore(v[a],t),a++;for(a++;v[a];)v[0].parentNode.appendChild(v[a]),a++;return p(),!0}function r(e){var t=document.createElement("div");return t.classList.add("webpub-viewer__page-container"),t.style.width=e.style.width,t.style.height=e.style.height,t.style.left=e.style.left,t.style.top=e.style.top,t.pageNumber=e.pageNumber,e.style="",e.parentNode&&e.parentNode.removeChild(e),t.appendChild(e),t}function o(e,t){return"IMG"===e.tagName.toUpperCase()&&(e=r(e)),t.classList.add("webpub-viewer__page-link-image"),t.classList.add("webpub-viewer__link"+t.idLink),t.style.width=100*t.coord.width/t.coord.container.width+"%",t.style.height=100*t.coord.height/t.coord.container.height+"%",t.style.left=100*t.coord.x/t.coord.container.width+"%",t.style.top=100*t.coord.y/t.coord.container.height+"%",e.appendChild(t),e}function s(n,i){"IMG"===n.tagName.toUpperCase()&&(n=r(n)),n.classList.add("webpub-viewer__page-container");var a,o=parseInt(n.style.width),s=parseInt(n.style.height),l=o/i.container.width,u=s/i.container.height,c=i.w*l*100/o+"%",p=i.h*u*100/s+"%";return"rect"===i.type?a=t(c,p):"circle"===i.type?a=t(c,p,"50%"):"roundrect"===i.type?a=t(c,p,i.radius):"roundrectcomplex"===i.type&&(a=t(c,p,{tl:i.tl_radius,tr:i.tr_radius,br:i.br_radius,bl:i.bl_radius})),a.classList.add("webpub-viewer__page-link-dom"),a.classList.add("webpub-viewer__link"+i.id),a.style.border="1px solid "+e.Main.cssManager.getStyle("secondary","linkColor"),a.style.backgroundColor=e.Main.cssManager.getStyle("secondary","linkBackgroundColor"),a.style.left=i.x*l*100/o+"%",a.style.top=i.y*u*100/s+"%",n.appendChild(a),n}function l(e){y=e.width,E=e.height,M=e.top,S=e.left}function u(){}function c(){}function p(){m=window.innerWidth,g=window.innerHeight;for(var e,t=v.length;t--;)e=v[t],P.verticalSlider?e.style.top=t*g+"px":e.style.left=t*m+"px",e.style.width=m+"px",e.style.height=g+"px"}function h(){for(var e,t=-P.deltaFrameInDOM;t<=P.deltaFrameInDOM;)e=document.createElement("div"),e.className="webpub-viewer__frame-container",e.id="webpub-viewer__frame-"+t,P.container.appendChild(e),v[t+P.deltaFrameInDOM]=e,t++}function d(e){var t;for(t in e)"undefined"!=typeof P[t]&&(P[t]=e[t]);b&&p()}function f(e){d(e||{}),h(),b=!0}var m=0,g=0,v=(Math,[]),b=!1,y=0,E=0,M=0,S=0,P={deltaFrameInDOM:1,pagesInFrame:1,pagesRetina:!0,pageShadowSize:0,maxZoom:2.5,zoomScale:2,pageBgColor:"rgb(240, 240, 240, 0)",useBgColorPerPage:!0,verticalSlider:!1,container:null};return{init:f,setConfig:d,clearDomFrame:n,addImageIntoPageDom:o,addLinkBoxIntoPageDom:s,visualizePageAtFrame:i,zoomIn:u,zoomOut:c,setPageSize:l,onResize:p,setActiveFromPages:a}}}(webpublicationNamespace),function(e){function t(t,n){var i=t.querySelectorAll("[data-action='close']");i=Array.prototype.slice.call(i),t.hasAttribute("data-action")&&"close"===t.getAttribute("data-action")&&i.push(t);for(var a=0;a<i.length;a++)i[a].addEventListener(e.Param.eventClick,v.close.bind(null,n))}function n(t){var n=t.querySelectorAll("[data-action='menu']");n=Array.prototype.slice.call(n),t.hasAttribute("data-action")&&"menu"===t.getAttribute("data-action")&&n.push(t);for(var i=0;i<n.length;i++)n[i].addEventListener(e.Param.eventClick,NIApi.menu.toggle.bind(null))}function i(t){var n=t.querySelectorAll("[data-section='headerIcon']");n=Array.prototype.slice.call(n),t.hasAttribute("data-action")&&n.push(t);for(var i=0;i<n.length;i++)n[i].addEventListener(e.Param.eventClick,function(t){e.API.menuButtonClick({name:t})}.bind({},n[i].getAttribute("data-action")))}function a(t,n){if(this.params.disableOverlay!==!0){var i=t.querySelectorAll("[data-action='overlay']");i=Array.prototype.slice.call(i),t.hasAttribute("data-action")&&"overlay"===t.getAttribute("data-action")&&i.push(t);for(var a=0;a<i.length;a++)i[a].addEventListener(e.Param.eventClick,o.bind(i[a],n))}}function r(e){var t=e.querySelectorAll("[data-section='header']");t=Array.prototype.slice.call(t),e.hasAttribute("data-section")&&"header"===e.getAttribute("data-section")&&t.push(e);for(var n=0;n<t.length;n++)"none"===this.params.header?t[n].style.display="none":"invisible"===this.params.header&&(t[n].style.display="none")}function o(e,t){t.target===this&&v.close.call(null,e)}function s(e){for(var t,n=0;n<this.tpl.length;n++){var i=this.tpl[n].querySelector("[data-section='"+e+"']");i&&(t=i)}return t}function l(e){var t=e.querySelectorAll("iframe");Array.prototype.slice.call(t).forEach(function(e){"complete"===e.readyState?(u.call(e),c.call(e)):e.addEventListener("load",function(e){u.call(e),c.call(e)})})}function u(){e.Param.userAgent.browser.name===e.Param.userAgent.BROWSER.SAFARI&&this.parentNode&&(this.parentNode.style.display="none",this.parentNode.offsetHeight,this.parentNode.style.display="block")}function c(){try{var e=this.contentWindow.document;e.addEventListener("touchmove",function(e){1!==e.scale&&e.preventDefault()},!1);var t=0;e.addEventListener("touchend",function(e){var n=Date.now();n-t<=300&&e.preventDefault(),t=n},!0)}catch(n){}}function p(e){}function h(){e.Main.urlManager["delete"]("lightbox")}function d(e){this.parentNode.removeChild(this),e.params.onclose&&e.params.onclose()}function f(){return g.call(this),Promise.resolve()}function m(){this.params.theme&&void 0!==P[this.params.theme]&&(this.params.theme=P[this.params.theme]),b[this.params.id]&&(b[this.params.id].params.animation="none",this.close(this.params.id),this.params.animation="none"),b[this.params.id]=this;var o=this.params.target||e.Param.viewMain,s=[];this.params.headerMenu&&this.params.headerMenu.forEach(function(t){s.push(e.Main.menuService.get(t))});var u={id:this.params.id,height:this.params.height,width:this.params.width,title:this.params.title,priority:this.params.priority,animation:this.params.animation,header:this.params.header,headerSpacer:this.params.headerSpacer,headerMenu:s||!1,menuButton:this.params.menuButton,closeButton:this.params.closeButton,position:this.params.position,originalParams:this.params.originalParams};this.params.url&&(u.url=this.params.url,u.url.indexOf(".pdf")===-1&&(u.isNotPdfUrl=!0));var c=e.Class.LightboxManagerNew.getTrackingParam(this.params);if(c){e.Main.trackerManager.trackEvent({name:"lightboxOpen",variables:{1:c}});var p=new CustomEvent("webpub-tracking-openPopup",{detail:{title:c}});window.dispatchEvent(p)}this.params.activeElement&&e.Main.menuManager.setActive(this.params.activeElement),e.Utils.removeToast();var h=this.params.originalParams&&this.params.originalParams.appearance?this.params.originalParams.appearance:void 0;if(u.componentConfig=h,void 0!==h){var d=this.params.originalParams.appearance&&this.params.originalParams.appearance.customizationEnable===!0,m=h.customEnabled===!0&&void 0!==h.style;if(!d&&m){u.width=h.width,u.height=h.height;var g=h.style.toLowerCase();g="fullscreen"===g?"theater":g,this.params.theme=P[g]}}var v;S.indexOf(this.params.theme)>-1?v=e.Utils.resolveVariable("${root}mobile/template/lightbox-"+this.params.theme+".html"):(v=e.Utils.resolveVariable("${template}html/template/lightbox-"+this.params.theme+".html"),e.require(["../../${template}html/template/lightbox-"+this.params.theme+".css"])),e.Main.templateManager.loadAppend(v,o,u).then(function(o){setTimeout(function(){this.params.closeImmediately===!0&&this.close(this.params.id)}.bind(this),200),this.tpl=o,"undefined"!=typeof this.params.linkType&&this.tpl[0].classList.add("webpub-lightbox-contains-"+this.params.linkType);for(var s,u=0;u<o.length;u++){r.call(this,o[u]),n.call(this,o[u]),i.call(this,o[u]),t.call(this,o[u],this.params.id),a.call(this,o[u],this.params.id),l.call(this,o[u]);var c=o[u].querySelector("[data-section='content']");c&&(s=c),s&&this.params.html&&this.setHTML(this.params.html),this.params.DOMcloseButton&&this.setHTML(this.params.DOMcloseButton.innerHTML,"right")}return this.params.subtemplate?s?e.Main.templateManager.load(this.params.subtemplate.url,s,this.params.subtemplate.params).then(e.Utils.promiseTimeout.bind({},16)).then(f.bind(this)):void console.error('You need one data-section="content" in your lightbox template'):e.Utils.promiseTimeout(16).then(f.bind(this))}.bind(this))}function g(){e.Param.viewBody.setAttribute("data-lightbox",this.params.id),window.setTimeout(function(){var t=s.call(this,"content");"theater"===this.params.theme&&t&&"100%"===t.style.height&&e.Param.userAgent.browser.name===e.Param.userAgent.BROWSER.SAFARI&&(t.style.height="calc(100% - 108px)"),e.Main.menuManager.hideMenu();for(var n=0;n<this.tpl.length;n++)this.tpl[n].classList.add("webpub--active");var i={};this.params.subtemplate&&this.params.subtemplate.params&&(i=this.params.subtemplate.params),this.params.onload&&this.params.onload.call(this,this.tpl,{rightSection:s.call(this,"right")},i)}.bind(this),16)}function v(e){this.params=e||{},this.resolveConfigs(this.params),m.call(this)}var b={},y=["visible","none","invisible"],E=["normal","high"],M=["none","slideup","slidedown","slideleft","slideright","fade","pop","fadeslideup","fadeslidedown","fadeslideleft","fadeslideright","fadepop"],S=["default","theater","modale","page","panel"],P={"default":S[0],DEFAULT:S[0],theater:S[1],THEATER:S[1],fullscreen:S[1],FULLSCREEN:S[1],modale:S[2],MODALE:S[2],modal:S[2],MODAL:S[2],page:S[3],PAGE:S[3],
panel:S[4],PANEL:S[4]};v.getTrackingParam=function(e){if(e.originalParams&&e.originalParams.assetDriveItem&&e.originalParams.assetDriveItem.globalId&&e.originalParams.assetDriveItem.label)return e.originalParams.assetDriveItem.globalId+"-"+e.originalParams.assetDriveItem.label;if(e.originalParams&&e.originalParams.param&&e.originalParams.label){var t=e.originalParams.param.match(/\d+/g),n=t?t[0]:"0",i=e.originalParams.label||"";return n+"-"+i}return e.url},v.prototype.resolveConfigs=function(t){var n=e.Main.viewerService.getPopup("default_mode");if(this.params.theme=this.params.theme||n||"default",void 0!==P[this.params.theme]&&(this.params.theme=P[this.params.theme]),this.params.position=this.params.position||"bottom",this.params.priority=this.params.priority||"normal",this.params.header=this.params.header||"visible",this.params.headerSpacer=this.params.headerSpacer!==!1,this.params.menuButton=this.params.menuButton||!1,this.params.id=this.params.id||btoa(Math.random()).replace(/=/g,""),this.params.closeImmediately=this.params.closeImmediately||!1,"undefined"==typeof this.params.closeButton&&(this.params.closeButton=!0),"string"!=typeof this.params.closeButton&&"boolean"!=typeof this.params.closeButton&&(this.params.DOMcloseButton=this.params.closeButton,this.params.closeButton=""),this.params.url&&(this.params.url=e.Utils.resolveVariable(this.params.url)),this.params.height&&this.params.height.match(/^[0-9.]+$/)&&(this.params.height+="px"),this.params.width&&this.params.width.match(/^[0-9.]+$/)&&(this.params.width+="px"),"default"===this.params.theme?this.params.animation=this.params.animation||"slideup":"theater"===this.params.theme?this.params.animation=this.params.animation||"fadepop":"modale"===this.params.theme?this.params.animation=this.params.animation||"fadepop":"page"===this.params.theme?this.params.animation=this.params.animation||"fadepop":"panel"===this.params.theme?this.params.animation=this.params.animation||"fadeslideup":this.params.animation=this.params.animation||"fade",["theater","modale","panel"].indexOf(this.params.theme)>-1&&this.params.animation.indexOf("fade")===-1){var i="fade"+this.params.animation;M.indexOf(i)>-1&&(this.params.animation="fade"+this.params.animation)}"false"===this.params.header&&(this.params.header="none"),e.Utils._assertString(this.params.theme,"The theme key must be string"),e.Utils._assertBoolean(this.params.menuButton,"The menuButton key must be boolean"),e.Utils._assertBoolean(this.params.headerSpacer,"The headerSpacer key must be boolean"),e.Utils._assertOneOf(this.params.animation,M,"The animation key must be one of: "+M.join(", ")),e.Utils._assertOneOf(this.params.header,y,"The header key must be one of: "+y.join(", ")),e.Utils._assertOneOf(this.params.priority,E,"The priority key must be one of: "+E.join(", ")),p.call(this,this.params),e.Utils._assertString(this.params.id,"You need a lightbox ID")},v.prototype.close=function(t){if("undefined"!=typeof b[t]){var n=e.Class.LightboxManagerNew.getTrackingParam(b[t].params);n&&e.Main.trackerManager.trackEvent({name:"lightboxClose",variables:{1:n}}),h(),document.activeElement&&document.activeElement.blur&&document.activeElement.blur();for(var i="none"===b[t].params.animation?0:500,a=0;a<b[t].tpl.length;a++)b[t].tpl[a].classList.remove("webpub--active"),window.setTimeout(d.bind(b[t].tpl[a],b[t]),i);e.Param.viewBody.removeAttribute("data-lightbox"),delete b[t]}},v.prototype.closeAll=function(e){var t=e?e.except:[];for(var n in b)t.indexOf(n)===-1&&v.close(n)},v.prototype.get=function(e){return b[e]},v.prototype.getLength=function(){return Object.keys(b).length},v.prototype.exists=function(e){return b.hasOwnProperty(e)},v.prototype.setSubtemplate=function(t,n){"undefined"==typeof n&&(n="content");var i=s.call(this,n);if(i){this.params.onload=t.onload,this.params.subtemplate.params=t;var a=e.Main.templateManager.load(this.params.subtemplate.url,i,this.params.subtemplate.params);return t.onload&&(a=a.then(e.Utils.promiseTimeout.bind({},16)).then(f.bind(this))),a}console.error('You need one data-section="content" in your lightbox template')},v.prototype.setHTML=function(e,t){"undefined"==typeof t&&(t="content");var n=s.call(this,t);return n&&("string"==typeof e?n.innerHTML=e:null!==e&&(n.innerHTML="",n.appendChild(e))),Promise.resolve()},v.prototype.setTitle=function(e){var t=s.call(this,"title");t&&("string"==typeof e&&(e=document.createTextNode(e)),t.innerHTML="",t.appendChild(e))},v.prototype.setUrl=function(e){var t=s.call(this,"iframe");t&&(t.src=e)},v.close=v.prototype.close,v.closeAll=v.prototype.closeAll,v.get=v.prototype.get,v.getLength=v.prototype.getLength,v.overridedAppearance=function(t,n){try{var i=e.Main.viewerService.getPopup("default_mode");if((void 0===n.appearance||n.appearance.customizationEnable===!1&&i)&&(t.theme=i),n.height||n.width){var a=parseFloat(n.height),r=parseFloat(n.width);a||(delete t.height,delete n.height),r||(delete t.width,delete n.width)}var o=new Promise(function(i,a){var r=t.originalParams.param,o="/"===r[r.length-1],s=void 0!==t.originalParams.appearance&&t.originalParams.appearance.customizationEnable;if(s===!0||!o)return void i();var l=r+"configs.json";NIApi.common.resolveValues(l).then(function(r){e.Utils.promiseXHR("GET",r).then(function(e){var r=JSON.parse(e.responseText);if(r.appearance.customEnabled===!1||r.appearance.customEnabled===!1)return void a();var o=void 0,s=void 0;t.originalParams=t.originalParams||{},t.originalParams.appearance=t.originalParams.appearance||{};for(var l in t.originalParams.appearance)void 0!==r.appearance[l]&&"customizationEnable"!==l&&(t.originalParams.appearance[l]=r.appearance[l]);for(var u in r.appearance)void 0!==r.appearance[u]&&"customizationEnable"!==u&&(t.originalParams.appearance[u]=r.appearance[u]);t.theme=t.originalParams.appearance.style.toLowerCase(),o=t.originalParams.appearance.width,s=t.originalParams.appearance.height,"0"==o&&(o=void 0),"0"==s&&(s=void 0),n.width=t.width=o,n.height=t.height=s,i()})["catch"](function(e){a(e)})})});return o}catch(s){return Promise.reject(s)}},v.handleSpecialFormat=function(t,n){var i=e.Utils.resolveVariable(t.param);if(i){var a=function(e){var t=e.toLowerCase().split(".");return t[t.length-1]};if(n=n||{},n.id="link-"+t.id+"-"+t.type,n.height=n.height||t.height,n.width=n.width||t.width,t.onclose&&(n.onclose=t.onclose),t.theme&&!n.theme&&(n.theme=t.theme),void 0!==P[t.theme]&&(t.theme=P[t.theme]),void 0!==P[n.theme]&&(n.theme=P[n.theme]),t.animation&&(n.animation=t.animation),["jpeg","jpg","png","gif","webp"].indexOf(a(i))!==-1)n.html="<img class='webpub-link-image' src='"+i+"'></div>",n.linkType="image";else if(["mp4","mpeg","mpg"].indexOf(a(i))!==-1)n.html="<iframe class='webpub-link-video' src='publication/mobile/components/video_player/index.html?controls&amp;autoplay&amp;url="+encodeURIComponent(i)+"' allowfullscreen></video>",n.linkType="video";else if(["pdf"].indexOf(a(i))!==-1&&e.Param.userAgent.os.name===e.Param.userAgent.OS.IOS){window.open(i);setTimeout(function(){NIApi.lightbox.closeAll(),n.closeImmediately=!0},100)}else i.indexOf("http")===-1&&"/"===i[i.length-1]&&(i+="index.html"),n.url=i,n.header="false"===t.header?"none":"visible";e.Utils.promiseXHR("GET","publication/contents/templates/styles.css").then(this.applyDefaultModalSizeIfNeeded(n)).then(function(t){new e.Class.LightboxManagerNew(t)})["catch"](function(){new e.Class.LightboxManagerNew(n)})}return n},v.applyDefaultModalSizeIfNeeded=function(e){return function(t){if("modale"===e.theme&&(void 0===e.height||void 0===e.width)){var n=t.responseText,i=/modalWidth:(.*);/gim,a=/modalHeight:(.*);/gim,r=i.exec(n),o=a.exec(n);void 0===e.width&&null===r&&(e.width="800px"),void 0===e.height&&null===o&&(e.height="800px")}return e}},e.Class.LightboxManagerNew=v,NIApi.register("lightbox.open",function(t,n){if(null===t)return Promise.resolve(new e.Class.LightboxManagerNew(n));var i={},a=arguments;"url"!==t&&(a=n.split("/"),i.url=t);for(var r=0;r<a.length;r+=2)i[a[r]]=a[r+1];return Promise.resolve(new e.Class.LightboxManagerNew(i))}),NIApi.register("lightbox.openPopup",function(t,n){var i={};if(i.originalParams=n,null===t){var a=new Promise(function(t,a){e.Class.LightboxManagerNew.overridedAppearance(i,n).then(function(){t(e.Class.LightboxManagerNew.handleSpecialFormat(n,i))})["catch"](function(a){t(e.Class.LightboxManagerNew.handleSpecialFormat(n,i))})});return a}var r=arguments;"url"!==t&&(r=n.split("/"),i.url=t);for(var o=0;o<r.length;o+=2)i[r[o]]=r[o+1];return Promise.resolve(new e.Class.LightboxManagerNew(i))}),NIApi.register("lightbox.closeAll",function(){return Promise.resolve(new e.Class.LightboxManagerNew.closeAll)}),NIApi.register("lightbox.close",function(t){return Promise.resolve(new e.Class.LightboxManagerNew.close(t))}),NIApi.register("lightbox.getOpenList",function(e){return Promise.resolve(Object.keys(b))}),NIApi.register("lightbox.setHeaderMenu",function(t){e.Main.thumbnailListManager||(e.Main.thumbnailListManager=new e.Class.ThumbnailListManager),e.Main.thumbnailListManager.headerMenu=t.split(",")})}(webpublicationNamespace),function(e){e.Class.LinksManagerNew=function(){function t(t){e.Main.urlManager.contains("isApp")&&e.Param.userAgent.os.name===e.Param.userAgent.OS.IOS&&t.addEventListener(e.Param.eventClick,function(){e.Utils.toast({text:e.Main.xmlManager.get("locale","loading"),duration:3e3})})}function n(e){return"swiffy"===e.type}function i(e){return e!==!1}function a(e){return("undefined"==typeof e.useract||0===e.useract.length||e.useract[0].type in le)&&e.type in he}function r(e){return J.indexOf(e.type)===-1||!!e.param}function o(e){for(var t=e.length;t--;)if("video"===e[t].type&&e[t].content[0].autoplay!==!1)return e[t].index;return!1}function s(t){var a=e.Main.pageManager.getLinks(t);if(a.length){var r=a.filter(n);return!r.length||new Promise(function(n){if(H[t])n(!0);else{for(var a,o=[],s=r.length;s--;)a=r[s].content[0],a.id=r[s].index,o.push(e.Utils.GetSwiffyPromise(a));Promise.all(o).then(function(e){H[t]=e.filter(i),e=void 0,n(!0)})}})}return!1}function l(t,n){for(var i=e.Main.pageManager.getLinks(t),a=n.index.toString(),r=i.length;r--;)if(i[r].index===a){c(i[r].useract);break}}function u(t,n){e.Main.trackerManager.trackEvent({name:"link",variables:{1:t.type,2:t.param}}),n&&e.Class.LightboxManagerNew.close(n),le.hasOwnProperty(t.type)&&le[t.type](t)}function c(t,n){if(t.length){if(n&&n.preventDefault(),t.length>1){var i={id:"userActPopup"},a=document.createElement("div"),r=document.createElement("div");r.classList.add("popup-title"),r.innerText=e.Utils.prodTools.getWordLangueByIndex("multilinks_title"),a.appendChild(r);for(var o=t.length;o--;){var s=document.createElement("div");s.classList.add("search-result");var l=document.createElement("div");l.classList.add("search-result-content"),t[o].textContent||t[o].textField?l.innerText=t[o].textContent||t[o].textField:l.innerText=e.Main.xmlManager.get("locale","multilink_"+t[o].type+"_label")+" "+e.Utils.resolveVariable(t[o].param),l.addEventListener(e.Param.eventClick,u.bind({},t[o],i.id)),s.appendChild(l),a.appendChild(s)}i.html=a,new e.Class.LightboxManagerNew(i)}else u(t[0],!1);return!0}return!1}function p(t,n,i,r){var o=e.Main.pageManager.getLinks(t).filter(a);if(o.length){for(var s=[],l=[],u=U.round(j.width*n/Y),c=U.round(j.height*i/Z),p=ne.linkClickMargin,h=o.length;h--;)for(var d=o[h].content.length;d--;){var f=o[h].content[d];u>=f.x&&u<=f.x+f.width&&c>=f.y&&c<=f.y+f.height&&(s=s.concat(o[h].useract)),u>=f.x-p&&u<=f.x+f.width+p&&c>=f.y-p&&c<=f.y+f.height+p&&(l=l.concat(o[h].useract))}return 0===s.length&&(s=l),s}return[]}function h(e,t,n,i){return"VIDEO"===i.target.tagName.toUpperCase()||p(e,t,n,i).length>0}function d(t,n,i,a){if("VIDEO"!==a.target.tagName.toUpperCase()){clearTimeout(e.Main.linksManagerNew._mouseIdleTimer),e.Main.tooltipManager.hide(a);var o=p(t,n,i,a);ne.linksBoxWithDom&&(o=o.filter(r)),c(o,a)}}function f(t){var n=e.Utils.resolveVariable(t.param);return n.indexOf("http")===-1&&"/"===n[n.length-1]&&(n+="index.html"),n}function m(t){var n=e.Utils.resolveVariable(t.param);return 0!==n.indexOf("#")&&(n="#"+n),e.Main.xmlManager.get("common-configuration","contents","gallery","path")+n}function g(t,n,i,a,r){if(i=i||B.getDeltaFrameForPage(n),r=r||document.getElementById("webpub-viewer__links-page-container-"+n))for(var o=0;o<t.content.length;o++)if("swiffy"===t.type){if(H[n]&&H[n].length)for(var s=H[n].length;s--;){var l=H[n][s];l.classList.contains("webpub-viewer__link-"+t.index)&&r.appendChild(he.swiffy(l,!1))}}else{var u={};u.pageNumber=n,"video"===t.type&&(u.play=ne.autoPlayVideo===!0&&0===i&&t.index===a&&t.content[o].video.autoplay!==!1),"iframe"===t.type&&(u.visible=0===i),t.useract[0]&&("drive"===t.useract[0].type&&(u.url=m(t.useract[0])),"url"!==t.useract[0].type&&"gallery"!==t.useract[0].type||(u.url=f(t.useract[0])));var c="";if(t.useract.length>0&&(c=t.useract[0].textField,""===c&&(c=e.Main.xmlManager.get("locale","tooltip_"+t.useract[0].type),"gotoPage"===t.useract[0].type))){var p=parseInt(e.Utils.resolveVariable(t.useract[0].param),10)-e.Main.xmlManager.get("common-configuration","config","shift");c+=" "+p}var h=he[t.type](t.index,t.content[o],!!t.useract.length,u,c);h!==!1&&r.appendChild(h)}}function v(){this.classList.add("webpub-viewer__links-page-container-reveal--taped")}function b(){this.classList.remove("webpub-viewer__links-page-container-reveal--taped"),setTimeout(v.bind(this),16)}function y(t,n){var i=e.Main.pageManager.getLinks(t).filter(a);if(i&&i.length&&Q.indexOf(t)===-1){var r=o(i),s=document.createDocumentFragment();Q.push(t);for(var l=0;l<i.length;l++)ne.linksBoxWithDom===!1&&$.indexOf(i[l].type)>-1&&(i[l].type=i[l].type+"_domManager"),g(i[l],t,n,r,s);if(s.childNodes.length){var u=document.createElement("div");u.id="webpub-viewer__links-page-container-"+t,ne.linkBoxAspect===e.Class.LinksManagerNew.linksBehaviors.blink&&0===n?u.className="webpub-viewer__links-page-container-active":ne.linkBoxAspect===e.Class.LinksManagerNew.linksBehaviors["static"]?u.className="webpub-viewer__links-page-container-show":ne.linkBoxAspect===e.Class.LinksManagerNew.linksBehaviors.revealOnTap&&(u.className="webpub-viewer__links-page-container-reveal",u.addEventListener(e.Param.eventClick,b.bind(u))),u.appendChild(s),s=i=void 0,u.style.left=B.getFrameCoordX(n)+B.getPageCoordX(t)+"px",u.style.top=B.getFrameCoordY(n)+X+"px",u.style.width=j.width+"px",u.style.height=j.height+"px",u.style.zIndex=t,e.Utils.styleTransformOrigin(u,"0 0"),e.Utils.styleTransform(u,"scale3d("+q+", "+W+", 1)"),z.appendChild(u),H[t]&&H[t].length&&(0===n||ne.autoPlayAnim)&&(P(t,!1),setTimeout(function(){P(t,!0)},100))}}}function E(e){for(var t=document.querySelectorAll("#webpub-viewer__links-page-container-"+e+" .animation_for_swiffy"),n=[],i=t.length;i--;)n.push(t[i].id);return t=null,n}function M(e,t){if(Q.indexOf(e)>-1){var n=document.getElementById("webpub-viewer__links-page-container-"+e);Q.splice(Q.indexOf(e),1);for(var i=E(e),a=i.length;a--;)document.getElementById(i[a]).swiffyElement.swiffyObject.destroy();z.removeChild(n),ee.appendChild(n),n.innerHTML="",n=void 0,ee.innerHTML=""}t&&(H[e]=void 0,delete H[e])}function S(e,t){var n=document.querySelector("#webpub-viewer__links-page-container-"+e+" .webpub-viewer__link-"+t);n&&(n.classList.contains("animation_for_swiffy")&&document.getElementById(n.id).swiffyElement.swiffyObject.destroy(),n.parentNode.removeChild(n))}function P(e,t){var n,i=E(e);if(t)for(n=i.length;n--;)document.getElementById(i[n]).swiffyElement.swiffyObject.start();else{for(n=i.length;n--;){var a=document.getElementById(i[n]);a.swiffyElement.swiffyObject.destroy(),a.parentNode.removeChild(a),H[e]=void 0,delete H[e]}var r=document.getElementById("webpub-viewer__links-page-container-"+e),o=s(e);o.then&&o.then(function(){if(H[e]&&H[e].length)for(n=H[e].length;n--;){var t=H[e][n];r.appendChild(he.swiffy(t,0===B.getDeltaFrameForPage(e)||t.autoPlay||ne.autoPlayAnim))}})}}function w(t){var n=this||t.target,i=e.Param.lastVideoPlayed,a=parseInt(n.getAttribute("data-index"),10),r=parseInt(n.getAttribute("data-page"),10),o=i?parseInt(i.getAttribute("data-index"),10):a,s=i?parseInt(i.getAttribute("data-page"),10):r,l=B.getFrameOfPage(r),u=B.getFrameOfPage(s);l!==u&&(o=a,s=r),"true"===n.getAttribute("data-has-autoplay")&&a<=o&&r<=s&&(n.play(),i&&i.pause(),e.Param.lastVideoPlayed=n)}function _(e,t){var n=document.querySelectorAll("#webpub-viewer__links-page-container-"+e+" .webpub-viewer__link-iframe"),i=n.length;if(t)for(;i--;)n[i].src=n[i].getAttribute("data-src");else for(;i--;)n[i].src="";n=void 0}function T(t){for(var n=document.querySelectorAll("#webpub-viewer__links-container > div"),i=n.length;i--;){var a=n[i],r=parseInt(a.id.substring(a.id.lastIndexOf("-")+1,a.id.length)),o=B.getFrameOfPage(r),s=o-t;U.abs(s)>ne.deltaFrameInDOM?M(r,!0):(0!==s&&(P(r,!1),_(r,!1),ne.linkBoxAspect===e.Class.LinksManagerNew.linksBehaviors.blink?a.classList.remove("webpub-viewer__links-page-container-active"):ne.linkBoxAspect===e.Class.LinksManagerNew.linksBehaviors["static"]&&a.classList.remove("webpub-viewer__links-page-container-show")),a.style.left=B.getFrameCoordX(s)+B.getPageCoordX(r)+"px",a.style.top=B.getFrameCoordY(s)+X+"px",0===s&&(P(r,!0),_(r,!0),ne.linkBoxAspect===e.Class.LinksManagerNew.linksBehaviors.blink?(a.classList.remove("webpub-viewer__links-page-container-active"),a.classList.add("webpub-viewer__links-page-container-active")):ne.linkBoxAspect===e.Class.LinksManagerNew.linksBehaviors["static"]&&a.classList.add("webpub-viewer__links-page-container-show")))}}function A(e){Y=e.width,Z=e.height,K=e.left,X=e.top,L()}function C(e,t,n){var i=z.querySelectorAll(".webpub-viewer__link-iframe");i=Array.prototype.filter.call(i,function(e){return null!==e.contentWindow&&void 0!==e.contentWindow});var a=0;if("all"===e)for(a=i.length;a--;)i[a].contentWindow.postMessage(t,"*");else if("others"===e)for(a=i.length;a--;)i[a].contentWindow!==n&&i[a].contentWindow.postMessage(t,"*")}function L(){if(j.width=e.Main.xmlManager.get("common-configuration","contents","links","width")||e.Main.xmlManager.get("common-configuration","contents","swf","width"),j.height=e.Main.xmlManager.get("common-configuration","contents","links","height")||e.Main.xmlManager.get("common-configuration","contents","swf","height"),Y>0){q=Y/j.width,W=Z/j.height;for(var t,n=z.childNodes,i=n.length;i--;){t=n[i];var a=t.id,r=parseInt(a.match(/[0-9]+$/)[0],10),o=B.getDeltaFrameForPage(r);Math.abs(o)>ne.deltaFrameInDOM&&(e.Utils.styleTransform(t,"scale3d("+q+", "+W+", 1)"),M(r,!0)),t.style.left=B.getFrameCoordX(o)+B.getPageCoordX(r)+"px",t.style.top=B.getFrameCoordY(o)+X+"px",e.Utils.styleTransform(t,"scale3d("+q+", "+W+", 1)")}re()}}function x(){D=window.innerWidth,R=window.innerHeight}function k(){z=document.createElement("div"),z.id="webpub-viewer__links-container",ne.container.appendChild(z),ee.classList.add("display-none"),te.classList.add("display-none"),document.body.appendChild(te);var e="div.webpub-viewer__links-page-container-active > .webpub-viewer__link-box { ";e+="-webkit-animation-duration: "+ne.linkBlinkDuration/1e3+"s;",e+="animation-duration: "+ne.linkBlinkDuration/1e3+"s;",e+="}";var t=document.createElement("style");t.type="text/css",t.innerText=e,document.head.appendChild(t)}function O(e){var t;for(t in e)"undefined"!=typeof ne[t]&&(ne[t]=e[t])}function I(){var t=e.Main.pageManager.getCurrent(),n=document.getElementById("webpub-viewer__links-page-container-"+t);if(null!==n)for(var i=n.querySelectorAll("video"),a=0,r=i.length;a<r;a++)i[a].pause()}function N(e){O(e||{}),k(),V=!0}var D=window.innerWidth,R=window.innerHeight,U=Math,F=document.head||document.getElementsByTagName("head")[0],B=e.Main.viewerManager,V=!1,G=!1,H={},z={},j={},q=0,W=0,Y=0,Z=0,X=0,K=0,Q=[],J=["url","drive","gallery"],$=["roundrectcomplex","roundrect","rect","circle"],ee=document.createElement("div"),te=document.createElement("iframe"),ne={pageOnFirstFrame:1,pagesInFrame:1,linksRetina:!1,deltaFrameInDOM:0,maxZoom:2.5,autoPlayAnim:!1,autoPlayVideo:!1,linkClickMargin:5,linksBoxWithDom:!0,container:e.Param.viewMain,linkBoxAspect:e.Class.LinksManagerNew.linksBehaviors.blink,linkBlinkDuration:1e3},ie=e.Utils.noop,ae=e.Utils.noop,re=e.Utils.noop,oe=e.Utils.noop,se=e.Utils.noop;"7.3"===e.Main.startupManager.get("vendor.swiffy")&&(oe=function(e){var t=e.querySelector("canvas");t&&(e.style.backgroundImage="url("+t.toDataURL()+")",e.style.backgroundSize="contain",t.classList.add("display-none"))},se=function(e){var t=e.querySelector("canvas");t&&(e.style.backgroundImage="none",t.classList.remove("display-none"))},ie=function(){if(!G){G=!0;for(var e=document.querySelectorAll(".animation_for_swiffy"),t=e.length;t--;)oe(e[t])}},ae=function(){if(G){G=!1;for(var e=document.querySelectorAll(".animation_for_swiffy"),t=e.length;t--;)se(e[t])}},re=function(){for(var e=document.querySelectorAll("#webpub-viewer__links-container > div"),t=e.length;t--;){var n=e[t],i=parseInt(n.id.substring(n.id.indexOf("_")+1,n.id.length));P(i,!1)}});var le={history:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){"back"===e.param?history.back():"fwd"===e.param&&history.forward()}),close:function(){e.Main.urlManager.get("backHome")?document.location=e.Starter.main.backHomeString:window.close()},prevPage:NIApi.page.openPrevious,nextPage:NIApi.page.openNext,firstPage:NIApi.page.openFirst,lastPage:NIApi.page.openLast,activate:function(t){"panel_pdf"===t.param?e.API.pdfDownload():"panel_search"===t.param?e.API.searchOpen():"panel_share"===t.param&&e.Main.shareManager.open("home","share")},gotoPage:function(e){B.goToPage(e.param)},javascript:function(e){try{new Function(e.param)()}catch(t){console.warn(t)}},popup:NIApi.lightbox.openPopup.bind(null,null),url:function(e){window.open(f(e),"_blank")},drive:function(e){window.open(m(e),"_blank")},gallery:function(e){window.open(f(e),"_blank")},window:function(t){var n=e.Utils.resolveVariable(t.param);n.indexOf("http")===-1&&"/"===n[n.length-1]&&(n+="index.html");var i={id:"link-"+t.id+"-"+t.type,height:t.height,width:t.width},a=function(e){var t=e.toLowerCase().split(".");return t[t.length-1]};["jpeg","jpg","png","gif","webp"].indexOf(a(n))!==-1?(i.html="<img class='webpub-link-image' src='"+n+"'></div>",i.theme=i.theme||"theater",i.height=i.height||"100%",i.width=i.width||"100%"):(i.header="false"===t.header?"none":"visible",i.url=n),t.theme&&(i.theme=t.theme),t.animation&&(i.animation=t.animation),new e.Class.LightboxManagerNew(i)},mailto:function(e){window.location.href="mailto:"+e.param},refreshLink:function(t){if(t.param){var n=B.getDeltaFrameForPage(t.param);if(t.linkIndex>=0){S(t.param,t.linkIndex);var i=e.Main.pageManager.getLinks(t.param).filter(a);if(i&&i.length)for(var r=o(i),s=i.length;s--;)i[s].index==t.linkIndex&&(g(i[s],t.param,n,r),"swiffy"!==i[s].type||0!==n&&!ne.autoPlayAnim||(P(t.param,!1),setTimeout(P.bind({},t.param,!0),100)))}else M(t.param,!1),U.abs(n)<=ne.deltaFrameInDOM&&y(t.param,n)}}};le.lightbox=le.popup;var ue=function(){var n,i,a,r,o;return function(s,l,u,c,p,h){return a=c?ne.maxZoom:1,r=u.width*a+"px",o=u.height*a+"px",l.classList.add("webpub-viewer__link"),l.style.height=o,l.style.width=r,l.style.position="absolute",u.file&&u.file.foreground===!1?(n=document.createElement("div"),i=document.createElement("div"),n.style.width=r,n.style.height=o,n.style.position="absolute",n.style.zIndex=1,l.style.left="0",l.style.top="0",l.style.zIndex=-10,i.style.width=r,i.style.height=o,i.style.top="0",i.style.left="0",i.style.position="absolute",i.style.zIndex=10,n.appendChild(i),n.appendChild(l)):(n=l,n.style.zIndex=10),n.style.top=u.y+"px",n.style.left=u.x+"px",n.classList.add("webpub-viewer__link-"+s),p&&(n.classList.add("webpub-viewer__link-clickable"),h.url&&(n.href=h.url,n.target="_blank",t(n))),c&&e.Utils.scaleDom3d(n,1/a,0,0),e.Main.urlManager.contains("isApp")&&e.Param.userAgent.os.name===e.Param.userAgent.OS.IOS&&n.addEventListener(e.Param.eventClick,function(){this.classList.add("webpub-viewer__link--focused"),setTimeout(function(){this.classList.remove("webpub-viewer__link--focused")}.bind(this),400)}),n}}(),ce=function(){var e=function(e){e.paused&&e.play()},t=function(e){e.paused||document.hackFullscreenElement||e.pause()};return function(n){n.target.paused?setTimeout(e.bind({},n.target),125):setTimeout(t.bind({},n.target),125)}}(),pe=!1;pe="safari"===e.Param.userAgent.browser.name||"ie"===e.Param.userAgent.browser.name&&e.Param.userAgent.browser.version<10?function(){var e,t=[],n=!1;return te.onload=function(){e=t.shift(),"undefined"!=typeof e?te.src=e:n=!1},function(e){n===!0?t.push(e):(n=!0,te.src=e)}}():function(e){var t=document.createElement("link");t.setAttribute("href",e),t.setAttribute("rel","prefetch prerender"),F.appendChild(t)};var he={swiffy:function(){return"7.3"===e.Main.startupManager.get("vendor.swiffy")?function(t,n){if(t!==!1){t.style.left=t.coords.x+"px",t.style.top=t.coords.y+"px",t.style.width=t.coords.w+"px",t.style.height=t.coords.h+"px",t.swiffyElement.swiffyWrapper.style.visibility="hidden";var i=function(){var t=this.firstChild;if(t){var n=this.querySelector("canvas"),a=t.offsetWidth/n.offsetWidth,r=t.offsetHeight/n.offsetHeight;t.style.overflow="visible",e.Utils.styleTransformOrigin(n,"0 0"),e.Utils.styleTransform(n,"scale3d("+a+", "+r+", 1)"),this.style.visibility=""}else window.setTimeout(i,32)}.bind(t.swiffyElement.swiffyWrapper);return window.setTimeout(i,32),n&&t.swiffyElement.swiffyObject.start(),t}}:function(e,t){if(e!==!1)return e.style.left=e.coords.x+"px",e.style.top=e.coords.y+"px",e.style.width=e.coords.w+"px",e.style.height=e.coords.h+"px",t&&e.swiffyElement.swiffyObject.start(),e}}(),iframe:function de(e,t,n,i){var de=document.createElement("iframe");return de.classList.add("webpub-viewer__link-iframe"),de.setAttribute("data-src",t.file.url),de.style.visibility="hidden",de.onload=function(){this.style.visibility="visible"},i.visible?de.src=t.file.url:pe(t.file.url),ue(e,de,t,ne.linksRetina)},javascript:function(){},image:function fe(t,n,i,a,r){if(B.linkChargedInPage(a.pageNumber,t)===!1){var fe=new Image;fe.coord={x:n.x,y:n.y,width:n.width,height:n.height,container:j},fe.idLink=t,fe.onload=B.addImagesOnPage.bind({},a.pageNumber,[fe]),fe.src=e.Utils.resolveVariable(n.file.url)}return!!i&&(ne.linksBoxWithDom?he.rect(t,n,i,a,r):he.rect_domManager(t+"-box",n,!1,a,r))},video:function me(t,n,i,a,r){var me=document.createElement("video");r&&(me.setAttribute("data-tooltip",r),e.Main.tooltipManager.register(me)),me.classList.add("webpub-viewer__link-video");var o=/(?:\.([^.]+))?$/.exec(n.video.url)[1].toUpperCase(),s=document.createElement("source");return["MP4","OGG"].indexOf(o)>=0&&(s.type="video/"+o.toLowerCase(),s.src=e.Utils.resolveVariable(n.video.url)),me.appendChild(s),me.controls=!0,me.preload=!0,e.Param.userAgent.os.name===e.Param.userAgent.OS.IOS&&a.play===!0&&me.setAttribute("muted",""),me.setAttribute("data-has-autoplay",a.play),me.setAttribute("data-page",a.pageNumber),me.setAttribute("data-index",t),me.loop=!1,me.oncanplay=w,e.Param.userAgent.os.name!==e.Param.userAgent.OS.ANDROID&&me.addEventListener(e.Param.eventStart,ce),e.Param.userAgent.os.name!==e.Param.userAgent.OS.SAFARI&&(me.addEventListener("webkitbeginfullscreen",function(){document.hackFullscreenElement=this},!1),me.addEventListener("webkitendfullscreen",function(){document.hackFullscreenElement=void 0,delete document.hackFullscreenElement},!1)),e.Utils.addVideoStats(me),e.Param.userAgent.browser.name!==e.Param.userAgent.BROWSER.SAFARI||me.hasAttribute("autoplay")||(me.setAttribute("autoplay",""),me.dataset.ignoreAutoplay="true",me.pause()),ue(t,me,n,!1)},text:function ge(t,n,i,a,r){var o=document.createElement("a");r&&(o.setAttribute("data-tooltip",r),e.Main.tooltipManager.register(o)),o.className="webpub-viewer__link-text ",o.align="center",o.setAttribute("data-tooltip",r);var ge=document.createElement("p");return ge.innerHTML=n.textContent,ge.style.fontSize="15px",o.appendChild(ge),ue(t,o,n,!1,i,a)},rect:function(t,n,i,a,r){var o=document.createElement("a");return r&&(o.setAttribute("data-tooltip",r),e.Main.tooltipManager.register(o)),o.className="webpub-viewer__link-rect webpub-viewer__link-box",ue(t,o,n,ne.linksRetina,i,a)},rect_domManager:function(e,t,n,i){return B.linkChargedInPage(i.pageNumber,e)===!1&&B.addLinksBoxOnPage(i.pageNumber,[{type:"rect",id:e,x:t.x,y:t.y,w:t.width,h:t.height,container:j}]),!1},circle:function(t,n,i,a,r){var o=document.createElement("a");return r&&(o.setAttribute("data-tooltip",r),e.Main.tooltipManager.register(o)),o.className="webpub-viewer__link-circle webpub-viewer__link-box",ue(t,o,n,ne.linksRetina,i,a)},circle_domManager:function(e,t,n,i){return B.linkChargedInPage(i.pageNumber,e)===!1&&B.addLinksBoxOnPage(i.pageNumber,[{type:"circle",id:e,x:t.x,y:t.y,w:t.width,h:t.height,container:j}]),!1},roundrect:function(t,n,i,a,r){var o=document.createElement("a");return r&&(o.setAttribute("data-tooltip",r),e.Main.tooltipManager.register(o)),o.className="webpub-viewer__link-roundrect webpub-viewer__link-box",e.Utils.styleBorderRadius(o,n.roundrect.radius+"px"),ue(t,o,n,ne.linksRetina,i,a)},roundrect_domManager:function(e,t,n,i){return B.linkChargedInPage(i.pageNumber,e)===!1&&B.addLinksBoxOnPage(i.pageNumber,[{type:"roundrect",id:e,x:t.x,y:t.y,w:t.width,h:t.height,radius:t.roundrect.radius,container:j}]),!1},roundrectcomplex:function(t,n,i,a,r){var o=document.createElement("a");r&&(o.setAttribute("data-tooltip",r),e.Main.tooltipManager.register(o));var s=n.roundrectcomplex;return o.className="webpub-viewer__link-roundrectcomplex webpub-viewer__link-box",e.Utils.styleBorderRadius(o,s.tl_radius+"px "+s.tr_radius+"px "+s.br_radius+"px "+s.bl_radius+"px "),ue(t,o,n,ne.linksRetina,i,a)},roundrectcomplex_domManager:function(e,t,n,i){return B.linkChargedInPage(i.pageNumber,e)===!1&&B.addLinksBoxOnPage(i.pageNumber,[{type:"roundrectcomplex",id:e,x:t.x,y:t.y,w:t.width,h:t.height,tl_radius:t.roundrectcomplex.tl_radius,tr_radius:t.roundrectcomplex.tr_radius,br_radius:t.roundrectcomplex.br_radius,bl_radius:t.roundrectcomplex.bl_radius,container:j}]),!1},symbol:function(){return document.createElement("div")}};return NIApi.event.onPageChange(I),NIApi.register("viewer.linkHandler",function(e,t){var n={next:le[e]};return le[e]=t.bind(n),Promise.resolve()}),{addLinksToPage:y,removeLinksFromPage:M,preloadAnimPromise:s,setPageSize:A,addFixSwiffyAnims:ie,removeFixSwiffyAnims:ae,adjustLinksCache:T,setConfig:O,linkClick:l,linksBroadcast:C,onLayerClick:d,findClickedUserActs:h,onResize:x,init:N}},e.Class.LinksManagerNew.linksBehaviors={blink:"blink","static":"static",none:"none",revealOnTap:"revealOnTap"}}(webpublicationNamespace),function(e){e.Param.eventResize="resizeCustom",e.Param.eventKeyboardDown="keydown";var t=function(){function t(){window.innerHeight>=window.innerWidth?(e.Param.viewHtml.classList.remove("webpub-device__landscape"),e.Param.viewHtml.classList.add("webpub-device__portrait"),e.Param.isPortrait=!0):(e.Param.viewHtml.classList.remove("webpub-device__portrait"),e.Param.viewHtml.classList.add("webpub-device__landscape"),e.Param.isPortrait=!1)}function n(n){t(),e.Utils.callEvent(window,e.Param.eventResize)}t();return function(e){var t=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.hackFullscreenElement;return t&&"video"===t.tagName.toLowerCase()?(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1):void n(e)}}();e.Param.userAgent.os.name===e.Param.userAgent.OS.WINDOWS&&e.Param.userAgent.device.type===e.Param.userAgent.FORMAT.PHONE?window.addEventListener("orientationchange",function(){setTimeout(t,48)}):window.visualViewport?window.visualViewport.addEventListener("resize",t):window.addEventListener("resize",t),document.addEventListener(e.Param.eventClick,function(t){var n=e.Utils.getClosestByClass(t.target,"focusable");n!==!1&&(n.classList.add("focused"),window.setTimeout(function(){
n.classList.remove("focused")},300))})}(webpublicationNamespace),function(e){!function(){document.addEventListener("touchmove",function(e){void 0!==e.scale&&1!==e.scale&&e.preventDefault()},!!e.Utils.supportsPassive()&&{passive:!1});var t=0;document.addEventListener("touchend",function(e){var n=Date.now();n-t<=300&&e.preventDefault(),t=n},!0)}(),e.Class.Main=function(){var t=function(){var t=e.Main.urlManager.get("gallery");if("undefined"!=typeof t){var n=e.Main.xmlManager.get("common-configuration","contents","gallery","path");location.href=n+"#"+t}this.backHomeString="api:backHome",e.Param.userAgent.os.name===e.Param.userAgent.OS.WINDOWS&&(this.backHomeString="api-backHome"),this.backHomeParamString="api-param-",e.Main.eventEmul=new e.Class.EventEmul,e.Main.pdfManager=new e.Class.PdfManager,e.Main.tooltipManager=new e.Class.TooltipManager,e.Main.fullScreenManager=new e.Class.FullScreenManager,e.Main.playlistManager=new e.Class.PlaylistManager,e.Main.pageManager=new e.Class.PageManager,e.Main.pageManager.init(),e.Main.paginationManager=new e.Class.PaginationManager,e.Main.favoriteStarsManager=new e.Class.FavoriteStarsManager,e.Main.favoriteStarsManager.addFavoriteStars(e.Param.viewMain),e.Main.trackerManager||(e.Main.trackerManager=new e.Class.TrackerManager),this.initPageTitles(),e.Main.pagesLoaderNew=new e.Class.PagesLoaderNew;var i=["epub-HTML","pdf-HTML","pdf-SVG","pdf-PDF","pdf-IMG"];"html"===e.Param.viewerMode&&i.indexOf(e.Param.viewerFormat)!==-1?e.Main.viewerManager=new e.Class.EpubManager(this,e.Param.viewMain):e.Main.viewerManager=new e.Class.ViewerManager,e.Main.toolsEvents=new e.Class.ToolsEvents(this),e.Main.chapteringPanelManager=new e.Class.ChapteringPanelManager,e.Main.shareMailManager=new e.Class.ShareMailManager,e.Main.shareManager=new e.Class.ShareManager,e.Main.shareManager.init(),e.Main.copyUrlManager=new e.Class.ShareMailManager,null!==e.Main.startupManager.get("ui.menu")&&(e.Main.menuService=new e.Class.MenuService,e.Main.menuManager=new e.Class.MenuManager),this.initConsent(),e.Utils.callEvent(window,"webpub-init")};return t.prototype.initPageTitles=function(){var t=e.Main.xmlManager.get("common-configuration","config","pageCount"),n=e.Main.xmlManager.get("summary","xml"),i=this.getChaptersFromSummary(n),a=0===i.length;if(a){var r=e.Main.xmlManager.get("common-ui","configs","chapters");i=this.getChaptersFromChapterTabs(r)}var o=0===i.length;e.Main.trackerManager.initPageTitles(t,o?null:i)},t.prototype.getChaptersFromSummary=function(e){var t=e.querySelector("menu"),n=[];return this.mapSummaryNodes(t,[],n),n},t.prototype.getDirectItemExceptComments=function(e){return Array.from(e.getElementsByTagName("it")).filter(function(t){return t.parentNode===e}).filter(function(e){return"COMMENT"!==e.getAttribute("t")})},t.prototype.getDirectTextNode=function(e){var t=Array.from(e.getElementsByTagName("text")).filter(function(t){return t.parentNode===e});return t.length>0?t[0]:null},t.prototype.mapSummaryNodes=function(e,t,n){var i=this.getDirectItemExceptComments(e),a=[].concat(_toConsumableArray(t)),r=this.getDirectTextNode(e);if(r&&a.push(r.textContent),0===i.length&&a.length>0){var o="p",s=e.getAttribute(o);n.push({name:a.join(" - "),page:s})}for(var l=0;l<i.length;l++){var u=i[l];this.mapSummaryNodes(u,a,n)}},t.prototype.getChaptersFromChapterTabs=function(e){return e.filter(function(e){return"tab"===e.type}).map(function(e){return{name:e.label,page:parseInt(e.page,10)}})},t.prototype.initConsent=function(){var t=e.Main.xmlManager.get("common-ui","configs","cookie"),n=t.enabled;if(n){var i=t.url,a=e.Main.xmlManager.get("locale","cookie_url"),r=i||a,o=t.gdpr;if(o){var s=e.Main.xmlManager.getVariable("locale"),l=s.split("_")[0];e.Main.consentManager=new e.Class.ConsentManager,e.Main.consentManager.init(e.Param.viewMain,{language:l,privacyUrl:r,services:t.services})}else{var u=e.Utils.getCookie("areCookieAccepted");u||this.loadCookieNotice(r)}}},t.prototype.loadCookieNotice=function(t){var n=document.createElement("div");n.classList.add("cookieNotice__container");var i=e.Main.xmlManager.get("locale","cookie_notice").replace("$$",t);n.innerHTML=i;var a=document.createElement("button");a.classList.add("cookieNotice__closeButton"),a.innerHTML='<svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svgicon-close"></use></svg>',n.appendChild(a),a.onclick=function(){e.Utils.setCookie("areCookieAccepted","true",90),n.parentNode.removeChild(n)},document.body.appendChild(n)},t.prototype.init=function(){var t=this;setTimeout(function(){var n=document.createElement("div");n.style.display="none",e.Main.templateManager.loadAppend("publication/mobile/img/icons.svg",n),document.body.appendChild(n);var i=e.Main.startupManager.get("startup.welcomepage.url"),a=e.Main.urlManager.get("initState"),r=e.Main.startupManager.get("startup.welcomepage.initial"),o=!1;return o="welcomepage"===a||"nowelcomepage"===a?"welcomepage"===a:"hidden"!==r,i&&o&&(e.Main.trackerManager.trackPage({name:"welcomepage"}),new e.Class.LightboxManagerNew({animation:"none",header:"none",id:"startupPanel",url:e.Utils.resolveVariable(i),onclose:function(){e.Utils.callEvent(window,"webpub-show")}})),null!==e.Main.startupManager.get("ui.menu")&&e.Main.menuManager.init({topnav:e.Main.startupManager.has("ui.menu.mode","topnav"),topnavAlwaysVisible:"sticky"===e.Main.startupManager.get("ui.menu.topnav.display")}),e.Main.viewerManager.epubMode?void t.documentReady():void e.Main.javascriptInit.removePreloader(t.documentReady)},0)},t.prototype.documentReady=function(){function t(e,t){var n=t.length>0,i="coverHorizontally"===e;return i||n}e.Utils.callEvent(window,"webpub-ready"),e.Param.sliderDirection="horizontal";var n=e.Main.startupManager.get("core.viewerDirection"),i="vertical"===n||"verticalOnePage"===n,a="horizontal"===n||null===n,r="vertical"===e.Main.urlManager.get("direction"),o=e.Param.userAgent.isPhone(),s=e.Main.viewerService.get("page","size_type"),l=e.Main.xmlManager.get("comboPages","scrollablePages"),u=t(s,l),c=i||r||o&&!u&&!a;if(c){e.Param.sliderDirection="vertical",e.Param.sliderDirectionNotice=!1;var p=function(){var t=document.createElement("span");t.classList.add("svgicon-new-text"),t.innerHTML=e.Main.xmlManager.get("locale","vertical_slide_notice");var n=e.Utils.createSvgIcon("swipe-vertical-v4","svgicon-new svgicon-v4","#ffffff"),i=document.createElement("div");i.appendChild(t),i.appendChild(n),e.Utils.toast({html:i.innerHTML,duration:5e3,position:"bottom"})};window.addEventListener("webpub-show",function(){var t=e.Main.startupManager.get("core.verticalArrow.position"),n=!t||"hidden"===t;"vertical"===e.Param.sliderDirection&&e.Param.sliderDirectionNotice===!1&&n&&(p(),e.Param.sliderDirectionNotice=!0)})}(e.Main.urlManager.contains("bookmarks")||e.Main.urlManager.contains("bookmark"))&&(e.Main.thumbnailListManager||(e.Main.thumbnailListManager=new e.Class.ThumbnailListManager),e.Main.thumbnailListManager.show("sharedBy","favorite"));var h=e.Main.viewerService.getRotateClue();if(null!==h&&e.Param.isDesktop===!1){var d=function(t){"undefined"==typeof t&&(t="none"),new e.Class.LightboxManagerNew({header:"none",id:"rotate",theme:"theater",disableOverlay:!0,subtemplate:{url:e.Param.pathTemplate+"rotateClue.html"},priority:"high",animation:t,onload:function(t){t[0].classList.remove("webpub-lightbox--animation-none"),e.Class.LightboxManagerNew.get("rotate").params.animation="fade",t[0].classList.add("webpub-lightbox--animation-fade"),t[0].classList.add("webpub--active")}})},f=window.matchMedia("(orientation: "+h+")");f.matches||d(),f.addEventListener("change",function(t){t.matches?e.Class.LightboxManagerNew.close("rotate"):d("fade")})}var m=e.Main.xmlManager.get("common-ui","configs","links","mode")||e.Class.LinksManagerNew.linksBehaviors.blink,g=e.Main.xmlManager.get("common-ui","configs","links","duration")||1e3,v={pageBgColor:e.Main.cssManager.getStyle("primary","backgroundColor"),zoomPinch:e.Main.startupManager.has("ui.zoom.mode","pinch"),zoomDoubleClick:e.Main.startupManager.has("ui.zoom.mode","doubleclick"),zoomSingleClick:1===e.Main.viewerService.get("zoom","click"),draggable:e.Main.startupManager.get("ui.viewer.draggable"),pagesRetina:!(e.Param.userAgent.isIE()===!0&&e.Param.userAgent.isPhone()),zoomRetina:e.Param.isDesktop||e.Param.isTablet,domMode:e.Param.viewerMode,ePubConfig:null,highQualityKey:"svg"===e.Param.viewerFormat?"svg":"hdpi",linkBoxAspect:m,linkBlinkDuration:g,verticalSlider:"vertical"===e.Param.sliderDirection,isVerticalOnePage:"verticalOnePage"===n,pageQuantity:e.Main.pagesLoaderNew.getPageQuantity(),pageOnFirstFrame:e.Main.pageManager.pagesOnFirstScreen(),lowQualityDisabled:"svg"===e.Param.viewerFormat,maxZoom:e.Main.viewerService.get("zoom","max-scale"),transitionTime:parseFloat(e.Main.viewerService.get("page","transition_time")),spreadDraggable:"false"!==e.Main.viewerService.get("page","swipe"),coverPageCenter:"false"!==e.Main.viewerService.get("page","center_cover"),pageSizeType:e.Main.viewerService.get("page","size_type"),pdfHTMLMaxFontLoad:e.Main.xmlManager.get("common-ui","configs","pdfHTMLMaxFontLoad"),pageMargin:function(){var t=e.Main.viewerService.get("page","margin");if(!t)return[0,0,0,0];var n=t.split(" ");return n=n.map(function(e){return~~e})}()};e.Main.viewerManager.epubMode?("epub-HTML"===e.Param.viewerFormat?(v.ePubConfig=e.Main.xmlManager.get("common-configuration","contents","epub-HTML"),v.readerPageSrcType="EPUB_HTML"):"pdf-HTML"===e.Param.viewerFormat?(v.ePubConfig=e.Main.xmlManager.get("common-configuration","contents","pdf-HTML"),v.readerPageSrcType="PDF_HTML"):"pdf-SVG"===e.Param.viewerFormat?(v.ePubConfig=e.Main.xmlManager.get("common-configuration","contents","pdf-SVG"),v.readerPageSrcType="PDF_SVG"):"pdf-IMG"===e.Param.viewerFormat?(v.ePubConfig=e.Main.xmlManager.get("common-configuration","contents","pdf-IMG"),v.readerPageSrcType="PDF_IMG"):"pdf-PDF"===e.Param.viewerFormat?(v.ePubConfig=e.Main.xmlManager.get("common-configuration","contents","pdf-PDF"),v.readerPageSrcType="PDF_PDF"):(e.Param.viewerFormat="pdf-HTML",v.ePubConfig=e.Main.xmlManager.get("common-configuration","contents","pdf-HTML"),v.readerPageSrcType="PDF_HTML"),e.Main.viewerManager.init(v,e.Main.javascriptInit.setPercentageExternal).then(function(){e.Main.javascriptInit.removePreloader(function(){})}.bind(this))):e.Main.viewerManager.init(v),e.Utils.callEvent(window,"webpub-load");var b=e.Main.startupManager.get("startup.welcomepage.url"),y=e.Main.urlManager.get("initState"),E=e.Main.startupManager.get("startup.welcomepage.initial"),M=!1;M="welcomepage"===y||"nowelcomepage"===y?"welcomepage"===y:"hidden"!==E,b&&M||e.Utils.callEvent(window,"webpub-show");var S=e.Main.startupManager.get("ui.theme.lateralArrows");e.Main.paginationManager.init(e.Main.startupManager.get("ui.paging"),S),e.Main.paginationManager.addPagination("vertical",e.Param.viewMain),e.Main.paginationManager.addPagination("lateral",e.Param.viewMain)},t}()}(webpublicationNamespace),function(e){e.Class.MenuManager=function(){function t(){NIApi.register("menu.ready",function(){return B.promise}),NIApi.register("menu.open",function(){return Promise.resolve(e.Main.menuManager.showMenu())}),NIApi.register("menu.close",function(){return Promise.resolve(e.Main.menuManager.hideMenu())}),NIApi.register("menu.toggle",function(){return Promise.resolve(e.API.menuToggle())}),NIApi.register("menu.activate",function(t){return Promise.resolve(e.Main.menuManager.callButtonClick(t))})}function n(e){return"string"==typeof e?e:e.attributes.name}function i(t,i){if("undefined"==typeof t)return[];for(var a,r,o=[],s=0,l=t.length;s<l;s++){var u=n(t[s]);r=e.Main.menuService.get(u),r&&(a=Object.assign({},r),t[s].xmlElement.hasAttribute("label")&&(a.label=t[s].xmlElement.getAttribute("label")),a.data=t[s],t[s].file&&t[s].file.image&&(a.icon={url:e.Utils.resolveVariable(t[s].file.image),noMargin:t[s].file.noMargin}),a.isInBurger=!!i,o.push(a))}return o}function a(){var t=function(e,t){var i=n(e);return t.includes(i)},i=function(e,n){for(var i=0;i<e.length;i++){var a=e[i];if(t(a,n))return!0}},a=e.Main.xmlManager.get("common-ui","menu"),r=a.left.concat(a.center).concat(a.right),o=i(r,["menu"]);return o&&(r=r.concat(a.burger)),i(r,["pdf_btn","pdf_full_btn"])}function r(e){for(var t=0;t<D.icons.length;t++){var n=D.icons[t];n.style.fill=e}D.pageControl&&(D.pageControl.style.borderColor=e,D.pageControl.style.color=e)}function o(t,n){t=t?t:e.Main.cssManager.getStyle("primary","topnavColor"),n=void 0!==n?n:e.Main.cssManager.getStyle("primary","topnavAlpha"),D.topnav.style.backgroundColor=e.Utils.hexToRgb(t,n)}function s(){for(var e=0;e<D.icons.length;e++){var t=D.icons[e];t.style.fill=null}D.pageControl&&(D.pageControl.style.borderColor=null,D.pageControl.style.color=null)}function l(){D.topnav.style.backgroundColor=null}function u(t){void 0===t&&(t=e.Main.pagesLoaderNew.getCurrentPage());var n=t-1,i=e.Main.configsJsonManager.getPageData(["menuBar"],n).menuBar;i&&i.iconsColor?r(i.iconsColor):s(),i&&(i.color||void 0!==i.opacity)?o(i.color,i.opacity):l()}function c(){D.topnav&&D.topnav.parentNode.removeChild(D.topnav),R&&R.parentNode.removeChild(R);var t=e.Main.xmlManager.get("common-ui","menu"),n=p(t);if(V.topnav&&(e.Main.templateManager.loadPrepend(e.Param.pathTemplate+"menuTopnav.html",e.Param.viewMain,{theme:k?"v4":"v3",visible:V.topnavAlwaysVisible,itemsLeft:n.left,itemsCenter:n.center,itemsRight:n.right}).then(function(t){D.topnav=document.querySelector(".webpub-topnav-v4"),D.topnavLeft=document.querySelector(".webpub-topnav-v4__region.webpub-topnav-v4__left"),D.topnavCenter=document.querySelector(".webpub-topnav-v4__region.webpub-topnav-v4__center"),D.topnavRight=document.querySelector(".webpub-topnav-v4__region.webpub-topnav-v4__right"),D.icons=D.topnav.querySelectorAll(".webpub-topnav-v4__item-icon svg"),D.pageControl=D.topnav.querySelector(".menu-item-page-control"),D.chaptersTabs=D.topnav.querySelector(".menu-item-chapters__wrapper"),D.menu=D.topnav.querySelector(".webpub-topnav-v4__type-menu"),u(),e.Main.pagesLoaderNew.addPageChangeCallback(u),document.addEventListener("configsJson.pageDataUpdated",function(){u()}),g(),window.addEventListener("resize",g)}),V.topnavAlwaysVisible)){var i={paddingTop:k?45:60,paddingBottom:0};e.Main.viewerService.set(i)}for(var a=h(t),r=!1,o=0;o<a.length;o++)if("summary_btn"===a[o].name){r=!0,a.splice(o,1);break}var s="true"===e.Main.xmlManager.get("common-ui","configs","useDropdownDesign"),l={theme:k?"v4":"v3",items:a,title:document.getElementsByTagName("title")[0].innerText,hasSummaryInBurger:r,useDropdownDesign:s},c=e.Main.xmlManager.get("common-ui","logo");c&&(l.logoSrc=e.Utils.resolveVariable(c.image));var d=e.Main.xmlManager.get("summary","xml");if(d){var f=e.Main.chapteringPanelManager.getSummary(d.childNodes[0]);l.summaryList=f.filter(function(e){return null!==e.gotopage})}e.Main.templateManager.loadAppend(e.Param.pathTemplate+"menuAside.html",document.body,l).then(function(t){if(k){R=document.querySelector(".webpub-aside-menu-v4");var n=document.querySelector(".webpub-aside-menu-v4__header-close");n.addEventListener(e.Param.eventStart,w,!1);var i=document.querySelector(".webpub-aside-menu-v4__overlay");i.addEventListener(e.Param.eventStart,w,!1)}else R=document.querySelector(".webpub-aside-menu");D.chapterButton=document.querySelector(".webpub-aside-menu-v4__type-chapters_btn"),e.Utils.preventOverScroll(document.querySelector(".webpub-aside-menu, .webpub-aside-menu-v4")),g(),setTimeout(function(){return B.resolve(!0)},0)}),e.Main.eventEmul.listenEvent("showMenu",e.API.menuToggle)}function p(t){var n={left:i(t.left),center:i(t.center),right:i(t.right)};return d(t)&&f(t)&&n.left.unshift(e.Main.menuService.get("menu")),n}function h(t){var n=i(t.burger,!0);return d(t)&&n.unshift(e.Main.menuService.get("chapters_btn")),n}function d(e){return m(e,"chapters")}function f(e){return!m(e,"menu")}function m(e,t){var n=e.left.concat(e.center).concat(e.right);return n.some(function(e){return e.attributes&&e.attributes.name===t})}function g(){var t=[D.topnav,D.topnavLeft,D.topnavCenter,D.topnavRight,D.chaptersTabs,D.menu,D.chapterButton].every(function(e){return null!==e});if(t){var n=v(),i=e.Main.xmlManager.get("common-ui","configs","showChaptersInBurger");if(D.chapterButton.style.display="none",n)return D.chaptersTabs.style.display="none",D.menu.style.display="",void("true"!==i&&null!==i||(D.chapterButton.style.display=""));D.chaptersTabs.style.display="";var a=e.Main.xmlManager.get("common-ui","menu");f(a)&&(D.menu.style.display="none")}}function v(){var e=window.getComputedStyle(D.topnav,null),t=D.topnav.offsetWidth-parseFloat(e.getPropertyValue("padding-left"))-parseFloat(e.getPropertyValue("padding-right"));D.chaptersTabs.style.display="";var n=[].concat(_toConsumableArray(D.topnavLeft.children),_toConsumableArray(D.topnavCenter.children),_toConsumableArray(D.topnavRight.children)),i=n.reduce(function(e,t){return e+b(t)},0);return i>t}function b(e){var t=e.offsetWidth,n=getComputedStyle(e);return t+=parseInt(n.marginLeft)+parseInt(n.marginRight)}function y(){V.topnav?V.topnavAlwaysVisible||S():_()}function E(){return!!D.topnav&&(O||(D.topnav.classList.add(U),O=!0),!0)}function M(){return!!D.topnav&&(O&&!V.topnavAlwaysVisible&&(D.topnav.classList.remove(U),O=!1),!0)}function S(){O?M():E()}function P(){return I===!1&&(G(),I=!0,!0)}function w(e){return e&&(e.stopPropagation(),e.preventDefault()),!!I&&(H(),I=!1,!0)}function _(){I?w():P()}function T(t){if("string"==typeof t){var n=e.Main.menuService.get(t);if(n===!1&&(t+="_btn",n=e.Main.menuService.get(t)),n&&"function"==typeof n.onclick)return F.indexOf(t)===-1&&n.onload(),n.onclick(),!0}return!1}function A(){var t=e.Main.xmlManager.get("common-ui","menu");for(var n in t)if(t[n].indexOf("menu")!==-1)return!0;return!1}function C(e){for(var t in e)"undefined"!=typeof V[t]&&(V[t]=e[t])}function L(e){C(e),c(),t(),N=!0}function x(e){for(var t=document.querySelectorAll(".webpub-aside-menu-v4__type-"+e+", .webpub-topnav-v4__type-"+e+", .webpub-aside-menu__type-"+e+", .webpub-topnav__type-"+e),n=0;n<t.length;n++)t[n].classList.add("webpub--active")}var k=e.Param.newThemeVersion,O=!1,I=!1,N=!1,D={topnav:null,topnavLeft:null,topnavCenter:null,topnavRight:null,icons:null,pageControl:null,chaptersTabs:null,menu:null,chapterButton:null},R=!1,U=k?"webpub-topnav-v4--visible":"webpub-topnav--visible",F=[],B={};B.promise=new Promise(function(e,t){B.resolve=e,B.reject=t});var V={topnav:!0,topnavAlwaysVisible:!0},G=function(){function t(){e.Main.trackerManager.trackEvent({name:"menuOpen"})}return k?function(){R.classList.add("webpub-aside-menu-v4--open"),t()}:function(){e.Param.viewMain.classList.add("menu-open"),t()}}(),H=function(){function t(){e.Main.trackerManager.trackEvent({name:"menuClose"})}return k?function(){R.classList.remove("webpub-aside-menu-v4--open"),t()}:function(){e.Param.viewMain.classList.remove("menu-open"),t()}}();return{init:L,buildMenu:c,showTopnav:E,hideTopnav:M,toggleTopnav:S,showMenu:P,hideMenu:w,toggleMenu:_,onDocumentClick:y,callButtonClick:T,setActive:x,hasDownloadItem:a,hasMenuBurger:A}}}(webpublicationNamespace);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){NIApi.register("menu.setBadge",function(t,n){for(var i=document.querySelectorAll('[data-menu="'+t+'"] [data-section="badge"]'),a=0;a<i.length;a++)i[a].innerHTML=n;e.Main.menuService.set(t,{badge:n})}),NIApi.register("menu.setTitle",function(e,t){for(var n=document.querySelectorAll('[data-menu="'+e+'"]'),i=0;i<n.length;i++){n[i].hasAttribute("data-tooltip")&&n[i].setAttribute("data-tooltip",t);var a=n[i].querySelector('[data-section="title"]');a&&(a.innerHTML=t)}}),NIApi.register("menu.setIcon",function(t,n,i){i=i||document;for(var a=i.querySelectorAll('[data-menu="'+t+'"] [data-section="icon"]'),r=0;r<a.length;r++)if("object"===("undefined"==typeof n?"undefined":_typeof(n)))n.url?a[r].src=e.Utils.resolveVariable(n.url):n.text;else{var o=a[r].querySelector("svg");e.Utils.svgIcon(o,{icon:n})}}),e.Class.MenuService=function(){function t(e){var t=r[e];if(t){for(var n=a.length;n--;)t[a[n].key]||(t[a[n].key]=a[n]["default"]);return t.name=e,t}return!1}function n(t,n){var i=Object.keys(n);if(void 0===r[t]||0===i.length)return!1;for(var o=i.length;o--;)for(var s=0;s<a.length;s++)a[s].key===i[o]&&(r[t][i[o]]=e.Utils.resolveVariable(n[i[o]]));return!0}function i(e,t){return!(!t.label&&!t.template)&&(r[e]={},n(e,t))}var a=[{key:"label","default":""},{key:"icon","default":!1},{key:"onclick","default":e.Utils.noop},{key:"onload","default":e.Utils.noop},{key:"badge","default":""},{key:"template","default":!1}],r={menu:{icon:"menu",onclick:function(){e.Class.LightboxManagerNew.closeAll(),e.API.menuToggle()}},documentback:{label:e.Main.xmlManager.get("locale","menu_documentback"),icon:"left-arrow",onclick:function(){e.Class.LightboxManagerNew.closeAll(),e.API.menuClose()}},page_control:{template:"menuItem-page_control"},logo:{label:"LOGO",template:"menuItem-logo",onclick:function(){var t=this.querySelector(".menu-item--logo");return t.hasAttribute("href")&&e.Main.trackerManager.trackEvent({name:"externalLink",variables:{1:t.getAttribute("href")}}),!1}},custom:{label:"",template:"menuItem-custom"},share_btn:{label:e.Main.xmlManager.get("locale","menu_sharethis"),icon:"share",onclick:function(){e.API.menuClose(),e.Utils.prodTools.showTools(!1),e.Main.shareManager.open("home","share")},onload:function(){e.Main.thumbnailListManager||(e.Main.thumbnailListManager=new e.Class.ThumbnailListManager)}},thumbnails_btn:{label:e.Main.xmlManager.get("locale","menu_thumbnail"),icon:"pages",onclick:function(){e.Main.thumbnailListManager.show("none","thumbnails")},onload:function(t){e.Main.thumbnailListManager||(e.Main.thumbnailListManager=new e.Class.ThumbnailListManager),(e.Main.urlManager.contains("bookmarks")||e.Main.urlManager.contains("bookmark"))&&e.Main.thumbnailListManager.show("sharedBy","favorite")}},favorite_btn:{label:e.Main.xmlManager.get("locale","menu_favorite"),icon:"favorite",onclick:function(){e.Main.thumbnailListManager.show("favorite","favorite")},onload:function(){"undefined"==typeof this.event&&(this.event=!1),e.Main.thumbnailListManager||(e.Main.thumbnailListManager=new e.Class.ThumbnailListManager),this.event===!1&&(NIApi.event.onPageChange(function(){e.Utils.removeToast()}),this.event=!0)}},search_btn:{label:e.Main.xmlManager.get("locale","menu_search"),icon:"search",onclick:function(){e.Main.searchManager.show()},onload:function(t){"undefined"==typeof e.Main.searchManager&&(e.Main.searchManager=new e.Class.SearchManager),e.Main.searchManager.init()}},email_btn:{label:e.Main.xmlManager.get("locale","menu_mail"),icon:"mail",onclick:function(){"mailto"===e.Param.mailType?e.Main.shareMailManager.doMailTo():e.Main.shareMailManager.load(),e.Main.trackerManager.trackPage({name:"share-email"})}},summary_btn:{label:e.Main.xmlManager.get("locale","menu_summary"),icon:"list",onclick:function(){e.Main.chapteringPanelManager.show(!1)}},chapters_btn:{label:e.Main.xmlManager.get("locale","menu_tabs"),icon:"list",onclick:function(){e.Main.chapteringPanelManager.show(!0)}},drive_btn:{label:e.Main.xmlManager.get("locale","menu_gallery"),icon:"image",onclick:function(){var e=this.dataset.asset,t=e&&e.match(/\d+/g)[0],n=this.dataset.target;NIApi.gallery.open(void 0,t,void 0,n)},onload:function(t){return null===e.Main.xmlManager.get("common-configuration","contents","gallery","path")&&t.parentNode.removeChild(t),!1}},fullscreen_btn:{label:e.Main.xmlManager.get("locale","menu_fullscreen"),icon:"fullscreen",onclick:function(){e.Main.fullScreenManager.fullScreenToggle()},onload:function(){return function(t){if(e.Main.fullScreenManager.hasFullScreen()===!1)return t.style.display="none",!1}}()},home:{label:"Home",icon:"close-1",onclick:function(){if(e.API.menuClose(),e.Main.urlManager.get("backHome")){if(e.Main.urlManager.get("isApp")){var t={type:"none"};NIApi.gallery.doActionInApp(t)}e.Main.urlManager.get("integration")&&window.parent.postMessage({target:"webpublication-integration",action:"close"},"*")}return!1}},welcomepage_btn:{label:e.Utils.prodTools.getWordLangueByIndex("menu_welcomepage_btn"),icon:"home",onclick:function(){e.API.menuClose(),e.API.welcomepageOpen()},onload:function(t){var n=e.Main.startupManager.get("startup.welcomepage.url");if(!n)return t.style.display="none",!1}},pinterest_btn:{label:e.Main.xmlManager.get("locale","menu_pinterest_share"),icon:"pinterest",onclick:function(){e.API.menuClose(),e.Main.shareManager.shareSocial("pinterest")}},twitter_btn:{label:e.Main.xmlManager.get("locale","menu_twitter_share"),icon:"twitter",onclick:function(){e.API.menuClose(),e.Main.shareManager.shareSocial("twitter")}},tumblr_btn:{label:e.Main.xmlManager.get("locale","menu_tumblr_share"),icon:"tumblr",onclick:function(){e.API.menuClose(),e.Main.shareManager.shareSocial("tumblr")}},linkedin_btn:{label:e.Main.xmlManager.get("locale","menu_linkedin_share"),icon:"linkedin",onclick:function(){e.API.menuClose(),e.Main.shareManager.shareSocial("linkedin")}},googleplus_btn:{label:e.Main.xmlManager.get("locale","menu_googleplus_share"),icon:"googleplus",onclick:function(){e.API.menuClose(),e.Main.shareManager.shareSocial("googleplus")}},facebook_btn:{label:e.Main.xmlManager.get("locale","menu_facebook_share"),icon:"facebook",onclick:function(){e.API.menuClose(),e.Main.shareManager.shareSocial("facebook")}},print_btn:{label:e.Main.xmlManager.get("locale","menu_print"),icon:"print",onclick:function(){e.API.menuClose(),e.Main.shareManager.open("home","print")}},pdf_btn:{label:e.Main.xmlManager.get("locale","menu_download"),icon:"download",onclick:function(){e.API.menuClose();var t="full";return this.dataset.option===t?(e.Main.trackerManager.trackEvent({name:"pdfFullDownloadButton"}),void e.Main.pdfManager.download()):void e.Main.shareManager.open("home","download")}},pdf_full_btn:{label:e.Main.xmlManager.get("locale","menu_download"),icon:"download",onclick:function(){e.API.menuClose(),e.Main.trackerManager.trackEvent({name:"pdfFullDownloadButton"}),e.Main.pdfManager.download()}},zoom_btn:{label:e.Main.xmlManager.get("locale","menu_zoomup_btn"),alternativeLabel:e.Main.xmlManager.get("locale","menu_zoomdown_btn"),icon:"zoom-up",alternativeIcon:"zoom-down",onload:function(t){var n=t.getAttribute("data-alternativeIcon"),i=t.getAttribute("data-alternativeLabel"),a=e.Param.newThemeVersion?"-v4":"",r=null,o="",s="";window.addEventListener("webpub-zoom",function(){var l=this.label,u=this.icon.url?this.icon:this.icon+a;r!==e.Param.zoom&&(e.Param.zoom&&(n&&(u=this.alternativeIcon.url?this.alternativeIcon:this.alternativeIcon+a),i&&(l=this.alternativeLabel)),o!==l&&NIApi.menu.setTitle("zoom_btn",l),s!==u&&NIApi.menu.setIcon("zoom_btn",u,t),o=l,s=u,r=e.Param.zoom)}.bind(this))},onclick:function(){e.Main.viewerManager.isZoomed()?e.Main.viewerManager.zoomOut():e.Main.viewerManager.zoomIn()}},zoomup_btn:{label:e.Main.xmlManager.get("locale","menu_zoomup_btn"),icon:"zoom-up",onclick:function(){e.Main.viewerManager.zoomIn()}},zoomdown_btn:{label:e.Main.xmlManager.get("locale","menu_zoomdown_btn"),icon:"zoom-down",onclick:function(){e.Main.viewerManager.zoomOut()}},chapters:{template:"menuItem-chapters",items:e.Main.xmlManager.get("common-ui","configs","chapters"),isInThumbnail:!1},cart_btn:{icon:"cart-1",onload:function(){console.warn('cart_btn load : Please overide default behaviour with w.Main.menuService.set("cart_btn", { ... })')},onclick:function(){console.warn('cart_btn click : Please overide default behaviour with w.Main.menuService.set("cart_btn", { ... })')}}};return r.pagemark_btn=r.favorite_btn,{get:t,set:n,add:i}}}(webpublicationNamespace),function(e){function t(){}function n(e,t){return e.index-t.index}function i(e){for(var t=e.length;t--;)e[t].content.forEach(function(n){if(n.circle)e[t].type="circle";else if(n.text)e[t].type="text";else if(n.file){"/"===n.file.url[n.file.url.length-1]&&n.file.url.indexOf("http:")===-1&&(n.file.url+="index.html");var i=/(?:\.([^.]+))?$/.exec(n.file.url)[1];i?(i=i.toUpperCase(),["JPG","JPEG","PNG","SVG","GIF","WEBP"].indexOf(i)>=0?e[t].type="image":"JSON"===i?e[t].type="swiffy":"HTML"===i.substring(0,4)?e[t].type="iframe":"SWF"===i?e[t].type="boh":e[t].type="boh"):e[t].type="boh"}else n.roundrect?e[t].type="roundrect":n.rect?e[t].type="rect":n.roundrectcomplex?e[t].type="roundrectcomplex":n.symbol?e[t].type="symbol":n.video?e[t].type="video":e[t].type="boh";n.x=parseInt(n.x),n.y=parseInt(n.y),n.width=parseInt(n.width),n.height=parseInt(n.height)});return e}var a,r={},o={},s="zoom";t.prototype.getPageCount=function(){var t=e.Main.playlistManager.isEnabled;return t?e.Main.playlistManager.pageCount:e.Main.xmlManager.get("common-configuration","config","pageCount")},t.prototype.getCurrent=function(){return e.Main.pagesLoaderNew.getCurrentPage()},t.prototype.getImage=function(t,n){if("undefined"==typeof n&&(n=e.Main.pageManager.getCurrent()),"mdpi"===t)return e.Main.xmlManager.get("common-configuration","contents","low","path").replace("%num%",n);if("ldpi"===t){var i=e.Main.xmlManager.get("common-configuration","contents","thumbnails_xdpi","path"),a=e.Main.xmlManager.get("common-configuration","contents","thumbnails","path");return i?i.replace("%num%",n):a.replace("%num%",n)}return"svg"===t?e.Main.xmlManager.get("common-configuration","contents","svg","path").replace("%num%",n):e.Main.xmlManager.get("common-configuration","contents",s,"path").replace("%num%",n)},t.prototype.getSvg=function(t){return e.Main.xmlManager.get("common-configuration","contents","svg","path").replace("%num%",t)},t.prototype.getPdf=function(t){return e.Main.xmlManager.get("common-configuration","contents","pdf","path").replace("%num%",t)},t.prototype.getEpubHtml=function(t){var n=e.Main.playlistManager.isEnabled,i=n?e.Main.playlistManager.getOriginalPageNumber(t):t;return e.Main.xmlManager.get("common-configuration","contents","epub-HTML","path").replace("%num%",i)},t.prototype.getPdfHtml=function(t){return e.Main.xmlManager.get("common-configuration","contents","pdf-HTML","path").replace("%num%",t)},t.prototype.hasLinks=function(e){return!!r[e]},t.prototype.getLinks=function(t){return(r[t]||[]).filter(function(t){return("single"!==t.layout||2!==this.pagePerScreen())&&(("double"!==t.layout||1!==this.pagePerScreen())&&(("landscape"!==t.orientation||e.Param.isPortrait!==!0)&&("portrait"!==t.orientation||e.Param.isPortrait!==!1)))},this)},t.prototype.getRealLinks=function(e){return r[e]},t.prototype.getLinksPromise=function(t){return!!r[t]||(void 0===o[t]?(o[t]=new Promise(function(a,s){var l=new XMLHttpRequest,u=e.Main.xmlManager.get("common-configuration","contents","links","path").replace("%num%",t);l.open("GET",u,!0),l.onreadystatechange=function(){if(4===l.readyState){for(var s=[],u=null,c=l.responseXML?l.responseXML.querySelectorAll("lk"):[],p=0;p<c.length;p++)if(u=c[p].getAttribute("aim"),null===u||u.split(",").indexOf("html")!==-1){for(var h={index:c[p].getAttribute("index")||null,id:c[p].getAttribute("id")||null,layout:c[p].getAttribute("layout")||null,orientation:c[p].getAttribute("orientation")||null,useract:[],content:[]},d=c[p].querySelectorAll("content"),f=0;f<d.length;f++){var m,g={y:d[f].getAttribute("y"),x:d[f].getAttribute("x"),width:d[f].getAttribute("width"),height:d[f].getAttribute("height"),id:d[f].getAttribute("id")},v=d[f].querySelector("*");g[v.tagName]={};for(var b=0;b<v.attributes.length;b++)m=v.attributes[b].value,"true"===m?g[v.tagName][v.attributes[b].name]=!0:"false"===m?g[v.tagName][v.attributes[b].name]=!1:g[v.tagName][v.attributes[b].name]=e.Utils.resolveVariable(m);v.textContent&&(g.textContent=v.textContent),h.content.push(g)}for(var y=c[p].querySelectorAll("useract"),E=0;E<y.length;E++){for(var M={},S=0;S<y[E].attributes.length;S++)M[y[E].attributes[S].name]=y[E].attributes[S].value;M.textField=y[E].textContent,h.useract.push(M);
}s.push(h)}s=i(s.sort(n)),r[t]=s,a(s),o[t]=void 0,delete o[t]}},l.send()}),o[t].isNew=!0):o[t].isNew=!1,o[t])},t.prototype.pagePerScreen=function(){var t=e.Main.pageLayoutService.get("pageLayout");return"single"===t?function(){return 1}:"double"===t?function(){return 2}:function(){var t=e.Main.xmlManager.get("common-configuration","contents","zoom","width"),n=e.Main.xmlManager.get("common-configuration","contents","zoom","height");return t>n?1:e.Param.isPortrait?1:2}}(),t.prototype.pagesOnFirstScreen=function(){var t=e.Main.pageLayoutService.get("pagesOnFirstFrame"),n=e.Main.pageManager.pagePerScreen();return t<=n?t:n},t.prototype.getBackgroundColor=function(t){return e.Main.commonLayout.get("pages."+t+".backgroundColor")||"transparent"},t.prototype.set=function(t){e.Main.xmlManager.get("common-ui","configs","deepLinking")===!0&&("undefined"==typeof e.Main.urlManager.get("page")&&e.Main.urlManager.set("page",t),t!==a&&(a=t,e.Main.urlManager.set("page",t)))},t.prototype.onChange=function(){var t=[];return window.addEventListener("hashchange",function(n){e.Main.urlManager.init();var i=parseInt(e.Main.urlManager.get("page"),10);if(i!==a)for(var r=0;r<t.length;r++)t[r](i)}),function(e){t.push(e)}}(),t.prototype.init=function(){var t=screen.height||window.innerHeight,n=screen.width||window.innerWidth,i=!0;e.Param.isDesktop===!1&&Math.max(t,n)*window.devicePixelRatio<=1300&&(i=!1),null!==e.Main.xmlManager.get("common-configuration","contents","zoom_hd","path")&&i&&(s="zoom_hd")},e.Class.PageManager=t}(webpublicationNamespace),function(e){e.Class.PagesLoaderNew=function(){function t(e){r=e;for(var t=o.length;t--;)o[t](r)}function n(){return r}function i(){return e.Main.pageManager.getPageCount()}function a(e){"function"==typeof e&&o.push(e)}var r=1,o=[];return{setCurrentPage:t,getCurrentPage:n,getPageQuantity:i,addPageChangeCallback:a}}}(webpublicationNamespace),function(e){e.Class.PaginationManager=function(){function t(e,t){ee(e,t)}function n(t,n){"undefined"!=typeof n&&he[t]&&he[t].active&&(he[t].added=!0,he[t].type=t,e.Main.templateManager.loadAppend(e.Param.pathTemplate+"pagination.html",n,he[t]).then(de[he[t].type]).then(fe[he[t].type]))}function i(t){NIApi.page["open"+e.Utils.capitalize(t)]()}function a(){if(he.lateral.prevNext||he.lateral.firstLast){var t=e.Main.viewerManager.getCurrentPages(),n=t.map(function(e){return X(e)});if(1===n.length)return void r(ae.BOTH,n[0]);r(ae.LEFT,n[0]),r(ae.RIGHT,n[1])}}function r(e,t){s(e,o(t)),l(e,t),m(e,t)}function o(e){var t=parseFloat(f(e,"opacity")),n=parseFloat(f(e,"bgOpacity"));return 0===t&&0===n}function s(e,t){(c(e)||h(e))&&he.lateral.left.classList.toggle(ce,t),(p(e)||h(e))&&he.lateral.right.classList.toggle(ce,t)}function l(e,t){var n=d(t,"color","opacity");u(e,n)}function u(e,t){he.lateral.prevNext&&((c(e)||h(e))&&(he.lateral.prev.style.color=t),(p(e)||h(e))&&(he.lateral.next.style.color=t)),he.lateral.firstLast&&((c(e)||h(e))&&(he.lateral.first.style.color=t),(p(e)||h(e))&&(he.lateral.last.style.color=t))}function c(e){return e===ae.LEFT}function p(e){return e===ae.RIGHT}function h(e){return e===ae.BOTH}function d(t,n,i){var a=f(t,n),r=f(t,i);return e.Utils.hexToRgb(a,r)}function f(t,n){var i=t&&t[n];if(void 0===i){var a=re[n];return e.Main.cssManager.getStyle("primary",a)}return i}function m(e,t){var n=d(t,"bgColor","bgOpacity");g(e,n)}function g(e,t){(c(e)||h(e))&&(he.lateral.left.style.backgroundColor=t),(p(e)||h(e))&&(he.lateral.right.style.backgroundColor=t)}function v(t){if(he.lateral.prevNext||he.lateral.firstLast){a();var n=e.Main.pageManager.getPageCount(),i=e.Main.viewerManager.getFrameOfPage(t),r=e.Main.viewerManager.getFrameOfPage(1),o=e.Main.viewerManager.getFrameOfPage(n),s=i===r,l=i===o;he.lateral.left.classList.toggle(ue,s),he.lateral.right.classList.toggle(ue,l),NIApi.page.getVisiblePages().then(function(t){var n=t[0]-1,i=e.Main.configsJsonManager.getPageData(["arrow"],n).arrow;if(!i){var a="pages."+t[0]+".paginationBackground",r="pages."+t[0]+".paginationColor",o="pages."+t[t.length-1]+".paginationBackground",s="pages."+t[t.length-1]+".paginationColor";he.lateral.left.style.backgroundColor=e.Main.commonLayout.get(a)||"",he.lateral.right.style.backgroundColor=e.Main.commonLayout.get(o)||"",he.lateral.prevNext&&(he.lateral.prev.style.color=e.Main.commonLayout.get(r)||"",he.lateral.next.style.color=e.Main.commonLayout.get(s)||""),he.lateral.firstLast&&(he.lateral.first.style.color=e.Main.commonLayout.get(r)||"",he.lateral.last.style.color=e.Main.commonLayout.get(s)||"")}})}}function b(e){var t=Y(e);he.vertical.backToTop.style.color=t,he.vertical.side.style.color=t}function y(e){var t=W(e);he.vertical.side.style.backgroundColor=t,he.vertical.backToTop.style.backgroundColor=t}function E(t){void 0===t&&(t=e.Main.pagesLoaderNew.getCurrentPage());var n=e.Main.viewerManager.getFrameOfPage(t),i=1===n;i||(b(t),y(t))}function M(){he.vertical.center.classList.remove(ue)}function S(){he.vertical.center.classList.add(ue)}function P(){he.vertical.side.classList.remove(ue)}function w(){he.vertical.side.classList.add(ue)}function _(e){[oe.LEFT,oe.CENTER,oe.RIGHT].forEach(function(e){return he.vertical.side.classList.remove(e)}),he.vertical.side.classList.add(e)}function T(){he.vertical.backToTop.classList.remove(ue)}function A(){he.vertical.backToTop.classList.add(ue)}function C(){he.vertical.sidePrev.classList.remove(ue)}function L(){he.vertical.sidePrev.classList.add(ue)}function x(){he.vertical.side.classList.remove(pe)}function k(){he.vertical.side.classList.add(pe)}function O(){he.vertical.sideNext.classList.remove(ue)}function I(){he.vertical.sideNext.classList.add(ue)}function N(t){var n=e.Utils.prodTools.getPageLength(),i=e.Main.viewerManager.getFrameOfPage(t),a=e.Main.viewerManager.getFrameOfPage(n),r=i===a,o=Z(t);he.vertical.center.classList.toggle("transparent",o),he.vertical.side.classList.toggle("transparent",o),he.vertical.backToTop.classList.toggle("transparent",o);var s=1===i,l="verticalOnePage"===e.Main.startupManager.get("core.viewerDirection");if(l)return void R(s);if(s)return void D(r);S();var u=e.Main.startupManager.has("core.verticalArrow.display",e.Param.userAgent.device.type);return u?(C(),P(),T(),r?void F():void B()):void U()}function D(e){e?S():M(),x(),L(),I(),w(),A()}function R(e){S(),U(),e?A():T()}function U(){L(),I()}function F(){I(),k()}function B(){O(),x()}function V(){he.vertical.position===oe.HIDDEN?(S(),w()):(M(),P(),_(he.vertical.position))}function G(e){E(e),N(e)}function H(t,n){t.addEventListener(e.Param.eventStop,i.bind({},n))}function z(t){for(var n=t.length;n--;)t[n].classList.contains("webpub-pagination__lateral-left")?he.lateral.left=t[n]:t[n].classList.contains("webpub-pagination__lateral-right")&&(he.lateral.right=t[n]);if(he.lateral.prevNext){var i=he.lateral.left.querySelector(".webpub-pagination__lateral-arrow-prev");he.lateral.prev=i.querySelector("svg");var r=he.lateral.right.querySelector(".webpub-pagination__lateral-arrow-next");he.lateral.next=r.querySelector("svg"),H(i,se.PREVIOUS),H(r,se.NEXT)}if(he.lateral.firstLast){var o=he.lateral.left.querySelector(".webpub-pagination__lateral-arrow-first");he.lateral.first=o.querySelector("svg");var s=he.lateral.right.querySelector(".webpub-pagination__lateral-arrow-last");he.lateral.last=s.querySelector("svg"),H(o,se.FIRST),H(s,se.LAST)}if(he.lateral.alwaysVisible){var l={paddingLeft:52,paddingRight:52};e.Main.viewerService.set(l)}e.Main.pagesLoaderNew.addPageChangeCallback(fe.lateral),document.addEventListener("configsJson.pageDataUpdated",function(){a()})}function j(e){for(var t=e.length;t--;)e[t].classList.contains("webpub-pagination__vertical-backToTop")?he.vertical.backToTop=e[t]:e[t].classList.contains("webpub-pagination__vertical-side")?he.vertical.side=e[t]:e[t].classList.contains("webpub-pagination__vertical-center")&&(he.vertical.center=e[t]);he.vertical.centerNext=he.vertical.center.querySelector(".webpub-pagination__vertical-arrow"),he.vertical.sideNext=he.vertical.side.querySelector(".webpub-pagination__vertical-arrow.reversed"),he.vertical.sidePrev=he.vertical.side.querySelector(".webpub-pagination__vertical-arrow:not(.reversed)")}function q(){var e=W(1),t=Y(1);he.vertical.center.style.backgroundColor=e,he.vertical.center.style.color=t,Z(1)&&he.vertical.center.classList.add("transparent")}function W(e){var t=X(e);return d(t,"bgColor","bgOpacity")}function Y(e){var t=X(e);return d(t,"color","opacity")}function Z(e){var t=X(e),n=f(t,"opacity"),i=f(t,"bgOpacity"),a=["0","0%"];return a.includes(n)&&a.includes(i)}function X(t){var n=t-1;return e.Main.configsJsonManager.getPageData(["arrow"],n).arrow||{}}function K(){H(he.vertical.backToTop,se.FIRST),H(he.vertical.centerNext,se.NEXT),H(he.vertical.sideNext,se.NEXT),H(he.vertical.sidePrev,se.PREVIOUS)}function Q(t){j(t),q(),K(),e.Main.pagesLoaderNew.addPageChangeCallback(fe.vertical),document.addEventListener("configsJson.pageDataUpdated",function(){E(),q()})}function J(t,n){var i=e.Param.sliderDirection===le.HORIZONTAL;he.lateral.theme=n||ie.SHARP,he.lateral.active=i,t.lateral&&(t.lateral.display&&(he.lateral.alwaysVisible=t.lateral.display===ne.STICKY),t.lateral.hasOwnProperty("hasPrevNext")?he.lateral.prevNext=t.lateral.hasPrevNext:he.lateral.prevNext=he.lateral.prevNext,t.lateral.hasOwnProperty("hasFirstLast")?he.lateral.firstLast=t.lateral.hasFirstLast:he.lateral.firstLast=he.lateral.firstLast),e.Param.isDesktop===!1&&he.lateral.alwaysVisible===!1&&(he.lateral.active=!1)}function $(){var t=e.Param.sliderDirection===le.VERTICAL,n=e.Main.startupManager.get("core.verticalArrow.position");he.vertical.active=t,he.vertical.alwaysVisible=!0,he.vertical.position=n?n:oe.LEFT,NIApi.register("pagination.setVerticalArrowPosition",function(t){var n=e.Param.sliderDirection===le.VERTICAL,i="verticalOnePage"===e.Main.startupManager.get("core.viewerDirection"),a=n&&!i;a&&(he.vertical.position=t,V())}),NIApi.register("pagination.getVerticalArrowPosition",function(){return he.vertical.position})}function ee(e,t){e.mode&&(e.mode.indexOf(te.LATERAL)>=0&&J(e,t),e.mode.indexOf(te.VERTICAL)>=0&&$())}var te={LATERAL:"lateral",VERTICAL:"vertical"},ne={STICKY:"sticky",NEAR:"near"},ie={SHARP:"sharp",ROUNDED:"rounded"},ae={LEFT:"left",RIGHT:"right",BOTH:"both"},re={color:"lateralArrowsColor",opacity:"lateralArrowsAlpha",bgColor:"lateralArrowsBackgroundColor",bgOpacity:"lateralArrowsBackgroundAlpha"},oe={LEFT:"left",CENTER:"center",RIGHT:"right",HIDDEN:"hidden"},se={PREVIOUS:"previous",NEXT:"next",FIRST:"first",LAST:"last"},le={HORIZONTAL:"horizontal",VERTICAL:"vertical"},ue="hide",ce="transparent",pe="noNextPage",he={lateral:{alwaysVisible:!1,firstLast:!0,prevNext:!0,active:!1},vertical:{active:!1}},de={lateral:z,vertical:Q},fe={lateral:v,vertical:G};return{init:t,addPagination:n}}}(webpublicationNamespace),function(e){function t(){NIApi.register("page.downloadPDF",function(t){return Promise.resolve(e.Main.pdfManager.download(t.toUpperCase()))}),NIApi.register("page.print",function(t){return"undefined"==typeof t&&(t="ALL"),"string"==typeof t&&(t=t.toUpperCase()),"ALL"===t?Promise.resolve(e.Main.pdfManager.print):Promise.resolve(e.Main.pdfManager.print.bind({},t))})}function n(){t()}n.prototype._getUrl=function(t,n){if(t.indexOf(";")!==-1||t.indexOf("-")!==-1){for(var i=t.split(";"),a=e.Main.xmlManager.get("common-configuration","config","pageCount"),r=[],o=0;o<i.length;o++)if(i[o].indexOf("-")!==-1)for(var s=parseInt(i[o].split("-")[0],10),l=parseInt(i[o].split("-")[1],10)>a?a:parseInt(i[o].split("-")[1],10);s<=l;s++)r.indexOf(s)===-1&&r.push(s);else{var u=parseInt(i[o],10)>a?a:parseInt(i[o],10);r.indexOf(u)===-1&&r.push(u)}r=r.filter(Boolean).sort(function(e,t){return e-t}),t=r.join(",")}var c=e.Utils.resolveVariable("${manager_host}/services/rest/playerGateway/pdfmerge");return c=e.Utils.addParamsToUrl(c,"genId="+e.Main.xmlManager.getVariable("id")),c=e.Utils.addParamsToUrl(c,"clientId="+e.Main.xmlManager.getVariable("client_id")),c=e.Utils.addParamsToUrl(c,"pages="+t),"print"===n&&(c=e.Utils.addParamsToUrl(c,"print=true")),c},n.prototype.download=function(t){t=t||"ALL";var n=this._getUrl(t,"download");e.Main.trackerManager.trackEvent({name:"pdfDownload",variables:{1:t}});window.open(n,"_blank");return Promise.resolve(!0)},n.prototype.print=function(t){if(t=t||"ALL",e.Param.isDesktop||e.Param.isUnknown){var n=this._getUrl(t,"print");e.Main.trackerManager.trackEvent({name:"print",variables:{1:t}}),window.open(n,"_blank")}else this.download(t)},e.Class.PdfManager=n}(webpublicationNamespace),function(e){e.Utils.prodTools={},e.Utils.prodTools.getPageLength=function(){return e.Main.pageManager.getPageCount()},NIApi.register("common.getDeviceInformation",function(){var t={};return t.type=e.Param.userAgent.device.type,t.os=e.Param.userAgent.os.name+" "+e.Param.userAgent.os.version,t.browser=e.Param.userAgent.browser.name,t.isApp=e.Param.isApp,Promise.resolve(t)}),NIApi.register("event.onPageChange",function(t){return e.Main.pagesLoaderNew.addPageChangeCallback(t),!0}),NIApi.register("page.getVisiblePages",function(){return Promise.resolve(e.Utils.getVisiblePages())}),NIApi.register("navigator.openUrl",function(t){return Promise.resolve(window.open(e.Utils.resolveVariable(t),"_blank"))}),NIApi.register("navigator.close",function(t){return e.Main.menuService.get("home").onclick(),Promise.resolve(!0)}),e.Utils.prodTools.showTools=function(t){e.Main.toolsEvents.showTools(t)},e.Utils.prodTools.onPageChange=function(t){e.Main.pagesLoaderNew.addPageChangeCallback(t)},e.Utils.prodTools.getWordLangueByIndex=function(t){return e.Main.xmlManager.get("locale",t)}}(webpublicationNamespace),function(e){function t(){this.initialised=!1,this.worker=null,this.counter=0,this.finalResultElement=null,this.notificationElement=null,this.strictResultElement=null,this.unstrictResultElement=null,this.formField=null,this.searchedWord="",n()}function n(){NIApi.register("panels.search",{toggle:function(){e.Main.searchManager.toggle()}})}var i=[37,38,39,40];t.prototype.displayEnd=function(){this.setCounter(this.counter),this.finalResultElement.classList.add("search__searched"),0===this.counter?(this.notificationElement.classList.add("alert"),this.finalResultElement.classList.add("search__no-result")):(this.notificationElement.classList.add("notification"),this.finalResultElement.classList.add("search__has-result"))},t.prototype.displayResult=function(t){var n=t.isStrict,i=n?this.strictResultElement:this.unstrictResultElement;e.Main.templateManager.loadAppend(e.Param.pathTemplate+"component/searchItem.html",i,{page:t.page,displayNumber:e.Utils.byOffsetIndex(t.page),string:t.string,label:t.label,containerParentId:t.container&&t.container.parentId,containerId:t.container&&t.container.id,isAnimationState:!!t.container}),this.counter++},t.prototype.init=function(){if(this.initialised===!1){this.worker=new Worker(e.Param.pathJavaScript+"workerSearch.js"),this.worker.addEventListener("message",function(e){if("parse"===e.data.method){var t=this.getPagesContent(e.data.data);this.worker.postMessage({method:"parsedString",data:t})}else"result"===e.data.method?this.displayResult(e.data):"end"===e.data.method&&this.displayEnd(e.data)}.bind(this));var t={method:"config",pageLength:e.Main.xmlManager.get("common-configuration","config","pageCount"),xmlUrl:e.Param.pathRootForWorker+e.Main.xmlManager.get("common-configuration","contents","text","path")};t.wordSearch=!0,this.worker.postMessage(t),this.initialised=!0}},t.prototype.getPagesContent=function(t){var n=e.JXONTree((new DOMParser).parseFromString(t,"text/xml")),i=e.Main.playlistManager.isEnabled;if(!i)return n;var a=n.texts.page,r=e.Main.playlistManager.getPageIndexes(),o=r.map(function(e,t){var n=Object.assign({},a[e]);return n["@num"]=String(t+1),n});return n.texts.page=o,n},t.prototype.reset=function(){this.resetContent(),this.formField.value="",this.searchedWord=""},t.prototype.resetContent=function(){this.notificationElement.classList.remove("alert"),this.notificationElement.classList.remove("notification"),this.finalResultElement.classList.remove("search__no-result"),this.finalResultElement.classList.remove("search__has-result"),this.finalResultElement.classList.remove("search__searched"),e.Main.searchManager.strictResultElement.innerHTML="",e.Main.searchManager.unstrictResultElement.innerHTML="",this.setCounter("")},t.prototype.search=function(t,n){n=n||2;var a=t?t.keyCode:t;i.indexOf(a)>=0||(this.resetContent(),this.counter=0,0!==this.formField.value.length&&(this.formField.value.length>=n||13===a&&this.formField.value.length<n)&&(this.strictResultElement.innerHTML="",this.unstrictResultElement.innerHTML="",e.Main.searchManager.worker.postMessage({method:"search",search:this.formField.value}),this.searchedWord=this.formField.value))},t.prototype.searchEvent=function(t){this.formField.value.length>=2&&(this.eventTimer&&clearTimeout(this.eventTimer),this.eventTimer=setTimeout(function(){e.Main.trackerManager.trackPage({name:"search-alt",variables:{1:this.formField.value}})}.bind(this),1e3))},t.prototype.setCounter=function(e){Array.prototype.slice.call(document.querySelectorAll(".search__counter")).forEach(function(t){t.innerHTML=e})},t.prototype.openState=function(t,n){var i=document.getElementById(t),a=document.getElementById(n);if(i&&a){var r=a.getAttribute("data-idgenobjectstate");e.epubAnimUtils.goToState(t,r)}else setTimeout(function(){e.Main.searchManager.openState(t,n)},500)},t.prototype.show=function(){var t=function(t){e.Main.searchManager.finalResultElement=t.querySelector(".search__final-result"),e.Main.searchManager.notificationElement=t.querySelector(".search__notification"),e.Main.searchManager.strictResultElement=t.querySelector(".search__result__strict"),e.Main.searchManager.unstrictResultElement=t.querySelector(".search__result__unstrict"),e.Main.searchManager.formField=t.querySelector(".search__form-field"),e.Main.searchManager.formField.addEventListener("keyup",e.Main.searchManager.search.bind(e.Main.searchManager)),e.Main.searchManager.formField.addEventListener("keyup",e.Main.searchManager.searchEvent.bind(e.Main.searchManager)),e.Main.searchManager.formField.addEventListener("keydown",function(e){if(13===e.keyCode||i.indexOf(e.keyCode)>=0)return 13===e.keyCode&&e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1}),t.querySelector(".search__form-submit").addEventListener(e.Param.eventClick,function(t){e.Main.searchManager.search(t,1)}),t.querySelector(".search__form-reset").addEventListener(e.Param.eventClick,e.Main.searchManager.reset.bind(e.Main.searchManager));var n=function(t){var n=e.Utils.getClosestByClass(t.target,"search__item");if(n!==!1){var i=n.getAttribute("data-page");e.Class.LightboxManagerNew.closeAll();var a=n.getAttribute("data-containerParentId"),r=n.getAttribute("data-containerId");NIApi.page.open(i).then(function(){a&&r&&e.Main.searchManager.openState(a,r)}.bind(this))}};e.Main.searchManager.strictResultElement.addEventListener(e.Param.eventClick,n),e.Main.searchManager.unstrictResultElement.addEventListener(e.Param.eventClick,n);var a=e.Class.LightboxManagerNew.get("search-manager");a.setTitle(document.querySelector(".search__form")),""!==a.params.subtemplate.params.search&&e.Main.searchManager.search()};e.Main.trackerManager.trackPage({name:"search"}),new e.Class.LightboxManagerNew({id:"search-manager",theme:"page",menuButton:!1,animation:"none",subtemplate:{url:e.Param.pathTemplate+"search.html",params:{search:this.searchedWord}},onload:function(e){t(e[0])}})},t.prototype.toggle=function(){var t=document.querySelector("#webpub-lightbox-search-manager");t?e.Class.LightboxManagerNew.closeAll():e.Main.searchManager.show()},e.Class.SearchManager=t}(webpublicationNamespace),function(e){function t(t){t||(t=e.Utils.createUrlForPages()),t=e.Utils.whitelistParameters(t),t=t.replace("&","%26");var n="mailto:?subject="+document.title+"&body="+document.title+": %0D%0A "+t;return n}function n(t){for(var n={},o=[],s=t.querySelectorAll("input, textarea"),u=!0,c=0;c<s.length;c++){var p=s[c],h=!0;if(p.hasAttribute("data-validation")&&(h=r(p)),h){n[p.getAttribute("name")]=p.value;var d=o.indexOf(p.parentNode.getAttribute("data-error"));d>=0&&o.splice(d,1)}else u=!1,o.push(p.parentNode.getAttribute("data-error"))}if(u===!1)return l(o),!1;n.language=a(e.Main.xmlManager.getVariable("locale")),n.clientId=e.Main.xmlManager.getVariable("client_id"),n.genId=e.Main.xmlManager.getVariable("id"),e.Main.shareMailManager.url?n.pubUrl=e.Main.shareMailManager.url:n.pubUrl=e.Utils.createUrlForPages(n),e.Main.shareMailManager.keepOriginalUrl||(n.pubUrl=e.Utils.whitelistParameters(n.pubUrl));var f=document.createElement("a");f.href=n.pubUrl,n.querySearch=f.search,n.queryHash=f.hash,n.queryHost=f.protocol+"//"+f.host+f.pathname;var m=e.Main.xmlManager.getVariables();for(var g in m)0===g.indexOf("transferring")&&"undefined"!=typeof m[g]&&(n[g]=m[g]);var v="",b=e.Main.xmlManager.get("common-ui","services","sendmail","subject");v=n.transferring?e.Main.xmlManager.get("common-ui","services","sendmail","templateTransferring"):e.Main.xmlManager.get("common-ui","services","sendmail","template"),v&&(n.template=v),b&&(n.subject=b);var y=[e.Main.xmlManager.get("config","transferringVariable")];return e.Main.shareMailManager.keepOriginalUrl&&y.push(i(n.pubUrl)),n.extraAllowedParameters=y.join(","),n}function i(e){var t=new URL(e),n=t.searchParams.keys();return Array.from(n)}function a(e){var t=/^([a-z][a-z]_[A-Z][A-Z])\..*$/,n=t.exec(e),i=n?n[1]:void 0;return i}function r(t){if("mails"===t.getAttribute("data-validation")){var n=e.Utils.mailStringToArray(t.value);if(0===n.length)return t.parentNode.classList.add("alert"),!1;t.value=n.join(";").toLowerCase()}else if("required"===t.getAttribute("data-validation")&&!t.value)return t.parentNode.classList.add("alert"),!1;return t.parentNode.classList.remove("alert"),!0}function o(){return e.Main.shareMailManager.keepOriginalUrl?void e.Main.trackerManager.trackEvent({name:"shareMail-"+e.Main.shareMailManager.shareType,variables:{1:e.Main.shareMailManager.url}}):void e.Main.trackerManager.trackEvent({name:"shareMail"})}function s(t){return"undefined"==typeof t||0===t.length?e.Main.xmlManager.get("locale","mail_send_error"):1===t.length?e.Main.xmlManager.get("locale","mail_"+t[0]+"_error"):t.length>1?e.Main.xmlManager.get("locale","mail_fields_error"):void 0}function l(t){e.Utils.toast({html:s(t),duration:3e3,position:"bottom"})}function u(t){"response=ok"!==t.responseText&&console.warn("mail_send_error : "+e.Main.xmlManager.get("locale","mail_send_error")),e.Utils.toast({text:e.Main.xmlManager.get("locale","mail_send_success"),duration:3e3}),document.getElementsByName("to")[0].value="",e.Class.LightboxManagerNew.get("shareManager")&&e.Main.shareManager.open("confirm")}function c(){}var p={},h=function(t){var n="needBottomPadding",i="#webpub-lightbox-thumbnails-manager",a=t.querySelectorAll(i+" input, "+i+" textarea"),r="iOS"===e.Param.userAgent.os.name;if(r)for(var o=0;o<a.length;o++)a[o].onfocus=function(e){var t=window.document.querySelector(i);t.classList.add(n),setTimeout(function(){e.target.scrollIntoView(!0)},100)}.bind(this),a[o].onblur=function(e){var t=window.document.querySelector(i);t.classList.remove(n)}.bind(this)};c.prototype.send=function(t){e.Utils.preventDefault(t);var i=n(this);if(i!==!1){p=i,o();var a=new CustomEvent("webpub-tracking-sendMail",{detail:{}});window.dispatchEvent(a);var r=e.Main.xmlManager.get("common-ui","services","sendmail","url"),s=e.Utils.serialize(i);e.Utils.promiseXHR("POST",r,[{key:"Content-Type",value:"application/x-www-form-urlencoded; charset=UTF-8"}],s,!0).then(u)["catch"](l)}},c.prototype.load=function(t,n,i){this.keepOriginalUrl=n,this.shareType=i,t?this.url=t:this.url=null;var a=p,r=e.Main.shareManager.selectedThumb;a.sharedPages=r?r.pages:[],a.title=document.title,new e.Class.LightboxManagerNew({id:"shareManager",menuButton:!e.Param.isDesktop&&"close",closeButton:!!e.Param.isDesktop||this.createSendButton(),title:e.Main.xmlManager.get("locale","menu_mail"),theme:"page",animation:"none",subtemplate:{url:e.Param.pathTemplate+"shareMail.html",params:a},onload:function(t){h(t[0]);var n=t[0].querySelector('.webpub-lightbox-page-header-close [data-action="submit"]');n&&n.addEventListener(e.Param.eventClick,function(){var t=document.querySelector(".webpub-lightbox-page-content"),n=t.querySelector('[data-action="submit"]');e.Utils.callEvent(n,"submit")}),t[0].querySelector('.webpub-lightbox-page-content [data-action="submit"]').addEventListener("submit",this.send)}.bind(this)})},c.prototype.createSendButton=function(){var t=document.createElement("div"),n=document.createElement("div"),i=e.Utils.createSvgIcon("send-v4","wpmt-button-icon-center svgicon-new svgicon-v4");return n.classList.add("wpmt-button__default"),n.classList.add("wpmt-button__type-mail"),n.classList.add("wpmt-button__style-tiny"),n.setAttribute("data-action","submit"),n.appendChild(i),t.appendChild(n),t},c.prototype.doMailTo=function(e){location.href=t(e)},e.Class.ShareMailManager=c}(webpublicationNamespace),function(e){e.Class.ShareManager=function(){function t(){var t,n=(t={},_defineProperty(t,Y.COPY_URL,!0),_defineProperty(t,Y.MAIL,!0),_defineProperty(t,Y.PRINT,!0),_defineProperty(t,Y.DOWNLOAD,!0),_defineProperty(t,Y.FACEBOOK,!0),_defineProperty(t,Y.TWITTER,!0),_defineProperty(t,Y.LINKEDIN,!0),_defineProperty(t,Y.PINTEREST,!1),_defineProperty(t,Y.TUMBLR,!1),_defineProperty(t,Y.WHATSAPP,!1),t),i=e.Main.startupManager.get("core.share.methods"),a=i||n;return le||(a.print=!1,a.download=!1),a}function n(t,n){if((n||pe[t]===!0)&&he[t]){var i=e.Utils.createUrlForPages({page:e.Main.urlManager.get("page")});return i=e.Utils.whitelistParameters(i),he[t](i),["copy_url","print","download","mail"].indexOf(t)===-1&&e.Main.trackerManager.trackEvent({name:"shareSocial",variables:{1:e.Utils.capitalize(t)}}),!0}return!1}function i(){return K="frame",2===J.length?void M(W.FRAME):($=[e.Main.pageManager.getCurrent()],e.Main.shareManager.selectedThumb.pages=$,"download"===e.Main.shareManager.sharePanelPath||"print"===e.Main.shareManager.sharePanelPath?void b(e.Main.shareManager.sharePanelPath):void M(W.SOCIAL))}function a(){var t=r(),n=o(),i=e.Main.xmlManager.get("common-configuration","config","pageCount"),a=t<=0||t>n,s=n>i,l=a||s,u=document.querySelector(".webpub-share__pageRange");u.classList.toggle("error",l),u.classList.toggle("error-first",a),u.classList.toggle("error-last",s);var c=document.querySelector('.webpub-share__pageRange button[name="confirm"]');c.disabled=l;var p=document.querySelector(".webpub-share__pageRange .errorMessage");p.classList.toggle("show",l)}function r(){return s("pageRangeFrom")}function o(){return s("pageRangeTo")}function s(t){var n=document.querySelector('.webpub-share__pageRange input[name="'+t+'"]').value,i=e.Utils.byOffsetIndex(n,!0);return i}function l(){K="pageRange";var t=r(),n=o();return $=u(t,n),e.Main.shareManager.selectedThumb.pages=$,"download"===e.Main.shareManager.sharePanelPath||"print"===e.Main.shareManager.sharePanelPath?(Q="pdf",void b(e.Main.shareManager.sharePanelPath)):(M(W.SOCIAL),void k(t))}function u(e,t){for(var n=[],i=e;i<=t;i++)n.push(i);return n}function c(){return"download"===e.Main.shareManager.sharePanelPath||"print"===e.Main.shareManager.sharePanelPath?(Q="pdf",void b(e.Main.shareManager.sharePanelPath)):(K="publication",k(1),le?void M(W.PUBLICATION):(Q="url",void M(W.SOCIAL)))}function p(){e.Main.thumbnailListManager.show("favorite",e.Main.shareManager.sharePanelPath)}function h(t,n,i){return K="favorite",$=t,Q=n,e.Main.shareManager.sharePanelPath=i,e.Main.shareManager.selectedThumb.pages=t,"download"===e.Main.shareManager.sharePanelPath||"print"===e.Main.shareManager.sharePanelPath?void b(e.Main.shareManager.sharePanelPath):void M(W.SOCIAL)}function d(e){e.length>0&&($=e),K="favorite",M(W.SOCIAL)}function f(){M(W.HOME)}function m(){if(Z===W.FRAME){if($=[],0===document.querySelectorAll(".webpub-share__checkbox--checked").length)return;document.querySelector(".webpub-share__left-page").classList.contains("webpub-share__checkbox--checked")?($.push(J[0]),e.Main.shareManager.selectedThumb.pages.push(J[0])):e.Main.shareManager.selectedThumb.left=!1,document.querySelector(".webpub-share__right-page").classList.contains("webpub-share__checkbox--checked")?($.push(J[1]),e.Main.shareManager.selectedThumb.pages.push(J[1])):e.Main.shareManager.selectedThumb.right=!1}else Z===W.PUBLICATION&&(document.querySelector(".webpub-share__online-url").classList.contains("webpub-share__checkbox--checked")?Q="url":document.querySelector(".webpub-share__pdf").classList.contains("webpub-share__checkbox--checked")&&(Q="pdf"));return"download"===e.Main.shareManager.sharePanelPath||"print"===e.Main.shareManager.sharePanelPath?void b(e.Main.shareManager.sharePanelPath):void M(W.SOCIAL)}function g(t){var n=e.Utils.getClosestByClass(t.target,"webpub-share__item"),i=document.querySelector("[data-page="+n.getAttribute("data-page")+"]");i.classList.toggle("webpub-share__thumbnail-unchecked"),n.classList.toggle("webpub-share__checkbox--checked"),0===document.querySelectorAll(".webpub-share__checkbox--checked").length?document.querySelector(".webpub-share__button-confirm").classList.add("webpub-share__button-disabled"):document.querySelector(".webpub-share__button-confirm").classList.remove("webpub-share__button-disabled")}function v(t){var n=e.Utils.getClosestByClass(t.target,"webpub-share__item");n.classList.contains("webpub-share__online-url")?(n.classList.add("webpub-share__checkbox--checked"),document.querySelector(".webpub-share__pdf").classList.remove("webpub-share__checkbox--checked")):n.classList.contains("webpub-share__pdf")&&(n.classList.add("webpub-share__checkbox--checked"),document.querySelector(".webpub-share__online-url").classList.remove("webpub-share__checkbox--checked"))}function b(e){var t=E(e);he[e](t),y(e);var n=new CustomEvent("webpub-tracking-share",{detail:{method:e}});window.dispatchEvent(n),["mail"].indexOf(e)===-1&&M(W.CONFIRM_MESSAGE)}function y(t){var n=!!ee,i=n?{name:"shareSocial-"+ae+"-"+t,variables:{1:ee}}:{name:"shareSocial-"+t};e.Main.trackerManager.trackEvent(i)}function E(t){if(ee)return ee;var n="";return n=["copy_url","print","download","mail"].includes(t)?"frame"===K||"pageRange"===K?e.Utils.createUrlForPages({page:$[0]}):e.Utils.createUrlForPages({page:1}):"frame"===K||"pageRange"===K?e.Utils.createUrlForPages({page:$[0]}):"url"===Q?e.Utils.createUrlForPages():e.API.pdfGetUrl(),"favorite"!==K&&"pageRange"!==K||(n=e.Utils.addParamsToUrl(n,"bookmarks="+$)),n="favorite"===K||"frame"===K?e.Utils.addParamsToUrl(n,"initState=nowelcomepage"):e.Utils.addParamsToUrl(n,"initState=welcomepage"),n=e.Utils.whitelistParameters(n)}function M(t){return Z=t,e.Utils.empty(X),t===W.FAVORITE&&(t=W.HOME),e.Main.templateManager.loadAppend(e.Param.pathTemplate+"share"+e.Utils.capitalizeWord(t)+".html",X,{sharePanelTitle:F(e.Main.shareManager.sharePanelPath),confirmMessage:B(e.Main.shareManager.sharePanelPath),thumbnailUrlLeftInactive:!e.Main.shareManager.selectedThumb.left,thumbnailUrlRightInactive:!e.Main.shareManager.selectedThumb.right,thumbnailUrlLeft:e.Main.pageManager.getImage("ldpi",J[0]),thumbnailUrlRight:!!J[1]&&e.Main.pageManager.getImage("ldpi",J[1]),isPdfEnabled:le,isFavoriteEnabled:ue,socials:U(),sendMethods:R()}).then(de[t]).then(S)}function S(){return new Promise(function(t){return oe?(oe.setHTML(X.firstChild),void t()):void(oe=new e.Class.LightboxManagerNew({theme:"panel",html:X.firstChild,id:"shareManager",onclose:w,onload:t}))})}function P(t,n){var i={download:"pdf",print:"print"};return e.Main.shareManager.sharePanelPath=n,e.Class.LightboxManagerNew.closeAll({except:["shareManager"]}),e.Main.shareManager.selectedThumb={left:!0,right:!0,pages:[]},Object.values(W).includes(t)||(t=W.HOME),j=!0,q&&clearTimeout(q),e.Main.trackerManager.trackPage({name:i[n]||"share"}),x(e.Main.pageManager.getCurrent()),M(t)}function w(){A()}function _(){T(),A()}function T(){var t=!!ee,n=t?{name:"shareSocial-"+ae+"-close",
variables:{1:ee}}:{name:"shareSocial-close"};e.Main.trackerManager.trackEvent(n)}function A(){return!!j&&(document.querySelector(".lightbox")?void P():(oe&&oe.close("shareManager"),j=!1,$=[],ee="",ne=te,oe=null,e.Utils.empty(X),!0))}function C(e,t){j?A():P(e,t)}function L(e){q&&clearTimeout(q),q=setTimeout(x.bind({},e),2e3)}function x(t){J=e.Utils.getVisiblePages(),k(t)}function k(t){if(fe!==t){var n=e.Utils.createUrlForPages({page:t});fe=t;var i=document.head.querySelector("meta[property='og:url']");i&&(i.content=n),fe=t;var a=a||document.head.querySelector("meta[property='og:url']");null!==a&&(a.content=n)}}function O(){}function I(){window.addEventListener(e.Param.eventResize,O)}function N(e){NIApi.register("page.shareSocial",function(t){return Promise.resolve(e.shareSocial(t,!0))}),NIApi.register("panels.share",{toggle:function(){e.toggle("home")},shareUrl:function(t,n,i){ee=t,ae=i||ie,ne=n||te,e.toggle("social")}})}function D(e){var t;for(var n in e)"undefined"!=typeof pe[n]&&(pe[n]=e[n]);t={},_defineProperty(t,Y.FACEBOOK,pe.facebook),_defineProperty(t,Y.TWITTER,pe.twitter),_defineProperty(t,Y.LINKEDIN,pe.linkedin),_defineProperty(t,Y.PINTEREST,pe.pinterest),_defineProperty(t,Y.TUMBLR,pe.tumblr),_defineProperty(t,Y.WHATSAPP,pe.whatsapp),se=t,R()}function R(){pe.copy_url=ce.copy_url,pe.mail=ce.mail,pe.print=ce.print,pe.download=ce.download,"url"===Q?(pe.copy_url=!0,pe.download=!1,pe.print=!1,pe.mail=!0):"pdf"===Q&&(pe.copy_url=!0,pe.print=le,pe.download=le,pe.mail=!1);var e=!!ee;return e&&(pe.print=!1,pe.download=!1),re={copy_url:pe.copy_url,mail:pe.mail,print:pe.print,download:pe.download}}function U(){for(var e={},t=!1,n=Object.keys(se),i=0;i<n.length;i++)pe[n[i]]="pdf"!==Q&&se[n[i]],e[n[i]]=pe[n[i]],t=t||pe[n[i]];return t===!1&&(e=!1),e}function F(t){switch(t){case"download":return e.Main.xmlManager.get("locale","menu_download");case"print":return e.Main.xmlManager.get("locale","menu_print");case"share":return e.Main.xmlManager.get("locale","menu_sharethis");default:return t?t:e.Main.xmlManager.get("locale","menu_sharethis")}}function B(t){switch(t){case"download":return e.Main.xmlManager.get("locale","share_downloaded_confirm");case"print":return e.Main.xmlManager.get("locale","share_printed_confirm");case"copy_url":return e.Main.xmlManager.get("locale","copy_url_confirm");default:return e.Main.xmlManager.get("locale","share_shared_confirm")}}function V(t){D(t),N(this),I(),e.Main.pagesLoaderNew.addPageChangeCallback(L),z=!0}var G,H,z=!1,j=!1,q=!1,W={HOME:"home",FRAME:"frame",PUBLICATION:"publication",URL:"url",SOCIAL:"social",CONFIRM_MESSAGE:"confirm",FAVORITE:"favorite"},Y={COPY_URL:"copy_url",MAIL:"mail",PRINT:"print",DOWNLOAD:"download",FACEBOOK:"facebook",TWITTER:"twitter",LINKEDIN:"linkedin",PINTEREST:"pinterest",TUMBLR:"tumblr",WHATSAPP:"whatsapp"},Z=W.HOME,X=document.createElement("div"),K=!1,Q=!1,J=[],$=[],ee="",te=e.Main.startupManager.get("core.share.message")||"",ne=te,ie="custom",ae=ie,re={},oe=null,se=null,le=e.Utils.isPdfEnabled(),ue=e.Utils.isFavoriteEnabled(),ce=t(),pe=ce,he=(G={},_defineProperty(G,Y.COPY_URL,function(t){e.Main.shareManager.sharePanelPath="copy_url",e.Main.shareManager.copyToClipboard(t)}),_defineProperty(G,Y.MAIL,function(t){var n=!!ee;"mailto"===e.Param.mailType?e.Main.shareMailManager.doMailTo(t):e.Main.shareMailManager.load(t,n,ae)}),_defineProperty(G,Y.PRINT,function(){e.Main.shareManager.sharePanelPath="print","frame"===K||"favorite"===K||"pageRange"===K?e.Main.pdfManager.print($.join(",")):e.Main.pdfManager.print()}),_defineProperty(G,Y.DOWNLOAD,function(){e.Main.shareManager.sharePanelPath="download","frame"===K||"favorite"===K||"pageRange"===K?e.Main.pdfManager.download($.join(",")):e.Main.pdfManager.download()}),_defineProperty(G,Y.FACEBOOK,function(e){var t=document.head.querySelector("meta[itemprop='image']"),n=document.head.querySelector("meta[itemprop='description']"),i=document.head.querySelector("meta[itemprop='name']");e="http://www.facebook.com/sharer.php?u="+encodeURIComponent(e),e+=t&&t.content?"&picture="+t.content:"",e+=n&&n.content?"&description="+n.content:"",e+=i&&i.content?"&title="+i.content:"",window.open(e,"_blank")}),_defineProperty(G,Y.TWITTER,function(e){var t=document.head.querySelector("meta[itemprop='description']");e="https://twitter.com/intent/tweet?url="+encodeURIComponent(e),e+=t?"&text="+t.content:"",window.open(e,"_blank")}),_defineProperty(G,Y.LINKEDIN,function(e){e="http://www.linkedin.com/shareArticle?url="+encodeURIComponent(e),window.open(e,"_blank")}),_defineProperty(G,Y.PINTEREST,function(e){e="http://www.pinterest.com/pin/create/button/?url="+encodeURIComponent(e),window.open(e,"_blank")}),_defineProperty(G,Y.TUMBLR,function(e){e="http://www.tumblr.com/share/link?url="+encodeURIComponent(e),window.open(e,"_blank")}),_defineProperty(G,Y.WHATSAPP,function(e){e="https://api.whatsapp.com/send?text="+ne+encodeURIComponent(e),window.open(e,"_blank")}),G),de=(H={},_defineProperty(H,W.HOME,function(){X.querySelector(".webpub-share__frame").addEventListener(e.Param.eventClick,i),X.querySelector(".webpub-share__publication").addEventListener(e.Param.eventClick,c),X.querySelector('.webpub-share__pageRange input[name="pageRangeFrom"]').addEventListener("change",a),X.querySelector('.webpub-share__pageRange input[name="pageRangeTo"]').addEventListener("change",a),X.querySelector('.webpub-share__pageRange button[name="confirm"]').addEventListener(e.Param.eventClick,l),ue&&X.querySelector(".webpub-share__favorite").addEventListener(e.Param.eventStart,p),X.querySelector(".webpub-share__close").addEventListener(e.Param.eventClick,_),Q=!1,K=!1}),_defineProperty(H,W.FRAME,function(){X.querySelector(".webpub-share__button-confirm").addEventListener(e.Param.eventClick,m),X.querySelector(".webpub-share__back").addEventListener(e.Param.eventClick,f);for(var t=X.querySelectorAll(".webpub-share__item"),n=t.length;n--;)t[n].addEventListener(e.Param.eventClick,g,!1),e.Main.shareManager.selectedThumb[t[n].getAttribute("data-page")]&&t[n].classList.add("webpub-share__checkbox--checked");X.querySelector(".webpub-share__close").addEventListener(e.Param.eventClick,_)}),_defineProperty(H,W.PUBLICATION,function(){X.querySelector(".webpub-share__button-confirm").addEventListener(e.Param.eventClick,m),X.querySelector(".webpub-share__back").addEventListener(e.Param.eventClick,f);for(var t=X.querySelectorAll(".webpub-share__item"),n=t.length;n--;)t[n].addEventListener(e.Param.eventClick,v,!1);X.querySelector(".webpub-share__online-url").classList.add("webpub-share__checkbox--checked"),X.querySelector(".webpub-share__close").addEventListener(e.Param.eventClick,_)}),_defineProperty(H,W.SOCIAL,function(){for(var t in pe)pe[t]===!0&&X.querySelector(".webpub-share__social-button-"+t).addEventListener(e.Param.eventClick,b.bind({},t));X.querySelector(".webpub-share__back").addEventListener(e.Param.eventClick,f),X.querySelector(".webpub-share__close").addEventListener(e.Param.eventClick,_)}),_defineProperty(H,W.CONFIRM_MESSAGE,function(){window.setTimeout(function(){oe.close("shareManager"),Q=!1,K=!1,D(ce)},2e3)}),H),fe=!1,me=function(e){"undefined"!=typeof window&&navigator.clipboard&&navigator.clipboard.writeText&&e&&navigator.clipboard.writeText(e).then()};this.init=V,this.open=P,this.close=A,this.toggle=C,this.shareSocial=n,this.onPageChange=L,this.favoriteThumbnailsShare=h,this.favoriteDownloadShare=d,this.copyToClipboard=me}}(webpublicationNamespace),function(e){function t(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),n(this)}function n(t){t.classList.toggle("webpub-data-item--favorited");var n=document.querySelectorAll(".webpub-data-item--favorited"),i=t.getAttribute("data-favorite");if(e.Main.thumbnailListManager.saveFavoritedThumbnails(i),e.Main.thumbnailListManager.filter===y.FAVORITE){var a=document.querySelector(".webpub-thumbnails-list__item[data-page='"+i+"']");a.classList.remove("webpub-thumbnails-list__item-fade"),window.setTimeout(function(){a.style.display="none"},200),0===n.length&&e.Main.thumbnailListManager.updateContent(e.Main.thumbnailListManager.filter)}var r=document.querySelector(".webpub-thumbnails-list__menu-item.clear-favorites");r.classList.toggle("visible",n.length>0)}function i(t,n,i){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var a=document.querySelectorAll("[data-page]"),r=this.getAttribute("data-filter-bookmarks");if(Array.prototype.forEach.call(a,function(e){e.classList.remove("webpub-thumbnails-list__item-fade")}),e.Param.isPhone){var o=t.target;r=o.options[o.selectedIndex].getAttribute("data-filter-bookmarks")}window.setTimeout(function(){e.Main.thumbnailListManager.updateContent(r),h(n,i)}.bind(this),200)}function a(t,n,a){var r,o=document.querySelectorAll("[data-filter-bookmarks]");if(e.Param.isPhone){var s=document.querySelector(".webpub-thumbnails-list__menu-select");s.addEventListener("change",function(e){i.bind(this)(e,n,a)})}Array.prototype.forEach.call(o,function(o){e.Param.isPhone?(r=o.getAttribute("data-filter-bookmarks"),o.removeAttribute("selected"),r===t&&(o.setAttribute("selected",!0),o.parentNode.value=o.value)):(o.addEventListener(e.Param.eventClick,function(e){i.bind(this)(e,n,a)}),r=o.getAttribute("data-filter-bookmarks"),o.classList.remove("webpub-thumbnails-list__menu-item-active"),r===t&&o.classList.add("webpub-thumbnails-list__menu-item-active"))})}function r(e){var t=e.querySelector(".clear-favorites");t.addEventListener("click",function(){var t=e.querySelectorAll("[data-favorite]");t.forEach(function(e){e.classList.contains("webpub-data-item--favorited")&&n(e)})})}function o(e){var t=parseInt(this.getAttribute("data-page"),10);NIApi.page.open(t),NIApi.lightbox.closeAll()}function s(e){var t=document.querySelector(".webpub-action-bar__wrapper-display");t.style.display="block",window.setTimeout(function(){t.classList.toggle("webpub-action-bar__wrapper-display-visible")},200)}function l(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var n=[];if(e.Main.thumbnailListManager.filter!==y.NONE){var i=document.querySelectorAll("[data-favorite]");Array.prototype.forEach.call(i,function(e){e.classList.contains("webpub-data-item--favorited")&&n.push(e.getAttribute("data-favorite"))})}e.Main.shareManager.open("social","download").then(function(){e.Main.shareManager.favoriteDownloadShare(n)})}function u(e,t){var n=parseInt(t.attributes["data-page"].value),i=e.querySelector(".webpub-thumbnails-list__wrapper"),a=e.querySelector('.webpub-thumbnails-list__title[data-page="'+n+'"]');i&&a&&(i.scrollTop=a.offsetTop-i.offsetTop-10)}function c(e,t){var n=e.scrollTop,i=t.find(function(t){if(!t.element)return!1;var i=t.element.offsetTop-e.offsetTop;return n<i}),a=t[t.length-1],r=a?a.page:void 0,o=i?i.page:r;return o}function p(e,t){var n=e.getAttribute("data-page"),i="menu-item-chapters__underline--active";n===t?e.classList.add(i):e.classList.remove(i)}function h(e,t){var n=e.querySelectorAll(".menu-item-chapters__tab"),i=e.querySelector(".webpub-thumbnails-list__wrapper"),a=t.chaptersTabItems,r=a.map(function(t){return{page:t.page,element:e.querySelector('.webpub-thumbnails-list__title[data-page="'+t.page+'"]')}}),o=c(i,r);n.forEach(function(e){p(e,o)})}function d(t,n){if(n.chaptersTabItems.length>0){var i=t.querySelectorAll(".menu-item-chapters__tab"),a=t.querySelector(".webpub-thumbnails-list__wrapper");Array.prototype.forEach.call(i,function(n){n.addEventListener(e.Param.eventClick,function(){u(t,this)})}),h(t,n),a.addEventListener("scroll",function(){h(t,n)})}}function f(n,i,u){var c=n[0];a(e.Main.thumbnailListManager.filter,c,u),r(c);var p=c.querySelectorAll(".webpub-thumbnails-list__item[data-page]");Array.prototype.forEach.call(p,function(t){t.addEventListener(e.Param.eventClick,o),window.setTimeout(function(){t.classList.add("webpub-thumbnails-list__item-fade")}.bind(this),100)}),d(c,u);var h=c.querySelectorAll("[data-favorite]");Array.prototype.forEach.call(h,function(n){n.addEventListener(e.Param.eventClick,t)});var f=c.querySelector('[data-action="confirm"]'),v=c.querySelectorAll(".webpub-action-bar__item");f&&f.addEventListener(e.Param.eventClick,m),Array.prototype.forEach.call(v,function(t){t.addEventListener(e.Param.eventClick,g)});var b=c.querySelector('[data-action="share"]');b&&b.addEventListener(e.Param.eventClick,s);var y=c.querySelector('[data-action="download"]');y&&y.addEventListener(e.Param.eventClick,l)}function m(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var n=document.querySelectorAll("[data-favorite]"),i=[],a=document.querySelector(".webpub-action-bar__share-mode.webpub-share__checkbox--checked");if(null===a)return void e.Utils.toast({text:e.Main.xmlManager.get("locale","multilinks_title"),duration:3e3,type:"error"});var r=a.getAttribute("data-share-mode");Array.prototype.forEach.call(n,function(t){return e.Main.thumbnailListManager.filter!==y.FAVORITE?void i.push(t.getAttribute("data-favorite")):void(t.classList.contains("webpub-data-item--favorited")&&i.push(t.getAttribute("data-favorite")))}),e.Main.shareManager.open("social").then(function(){e.Main.shareManager.favoriteThumbnailsShare(i,r,e.Main.thumbnailListManager.getActionBarType())})}function g(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var n=e.Utils.getClosestByClass(t.target,"webpub-action-bar__item"),i=document.querySelectorAll(".webpub-action-bar__item");Array.prototype.forEach.call(i,function(e){e.classList.remove("webpub-share__checkbox--checked")}),n.classList.add("webpub-share__checkbox--checked")}function v(t){NIApi.register("panels.favorites",{toggle:function(){e.Main.thumbnailListManager.show(y.FAVORITE,b.FAVORITE)}}),NIApi.register("panels.thumbnail",{toggle:function(){t.toggle()}})}var b={THUMBNAILS:"thumbnails",PRINT:"print",DOWNLOAD:"download",FAVORITE:"favorite",SHARE:"share"},y={NONE:"none",FAVORITE:"favorite",SHARED_BY:"sharedBy"},E={NONE:"none",SHARE:"share",DOWNLOAD:"download"},M={IMAGE:"image",CHAPTER:"chapter"},S=function(){this.initFavoritedStorage();var t=e.Main.urlManager.get("bookmarks")||e.Main.urlManager.get("bookmark");this.sharedFavorite=t?t.split(","):[],this.sharedWithMeFilter=this.sharedFavorite.length>0,this.filter=y.NONE,this.origin=b.THUMBNAILS,v(this)};S.prototype.updateContent=function(e){var t=this.setParams(e);t.onload=f,this.popup.setSubtemplate(t)},S.prototype.setParams=function(t,n){t&&(this.filter=t),n&&(this.origin=n);var i=this.getFavoritedThumbnails(),a=e.Main.xmlManager.get("common-ui","configs","thumbs_chapters"),r=this.getThumbnailItems(),o=this.getActionBarType(),s=e.Main.menuManager.hasDownloadItem()&&e.Utils.isPdfEnabled();return{isShareFilter:this.filter===y.SHARE,actionBarType:o,hasDownloadButton:s,sharedByFilter:this.sharedWithMeFilter,favorited:i,chaptersConfig:{items:a,isInThumbnail:!0},chaptersTabItems:a.filter(function(e){return"tab"===e.type}),thumbnailItems:r}},S.prototype.getActionBarType=function(){if(this.origin===b.SHARE)return E.SHARE;var t=e.Main.menuManager.hasDownloadItem();return t?E.DOWNLOAD:E.NONE},S.prototype.getThumbnailItems=function(){var e=this.getUnfilteredThumbnailItems(),t=this.filterImages(e),n=this.filterEmptyChapters(t);return n},S.prototype.getUnfilteredThumbnailItems=function(){for(var t=e.Main.xmlManager.get("common-ui","configs","thumbs_chapters"),n=[],i=0;i<e.Main.xmlManager.get("common-configuration","config","pageCount");i++){for(var a=0;a<t.length;a++){var r=t[a];i===parseInt(r.page)-1&&n.push({type:M.CHAPTER,chapter:r})}n.push({type:M.IMAGE,page:i+1,image:e.Main.pageManager.getImage("ldpi",i+1)})}return n},S.prototype.filterImages=function(e){var t=[],n=[y.FAVORITE,y.SHARED_BY,y.SHARE].includes(this.filter);if(n){var i=this.filter===y.SHARED_BY?this.sharedFavorite:this.getFavoritedThumbnails(),t=e.filter(function(e){return e.type===M.CHAPTER||i.includes(e.page.toString())});return t}return e},S.prototype.filterEmptyChapters=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],a=e[n+1],r=this.isEmptyChapterThumbnailItem(i,a);r||t.push(i)}return t},S.prototype.isChapterThumbnailItem=function(e){return e.type===M.CHAPTER},S.prototype.isEmptyChapterThumbnailItem=function(e,t){var n=this.isChapterThumbnailItem(e);if(n){var i=void 0===t||this.isChapterThumbnailItem(t);return i}return!1},S.prototype.toggle=function(){var e=document.querySelector("#webpub-lightbox-thumbnails-manager");e?NIApi.lightbox.closeAll():this.show(y.NONE)},S.prototype.show=function(t,n){var i=this.setParams(t,n),a="thumbnails",r=e.Main.xmlManager.get("locale","menu_thumbnail");this.filter!==y.FAVORITE&&this.filter!==y.SHARE||(r=e.Main.xmlManager.get("locale","favorites_selection"),a="favorites"),this.sharedWithMeFilter&&this.filter===y.SHARED_BY&&(r=e.Main.xmlManager.get("locale","favorited_selection"),a="sharedby"),e.Main.trackerManager.trackPage({name:a});var o='<div class="application-page-loader spinner">';o+='<svg viewBox="0 0 32 32" width="32" height="32" class="spinner__circle" xmlns="http://www.w3.org/2000/svg">',o+='<path d="M16 0 A16 16 0 0 0 16 32 A16 16 0 0 0 16 0 M16 4 A12 12 0 0 1 16 28 A12 12 0 0 1 16 4" class="spinner__circle-background"/>',o+='<path d="M16 0 A16 16 0 0 1 32 16 L28 16 A12 12 0 0 0 16 4z" class="spinner__circle-foreground" />',o+="</svg>",o+="</div>",this.popup=new e.Class.LightboxManagerNew({id:"thumbnails-manager",title:r,html:o,headerMenu:this.headerMenu||!1,subtemplate:{url:e.Param.pathTemplate+"thumbnails.html",params:i},menuButton:!1,theme:"page",animation:"none",onload:f})},S.prototype.getFavoritedThumbnails=function(){var t=[],n=e.Main.xmlManager.getVariable("client_id"),i=(e.Main.xmlManager.getVariable("id"),JSON.parse(localStorage[n]));return"undefined"!=typeof i[e.Main.xmlManager.getVariable("id")]&&(t=i[e.Main.xmlManager.getVariable("id")].favoritedPages),t},S.prototype.initFavoritedStorage=function(){var t=e.Main.xmlManager.getVariable("client_id"),n=e.Main.xmlManager.getVariable("id"),i=localStorage[t]?JSON.parse(localStorage[t]):{};localStorage[t]&&i[n]||(i[n]={favoritedPages:[]},localStorage[t]=JSON.stringify(i))},S.prototype.saveFavoritedThumbnails=function(t){var n=e.Main.xmlManager.get("locale","label_page")+" "+e.Utils.byOffsetIndex(t)+" ",i=e.Main.xmlManager.getVariable("client_id"),a=e.Main.xmlManager.getVariable("id"),r=JSON.parse(localStorage[i]),o=r[a].favoritedPages;if(o.indexOf(t)===-1)o.push(t),n=n+e.Main.xmlManager.get("locale","favorites_added_to")+" ",n+=e.Main.xmlManager.get("locale","favorites_selection"),e.Main.trackerManager.trackEvent({name:"bookmark",variables:{1:t}});else{var s=o.indexOf(t);o.splice(s,1),n=n+e.Main.xmlManager.get("locale","favorites_removed_from")+" ",n+=e.Main.xmlManager.get("locale","favorites_selection"),e.Main.trackerManager.trackEvent({name:"unbookmark",variables:{1:t}})}this.showToast(n),localStorage[i]=JSON.stringify(r)},S.prototype.showToast=function(t){var n=document.querySelector(".webpub-toast--active");n?(document.querySelector(".webpub-toast__position--text-info")&&(n=document.querySelector(".webpub-toast__position--text-info"),n.style.paddingRight="30px"),n.innerText=t):e.Utils.toast({text:t,duration:3e3})},e.Class.ThumbnailListManager=S}(webpublicationNamespace),function(e){e.Class.ToolsEvents=function(){var t=function(t){this.parent=t,this.onshowToolsArray=[],this.showToolsInfo=0;var n=this;document.addEventListener(e.Param.eventKeyboardDown,function(e){32===e.keyCode&&n.showTools()},!1)},n=t.prototype;return n.onShowedTools=function(){var e=null,t=0;return function(){for(e=this.onshowToolsArray.length,t=0;t<e;t++)this.onshowToolsArray[t](this.showToolsInfo);return!1}}(),n.showTools=function(t){if(e.Main.menuManager.hideMenu())return!1;if(null===e.Main.startupManager.get("ui.menu")&&null===e.Main.startupManager.get("ui.carousel")&&null===e.Main.startupManager.get("ui.paging"))this.showToolsInfo=0;else if(t===!1)this.showToolsInfo=0;else if(t===!0)this.showToolsInfo=1;else if(0===this.showToolsInfo)this.showToolsInfo=1;else{if(1!==this.showToolsInfo)return!1;this.showToolsInfo=0}return 0===this.showToolsInfo?e.Main.menuManager.hideTopnav():e.Main.menuManager.showTopnav(),this.onShowedTools(),!1},n.onShowTools=function(e){return this.onshowToolsArray.push(e),!1},t}()}(webpublicationNamespace),function(e){function t(t){l===!1&&(l=!0,NIApi.event.onPageChange(function(){clearTimeout(e.Main.tooltipManager._mouseIdleTimer),e.Utils.callEvent(window,"tooltip.onPageChange")})),t.addEventListener("mouseenter",a)}function n(t){return clearTimeout(e.Main.tooltipManager._mouseIdleTimer),"mouseleave"===t.type||t.type===e.Param.eventStart?void r(t):void(e.Main.tooltipManager._mouseIdleTimer=setTimeout(function(e){o(e)}.bind({},t),c))}function i(t,n){n=n||t?t.target:null;var a=document.querySelector(".webpub-tooltip");if(clearTimeout(e.Main.tooltipManager._mouseIdleTimer),a){if(n){var r=e.Utils.getClosestByAttribute(n,"data-tooltip");r.removeEventListener("mousemove",i)}a.parentNode.removeChild(a)}}function a(t){t.target.onPageChangefunction=r.bind(t.target),t.target.addEventListener("mousemove",n),t.target.addEventListener("mouseleave",n),t.target.addEventListener(e.Param.eventStart,n),t.target.addEventListener(e.Param.eventMouseWheel,r),window.addEventListener("tooltip.onPageChange",t.target.onPageChangefunction)}function r(t){var a=t.target;"tooltip.onPageChange"===t.type&&(a=this);var o=e.Utils.getClosestByAttribute(a,"data-tooltip");i(t,a),o&&(o.removeEventListener("mousemove",n),o.removeEventListener("mouseleave",n),o.removeEventListener(e.Param.eventStart,n),o.removeEventListener(e.Param.eventMouseWheel,r)),window.removeEventListener("tooltip.onPageChange",a.onPageChangefunction)}function o(t){var n=e.Utils.getClosestByAttribute(t.target,"data-tooltip"),a={X:t.clientX,Y:t.clientY+25};n.addEventListener("mousemove",i),e.Main.tooltipManager.show(n.getAttribute("data-tooltip"),a)}var s=function(){},l=!1,u=e.Main.xmlManager.get("common-ui","configs","tooltip"),c=u.delay;s.prototype.showAfterDelay=function(t,n,i){clearTimeout(e.Main.tooltipManager._mouseIdleTimer),e.Main.tooltipManager._mouseIdleTimer=setTimeout(function(e){this.show(t,n,i)}.bind(this),500)},s.prototype.show=function(t,n,i){if(e.Param.isDesktop!==!1&&"touchstart"!==e.Param.eventStart){t=t||"";var a=t.length>5&&"<"===t[0]&&">"===t[t.length-1],r=document.createElement("div");if(a)r.innerHTML=t;else{var o=document.createElement("div");o.classList.add("webpub-tooltip-content"),r.appendChild(o),o.innerText=t}r.classList.add("webpub-tooltip"),r.style.transform="translate("+n.X+"px,"+n.Y+"px) scale(0)",r.style.webkitTransform="translate("+n.X+"px,"+n.Y+"px) scale(0)";var s=document.querySelector(".webpub-tooltip");s&&s.parentNode.removeChild(s),r.addEventListener("animationstart",function(e){e.target.style.transform="translate("+n.X+"px,"+n.Y+"px) scale(1)",e.target.style.webkitTransform="translate("+n.X+"px,"+n.Y+"px) scale(1)"},!1),r.addEventListener("animationend",function(e){var t=document.body.getBoundingClientRect().width,i=document.body.getBoundingClientRect().height,a=0;if(e.target.getBoundingClientRect().right>t){var r=e.target.getBoundingClientRect().width+15,o=Math.floor(t-r);a=o,e.target.style.transform="translate("+o+"px,"+n.Y+"px) scale(1)",e.target.style.webkitTransform="translate("+o+"px,"+n.Y+"px) scale(1)"}else e.target.getBoundingClientRect().left<0&&(e.target.style.transform="translate( 15px,"+n.Y+"px) scale(1)",e.target.style.webkitTransform="translate( 15px,"+n.Y+"px) scale(1)");if(e.target.getBoundingClientRect().bottom>i){var s=e.target.getBoundingClientRect().height+15,l=Math.floor(i-s);a=a||n.X,e.target.style.transform="translate( "+a+"px,"+l+"px) scale(1)",e.target.style.webkitTransform="translate( "+a+"px,"+l+"px) scale(1)"}},!1),document.body.appendChild(r)}},s.prototype.hide=i,s.prototype.register=t,e.Class.TooltipManager=s}(webpublicationNamespace);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){Math.abs=function(e){return e<0?-e:e},Math.floor=function(e){return e>>0},Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)},Math.parseIntToRoman=function(){var e=["I","V","X","L","C","D","M"],t=function(t,n){var i,a="",r=2*t;if(t>2)for(i=0;i<n*Math.pow(10,t-3);i++)a+="M";else if(n<4)for(i=0;i<n;i++)a+=e[r];else if(4==n)a=e[r]+e[r+1];else if(n<9)for(a=e[r+1],i=0;i<n-5;i++)a+=e[r];else 9==n&&(a=e[r]+e[r+2]);return a};return function(e){var n,i="";e=parseInt(e,10).toString();for(var a=0,r=e.length;a<r;a++){var o=parseInt(e.charAt(r-(a+1)));n=i,i=t(a,o)+n}return i}}(),Math.parseRomanToInt=function(){var e=null,t=/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/,n=/[MDLV]|C[MD]?|X[CL]?|I[XV]?/g,i={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},a=0;return function(r){if(a=0,r=r.toUpperCase(),!r||!t.test(r))return!1;for(;e=n.exec(r);)a+=i[e[0]];return a}}(),e.Utils.addParamsToUrl=function(e,t){if(""===t)return e;var n,i="";e.indexOf("#")>=0&&(i=e.substr(e.indexOf("#"),e.length),e=e.substr(0,e.indexOf("#"))),n=e.indexOf("?")===-1?e+"?"+t:e+"&"+t;var a=n.split("?")[1],r={};a.split("&").forEach(function(e){r[e.split("=")[0]]=e.split("=")[1]}),n=n.split("?")[0];for(var o in r)n=n+(n.indexOf("?")===-1?"?":"&")+o+"="+r[o];return n+i},e.Utils.createUrlForPages=function(t){t=t||{};var n=null,i=t.clientId||e.Main.xmlManager.getVariable("client_id"),a=t.genId||e.Main.xmlManager.getVariable("id"),r=t.page||"1",o=e.Main.xmlManager.getVariable("asp_url")||null;return null!==o&&(n=o+"/"+i+"/"+a+"/"),(e.Utils.isMaster()&&!e.Param.isApp||null===n)&&(n=window.location.origin+window.location.pathname),e.Param.isLocalReader&&e.Main.urlManager.get("version")&&(n=e.Utils.addParamsToUrl(n,"version="+e.Main.urlManager.get("version"))),n.indexOf("#page=")===-1&&(n+="#page="+r),n},e.Utils.isPdfEnabled=function(){if(e.Main.startupManager.has("core.format","epub-HTML")){var t=e.Main.xmlManager.getVariable("version"),n=t.substring(1),i=n.split(".").map(function(e){return parseInt(e)}),a=i[0],r=i[1],o=a>3||3===a&&r>46;if(o)return!1}return!0},e.Utils.isFavoriteEnabled=function(){var t=e.Main.xmlManager.get("common-ui","menu");for(var n in t){var i=t[n];if(i.some(function(e){return["pagemark_btn","favorite_btn"].includes(e.attributes.name)}))return!0}return!1},e.Utils.getFileExtension=function(e){var t=e.split("?").shift().split("#").shift().split(".").pop();return t},e.Utils.getFilenameWithoutExtension=function(e){var t=e.split(".");return t.pop(),t.join(".")},e.Utils.componentTemplates={},e.Utils.getTemplate=function(t,n){var i=".html",a="";"component"===t?a="publication/mobile/template/component/":(a="publication/mobile/tmpl/","page"===t?a+="page/":n=t);var r=e.Utils.getFunctionName(this.constructor),o=r.replace("Manager","").toLowerCase();"string"==typeof n&&(o=n,n=void 0),"undefined"==typeof n&&"undefined"!=typeof this.config&&(n=this.config.templateList),"undefined"==typeof n?n={main:a+o+i}:"undefined"==typeof n.main&&(n.main=a+o+i);var s=e.Utils.componentTemplates[o];return"component"===t&&s&&s.tablet&&(n.tablet=s.tablet),"component"===t&&s&&s.phone&&(n.phone=s.phone),"component"===t&&s&&s.desktop&&(n.desktop=s.desktop),"undefined"!=typeof n.phone&&e.Param.isPhone===!0?n.phone:"undefined"!=typeof n.tablet&&e.Param.isTablet===!0?n.tablet:"undefined"!=typeof n.desktop&&e.Param.isUnknown===!0?n.desktop:n.main},e.Utils.GetSwiffyPromise=function(){var t="js/swiffy_runtime";return null!==e.Main.startupManager.get("vendor.swiffy")&&(t+="_"+e.Main.startupManager.get("vendor.swiffy").replace(".","_")),function(n){return e.require([t]).then(function(){return new Promise(function(e,t){var i=n.file.url.match(/\/([a-zA-Z0-9]+).json/),a=document.createElement("div");a.classList.add("animation_for_swiffy"),a.classList.add("webpub-viewer__link-"+n.id),a.id="webpub-swiffy__"+(i?i[1]:"0"),a.coords={x:n.x,y:n.y,w:n.width,h:n.height,foreground:n.foreground},a.autoPlay=!1,a.swiffyElement={swiffyObject:null,swiffyWrapper:a,id:a.id};var r=new XMLHttpRequest;r.open("GET",n.file.url,!0),r.onreadystatechange=function(){if(2===this.readyState&&200!==this.status&&0!==this.status)a.parentNode&&a.parentNode.removeChild(a),this.abort(),e(!1);else if(4===this.readyState&&this.responseText){var t=new RegExp("swiffyobject\\s*\\=\\s*([\\s\\S]*?\\})\\;$","gmi"),n=t.exec(this.responseText),i=JSON.parse(null===n?this.responseText:n[1]);a.swiffyElement.swiffyObject=new swiffy.Stage(a,i),a.swiffyElement.swiffyObject.setBackground(null),e(a)}},r.send()})})}}(),e.Utils.addVideoStats=function(t){function n(e){var t=e.querySelector("source"),n=e.getAttribute("data-label"),i={label:"",time:Math.round(e.currentTime)};if(t){var a=t.getAttribute("src");if(a)if(n){var r=a.match(/\d+/g),o=r?r[0]:"0";i.label=o+"-"+n}else i.label=a}return i}t.dataset.isTracked||(t.dataset.isTracked="true",t.addEventListener("play",function(t){var i=n(t.target,!0);e.Main.trackerManager.trackEvent({name:"videoPlay",variables:{1:i.label,2:i.time}})}),t.addEventListener("pause",function(t){var i=n(t.target,!0);t.target.currentTime!==t.target.duration&&e.Main.trackerManager.trackEvent({name:"videoPause",variables:{1:i.label,2:i.time}})}),t.addEventListener("ended",function(t){var i=n(t.target,!1);e.Main.trackerManager.trackEvent({name:"videoEnd",variables:{1:i.label}})}))},e.Utils.getAudioCustomDOMElement=function(){var t=null,n=function(){var e=null,t=null;return function(n){return e=~~(n/60),t=~~(n%60),e<10&&(e=["0",e].join("")),t<10&&(t=["0",t].join("")),[e,":",t].join("")}}(),i=function(){this.audioPlayerButton.className="audio-player-button"},a=function(){this.audioPlayerButton.className="audio-player-button audio-player-pause"},r=function(){this.audioPlayerTotal.innerText=n(this.duration)},o=function(){var e=null;return function(){"undefined"!=typeof this.audioPlayerProgressValue&&(e=~~(100*(this.currentTime/this.duration)),this.audioPlayerElapsed.innerText=n(this.currentTime),this.audioPlayerProgressValue.style.width=e+"%")}}(),s=function(){this.addEventListener("timeupdate",o)},l=function(e){scale=((e.pageX||e.changedTouches[0].pageX)-this.getBoundingClientRect().left)/this.offsetWidth,this.audioDOMElement.currentTime=this.audioDOMElement.duration*scale};return function(n,o){t=o.parentNode;var u=document.createElement("audio");u.id=n,u.src=o.getAttribute("data-src"),u.className="audio-player-domelement",u.addEventListener("play",i),u.addEventListener("pause",a),u.addEventListener("durationchange",r),u.addEventListener("loadedmetadata",s),u.audioPlayerButton=o,u.audioPlayerElapsed=t.getElementsByClassName("audio-player-elapsed")[0],u.audioPlayerProgress=t.getElementsByClassName("audio-player-progress")[0],u.audioPlayerProgressContainer=t.getElementsByClassName("audio-player-progress-container")[0],u.audioPlayerProgressValue=t.getElementsByClassName("audio-player-progress-value")[0],u.audioPlayerTotal=t.getElementsByClassName("audio-player-total")[0],o.audioDOMElement=u,u.audioPlayerProgressContainer.audioDOMElement=u,u.audioPlayerProgressContainer.addEventListener(e.Param.eventStop,l),o.addEventListener(e.Param.eventClick,function(){this.audioDOMElement.paused?this.audioDOMElement.play():this.audioDOMElement.pause()}),o.parentNode.appendChild(u),e.Main.eventEmul.callEvent("audioBegin",o.getAttribute("data-src")),u.play()}}(),e.Utils.impair=function(e){return 1&e},e.Utils.clone=function(t){if("object"!=("undefined"==typeof t?"undefined":_typeof(t))||null==t)return t;var n=t.constructor(),i=null;for(i in t)n[i]=e.Utils.clone(t[i]);return n},e.Utils.getTintedSvg=function(){var e={},t=null,n=null,i=function(i,a,r){if(a)for(i=e[i].cloneNode(!0),t=i.getElementsByTagName("*"),n=t.length;--n>=0;)"string"!=typeof t[n].getAttribute("stroke")?t[n].setAttribute("fill",a):t[n].setAttribute("stroke",a);r[0].appendChild(i)};return function(t,n,a){if(!t)return!1;if("undefined"==typeof e[t]){var r=new XMLHttpRequest;r.open("GET",t,!1),r.onreadystatechange=function(o){
4==r.readyState&&(e[t]=r.responseXML.getElementsByTagName("svg")[0],i(t,n,a))},r.send()}else i(t,n,a);return!1}}(),e.Utils.preventDefault=function(){return function(e){return"object"===("undefined"==typeof e?"undefined":_typeof(e))&&("undefined"!=typeof e.stopPropagation&&e.stopPropagation(),"undefined"!=typeof e.cancelBubble&&(e.cancelBubble=!0),"undefined"!=typeof e.preventDefault&&e.preventDefault(),!1)}}(),e.Utils.uniqueId=function(){var e=0;return function(){return e++,(new Date).getTime()+"_"+e}}(),e.Utils.byOffsetIndex=function(){var t=null,n=e.Main.xmlManager.get("common-configuration","config","shift");return function(e,i){return i?(t=~~e,e=t&&0!==t?t+n:Math.parseRomanToInt(e)):(n>=e?e=Math.parseIntToRoman(e):e-=n,e)}}(),e.Utils.isOffsetIndex=function(){var t=e.Main.xmlManager.get("common-configuration","config","shift");return function(e){return e-t<=0}}(),e.Utils.hex16=function(e){return 8==e.length&&(e=e.substr(2,8)),e},e.Utils.getRadiant=function(){var e=null,t=null,n=null,i=null;return function(a,r,o,s,l,u){for(e=50,u&&(e=u),t=r.split(","),n=0;n<t.length;n++)t[n]=~~(~~t[n]+e),t[n]>255&&(t[n]=255);return i="",i+="background: rgb("+r+");",i+="background: -moz-linear-gradient(-45deg,  rgba("+t+","+l+") 0%, rgba("+r+","+s+") 50%);",i+="background: -webkit-gradient(linear, left top, right bottom, color-stop(0%,rgba("+r+",1)), color-stop(50%,rgba("+r+","+s+")));",i+="background: -webkit-linear-gradient(-45deg,  rgba("+t+","+l+") 0%,rgba("+r+","+s+") 50%);",i+="background: -o-linear-gradient(-45deg,  rgba("+t+","+l+") 0%,rgba("+r+","+s+") 50%);",i+="background: -ms-linear-gradient(-45deg,  rgba("+t+","+l+") 0%,rgba("+r+","+s+") 50%);",i+="background: linear-gradient(135deg,  rgba("+t+","+l+") 0%,rgba("+r+","+s+") 50%);",i+="filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='"+o+","+s+"',GradientType=1 );"}}(),e.Utils.mailValid=function(){var t=document.createElement("input");return t.type="email",t.required=!0,function(n){return t.value=n,t.checkValidity()&&e.Utils.regexEmail.test(n)}}(),e.Utils.isMaster=function(){var t=e.Main.xmlManager.getVariable("asp_url")||!1;return!!t||t},e.Utils.stringtoXML=function(){var e=null;return function(t){return DOMParser?e=(new DOMParser).parseFromString(t,"text/xml"):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t)),e}}(),e.Utils.getBase64Image=function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");return n.drawImage(e,0,0),t.toDataURL("image/png")},e.Utils.addVendorEventListener=function(e,t){for(var n=["","webkit","moz"],i=0;i<n.length;i++)if("on"+n[i]+e in document.documentElement){document.addEventListener(n[i]+e,t);break}},e.Utils.styleBorderRadius=function(){return"borderRadius"in document.body.style?function(e,t){e.style.borderRadius=t}:"webkitBorderRadius"in document.body.style?function(e,t){e.style.webkitBorderRadius=t}:"mozBorderRadius"in document.body.style?function(e,t){e.style.mozBorderRadius=t}:function(){}}(),e.Utils.styleTransform=function(){return"transform"in document.body.style?function(e,t){e.style.transform=t}:"webkitTransform"in document.body.style?function(e,t){e.style.webkitTransform=t}:"msTransform"in document.body.style?function(e,t){e.style.msTransform=t}:function(){}}(),e.Utils.styleTransformOrigin=function(){return"transformOrigin"in document.body.style?function(e,t){e.style.transformOrigin=t}:"webkitTransformOrigin"in document.body.style?function(e,t){e.style.webkitTransformOrigin=t}:"msTransformOrigin"in document.body.style?function(e,t){e.style.msTransformOrigin=t}:function(){}}(),e.Utils.styleTransition=function(){return"transition"in document.body.style?function(e,t){e.style.transition=t}:"webkitTransition"in document.body.style?function(e,t){e.style.webkitTransition=t}:"msTransition"in document.body.style?function(e,t){e.style.msTransition=t}:function(){}}(),e.Utils.styleTransitionTransform=function(){return"transform"in document.body.style?function(t,n,i){e.Utils.styleTransition(t,"transform "+n+"s "+i)}:"webkitTransform"in document.body.style?function(t,n,i){e.Utils.styleTransition(t,"-webkit-transform "+n+"s "+i)}:"msTransform"in document.body.style?function(t,n,i){e.Utils.styleTransition(t,"-ms-transform "+n+"s "+i)}:function(){}}(),e.Utils.resetDomTransform=function(t){e.Utils.styleTransformOrigin(t,"50% 50%"),e.Utils.styleTransform(t,"scale3d(1, 1, 1)")},e.Utils.scaleDom=function(t,n,i,a){e.Utils.styleTransformOrigin(t,i+("number"==typeof i?"px":"")+" "+a+("number"==typeof a?"px":"")),1===n?e.Utils.styleTransform(t,"none"):e.Utils.styleTransform(t,"scale("+n+", "+n+")")},e.Utils.scaleDom3d=function(t,n,i,a){e.Utils.styleTransformOrigin(t,i+("number"==typeof i?"px":"")+" "+a+("number"==typeof a?"px":"")),1===n?e.Utils.styleTransform(t,"none"):e.Utils.styleTransform(t,"scale3d("+n+", "+n+", 1)")},e.Utils.translateScaleDom3d=function(t,n,i,a,r,o){e.Utils.styleTransformOrigin(t,r+("number"==typeof r?"px":"")+" "+o+("number"==typeof o?"px":"")),0===n&&0===i&&1===a?e.Utils.styleTransform(t,"none"):e.Utils.styleTransform(t,"scale3d("+a+", "+a+", 1) translate3d("+n+"px, "+i+"px, 0px)")},e.Utils.eventPreventDefault=function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()},e.Utils.preventOverScroll=function(){function e(e){0===e.scrollTop?e.scrollTop++:e.scrollTop===e.scrollHeight-e.clientHeight&&e.scrollTop--}return function(t){t.setAttribute("touch-action","auto"),t.addEventListener("touchstart",function(n){for(var i=n.target;i!==t;)e(i),i=i.parentNode;e(t)})}}(),e.Utils.forceReflow=function(e){e.style.display="none",e.style.display="block"},e.Utils.cubicBezier=function(e,t,n,i,a){return Math.pow(1-a,3)*e+3*Math.pow(1-a,2)*a*t+3*(1-a)*Math.pow(a,2)*n+Math.pow(a,3)*i},e.Utils.getFunctionName=function(e){var t="function"==typeof e,n=t&&(e.name&&["",e.name]||e.toString().match(/function ([^\(]+)/));return!t&&"not a function"||n&&n[1]||"anonymous"},e.Utils.promiseTimeout=function(e,t){return 0===e?t:new Promise(function(n,i){setTimeout(function(){n(t)},e)})},e.Utils.getSegmentLength=function(e,t,n,i){return Math.abs(Math.sqrt(Math.pow(e-n,2)+Math.pow(t-i,2)))},e.Utils.createSvgIcon=function(t,n,i){var a=document.createElement("div");return a.className="svgicon svgicon-"+t+" "+n,e.Utils.svgIcon(a,{icon:t,color:i||null}),a},e.Utils.svgIcon=function(t,n){if(n.color=n.color||null,n.icon=n.icon||null,"svg"!==t.tagName){var i=t.querySelector("svg");null===i&&(i=document.createElement("svg"),t.appendChild(i)),t=i}if(null!==n.color&&n.color.indexOf(".")>0&&(n.color=n.color.split("."),n.color=e.Main.cssManager.getStyle(n.color[0],n.color[1])),null!==n.icon){if(t.firstChild)t.firstChild.setAttribute("xlink:href","#svgicon-"+n.icon);else{var a='xmlns:xlink="http://www.w3.org/1999/xlink"',r='xlink:href="#svgicon-'+n.icon+'"';t.innerHTML="<use "+a+" "+r+"></use>"}t.setAttribute("data-icon",n.icon)}null!==n.color&&(t.style.fill=n.color,t.setAttribute("data-color",n.color))},e.Utils.empty=function(e){if(e){for(var t=e.querySelectorAll("video"),n=0;n<t.length;n++)t[n].pause(),t[n].parentNode.removeChild(t[n]);e.textContent="",e.innerHTML=""}},e.Utils.fadeIn=function(){var e=function(){this.classList.remove("opacity-zero")};return function(t){t&&(t.classList.remove("display-none"),requestAnimationFrame(e.bind(t)))}}(),e.Utils.fadeOut=function(){var e=function(){this.classList.add("display-none")};return function(t){if(t){var n=window.getComputedStyle(t),i=1e3*parseFloat(n.getPropertyValue("transition-duration"));"opacity"===n.getPropertyValue("transition-property")&&i>0&&(t.classList.add("opacity-zero"),setTimeout(e.bind(t),i)),n=null}}}(),e.Utils.getVisiblePages=function(){return function(){return e.Main.viewerManager.getCurrentPages()}}(),e.Utils.capitalizeWord=function(e){return e[0].toUpperCase()+e.substr(1,e.length).toLowerCase()},e.Utils.regexEmail=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,e.Utils.mailStringToArray=function(t){for(var n=t.split(/[,;\s]+(?=(?:[^"]*"[^"]*")*[^"]*$)/g),i=[],a=0;a<n.length;a++)e.Utils.mailValid(n[a])&&i.push(n[a]);return i},e.Utils.removeToast=function(t){var n=e.Param.viewBody.querySelector(".webpub-toast--active");n&&(clearTimeout(e.Utils.removeToastTimer),t=t||0,n.classList.remove("webpub-toast--active"),setTimeout(function(){n.parentNode.removeChild(n)},t))},e.Utils.hideShowRemove=function(t){function n(){clearTimeout(e.Utils.removeToastTimer)}function i(){e.Utils.removeToastTimer=setTimeout(function(){e.Utils.removeToast(s)},o)}var a=t.element,r=t.className,o=t.duration||3e3,s=t.delay||1e3;a.addEventListener("mouseenter",n),a.addEventListener("mouseleave",i),setTimeout(function(){a.classList.add(r),i()},16)},e.Utils.toast=function(t){var n=function o(n){var i=document.querySelector(".webpub-toast--active");i?window.setTimeout(function(){o(n)},1e3):e.Utils.hideShowRemove({element:n,className:"webpub-toast--active",duration:t.duration,delay:1e3})},i=document.createElement("div");i.classList.add("webpub-toast");for(var a=t.className?t.className.split(" "):[],r=0;r<a.length;r++)i.classList.add(a[r]);return i.classList.add("webpub-toast__position--"+t.position),"undefined"!=typeof t.html?(i.classList.add("webpub-toast__position"),"string"==typeof t.html?i.innerHTML=t.html:i.appendChild(t.html)):i.innerText=t.text,"error"===t.type&&i.classList.add("webpub-toast--error"),document.body.appendChild(i),n(i),i},e.Utils.serialize=function(e){var t="";for(var n in e)t+=t?"&":"",t+=n+"="+encodeURIComponent(e[n]);return t},e.Utils.throttle=function(e,t){function n(o){return r?(i=arguments,void(a=o)):(e.apply(o,arguments),r=!0,void setTimeout(function(){r=!1,i&&(n.apply(a,i),i=a=null)},t))}var i,a,r=!1;return n}}(webpublicationNamespace);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){e.Param.zoom=!1,e.Class.ViewerManager=function(){function t(e){var t=[],n=0;if(e<=a()&&e>=0)for(var i=1;i<=dt.pagesInFrame;i++)n=e*dt.pagesInFrame+i-Se,n<=dt.pagesQuantity&&n>0&&t.push(n);return t}function n(e){return ge.floor((e+Se-1)/dt.pagesInFrame)}function i(e){return n(e)-Me}function a(){return ge.ceil((dt.pagesQuantity+Se)/dt.pagesInFrame)-1}function r(t,n,i,a){var r=De(ge.abs((t+i)/2),2),o=De(ge.abs((n+a)/2),2);tt=r,nt=o,ct===!1?ct=r:ct+=(r-ct)/st,pt===!1?pt=o:pt+=(o-pt)/st,it=e.Utils.getSegmentLength(t,n,i,a),Ve=We=0,ot&&O("out")}function o(t,n){$e=ke=!0,Ge=t-Ve,Be=Ge-Re,Re=Ge,Ue=ge.min(Re,Ue),Fe=ge.max(Re,Fe),(ge.abs(Ge)>dt.minPxToDrag||Ue<-dt.minPxToDrag||Fe>dt.minPxToDrag)&&(dt.links&&e.Main.linksManagerNew.addFixSwiffyAnims(),e.Utils.styleTransform(ye,"translate3d("+Re+"px, 0px, 0px)"),et&&clearTimeout(et),et=!1),ke=!1}function s(t,n){$e=ke=!0,Ye=n-We,qe=Ye-He,He=Ye,ze=ge.min(He,ze),je=ge.max(He,je),(ge.abs(Ye)>dt.minPxToDrag||ze<-dt.minPxToDrag||je>dt.minPxToDrag)&&(dt.links&&e.Main.linksManagerNew.addFixSwiffyAnims(),e.Utils.styleTransform(ye,"translate3d(0px, "+He+"px, 0px)"),et&&clearTimeout(et),et=!1),ke=!1}function l(t,n){$e=ke=!0,(ge.abs(t-Ve)>dt.minPxToDrag||ge.abs(n-We)>dt.minPxToDrag)&&(lt=De(ge.min(ge.max(ct-(t-Ve)/(st-1),0),fe),2),ut=De(ge.min(ge.max(pt-(n-We)/(st-1),0),me),2),dt.verticalSlider?e.Utils.scaleDom3d(ye,st,lt,ut+me*dt.deltaFrameInDOM):e.Utils.scaleDom3d(ye,st,lt+fe*dt.deltaFrameInDOM,ut),et&&clearTimeout(et),et=!1),ke=!1}function u(t){return!dt.links||!e.Main.pageManager.hasLinks(t)||e.Main.linksManagerNew.preloadAnimPromise(t)}function c(e){var t=ft.getPage(e).image,n=e-Ee,a=i(e),r=dt.deltaFrameInCache*dt.pagesInFrame;return r+=(Ee+Se)%dt.pagesInFrame||dt.pagesInFrame,n>-r&&n<=(2*dt.deltaFrameInCache+1)*dt.pagesInFrame-r&&(Pe[r+n-1]=t),ge.abs(a)<=dt.deltaFrameInDOM&&de.visualizePageAtFrame(t,a,A(t.pageNumber),ot),t}function p(t,n){var i=n?dt.highQualityKey:dt.lowQualityKey;return"svg"===i?e.Utils.promiseXHR("GET",e.Main.pageManager.getImage(i,t)).then(function(a){var r=e.Main.xmlManager.getVariable("contents")+e.Main.xmlManager.getVariable("pages")+t.toString()+"/svg/",o=document.createElement("div");return o.innerHTML=a.responseText.replace(/svg\//gi,r),o=o.querySelector("svg"),o.highQuality=n,o.pageNumber=t,o.idsLinks=[],o.quality=i,o.classList&&o.classList.add("webpub-viewer__page-img"),Promise.resolve(o)}):new Promise(function(a){var r=new Image;r.highQuality=n,r.pageNumber=t,r.idsLinks=[],r.quality=i,r.onload=a.bind({},r),r.onerror=a.bind({},!1),r.src=e.Main.pageManager.getImage(i,t)})}function h(e,t){var n=Ce.filter(function(n){return n.pageNumber===e&&n.highQuality===t});if(n.length)return n[0].promise.isNew=!1,n[0].promise;var i=p(e,t).then(function(t){if(t!==!1)return Ce.splice(Ce.indexOf(a),1),0===Te&&M(t),t.highQuality?ft.setHighPage(e,t):ft.setLowPage(e,t),c(e),Promise.resolve(t)}),a={pageNumber:e,highQuality:t,promise:i};return a.promise.isNew=!0,Ce.push(a),a.promise}function d(t){var i,a,r=ft.hasPage(t),o=e.Main.pageManager.hasLinks(t);i=r===!1?h(t,dt.lowQualityDisabled):c(t),a=o===!1?e.Main.pageManager.getLinksPromise(t):e.Main.pageManager.getLinks(t);var s=e.Utils.promiseTimeout(dt.delayLoadingHd,!0),l=function(e){n(t)===Me?g(t,e[0].highQuality):Math.abs(n(t)-Me)<2&&p(t,!0).then(function(e,t){ft.setHighPage(e,t),c(e)}.bind(this,t))};"undefined"!=typeof i.then||"undefined"!=typeof a.then?i.isNew!==!0&&a.isNew!==!0||Promise.all([i,a,s]).then(l):dt.delayLoadingHd>0?s.then(l.bind({},[i])):l([i])}function f(n,i){var a=n-Me,r=t(n),o=!1;if(dt.useBgColorPerPage){o=[];for(var s in r)o.push(e.Main.pageManager.getBackgroundColor(r[s]));for(;o.length<dt.pagesInFrame;)1===r[s]?o.unshift(o[0]):o.push(o[o.length-1])}var l=!1;if("svg"===dt.highQualityKey&&i===!0&&(l=de.setActiveFromPages(r),l&&r.forEach(function(t){e.Main.linksManagerNew.removeLinksFromPage(t,!0),e.Main.linksManagerNew.addLinksToPage(t,n-Me)})),l===!1){(ge.abs(a)<=dt.deltaFrameInDOM||n>=e.Main.xmlManager.get("common-configuration","config","pageCount"))&&de.clearDomFrame(a,o);for(var u in r)d(r[u])}}function m(){for(var e=1;e<=dt.deltaFrameInCache;e++)f(Me+e),f(Me-e)}function g(t,i){if(t<=dt.pagesQuantity&&t>0){var a=!!i||h(t,!0),r=u(t);Promise.all([a,r]).then(function(i){var a=ge.abs(n(t)-Me);dt.links&&a<=dt.deltaFrameInDOM&&i[1]&&(dt.delayLoadingAnim>0?e.Utils.promiseTimeout(dt.delayLoadingAnim,t).then(function(){i[0].highQuality&&e.Main.linksManagerNew.removeLinksFromPage(t,!0),e.Main.linksManagerNew.addLinksToPage(t,n(t)-Me)}):(i[0].highQuality&&e.Main.linksManagerNew.removeLinksFromPage(t,!0),e.Main.linksManagerNew.addLinksToPage(t,n(t)-Me)))})}}function v(e,t){var n=ft.getPage(e).image;if(n&&t.length){for(var a=t.length;a--;){var r=t[a];if(n.idsLinks.indexOf(r.idLink)<0){var o=de.addImageIntoPageDom(n,r);o.highQuality=n.highQuality,o.pageNumber=n.pageNumber,o.idsLinks=n.idsLinks.concat(r.idLink),n=o,o=void 0}}ft.setHighPage(e,n,!0);var s=i(e);ge.abs(s)<=dt.deltaFrameInDOM&&de.visualizePageAtFrame(n,s,A(e),!1)}}function b(e,t){var n=ft.getPage(e).image;if(n&&t.length){for(var a=t.length;a--;){var r=t[a];if(n.idsLinks.indexOf(r.id)<0){var o=de.addLinkBoxIntoPageDom(n,r);o.highQuality=n.highQuality,o.pageNumber=n.pageNumber,o.idsLinks=n.idsLinks.concat(r.id),n=o,o=void 0}}ft.setHighPage(e,n,!0);var s=i(e);ge.abs(s)<=dt.deltaFrameInDOM&&de.visualizePageAtFrame(n,s,A(e),!1)}}function y(e,t){var n=ft.getPage(e).image;return n&&n.idsLinks.indexOf(t)>=0}function E(e){ge.abs(e)<=2*dt.deltaFrameInCache*dt.pagesInFrame?e>0?Pe=Pe.splice(e,Pe.length).concat(new Array(e)):e<0&&(Pe=new Array((-e)).concat(Pe.splice(0,Pe.length+e))):Pe=new Array((2*dt.deltaFrameInCache+1)*dt.pagesInFrame)}function M(t){we===!1&&(we=e.Main.xmlManager.get("common-configuration","contents","swf","width")/e.Main.xmlManager.get("common-configuration","contents","swf","height")),we&&(we>=_e?(Te=De(dt.pageMaxWidth-2*dt.pageShadowSize),Ae=De(dt.pageMaxWidth/we-2*dt.pageShadowSize)):(Ae=De(dt.pageMaxHeight-2*dt.pageShadowSize),Te=De(dt.pageMaxHeight*we)),Te>dt.pageMaxWidth&&(Ae=De(Ae*dt.pageMaxWidth/Te),Te=dt.pageMaxWidth),Ae>dt.pageMaxHeight&&(Te=De(Te*dt.pageMaxHeight/Ae),Ae=dt.pageMaxHeight));var n=(fe-dt.paddingLeft-dt.paddingRight-Te*dt.pagesInFrame)/2;Ze=n+dt.paddingLeft,Ke=n+dt.paddingRight;var i=(me-dt.paddingTop-dt.paddingBottom-Ae)/2;if(Xe=i+dt.paddingTop,Qe=i+dt.paddingBottom,we){var a={width:Te,height:Ae,left:Ze,top:Xe};de.setPageSize(a),dt.links&&e.Main.linksManagerNew.setPageSize(a)}}function S(e){var t=[];if(e>=-dt.deltaFrameInCache||e<=dt.deltaFrameInCache){var n=(e+dt.deltaFrameInCache)*dt.pagesInFrame;t=Pe.slice(n,n+dt.pagesInFrame)}return t}function P(e){return((e+Se)%dt.pagesInFrame||dt.pagesInFrame)-1}function w(){return t(n(Ee))}function _(e){return dt.verticalSlider?0:fe*(dt.deltaFrameInDOM+e)}function T(e){return dt.verticalSlider?me*(dt.deltaFrameInDOM+e):0}function A(e){return Ze+P(e)*Te}function C(){return st}function L(e,t){return De(ge.min(ge.max(t/e*st,1),dt.maxZoom),2)}function x(t,n,i,a){if(0!==tt&&!ke){dt.links&&e.Main.linksManagerNew.addFixSwiffyAnims(),ke=!0,rt=at,at=e.Utils.getSegmentLength(t,n,i,a),it=it||at;var r=De(ge.abs((t+i)/2)),o=De(ge.abs((n+a)/2)),s=De(L(it,at)/st,2);lt=De(ge.min(ge.max(ct-(r-tt)/(s*st-1),0),fe),2),ut=De(ge.min(ge.max(pt-(o-nt)/(s*st-1),0),me),2),$e=Je=!1,s*st>(rt>at?1.05:1)?dt.verticalSlider?e.Utils.scaleDom3d(ye,s*st,lt,ut+me*dt.deltaFrameInDOM):e.Utils.scaleDom3d(ye,s*st,lt+fe*dt.deltaFrameInDOM,ut):ot&&N(),ke=!1}}function k(){lt!==!1&&(ct=lt,pt=ut,lt=lt=$e=!1)}function O(t){if(dt.zoomRetina&&("in"===t||"out"===t)){var n,i=w();"in"===t?(e.Param.zoom===!1&&(e.Param.zoom=!0,e.Utils.callEvent(window,"webpub-zoom")),de.zoomIn()):(e.Param.zoom===!0&&(e.Param.zoom=!1,e.Utils.callEvent(window,"webpub-zoom")),de.zoomOut());for(var a=i.length;a--;)n=ft.getPage(i[a]).image,n&&de.visualizePageAtFrame(n,0,A(n.pageNumber),"in"===t)}}function I(){ot===!1&&dt.links&&e.Main.linksManagerNew.addFixSwiffyAnims(),ot=!0,J("zoomIn"),e.Main.eventEmul.callEvent("pageZoomIn",w()),O("in")}function N(){st=1,ot=!1,J("zoomOut"),dt.links&&e.Main.linksManagerNew.removeFixSwiffyAnims(),tt=nt=it=at=0,ct=pt=lt=ut=!1,O("out"),e.Utils.resetDomTransform(ye)}function D(){var e=De(L(it,at)/st,2);st=De(e*st,2),k(),ke=!0,it=at=0,V(!1),1===st?N():ot===!1?I():O("in"),ke=!1}function R(){var e=Re>0,t=Fe-Re;$e=Je=!1,ot===!1&&(ge.abs(Ge)>dt.minPxToDrag||Ue<-dt.minPxToDrag||Fe>dt.minPxToDrag)&&(e&&(0===Me||Be<0&&t>dt.minPxToCancelScroll||Re<dt.minPxToChangePage)||!e&&(Me===a()||Be>0&&-t>dt.minPxToCancelScroll||-Re<dt.minPxToChangePage)?B(0,0,!1):e?B(fe,-1,!1):B(-fe,1,!1))}function U(){var e=He>0,t=je-He;$e=Je=!1,ot===!1&&(ge.abs(Ye)>dt.minPxToDrag||ze<-dt.minPxToDrag||je>dt.minPxToDrag)&&(e&&(0===Me||qe<0&&t>dt.minPxToCancelScroll||He<dt.minPxToChangePage)||!e&&(Me===a()||qe>0&&-t>dt.minPxToCancelScroll||-He<dt.minPxToChangePage)?B(0,0,!0):e?B(me,-1,!0):B(-me,1,!0))}function F(t){e.Utils.styleTransition(ye,"none"),Fe=Ue=Re=je=ze=He=0,dt.links&&e.Main.linksManagerNew.removeFixSwiffyAnims(),window.setTimeout(function(){if(0!==t){for(var n=S(t),i=n.length;i--;)n[i]&&"svg"!==dt.highQualityKey&&de.visualizePageAtFrame(n[i],0,A(n[i].pageNumber),!1);e.Utils.styleTransform(ye,"scale3d(1, 1, 1)"),ee(t>0?"next":"prev",!1)}xe=ke=!1},50)}function B(t,n,i){var a=dt.animationTimePerPage*dt.pagesInFrame/1e3;ke=!0,e.Utils.styleTransitionTransform(ye,a,"ease-out"),clearTimeout(ht),ht=setTimeout(F.bind({},n),1e3*a),i?e.Utils.styleTransform(ye,"translate3d(0px, "+t+"px, 0px)"):e.Utils.styleTransform(ye,"translate3d("+t+"px, 0px, 0px)")}function V(t){t===!1&&e.Main.menuManager.hideMenu(),Oe!==t&&(Oe="undefined"==typeof t?!Oe:t,e.Main.menuManager.onDocumentClick(),e.Main.toolsEvents&&e.Main.toolsEvents.showTools(Oe))}function G(t){if(32===t.keyCode)V();else if(dt.draggable!==!1){if(e.Class.LightboxManagerNew.getLength()>0)return;dt.verticalSlider?[38,40].indexOf(t.keyCode)>=0&&te(38===t.keyCode?"prev":"next"):[37,39].indexOf(t.keyCode)>=0&&te(37===t.keyCode?"prev":"next")}}function H(e,t,n){et?(clearTimeout(et),et=!1,q(e,t)):et=setTimeout(function(e){0===at&&Je===!1&&$e===!1&&j(n,e),et=!1}.bind({},Me),dt.doubleTapDelay)}function z(t){if(!ke&&!$e&&("mousedown"!==t.type&&"click"!==t.type||0===t.button)){var n=t.clientX,i=t.clientY;if(ot&&(n=De((n+ct*(st-1))/st),i=De((i+pt*(st-1))/st)),dt.links&&n>Ze&&n<fe-Ke&&i>Xe&&i<me-Qe){n-=Ze,i-=Xe;var a=ge.trunc(n/Te),r=dt.pagesInFrame*Me+a+1-Se;r>0&&(n-=a*Te,e.Main.linksManagerNew.onLayerClick(r,n,i,t))}}}function j(t,n){if(!ke&&!$e&&"VIDEO"!==t.target.tagName&&("mousedown"!==t.type&&"click"!==t.type||0===t.button)){var i=t.clientX>=0?t.clientX:t.touches[0].clientX,a=t.clientY>=0?t.clientY:t.touches[0].clientY;ot&&(i=De((i+ct*(st-1))/st),a=De((a+pt*(st-1))/st));var r=i,o=a,s=!0;if(dt.links&&i>Ze&&i<fe-Ke&&a>Xe&&a<me-Qe){i-=Ze,a-=Xe;var l=ge.trunc(i/Te),u=dt.pagesInFrame*n+l+1-Se;u>0&&(i-=l*Te,e.Main.linksManagerNew.findClickedUserActs(u,i,a,t)&&(s=!1))}s&&dt.zoomSingleClick?(q(r,o),$e=!1):s&&V()}}function q(t,n){ke||(ke=!0,ot?N():dt.zoomDoubleClick&&(st=dt.maxZoom,I(),V(!1),ct=t,pt=n,dt.verticalSlider?e.Utils.scaleDom3d(ye,st,t,n+me*dt.deltaFrameInDOM):e.Utils.scaleDom3d(ye,st,t+fe*dt.deltaFrameInDOM,n)),ke=!1)}function W(e){ye.style.willChange="transform",mt(e),ke||(1===be.length?(Ve=be[0].x,We=be[0].y,Je=!0,H(Ve,We,e)):r(be[0].x,be[0].y,be[1].x,be[1].y))}function Y(e){e.preventDefault(),mt(e),ke||(1===be.length?Je&&(ot?l(be[0].x,be[0].y):dt.draggable!==!1&&(dt.verticalSlider?s(be[0].x,be[0].y):o(be[0].x,be[0].y))):be.length>1&&dt.zoomPinch&&x(be[0].x,be[0].y,be[1].x,be[1].y))}function Z(e){mt(e),"mouseout"===e.type&&"CANVAS"===e.target.nodeName||(ot?at>0?dt.zoomPinch&&D():k():at>0?dt.zoomPinch&&D():0===be.length&&Je&&$e&&(dt.verticalSlider?U():R()),Je=!1,ye.style.willChange="")}function X(t){var i=!!document.activeElement&&"INPUT"===document.activeElement.tagName;if(!document.hasFocus()||!i){e.Param.userAgent.os.name===e.Param.userAgent.OS.IOS&&window.scrollTo(0,0),fe=window.innerWidth,me=window.innerHeight,_e=fe/me,"canvas"===dt.domMode&&(dt.maxZoom=ge.min(dt.maxZoom,De(10*ge.sqrt(Ie/(fe*me)))/10),dt.zoomScale=Math.min(dt.zoomScale,ge.round(100*ge.sqrt(Ie/(fe*me*dt.maxZoom*dt.maxZoom)))/100)),ot&&N(),dt=ne(dt),dt.verticalSlider?(ye.style.width="100%",ye.style.height=2*dt.deltaFrameInDOM+1+"00%",ye.style.left="0px",ye.style.top=-dt.deltaFrameInDOM+"00%",e.Param.viewMain.classList.add("webpub-viewer__container-vertical")):(ye.style.width=2*dt.deltaFrameInDOM+1+"00%",ye.style.height="100%",ye.style.left=-dt.deltaFrameInDOM+"00%",ye.style.top="0px"),dt.pageOnFirstFrame=e.Main.pageManager.pagesOnFirstScreen(),dt.pagesInFrame=e.Main.pageManager.pagePerScreen(),Se=dt.pagesInFrame-dt.pageOnFirstFrame;for(var a=Ne.length;a--;){var r=Ne[a],o=dt[r];"string"==typeof o&&o.indexOf("px")>0?dt[r]=parseInt(o)||0:"string"==typeof o&&o.indexOf("%")>0&&(["paddingLeft","paddingRight"].indexOf(r)>=0?dt[r]=De(fe*(parseInt(o)||0)/100):dt[r]=De(me*(parseInt(o)||0)/100))}dt.pageMaxWidth=De((fe-dt.paddingLeft-dt.paddingRight)/dt.pagesInFrame),dt.pageMaxHeight=De(me-dt.paddingTop-dt.paddingBottom);var s={pageOnFirstFrame:dt.pageOnFirstFrame,pagesInFrame:dt.pagesInFrame,maxZoom:dt.maxZoom,zoomScale:dt.zoomScale};if(M(),de.setConfig(s),de.onResize(t),dt.links){e.Main.linksManagerNew.setConfig(s),e.Main.linksManagerNew.onResize(t);var l=w();l.forEach(function(t){e.Main.linksManagerNew.addLinksToPage(t,n(t)),e.Main.linksManagerNew.removeLinksFromPage(t,n(t))})}Le&&(Me=n(Ee),Pe=new Array((2*dt.deltaFrameInCache+1)*dt.pagesInFrame),f(Me,!0),m())}}function K(e){if("string"==typeof e){var t=!1,n=!1,i=e.toUpperCase();if("NEXT"===i?e="+"+dt.pagesInFrame:"PREV"===i?e="-"+dt.pagesInFrame:"FIRST"===i?e=1:"LAST"===i&&(e=dt.pagesQuantity),["-","+"].indexOf(e[0])>=0&&(n=!0,t="-"===e[0],e=e.substr(1,e.length)),e=parseInt(e),0===e)e=Ee||1;else{if(!e)return;n&&(e=t?ge.max(Ee-e,1):ge.min(Ee+e,dt.pagesQuantity))}}return"number"==typeof e&&e>0&&e<=dt.pagesQuantity&&e}function Q(i,a){"string"==typeof i&&(i=i.toUpperCase());var r=t(n(a));e.Main.trackerManager.trackPage({name:"page",variables:{1:r}});for(var o=r.length;o--;)e.Main.trackerManager.trackEvent({name:"pageView",variables:{1:r[o]}});"NEXT"===i?e.Main.trackerManager.trackEvent({name:"pageNext",variables:{1:Ee}}):"PREV"===i&&e.Main.trackerManager.trackEvent({name:"pagePrev",variables:{1:Ee}})}function J(n){var i=t(Me);1===i.length?e.Main.trackerManager.trackEvent({name:n,variables:{1:Ee}}):e.Main.trackerManager.trackEvent({name:n,variables:{1:i[0]+"-"+i[1]}})}function $(t){ot&&N();var i=n(t),a=i-Me;a&&(E(a*dt.pagesInFrame),Ee=t,Me=i,e.Main.pagesLoaderNew.setCurrentPage(t),f(Me,!0),m(),dt.links&&e.Main.linksManagerNew.adjustLinksCache(i))}function ee(t,n){var i=K(t);!i||i===Ee&&n!==!0||(e.Main.pageManager.set(i),Q(t,i),V(!1),$(i))}function te(e){"prev"===e||e===-1?Me>0&&(dt.verticalSlider?B(me,-1,!0):B(fe,-1,!1)):"next"!==e&&1!==e||Me<a()&&(dt.verticalSlider?B(-me,1,!0):B(-fe,1,!1))}function ne(t){var n=e.Main.xmlManager.get("common-ui","configs","viewer","padding");if(n)for(var i in n)_typeof(n[i])&&(t[i]=n[i]);return t}function ie(t){dt.pagesQuantity=e.Main.pagesLoaderNew.getPageQuantity();for(var n in t)"undefined"!=typeof dt[n]&&(dt[n]=t[n]);Se=dt.pagesInFrame-dt.pageOnFirstFrame,Le&&X(),"undefined"==typeof t.animationTimePerPage&&t.verticalSlider===!0&&(dt.animationTimePerPage=400)}function ae(e){e.preventDefault(),setTimeout(function(){var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));te(1===t?"prev":"next")},16)}function re(){ye=document.createElement("div"),ye.id="webpub-viewer__container",ye.addEventListener(e.Param.eventClick,z,!0),ye.addEventListener(e.Param.eventStart,W,!0),ye.addEventListener(e.Param.eventMove,Y,!0),window.addEventListener(e.Param.eventStop,Z,!0),dt.container.appendChild(ye),dt.keyboardFeature&&document.addEventListener(e.Param.eventKeyboardDown,G,!1),window.addEventListener(e.Param.eventResize,X),dt.draggable!==!1&&ye.addEventListener(e.Param.eventMouseWheel,ae)}function oe(){var t={};for(var n in dt)t[n]=dt[n];if(t.container=ye,"canvas"===dt.domMode)de=new e.Class.CanvasViewerManager;else{if("html"!==dt.domMode)return!1;de=new e.Class.HtmlViewerManager}de.init(t),dt.links&&(e.Main.linksManagerNew=new e.Class.LinksManagerNew,e.Main.linksManagerNew.init(t))}function se(){NIApi.register("page.open",function(t){return e.Utils._assertInteger(t,"Page number must be an integer"),ee(t),Promise.resolve()}),NIApi.register("page.openNext",function(){return te("next"),Promise.resolve()}),NIApi.register("page.openPrevious",function(){return te("prev"),Promise.resolve()}),NIApi.register("page.openFirst",function(){return ee("first"),Promise.resolve()}),NIApi.register("page.openLast",function(){return ee("last"),Promise.resolve()}),NIApi.register("page.clickLink",function(t,n){return e.Utils._assertInteger(t,"Page number must be an integer")&&e.Utils._assertInteger(n,"Link index must be an integer")&&t>0&&t<=dt.pagesQuantity&&n>=0&&e.Main.linksManagerNew.linkClick(t,{index:n}),Promise.resolve()})}function le(t){ie(t||{}),"canvas"===dt.domMode&&(Ie=5e6),re(),oe(),X(),Pe=new Array((2*dt.deltaFrameInCache+1)*dt.pagesInFrame),Le=!0,se();var n=parseInt(e.Main.urlManager.get("startPage")||e.Main.urlManager.get("page")||dt.startPage,10);ee(n),e.Main.pageManager.onChange(function(t){e.Main.viewerManager.goToPage(t)}),O("out")}function ue(){var e=window.innerWidth/2,t=window.innerWidth/2;q(e,t)}function ce(){ot=!1,ue()}function pe(){ot=!0,ue()}function he(){return ot}var de={},fe=0,me=0,ge=Math,ve=(e.Param.newThemeVersion,{}),be=[],ye=null,Ee=0,Me=-1,Se=0,Pe=[],we=!1,_e=!1,Te=0,Ae=0,Ce=[],Le=!1,xe=!1,ke=!1,Oe=!1,Ie=0,Ne=["paddingBottom","paddingRight","paddingTop","paddingLeft"],De=function(e,t){if("svg"===dt.highQualityKey)return e;var n=t?ge.pow(10,t):1;return ge.round(e*n)/n},Re=0,Ue=fe,Fe=0,Be=0,Ve=0,Ge=0,He=0,ze=me,je=0,qe=0,We=0,Ye=0,Ze=0,Xe=0,Ke=0,Qe=0,Je=!1,$e=!1,et=!1,tt=0,nt=0,it=0,at=0,rt=0,ot=!1,st=1,lt=!1,ut=!1,ct=!1,pt=!1,ht=null,dt={deltaFrameInCache:2,deltaFrameInDOM:1,pagesInFrame:1,pageOnFirstFrame:1,pageMaxWidth:0,pageShadowSize:0,pagesQuantity:0,lowQualityCacheLength:20,highQualityCacheLength:6,domMode:"canvas",startPage:1,highQualityKey:"hdpi",lowQualityKey:"mdpi",lowQualityDisabled:!1,links:!0,pagesRetina:!0,linksRetina:!1,zoomRetina:!0,linksBoxWithDom:!0,autoPlayVideo:!0,autoPlayAnim:!1,linkClickMargin:6,keyboardFeature:!0,zoomPinch:!0,zoomDoubleClick:!0,zoomSingleClick:!1,draggable:!0,delayLoadingHd:0,delayLoadingAnim:400,maxZoom:2.5,zoomScale:2,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,pageMaxHeight:0,minPxToChangePage:30,minPxToCancelScroll:60,minPxToDrag:5,doubleTapDelay:250,animationTimePerPage:125,pageBgColor:"rgba(240, 240, 240, 1)",useBgColorPerPage:!0,linkBoxAspect:e.Class.LinksManagerNew.linksBehaviors.blink,linkBlinkDuration:1e3,verticalSlider:!1,container:e.Param.viewMain},ft=function(){function e(e){var t,n=[],i={},a=0;"high"===e?(i=s,a=dt.highQualityCacheLength):"low"===e&&(i=o,a=dt.lowQualityCacheLength);var r=Object.keys(i);for(t=r.length;t--;)n.push(i[r[t]].date);n.sort(l);var u=n[a-1];NIApi.page.getVisiblePages().then(function(t,n,i){for(var a=[].concat(i),l=1;l<=dt.pagesInFrame;l++)a.push(i[i.length-1]+l);for(var u=1;u<=dt.pagesInFrame;u++)a.unshift(i[0]-u);for(a=a.map(function(e){return e.toString()}),l=r.length;l--;)a.indexOf(r[l])===-1&&t.hasOwnProperty(r[l])===!0&&t[r[l]].date<n&&(t[r[l]]=void 0,delete t[r[l]]);"high"===e?s=t:"low"===e&&(o=t)}.bind(null,i,u))}function t(t){"low"===t?Object.keys(o).length>dt.lowQualityCacheLength&&e(t):"high"===t&&Object.keys(s).length>dt.highQualityCacheLength&&e(t)}function n(e){var t=!1;return"undefined"!=typeof s[e]?t="high":"undefined"!=typeof o[e]&&(t="low"),t}function i(e){var t=!1;return"undefined"!=typeof s[e]?(s[e].date=new Date,t=s[e],t.highQuality=!0):"undefined"!=typeof o[e]&&(o[e].date=new Date,t=o[e],t.highQuality=!1),t}function a(e,n){o[e]&&(delete o[e],o[e]=void 0),n.setAttribute("data-pageNumber",e),o[e]={image:n,date:new Date},window.requestAnimationFrame(t.bind({},"low"))}function r(e,n,i){s[e]&&!i?s[e].date=new Date:(n.setAttribute("data-pageNumber",e),s[e]={image:n,date:new Date},window.requestAnimationFrame(t.bind({},"high")))}var o={},s={},l=function(e,t){return t-e};return{hasPage:n,getPage:i,setLowPage:a,setHighPage:r}}(),mt=function(){function t(){be=[];for(var e in ve)be.push({x:ve[e].x,y:ve[e].y})}return function(n){if(n.type.indexOf("mouse")>=0)be=n.type===e.Param.eventStop||n.type===e.Param.eventOut?[]:[{x:n.pageX,y:n.pageY}];else if(n.type.toLowerCase().indexOf("pointer")>=0)n.type===e.Param.eventStop||n.type===e.Param.eventOut?delete ve[n.pointerId]:n.type.toLowerCase().indexOf("move")>=0&&Je===!1||(ve[n.pointerId]={x:n.pageX,y:n.pageY}),t();else if(n.type.indexOf("touch")>=0){ve={};for(var i=n.touches.length;i--;)ve[n.touches[i].identifier]={x:n.touches[i].clientX,y:n.touches[i].clientY};t()}}}();return{init:le,setConfig:ie,goToPage:ee,scrollFrame:te,addImagesOnPage:v,addLinksBoxOnPage:b,linkChargedInPage:y,getScale:C,getPagesInCacheAtFrame:S,getPagePosition:P,getPageCoordX:A,getFrameCoordX:_,getFrameCoordY:T,getFrameOfPage:n,getPagesOfFrame:t,getDeltaFrameForPage:i,getCurrentPages:w,zoomIn:ce,zoomOut:pe,isZoomed:he}}}(webpublicationNamespace);var CSSJSON=new function(){var e=this;e.init=function(){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.repeat=function(e){return new Array(1+e).join(this)}},e.init();var t=/\/\*[\s\S]*?\*\//g,n=/([^\:]+):([^\;]*);/,a=/(\/\*[\s\S]*?\*\/)|([^\s\;\{\}][^\;\{\}]*(?=\{))|(\})|([^\;\{\}]+\;(?!\s*\*\/))/gim,r=1,o=2,s=3,l=4,u=function(e){return"undefined"==typeof e||0==e.length||null==e},c=function(e){return!u(e)&&(e.attributes&&e.children)};e.toJSON=function(c,p){var h={children:{},attributes:{}},d=null,f=0;if("undefined"==typeof p)var p={ordered:!1,comments:!1,
stripComments:!1,split:!1};for(p.stripComments&&(p.comments=!1,c=c.replace(t,""));null!=(d=a.exec(c));)if(!u(d[r])&&p.comments){var m=d[r].trim();h[f++]=m}else if(u(d[o])){if(!u(d[s]))return h;if(!u(d[l])){var g=d[l].trim(),v=n.exec(g);if(v){var b=v[1].trim(),y=v[2].trim();if(p.ordered){var E={};E.name=b,E.value=y,E.type="attr",h[f++]=E}else if(b in h.attributes){var M=h.attributes[b];M instanceof Array||(h.attributes[b]=[M]),h.attributes[b].push(y)}else h.attributes[b]=y}else h[f++]=g}}else{var b=d[o].trim(),S=e.toJSON(c,p);if(p.ordered){var E={};E.name=b,E.value=S,E.type="rule",h[f++]=E}else{if(p.split)var P=b.split(",");else var P=[b];for(i in P){var w=P[i].trim();if(w in h.children)for(var _ in S.attributes)h.children[w].attributes[_]=S.attributes[_];else h.children[w]=S}}}return h},e.toCSS=function(e,t,n){var a="";if("undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=!1),e.attributes)for(i in e.attributes){var r=e.attributes[i];if(r instanceof Array)for(var o=0;o<r.length;o++)a+=d(i,r[o],t);else a+=d(i,r,t)}if(e.children){var s=!0;for(i in e.children)n&&!s?a+="\n":s=!1,a+=f(i,e.children[i],t)}return a},e.toHEAD=function(t,n,i){var a=document.getElementsByTagName("head")[0],r=document.getElementById(n),o=null!==r&&r instanceof HTMLStyleElement;if(!u(t)&&a instanceof HTMLHeadElement){if(o){if(i!==!0&&!u(i))return;r.removeAttribute("id")}c(t)&&(t=e.toCSS(t));var s=document.createElement("style");if(s.type="text/css",u(n)?s.id="cssjson_"+h():s.id=n,s.styleSheet?s.styleSheet.cssText=t:s.appendChild(document.createTextNode(t)),a.appendChild(s),p(s))o&&r.parentNode.removeChild(r);else{if(s.parentNode.removeChild(s),!o)return;r.setAttribute("id",n),s=r}return s}},"undefined"!=typeof window&&(window.createCSS=e.toHEAD);var p=function(e){return e instanceof HTMLStyleElement&&e.sheet.cssRules.length>0},h=function(){return Date.now()||+new Date},d=function(e,t,n){return"\t".repeat(n)+e+": "+t+";\n"},f=function(t,n,i){var a="\t".repeat(i)+t+" {\n";return a+=e.toCSS(n,i+1),a+="\t".repeat(i)+"}\n"}},Tween=function(){function e(){}e.create=function(){var e=null,t=null,n=null;return function(i,a){for(e=[],t=arguments.length,n=2;n<t;n++)e[n-2]=arguments[n];return function(){a.apply(i,[].concat(arguments,e))}}}();var t=function(e,t,n,i,a,r,o){this.init(e,t,n,i,a,r,o)},n=t.prototype;return n.obj={},n.prop="",n.func=function(e,t,n,i){return n*e/i+t},n.begin=0,n.change=0,n.prevTime=0,n.prevPos=0,n.looping=!1,n._duration=0,n._time=0,n._pos=0,n._position=0,n._startTime=0,n._finish=0,n.name="",n.suffixe="",n._listeners=[],n.setTime=function(e){this.prevTime=this._time,e>this.getDuration()?this.looping?(this.rewind(e-this._duration),this.update(),this.broadcastMessage("onMotionLooped",{target:this,type:"onMotionLooped"})):(this._time=this._duration,this.update(),this.stop(),this.broadcastMessage("onMotionFinished",{target:this,type:"onMotionFinished"})):e<0?(this.rewind(),this.update()):(this._time=e,this.update())},n.getTime=function(){return this._time},n.setDuration=function(e){this._duration=null==e||e<0?1e5:e},n.getDuration=function(){return this._duration},n.setPosition=function(){var e=null;return function(t){this.prevPos=this._pos,e=""!=this.suffixe?this.suffixe:"",this.obj[this.prop]=Math.round(t)+e,this._pos=t,this.broadcastMessage("onMotionChanged",{target:this,type:"onMotionChanged"})}}(),n.getPosition=function(e){return void 0==e&&(e=this._time),this.func(e,this.begin,this.change,this._duration)},n.setFinish=function(e){this.change=e-this.begin},n.getFinish=function(){return this.begin+this.change},n.init=function(e,t,n,i,a,r,o){arguments.length&&(this._listeners=new Array,this.addListener(this),o&&(this.suffixe=o),this.obj=e,this.prop=t,this.begin=i,this._pos=i,this.setDuration(r),null!=n&&""!=n&&(this.func=n),this.setFinish(a))},n.start=function(){this.rewind(),this.startEnterFrame(),this.broadcastMessage("onMotionStarted",{target:this,type:"onMotionStarted"})},n.rewind=function(e){this.stop(),this._time=void 0==e?0:e,this.fixTime(),this.update()},n.fforward=function(){this._time=this._duration,this.fixTime(),this.update()},n.update=function(){this.setPosition(this.getPosition(this._time))},n.startEnterFrame=function(){this.stopEnterFrame(),this.isPlaying=!0,this.onEnterFrame()},n.onEnterFrame=function(){this.isPlaying&&(this.nextFrame(),window.requestAnimationFrame(e.create(this,this.onEnterFrame)))},n.nextFrame=function(){this.setTime((this.getTimer()-this._startTime)/1e3)},n.stop=function(){this.stopEnterFrame(),this.broadcastMessage("onMotionStopped",{target:this,type:"onMotionStopped"})},n.stopEnterFrame=function(){this.isPlaying=!1},n.continueTo=function(e,t){this.begin=this._pos,this.setFinish(e),void 0!=this._duration&&this.setDuration(t),this.start()},n.resume=function(){this.fixTime(),this.startEnterFrame(),this.broadcastMessage("onMotionResumed",{target:this,type:"onMotionResumed"})},n.yoyo=function(){this.continueTo(this.begin,this._time)},n.addListener=function(e){return this.removeListener(e),this._listeners.push(e)},n.removeListener=function(){var e=null,t=null;return function(n){for(e=this._listeners,t=e.length;t--;)if(e[t]==n)return e.splice(t,1),!0;return!1}}(),n.broadcastMessage=function(){var e=null,t=null,n=null,i=null,a=null,r=null;return function(){for(e=[],t=r=arguments.length;r--;)e.push(arguments[t-(r+1)]);for(n=e.shift(),i=this._listeners,a=i.length;a--;)i[a][n]&&i[a][n].apply(i[a],e)}}(),n.fixTime=function(){this._startTime=this.getTimer()-1e3*this._time},n.getTimer=function(){return(new Date).getTime()-this._time},t.backEaseIn=function(e,t,n,i,a,r){if(void 0==o)var o=1.70158;return n*(e/=i)*e*((o+1)*e-o)+t},t.backEaseOut=function(e,t,n,i,a,r){if(void 0==o)var o=1.70158;return n*((e=e/i-1)*e*((o+1)*e+o)+1)+t},t.backEaseInOut=function(e,t,n,i,a,r){if(void 0==o)var o=1.70158;return(e/=i/2)<1?n/2*(e*e*(((o*=1.525)+1)*e-o))+t:n/2*((e-=2)*e*(((o*=1.525)+1)*e+o)+2)+t},t.elasticEaseIn=function(e,t,n,i,a,r){if(0==e)return t;if(1==(e/=i))return t+n;if(r||(r=.3*i),!a||a<Math.abs(n)){a=n;var o=r/4}else var o=r/(2*Math.PI)*Math.asin(n/a);return-(a*Math.pow(2,10*(e-=1))*Math.sin((e*i-o)*(2*Math.PI)/r))+t},t.elasticEaseOut=function(e,t,n,i,a,r){if(0==e)return t;if(1==(e/=i))return t+n;if(r||(r=.3*i),!a||a<Math.abs(n)){a=n;var o=r/4}else var o=r/(2*Math.PI)*Math.asin(n/a);return a*Math.pow(2,-10*e)*Math.sin((e*i-o)*(2*Math.PI)/r)+n+t},t.elasticEaseInOut=function(e,t,n,i,a,r){if(0==e)return t;if(2==(e/=i/2))return t+n;if(!r)var r=i*(.3*1.5);if(!a||a<Math.abs(n))var a=n,o=r/4;else var o=r/(2*Math.PI)*Math.asin(n/a);return e<1?-.5*(a*Math.pow(2,10*(e-=1))*Math.sin((e*i-o)*(2*Math.PI)/r))+t:a*Math.pow(2,-10*(e-=1))*Math.sin((e*i-o)*(2*Math.PI)/r)*.5+n+t},t.bounceEaseOut=function(e,t,n,i){return(e/=i)<1/2.75?n*(7.5625*e*e)+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},t.bounceEaseIn=function(e,n,i,a){return i-t.bounceEaseOut(a-e,0,i,a)+n},t.bounceEaseInOut=function(e,n,i,a){return e<a/2?.5*t.bounceEaseIn(2*e,0,i,a)+n:.5*t.bounceEaseOut(2*e-a,0,i,a)+.5*i+n},t.strongEaseInOut=function(e,t,n,i){return n*(e/=i)*e*e*e*e+t},t.regularEaseIn=function(e,t,n,i){return n*(e/=i)*e+t},t.regularEaseOut=function(e,t,n,i){return-n*(e/=i)*(e-2)+t},t.regularEaseInOut=function(e,t,n,i){return(e/=i/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},t.strongEaseIn=function(e,t,n,i){return n*(e/=i)*e*e*e*e+t},t.strongEaseOut=function(e,t,n,i){return n*((e=e/i-1)*e*e*e*e+1)+t},t.strongEaseInOut=function(e,t,n,i){return(e/=i/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t},t}(),YT_ready=function(){var e=[],t=!1;return function(n,i){if(n===!0)for(t=!0;e.length;)e.shift()();else"function"==typeof n&&(t?n():e[i?"unshift":"push"](n))}}(),proxyUrl="https://yt.zone-secure.net/player_api",loadPromise=null;!function(e){var t=null;!function n(e,i,a){function r(s,l){if(!i[s]){if(!e[s]){var u="function"==typeof t&&t;if(!l&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var p=i[s]={exports:{}};e[s][0].call(p.exports,function(t){var n=e[s][1][t];return r(n?n:t)},p,p.exports,n,e,i,a)}return i[s].exports}for(var o="function"==typeof t&&t,s=0;s<a.length;s++)r(a[s]);return r}({1:[function(e,t,n){(function(i,a){!function(e,i){"object"==typeof n&&"undefined"!=typeof t?t.exports=i():"function"==typeof define&&define.amd?define(i):e.ES6Promise=i()}(this,function(){function t(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function n(e){return"function"==typeof e}function r(e){X=e}function o(e){K=e}function s(){return function(){return i.nextTick(h)}}function l(){return"undefined"!=typeof Z?function(){Z(h)}:p()}function u(){var e=0,t=new $(h),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function c(){var e=new MessageChannel;return e.port1.onmessage=h,function(){return e.port2.postMessage(0)}}function p(){var e=setTimeout;return function(){return e(h,1)}}function h(){for(var e=0;e<Y;e+=2){var t=ne[e],n=ne[e+1];t(n),ne[e]=void 0,ne[e+1]=void 0}Y=0}function d(){try{var t=e,n=t("vertx");return Z=n.runOnLoop||n.runOnContext,l()}catch(i){return p()}}function f(e,t){var n=arguments,i=this,a=new this.constructor(g);void 0===a[ae]&&D(a);var r=i._state;return r?!function(){var e=n[r-1];K(function(){return O(r,a,e,i._result)})}():C(i,a,e,t),a}function m(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(g);return w(n,e),n}function g(){}function v(){return new TypeError("You cannot resolve a promise with itself")}function b(){return new TypeError("A promises callback cannot return that same promise.")}function y(e){try{return e.then}catch(t){return le.error=t,le}}function E(e,t,n,i){try{e.call(t,n,i)}catch(a){return a}}function M(e,t,n){K(function(e){var i=!1,a=E(n,t,function(n){i||(i=!0,t!==n?w(e,n):T(e,n))},function(t){i||(i=!0,A(e,t))},"Settle: "+(e._label||" unknown promise"));!i&&a&&(i=!0,A(e,a))},e)}function S(e,t){t._state===oe?T(e,t._result):t._state===se?A(e,t._result):C(t,void 0,function(t){return w(e,t)},function(t){return A(e,t)})}function P(e,t,i){t.constructor===e.constructor&&i===f&&t.constructor.resolve===m?S(e,t):i===le?(A(e,le.error),le.error=null):void 0===i?T(e,t):n(i)?M(e,t,i):T(e,t)}function w(e,n){e===n?A(e,v()):t(n)?P(e,n,y(n)):T(e,n)}function _(e){e._onerror&&e._onerror(e._result),L(e)}function T(e,t){e._state===re&&(e._result=t,e._state=oe,0!==e._subscribers.length&&K(L,e))}function A(e,t){e._state===re&&(e._state=se,e._result=t,K(_,e))}function C(e,t,n,i){var a=e._subscribers,r=a.length;e._onerror=null,a[r]=t,a[r+oe]=n,a[r+se]=i,0===r&&e._state&&K(L,e)}function L(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,a=void 0,r=e._result,o=0;o<t.length;o+=3)i=t[o],a=t[o+n],i?O(n,i,a,r):a(r);e._subscribers.length=0}}function x(){this.error=null}function k(e,t){try{return e(t)}catch(n){return ue.error=n,ue}}function O(e,t,i,a){var r=n(i),o=void 0,s=void 0,l=void 0,u=void 0;if(r){if(o=k(i,a),o===ue?(u=!0,s=o.error,o.error=null):l=!0,t===o)return void A(t,b())}else o=a,l=!0;t._state!==re||(r&&l?w(t,o):u?A(t,s):e===oe?T(t,o):e===se&&A(t,o))}function I(e,t){try{t(function(t){w(e,t)},function(t){A(e,t)})}catch(n){A(e,n)}}function N(){return ce++}function D(e){e[ae]=ce++,e._state=void 0,e._result=void 0,e._subscribers=[]}function R(e,t){this._instanceConstructor=e,this.promise=new e(g),this.promise[ae]||D(this.promise),W(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?T(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&T(this.promise,this._result))):A(this.promise,U())}function U(){return new Error("Array Methods must be provided an Array")}function F(e){return new R(this,e).promise}function B(e){var t=this;return new t(W(e)?function(n,i){for(var a=e.length,r=0;r<a;r++)t.resolve(e[r]).then(n,i)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function V(e){var t=this,n=new t(g);return A(n,e),n}function G(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function H(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function z(e){this[ae]=N(),this._result=this._state=void 0,this._subscribers=[],g!==e&&("function"!=typeof e&&G(),this instanceof z?I(this,e):H())}function j(){var e=void 0;if("undefined"!=typeof a)e=a;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;if(n){var i=null;try{i=Object.prototype.toString.call(n.resolve())}catch(t){}if("[object Promise]"===i&&!n.cast)return}e.Promise=z}var q=void 0;q=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var W=q,Y=0,Z=void 0,X=void 0,K=function(e,t){ne[Y]=e,ne[Y+1]=t,Y+=2,2===Y&&(X?X(h):ie())},Q="undefined"!=typeof window?window:void 0,J=Q||{},$=J.MutationObserver||J.WebKitMutationObserver,ee="undefined"==typeof self&&"undefined"!=typeof i&&"[object process]"==={}.toString.call(i),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ne=new Array(1e3),ie=void 0;ie=ee?s():$?u():te?c():void 0===Q&&"function"==typeof e?d():p();var ae=Math.random().toString(36).substring(16),re=void 0,oe=1,se=2,le=new x,ue=new x,ce=0;return R.prototype._enumerate=function(e){for(var t=0;this._state===re&&t<e.length;t++)this._eachEntry(e[t],t)},R.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===m){var a=y(e);if(a===f&&e._state!==re)this._settledAt(e._state,t,e._result);else if("function"!=typeof a)this._remaining--,this._result[t]=e;else if(n===z){var r=new n(g);P(r,e,a),this._willSettleAt(r,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},R.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===re&&(this._remaining--,e===se?A(i,n):this._result[t]=n),0===this._remaining&&T(i,this._result)},R.prototype._willSettleAt=function(e,t){var n=this;C(e,void 0,function(e){return n._settledAt(oe,t,e)},function(e){return n._settledAt(se,t,e)})},z.all=F,z.race=B,z.resolve=m,z.reject=V,z._setScheduler=r,z._setAsap=o,z._asap=K,z.prototype={constructor:z,then:f,"catch":function(e){return this.then(null,e)}},z.polyfill=j,z.Promise=z,z})}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:2}],2:[function(e,t,n){function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function r(e){if(p===setTimeout)return setTimeout(e,0);if((p===i||!p)&&setTimeout)return p=setTimeout,setTimeout(e,0);try{return p(e,0)}catch(t){try{return p.call(null,e,0)}catch(t){return p.call(this,e,0)}}}function o(e){if(h===clearTimeout)return clearTimeout(e);if((h===a||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function s(){g&&f&&(g=!1,f.length?m=f.concat(m):v=-1,m.length&&l())}function l(){if(!g){var e=r(s);g=!0;for(var t=m.length;t;){for(f=m,m=[];++v<t;)f&&f[v].run();v=-1,t=m.length}f=null,g=!1,o(e)}}function u(e,t){this.fun=e,this.array=t}function c(){}var p,h,d=t.exports={};!function(){try{p="function"==typeof setTimeout?setTimeout:i}catch(e){p=i}try{h="function"==typeof clearTimeout?clearTimeout:a}catch(e){h=a}}();var f,m=[],g=!1,v=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];m.push(new u(e,t)),1!==m.length||g||r(l)},u.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.prependListener=c,d.prependOnceListener=c,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],3:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a=t("./EpubEvent"),r=t("./EpubGesturesEvent"),o=400;i.EVENT_FORCE_CHECK_LAST_ACTION="forceCheckLastAction";var s=function(){function t(t){this.epubEvent=e.epubEvent,this.resetActions(),this.epubGesturesEvent=new r["default"](this,t),this.epubGesturesEvent.addEventListener(r["default"].GESTURESNAME.TAPGESTURE,this.checkLastActions.bind(this)),document.addEventListener(i.EVENT_FORCE_CHECK_LAST_ACTION,this.checkLastActions.bind(this)),this.epubEvent.addListener(a.EPUB_EVENTS.PAGE_CLICK_PERMISSION,this.addAction.bind(this))}return t.prototype.resetActions=function(){this.actions=[]},t.prototype.addAction=function(e){this.actions.push({action:e.data.action,date:Date.now()})},t.prototype.checkLastActions=function(e){for(var t=!1,n=0,i=this.actions.length;n<i;n++){var r=Date.now()-this.actions[n].date<o;r&&(t=!0),this.actions[n].action(Promise.resolve(r))}if(this.actions=[],!t)return void("pointercancel"!==e.type&&this.epubEvent.fire({type:a.EPUB_EVENTS.PAGE_CLICK,data:{}}))},t}();i["default"]=s},{"./EpubEvent":8,"./EpubGesturesEvent":10}],4:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./EpubConfig/EpubDefaultConfig"),r=e("./utils/enums"),o=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.setConfig=function(t){e.prototype.setConfig.call(this,t),this.device=this.userAgent.device.type,this.browser=this.userAgent.browser.name,this.os=this.userAgent.os.name;var n="device_"+this.device,i="browser_"+this.browser,a="os_"+this.os;document.documentElement.classList.add("pagetype-"+r.READER_TYPES[this.readerPageSrcType].toLowerCase()),"function"==typeof this[n]&&this[n](),"function"==typeof this[i]&&this[i](),"function"==typeof this[a]&&this[a]()},t.prototype.device_phone=function(){},t.prototype.device_tab=function(){},t.prototype.device_desktop=function(){this.timeToRefreshScreenResize=0},t.prototype.browser_safari=function(){},t.prototype.browser_chrome=function(){},t.prototype.browser_firefox=function(){},t.prototype.browser_ie=function(){},t.prototype.browser_edge=function(){},t.prototype.browser_android=function(){},t.prototype.os_windows=function(){},t.prototype.os_mac=function(){},t.prototype.os_iOS=function(){},t.prototype.os_android=function(){},t}(a["default"]);n["default"]=o},{"./EpubConfig/EpubDefaultConfig":5,"./utils/enums":77}],5:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a,r=t("../utils/enums"),o=t("../EpubEvent");!function(e){e.CONTAIN="contain",e.COVER_HORIZONTALLY="coverHorizontally"}(a=i.PagesSizeTypes||(i.PagesSizeTypes={}));var s;!function(e){e.X="x",e.Y="y"}(s=i.NavigationAxis||(i.NavigationAxis={}));var l;!function(e){e.VERTICAL_ONE_PAGE="verticalOnePage"}(l=i.PageChangeSource||(i.PageChangeSource={}));var u=function(){function t(t){this._linksSizePageWidth=0,this._linksSizePageHeight=0,this._paddingBottom=0,this._paddingTop=0,this._paddingLeft=0,this._paddingRight=0,this._maxSpreadsLength=3,this._pageQuantity=0,this._firstSpreadSize=1,this._pageSizeType=a.CONTAIN,this._pageSizeMaxHeight=0,this._coverPageCenter=!1,this._currentPageAtInit=1,this.countPageChange=0,this._currentPage=1,this._pageChangeSource=void 0,this.lastPage=1,this.domMode="html",this._spreadDraggable=!0,this.highQualityKey="hdpi",this._linkBoxAspect=r.LinksBehaviors.blink,this._linkBlinkDuration=1e3,this._pdfHTMLMaxFontLoad=0,this.pageBgColor="#fff",this.pagesRetina=!0,this._verticalSlider=!1,this._isVerticalOnePage=!1,this.timeToRefreshScreenResize=50,this.switchLandScapeUsingPageSize=!1,this.pagesBySpreadMax=2,this.pagesBySpreadUseApiPageManager=!1,this.scrollablePages=[],this.disableArrowKeys=!1,this._zoomDoubleClick=!0,this._zoomSingleClick=!1,this.zoomPinch=!0,this.zoomRetina=!0,this._zoomFactor=.008,this._maxZoom=1,this.defaultPageScaleAt=.75,this.maxPageTotalScale=1.5,this._transitionTime=.2,this._use3DMatrixTransform=!1,this._useMatrixTransformZoomable=!0,this._useMatrixTransformScrollable=!0,this._enableAspLinks=!0,this._readerPageSrcType=r.READER_TYPES.EPUB_HTML,this.pageNeverChanged=!0,this.mainViewElementClassName="webpub-viewer__epub-container",this.spreadViewElementClassName="webpub-viewer__epub-container-spread",this.zoomableViewElementClassName="webpub-viewer__epub-container-spread-zoomable";this._currentPageAtInit=parseInt(e.Main.urlManager.get("page")||this._currentPage,10),this.epubEvent=e.epubEvent,this.userAgent=e.Param.userAgent,this.pageMargin=[0,0,0,0],this.linksSizePageWidth=parseFloat(e.Main.xmlManager.get("common-configuration","contents","swf","width")),this.linksSizePageHeight=parseFloat(e.Main.xmlManager.get("common-configuration","contents","swf","height")),this.menuViewPageControlItems=e.Main.xmlManager.get("common-ui","panelViewControlItems"),this.scrollablePages=e.Main.xmlManager.get("comboPages","scrollablePages"),this._firstSpreadSize=e.Main.pageLayoutService.get("pagesOnFirstFrame"),this.handleTransparentPageConfig(),this.handleEcoRatinConfig()}return t.prototype.paddinigsUpdate=function(){var e=this.paddings;this.paddingLeft=~~e.paddingLeft+this.pageMargin[0],this.paddingTop=~~e.paddingTop+this.pageMargin[1],this.paddingRight=~~e.paddingRight+this.pageMargin[2],this.paddingBottom=~~e.paddingBottom+this.pageMargin[3]},Object.defineProperty(t.prototype,"paddings",{get:function(){return e.Main.viewerService.getPadding()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCrossNavPublication",{get:function(){return this.pageSizeType===a.COVER_HORIZONTALLY},enumerable:!0,configurable:!0}),t.prototype.isCrossNavPage=function(e){var t=this.scrollablePages.includes(e);return this.isCrossNavPublication||t},t.prototype.hasCrossNavPage=function(){var e=this.scrollablePages.length>0;return this.isCrossNavPublication||e},Object.defineProperty(t.prototype,"paddingBottom",{get:function(){return this._paddingBottom},set:function(e){this._paddingBottom=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingTop",{get:function(){return this._paddingTop},set:function(e){this._paddingTop=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingLeft",{get:function(){return this._paddingLeft},set:function(e){this._paddingLeft=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingRight",{get:function(){return this._paddingRight},set:function(e){this._paddingRight=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linksSizePageHeight",{get:function(){return this._linksSizePageHeight},set:function(e){this._linksSizePageHeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linksSizePageWidth",{get:function(){return this._linksSizePageWidth/2},set:function(e){this._linksSizePageWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkBoxAspect",{get:function(){return this._linkBoxAspect},set:function(e){this._linkBoxAspect=r.LinksBehaviors[e]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkBlinkDuration",{get:function(){return this._linkBlinkDuration},set:function(e){this._linkBlinkDuration=e,this.addLinkStyleTags()},enumerable:!0,configurable:!0}),t.prototype.handleEcoRatinConfig=function(){var t=e.Main.xmlManager.get("common-ui","configs","ecoRating");t.enabled&&(this.disableArrowKeys=t.disableArrowKeys,this._maxSpreadsLength=t.disablePreload?1:3)},t.prototype.handleTransparentPageConfig=function(){var t=e.Main.configsJsonManager.getPagesData(["isTransparent"]);if(t){for(var n="",i=0;i<t.length;i++){var a=t[i];a&&a.isTransparent&&(n+=".pagetype-epub_html .webpub-viewer__epub-container-spread-page.spread-page-"+(i+1)+":before{display: none}")}var r=document.head.appendChild(document.createElement("style"));r.innerHTML=n}},t.prototype.addLinkStyleTags=function(e){void 0===e&&(e="ms"),void 0===this.styleElement&&(this.styleElement=document.createElement("style"),document.head.appendChild(this.styleElement));var t=".webpub-viewer__epub-container .epub-links_container-link{-webkit-animation-duration: "+(this.linkBlinkDuration+e)+"!important;animation-duration: "+(this.linkBlinkDuration+e)+"!important;}";this.styleElement.type="text/css",this.styleElement.innerText=t},Object.defineProperty(t.prototype,"navigationAxis",{get:function(){return this.verticalSlider===!1?s.X:s.Y},set:function(e){e===s.X?this.verticalSlider=!1:this.verticalSlider=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"verticalSlider",{get:function(){return this._verticalSlider},set:function(t){this._verticalSlider=t;var n="webpub-viewer__container-vertical";e.Param.viewMain.classList.toggle(n,this._verticalSlider)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVerticalOnePage",{get:function(){return this._isVerticalOnePage},set:function(t){this._isVerticalOnePage=t;var n="webpub-viewer__container-verticalOnePage";e.Param.viewMain.classList.toggle(n,this._isVerticalOnePage)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transitionTime",{get:function(){return this._transitionTime},set:function(e){isNaN(e)||(e=Math.max(e,1e-4),this._transitionTime=e||0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageQuantity",{get:function(){return this._pageQuantity},set:function(e){this._pageQuantity=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageChangeSource",{get:function(){return this._pageChangeSource},set:function(e){this._pageChangeSource=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPage",{get:function(){return 0===this.countPageChange&&(this._currentPage=this._currentPageAtInit),this._currentPage},set:function(e){this.changePage(e,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPageNoAnimation",{get:function(){return 0===this.countPageChange&&(this._currentPage=this._currentPageAtInit),this._currentPage},set:function(e){this.changePage(e,!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstSpreadSize",{get:function(){return this._firstSpreadSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"coverPageCenter",{get:function(){return this._coverPageCenter},set:function(e){this._coverPageCenter=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"use3DMatrixTransform",{get:function(){return this._use3DMatrixTransform},set:function(e){this._use3DMatrixTransform=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useMatrixTransformZoomable",{get:function(){return this._useMatrixTransformZoomable},set:function(e){this._useMatrixTransformZoomable=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxZoom",{get:function(){return this._maxZoom},set:function(e){this._maxZoom=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomFactor",{get:function(){return this._zoomFactor},set:function(e){this._zoomFactor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomDoubleClick",{get:function(){return this._zoomDoubleClick},set:function(e){this._zoomDoubleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomSingleClick",{get:function(){return this._zoomSingleClick},set:function(e){this._zoomSingleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"menuViewPageControlItems",{get:function(){return this._menuViewPageControlItems},set:function(e){this._menuViewPageControlItems=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useMatrixTransformScrollable",{get:function(){return this._useMatrixTransformScrollable},set:function(e){this._useMatrixTransformScrollable=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxSpreadsLength",{get:function(){return this._maxSpreadsLength},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageWidth",{get:function(){return this.ePubConfig.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageHeight",{get:function(){return this.ePubConfig.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageSizeType",{get:function(){return this._pageSizeType},set:function(e){this._pageSizeType=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageMargin",{get:function(){return this._pageMargin},set:function(e){this._pageMargin=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readerPageSrcType",{get:function(){return this._readerPageSrcType},set:function(e){"string"==typeof e&&(e=r.READER_TYPES[e]),this._readerPageSrcType=r.READER_TYPES[e]?e:this.readerPageSrcType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableAspLinks",{get:function(){return this._enableAspLinks},set:function(e){this._enableAspLinks=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mustLoadEpubHtmlCss",{get:function(){return this.readerPageSrcType===r.READER_TYPES.EPUB_HTML},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mustLoadPdfHtmlCss",{get:function(){return this.readerPageSrcType===r.READER_TYPES.PDF_HTML},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spreadDraggable",{get:function(){return this._spreadDraggable},set:function(e){this._spreadDraggable=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pdfHTMLMaxFontLoad",{get:function(){return this._pdfHTMLMaxFontLoad},set:function(e){this._pdfHTMLMaxFontLoad=e||0},enumerable:!0,configurable:!0}),t.prototype.checkEnableAspLinks=function(){switch(this.enableAspLinks=!1,this.readerPageSrcType){case r.READER_TYPES.PDF_SVG:this.enableAspLinks=!0;break;case r.READER_TYPES.PDF_HTML:this.enableAspLinks=!0;break;case r.READER_TYPES.PDF_IMG:this.enableAspLinks=!0;break;case r.READER_TYPES.PDF_PDF:this.enableAspLinks=!0}},t.prototype.updateConfigFromUrlData=function(){var t=e.Main.urlManager.get("reader-params");try{t=window.decodeURI(t),"undefined"!=typeof t&&this.setConfigLoc(new window.Function("return "+t)())}catch(n){}},t.prototype.setConfigLoc=function(e){var t="";for(t in e)"undefined"!=typeof this[t]&&(this[t]=e[t])},t.prototype.checkZoomLevel=function(){this.menuViewPageControlItems&&"true"===this.menuViewPageControlItems.enable&&e.Main.viewerService.get("zoom","max-scale")?(this.maxPageTotalScale=e.Main.viewerService.get("zoom","max-scale")/1.666,this.defaultPageScaleAt=this.maxPageTotalScale/2):e.Main.viewerService.get("zoom","max-scale")&&(this.maxPageTotalScale=this.defaultPageScaleAt=e.Main.viewerService.get("zoom","max-scale")/1.666)},t.prototype.changePage=function(e,t){this.countPageChange++,this.pageNeverChanged&&e!==this._currentPageAtInit&&(this.pageNeverChanged=!1),e=~~e,e>this.pageQuantity?e=this.pageQuantity:e<1&&(e=1),this.lastPage=this._currentPage,this._currentPage=e,this.epubEvent.fire({type:o.EPUB_EVENTS.PAGE_CHANGE,data:{pageNumber:e,useAnimationTime:t,pageNeverChanged:this.pageNeverChanged,pageChanged:this.lastPage!==e,source:this.pageChangeSource}})},t.prototype.setConfig=function(e){this.setConfigLoc(e),this.checkEnableAspLinks(),this.updateConfigFromUrlData(),this.checkZoomLevel(),this.ePubConfig instanceof Object==!1&&(this.ePubConfig={})},t}();i["default"]=u},{"../EpubEvent":8,
"../utils/enums":77}],6:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a=t("./utils/XHRPromise"),r=t("./utils/XHRPromise"),o=function(){function t(e){this.config=e,this.parseCss=!0,this.shadowSelector="",this.urls=[],this.styles=[],this.fontList=[]}return Object.defineProperty(t.prototype,"pdfHTMLMaxFontLoad",{get:function(){return this.config.pdfHTMLMaxFontLoad},enumerable:!0,configurable:!0}),t.prototype.init=function(e){var t=this;this.onProgressPercentage=e;var n=window.document.querySelector(".force-font-load");this.setUrls();var i=this.load();return i.then(function(){t.appendStyle(),null===n&&(t.styles.forEach(function(e){t.parse(e)}),t.fontsLettersAppend()),t.clearUnNeeded()}),i},t.prototype.setUrls=function(){var t;this.config.mustLoadEpubHtmlCss&&(t=e.Main.xmlManager.get("common-ui","assets","epub-idGeneratedStyles"),t&&(this.urls=this.urls.concat(e.Utils.resolveVariable(t.url).split(",")))),this.config.mustLoadPdfHtmlCss&&(t=e.Main.xmlManager.get("common-ui","assets","pdf-HTML-idGeneratedStyles"),t&&(this.urls=this.urls.concat(e.Utils.resolveVariable(t.url).split(","))))},t.prototype.load=function(){for(var e=this,t=[],n=0,i=this.urls.length;n<i;n++)t.push(new a["default"](r.Protocol.GET,this.urls[n]).init());return t.length?Promise.all(t).then(function(t){t.forEach(function(t){e.styles.push(t.responseText)})}):Promise.resolve()},t.prototype.parse=function(e){var t=CSSJSON.toJSON(e,{ordered:!0,comments:!1,stripComments:!1,split:!1}),n={};return this.cloneCssObject(t,n),e},t.prototype.cloneCssObject=function(e,t){var n;for(var i in e)isNaN(Number(i))||(n=this.shadowSelector,0===e[i].name.indexOf("@")&&(this.fontsExtractFromCssObject(e[i]),n=""),t[i]=t[i]||{},t[i].type=e[i].type,t[i].name=n+e[i].name,t[i].value=t[i].value||{},this.cloneCssObjectValues(e[i].value,t[i].value))},t.prototype.cloneCssObjectValues=function(e,t){for(var n in e)isNaN(Number(n))||this.cloneCssObject(t[n],e[n])},t.prototype.fontsExtractFromCssObject=function(e){if(0===e.name.indexOf("@font-face")){var t,n=e.value[1].value,i=n.match(/\([^)]*/gi);i&&(t=i[0].replace("(",""),this.fontList.push(e))}},t.prototype.fontsLettersAppend=function(){var e=[],t=document.createElement("div");t.className="force-font-load";for(var n=function(n,a){if(n>=i.pdfHTMLMaxFontLoad&&0!==i.pdfHTMLMaxFontLoad)return"break";var r=i.fontList[n].value,o=r[0].value,s=r[1].value,l=document.createElement("span");l.style.fontFamily=o,setTimeout(function(){t.appendChild(l)},100*n),e.push("@font-face {"),e.push("font-family: '"+o+"';"),e.push("src: "+s+";}")},i=this,a=0,r=this.fontList.length;a<r;a++){var o=n(a,r);if("break"===o)break}document.body.appendChild(t),this.fontFaces=e.join(" ")},t.prototype.appendStyle=function(){CSSJSON.toHEAD(this.styles.join("\n"))},t.prototype.clearUnNeeded=function(){this.urls=[],this.fontList=[],this.shadowSelector="",this.fontFaces=""},t.prototype.getStyleElement=function(e){return void 0===e&&(e=""),"<style>"+this.styles.join("")+e+"</style>"},t}();i.EpubCssManager=o},{"./utils/XHRPromise":75}],7:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),t("es6-promise");var a=t("./EpubEvent"),r=t("./EpubClickPermission"),o=function(){function t(t,n){e.epubEvent=e.epubEvent||new a.EpubEvent,this.epubEvent=e.epubEvent,"string"==typeof t&&"object"==typeof n&&this.onFire(t,n)}return t.prototype.onFire=function(e,t){return this["allowed_"+e]&&(this.epubEvent.fire({type:a.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:!0,action:this["allowed_"+e].bind(this,t)}}),document.dispatchEvent(new CustomEvent(r.EVENT_FORCE_CHECK_LAST_ACTION))),!1},t.prototype.allowed_action=function(e,t){var n=this;t.then(function(){var i,a,r,o=e[1].trim();return 0===o.indexOf("http")?void n.allowed_url([null,o],t):0===o.indexOf("javascript")||0===o.indexOf("js:")||0===o.indexOf("js :")?void n.allowed_javascript([null,o],t):0===o.indexOf("NIApi")?void n.allowed_NIApi([null,o],t):(r=o.match(/^mailto:|^mailto :/gi),null!==r&&0!==r.length?void n.allowed_mailto([null,o],t):(i=/-([0-9]*).xhtml$/gim,a=i.exec(o)||[],void(a.length>0&&n.allowed_gotoPage([null,~~a[1]],t))))})},t.prototype.allowed_gotoPage=function(e,t){t.then(function(t){t===!0&&NIApi.page.open(e[1])})},t.prototype.allowed_nextPage=function(e,t){t.then(function(e){e===!0&&NIApi.page.openNext()})},t.prototype.allowed_prevPage=function(e,t){t.then(function(e){e===!0&&NIApi.page.openPrevious()})},t.prototype.allowed_lastPage=function(e,t){t.then(function(e){e===!0&&NIApi.page.openLast()})},t.prototype.allowed_firstPage=function(e,t){t.then(function(e){e===!0&&NIApi.page.openFirst()})},t.prototype.allowed_mailto=function(e,t){t.then(function(t){if(t===!0){var n=e[1].trim(),i="mailto:",a=n.match(/^mailto:|^mailto :/gi);null!==a&&0!==a.length&&(i=""),window.location.href=i+n}})},t.prototype.allowed_url=function(t,n){n.then(function(n){if(n===!0){var i=t[1];e.Main.trackerManager.trackEvent({name:"externalLink",variables:{1:i}}),NIApi.navigator.openUrl(i)}})},t.prototype.allowed_popup=function(e,t){t.then(function(t){t===!0&&NIApi.lightbox.openPopup(null,e[2])})},t.prototype.allowed_lightbox=function(e,t){t.then(function(t){t===!0&&NIApi.lightbox.openPopup(null,e[2])})},t.prototype.allowed_javascript=function(e,t){t.then(function(t){if(t===!0){var n,i=e[1].split(":");i.shift(),n=i.join(":").trim(),new Function(n)()}})},t.prototype.allowed_NIApi=function(e,t){t.then(function(t){if(t===!0){var n=e[1];new Function(n)()}})},t}();i.EpubDomApi=o;var s=new o,l=s.onFire.bind(s);i["default"]=l},{"./EpubClickPermission":3,"./EpubEvent":8,"es6-promise":1}],8:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i;!function(e){e[e.SCREEN_ORIENTATION=0]="SCREEN_ORIENTATION",e[e.PAGE_CHANGE=1]="PAGE_CHANGE",e[e.VISIBLE_SPREADS_CHANGE=2]="VISIBLE_SPREADS_CHANGE",e[e.PAGE_ZOOM=3]="PAGE_ZOOM",e[e.PAGE_CLICK=4]="PAGE_CLICK",e[e.PAGE_CLICK_PERMISSION=5]="PAGE_CLICK_PERMISSION",e[e.PAGE_IN_DOM=6]="PAGE_IN_DOM",e[e.MOUSE_WHEEL=7]="MOUSE_WHEEL",e[e.ELEMENT_SCROLL=8]="ELEMENT_SCROLL",e[e.TOUCH_POINTERDOWN=9]="TOUCH_POINTERDOWN",e[e.TOUCH_POINTERCANCEL=10]="TOUCH_POINTERCANCEL",e[e.TOUCH_POINTERLEAVE=11]="TOUCH_POINTERLEAVE",e[e.TOUCH_POINTERUP=12]="TOUCH_POINTERUP",e[e.TOUCH_POINTERMOVE=13]="TOUCH_POINTERMOVE",e[e.ZOOM_CONTROLLER_RANGE=14]="ZOOM_CONTROLLER_RANGE",e[e.ZOOM_CONTROLLER_LEVEL_CLICK=15]="ZOOM_CONTROLLER_LEVEL_CLICK",e[e.FULLSCREEN_TOGGLE=16]="FULLSCREEN_TOGGLE",e[e.ADMIN_LINK_CREATE=17]="ADMIN_LINK_CREATE",e[e.ACTION_LINK_SUCCESS=18]="ACTION_LINK_SUCCESS"}(i=n.EPUB_EVENTS||(n.EPUB_EVENTS={}));var a=function(){function e(){this.listeners={},this.iName="EpubEvent"}return e.prototype.addListener=function(e,t){"string"==typeof e&&(e=i[e]),"undefined"==typeof this.listeners[e]&&(this.listeners[e]=[]),this.listeners[e].indexOf(t)===-1&&this.listeners[e].push(t)},e.prototype.fire=function(e){var t,n,a,r=0,o=0;if(e.target||(e.target=this),e.context||(e.context=this),t=e.type,"string"==typeof e.type&&(t=e.type,t=i[t]),this.listeners[t]instanceof Array){n=this.listeners[t],a=[];var s=void 0;for(o=n.length;r<o;r++)a.push(n[r]);for(;s=a.shift();)n.indexOf(s)!==-1&&s(e)}},e.prototype.removeListener=function(e,t){var n,a=0,r=0;if("string"==typeof e&&(e=i[e]),this.listeners[e]instanceof Array)for(n=this.listeners[e],a=n.length;r<a;r++){if(null!==t&&n[r]===t){n.splice(r,1);break}null===t&&n.splice(r,1)}},e}();n.EpubEvent=a},{}],9:[function(t,n,i){var a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,r){function o(e){try{l(i.next(e))}catch(t){r(t)}}function s(e){try{l(i["throw"](e))}catch(t){r(t)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,r&&(o=2&n[0]?r["return"]:n[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,r=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(i){n=[6,i],r=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,r,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(i,"__esModule",{value:!0});var o,s=t("./EpubManager");!function(e){e.NONE="none",e.VIEW_DRIVE_ITEM="viewDriveItem"}(o||(o={}));var l=function(){function t(){e.Class.EpubGalleryManager=t,this.registerApi()}return t.prototype.registerApi=function(){NIApi.register("gallery.open",this.open.bind(this)),NIApi.register("gallery.openAssetInApp",this.openAssetInApp.bind(this)),NIApi.register("gallery.doActionInApp",this.doActionInApp.bind(this))},t.prototype.open=function(t,n,i,o){return void 0===o&&(o=s.OpenTarget.BLANK),a(this,void 0,void 0,function(){var a,l,u,c,p;return r(this,function(r){switch(r.label){case 0:e.API.menuClose(),a=this.getGalleryConfigUrl(t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,fetch(a)];case 2:return u=r.sent(),l=u.ok,[3,4];case 3:return c=r.sent(),l=!1,[3,4];case 4:return p=this.getAssetUrl(t,n,i,l),e.Main.trackerManager.trackEvent({name:"externalLink",variables:{1:p}}),e.Param.isApp?(this.openAssetInApp(n,i),[2]):o===s.OpenTarget.POPUP?(this.openAsPopup(p),[2]):(window.open(p,o),[2])}})})},t.prototype.openAssetInApp=function(e,t){var n=this.getAction(e,t);this.doActionInApp(n)},t.prototype.getIsInWindowsWebview2=function(){var t=e.Param.isApp&&e.Param.userAgent.os.name===e.Param.userAgent.OS.WINDOWS,n=window.external&&window.external.hasOwnProperty("notify"),i=window.chrome&&window.chrome.webview;return t&&!n&&i},t.prototype.doActionInApp=function(t){var n=e.Starter.main.backHomeParamString,i="-"+e.Starter.main.backHomeString,a={action:t,currentPage:e.Main.pagesLoaderNew.getCurrentPage()},r=this.getIsInWindowsWebview2();if(r){var o={method:"closeFrame","args[]":[a]},s=JSON.stringify(o);return void window.chrome.webview.postMessage(s)}var l=encodeURI(JSON.stringify(a));document.location.href=""+n+l+i},t.prototype.getAssetUrl=function(t,n,i,a){if(!a&&n){var r=e.Utils.resolveVariable("${media}"+n);return i&&(r+="#page="+i),r}var o=this.getRootGalleryUrl(t);return n&&(o+="#/view/"+n,i&&(o+="/"+i)),o},t.prototype.getGalleryConfigUrl=function(e){return this.getRootGalleryUrl(e)+".gallery/config/config.json?preventRedirect=true"},t.prototype.getRootGalleryUrl=function(t){return t?e.Utils.resolveVariable("${media}"+t+"/"):e.Main.xmlManager.get("common-configuration","contents","gallery","path")},t.prototype.openAsPopup=function(t){new e.Class.LightboxManagerNew({animation:"none",header:"visible",id:"drivePopup",url:t})},t.prototype.getAction=function(e,t){return e?this.getViewDriveItemAction(e,t):this.getNoneAction()},t.prototype.getViewDriveItemAction=function(e,t){return{type:o.VIEW_DRIVE_ITEM,assetId:e,page:t}},t.prototype.getNoneAction=function(){return{type:o.NONE}},t}();i.EpubGalleryManager=l,i["default"]=l},{"./EpubManager":15}],10:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=e("./EpubGesturesEvent/Defs"),a=e("./EpubGesturesEvent/MouseWheelManager"),r=e("./utils/isTouchSupported"),o=function(){function e(t,n){this.gestureEventList={},this.moveDifferer=i.getMoveDifferer(),this.gestureData=i.getGestureData(),this.preventDefaultOnMove=!1,this.wheelData=i.getWheelData(),this._enableScrollElement=!1,this._enableCheckMediaPreventDefault=!0,this.touchConvert=function(e,t){for(var n=t.length,i=0,a=0,r=0,o=0,s=0,l=0;l<n;l++)a+=t[l].clientX,r+=t[l].clientY,o=o||t[0].clientX,s=s||t[0].clientY,o-=t[l].clientX,s-=t[l].clientY,i+=this.touchConvert_getDistance(o,s),o=t[l].clientX,s=t[l].clientY;e.hypotenuse=i,e.epubClientX=a/n,e.epubClientY=r/n},this.parent=t,this.element=n,this.element.epubGesturesEvent=this,this.resetMoveDiffererByKeyBinded=this.resetMoveDiffererByKey.bind(this),this.gestureID=Date.now().toString().concat("_UID_",(e.UID++).toString()),this.touchStart=this.touchStart.bind(this),this.touchEnd=this.touchEnd.bind(this),this.touchMove=this.touchMove.bind(this),this.mouseDown=this.mouseDown.bind(this),this.mouseUp=this.mouseUp.bind(this),this.mouseMove=this.mouseMove.bind(this),this.pointerDown=this.pointerDown.bind(this),this.pointerUp=this.pointerUp.bind(this),this.pointerMove=this.pointerMove.bind(this),this.gestureEventList[e.GESTURESNAME.PINCHGESTURE]=[],this.gestureEventList[e.GESTURESNAME.PRESSGESTURE]=[],this.gestureEventList[e.GESTURESNAME.PANGESTURE]=[],this.gestureEventList[e.GESTURESNAME.TAPGESTURE]=[],this.gestureEventList[e.GESTURESNAME.DBLTAPGESTURE]=[],this.gestureEventList[e.GESTURESNAME.SWIPEGESTURE]=[],this.gestureEventList[e.GESTURESNAME.MOUSEWHEELGESTURE]=[],this.eventsStatus=e.EVENTSSTATUS.data,this.initEvent()}return Object.defineProperty(e.prototype,"enableScrollElement",{get:function(){return this._enableScrollElement},set:function(e){this._enableScrollElement=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableCheckMediaPreventDefault",{get:function(){return this._enableCheckMediaPreventDefault},set:function(e){this._enableCheckMediaPreventDefault=e},enumerable:!0,configurable:!0}),e.prototype.initEvent=function(){var t=this;if(r.isTouchSupported()){var n={capture:!1,passive:!0};this.element.addEventListener(e.EVENTSTYPE.TOUCH.TOUCHSTART,this.touchStart,!1),this.element.addEventListener(e.EVENTSTYPE.TOUCH.TOUCHEND,this.touchEnd,n),this.element.addEventListener(e.EVENTSTYPE.TOUCH.TOUCHMOVE,this.touchMove,n)}this.element.addEventListener(e.EVENTSTYPE.MOUSE.MOUSEDOWN,this.mouseDown),this.element.addEventListener(e.EVENTSTYPE.MOUSE.MOUSEUP,this.mouseUp),this.element.addEventListener(e.EVENTSTYPE.MOUSE.MOUSEMOVE,this.mouseMove),document.addEventListener("mouseup",function(e){t.mouseUpDoc(e)},!0),this.mouseWheelManager=new a.MouseWheelManager(this.element),this.mouseWheelHandler=this.mouseWheelHandler.bind(this),this.onScroll=this.onScroll.bind(this),this.mouseWheelManager.addListeners(this.mouseWheelHandler,this.onScroll)},e.prototype.ePreventDefault=function(e){e.preventDefault()},e.prototype.mouseWheelHandler=function(t){var n=t.data,i=n.deltaX*this.wheelData.deltaX<0,a=n.deltaY*this.wheelData.deltaY<0;0===n.deltaX&&(i=!1),0===n.deltaY&&(a=!1),n.gestureData=this.gestureData,Math.abs(n.deltaX)>Math.abs(n.deltaY)?(i=!0,a=!1):Math.abs(n.deltaX)<Math.abs(n.deltaY)&&(i=!1,a=!0),this.gestureData.wheel.isX=i,this.gestureData.wheel.isY=a,this.callGestureEvent(e.GESTURESNAME.MOUSEWHEELGESTURE,n),this.wheelData.deltaX=n.deltaX||this.wheelData.deltaX,this.wheelData.deltaY=n.deltaY||this.wheelData.deltaY},e.prototype.onScroll=function(e){this.preventAllGesture()},e.prototype.mouseDown=function(e){e.hypotenuse=0,e.epubClientX=e.clientX,e.epubClientY=e.clientY,this.onTouchStart(e)},e.prototype.mouseUpDoc=function(t){e._eventsStatus=this.eventsStatus;var n=this.getStat(e._eventsStatus,"start");n.stat!==!1&&(t.hypotenuse=0,t.epubClientX=t.clientX,t.epubClientY=t.clientY,this.onTouchEnd(t))},e.prototype.mouseUp=function(e){e.hypotenuse=0,e.epubClientX=e.clientX,e.epubClientY=e.clientY,this.onTouchEnd(e)},e.prototype.mouseMove=function(e){e.hypotenuse=0,e.epubClientX=e.clientX,e.epubClientY=e.clientY,this.onTouchMove(e)},e.prototype.touchStart=function(e){e.changedTouches.length>0&&this.resetMoveDifferer(),this.touchConvert(e,e.touches),this.onTouchStart(e)},e.prototype.touchEnd=function(e){return 0===e.touches.length?(this.touchConvert(e,e.changedTouches),void this.onTouchEnd(e)):void this.resetMoveDifferer()},e.prototype.touchMove=function(e){this.preventDefaultOnMove&&this.ePreventDefault(e),this.touchConvert(e,e.touches),this.onTouchMove(e)},e.prototype.pointerDown=function(e){var t=e.data.currentEvent,n=e.data.touches,i=e.data.changedTouches;i.length>0&&this.resetMoveDifferer(),this.touchConvert(t,n),this.onTouchStart(t)},e.prototype.pointerUp=function(e){var t=e.data.currentEvent,n=e.data.touches,i=e.data.changedTouches;return 0===n.length?(this.touchConvert(t,i),void this.onTouchEnd(t)):void this.resetMoveDifferer()},e.prototype.pointerMove=function(e){var t=e.data.currentEvent,n=e.data.touches;this.preventDefaultOnMove&&this.ePreventDefault(t),this.touchConvert(t,n),this.onTouchMove(t)},e.prototype.overrideEventData=function(e,t,n,i,a,r,o,s,l,u,c,p,h){this.gestureData.resetAxis=this.resetMoveDiffererByKeyBinded,this.gestureData.type=t,this.gestureData.pinchZoomDiff=c,this.gestureData.x.pointDiff=n,this.gestureData.x.vectorDiff=a,this.gestureData.x.countDiff=o,this.gestureData.x.isVector=l,this.gestureData.x.client=p,this.gestureData.y.pointDiff=i,this.gestureData.y.vectorDiff=r,this.gestureData.y.countDiff=s,this.gestureData.y.isVector=u,this.gestureData.y.client=h,e.gestureData=this.gestureData},e.clearGlobalTapGestureTimer=function(){for(var t=e.globalTapGestureTimer.length,n=0;n<t;n++)clearTimeout(e.globalTapGestureTimer[n]);e.globalTapGestureTimer=[]},e.prototype.callGestureEvent=function(e,t,n){for(var i=this.gestureEventList[e].length,a=0;a<i;a++)this.gestureEventList[e][a](t,n)},e.prototype.touchConvert_getDistance=function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},e.prototype.getStat=function(e,t){return e[t]},e.prototype.setStat=function(t,n,i,a){e.lastTime=a,t[n].stat=i;var r=i?"true":"false";t[n].lastTime=t[n].time,t[n].time=a,t[n][r]=t[n][r],t[n][r].lastTime=t[n][r].time,t[n][r].time=a,clearTimeout(t[n].timer)},e.prototype.setMoveDifferer=function(t){return this.moveDifferer.x.count=this.moveDifferer.x.count||t.epubClientX,this.moveDifferer.x.countDiff+=Math.abs(t.epubClientX-this.moveDifferer.x.count),this.moveDifferer.x.count=t.epubClientX,this.moveDifferer.y.count=this.moveDifferer.y.count||t.epubClientY,this.moveDifferer.y.countDiff+=Math.abs(t.epubClientY-this.moveDifferer.y.count),this.moveDifferer.y.count=t.epubClientY,this.moveDifferer.hypotenuse=this.moveDifferer.hypotenuse||t.hypotenuse,this.moveDifferer.hypotenuseDiff=t.hypotenuse-this.moveDifferer.hypotenuse,this.moveDifferer.hypotenuse=t.hypotenuse,!(this.moveDifferer.x.countDiff<e.STARTMOVEAT&&this.moveDifferer.y.countDiff<e.STARTMOVEAT&&0===this.moveDifferer.hypotenuseDiff)&&(this.moveDifferer.x.pos=this.moveDifferer.x.pos||t.epubClientX,this.moveDifferer.x.diff=t.epubClientX-this.moveDifferer.x.pos,this.moveDifferer.x.vector=this.moveDifferer.x.vector||t.epubClientX,Math.abs(t.epubClientX-this.moveDifferer.x.vector)<Math.abs(this.moveDifferer.x.vectorDiff)&&(this.moveDifferer.x.vector=t.epubClientX),this.moveDifferer.y.pos=this.moveDifferer.y.pos||t.epubClientY,this.moveDifferer.y.diff=t.epubClientY-this.moveDifferer.y.pos,this.moveDifferer.y.vector=this.moveDifferer.y.vector||t.epubClientY,Math.abs(t.epubClientY-this.moveDifferer.y.vector)<Math.abs(this.moveDifferer.y.vectorDiff)&&(this.moveDifferer.y.vector=t.epubClientY),this.moveDifferer.x.vectorDiff=t.epubClientX-this.moveDifferer.x.vector,this.moveDifferer.y.vectorDiff=t.epubClientY-this.moveDifferer.y.vector,!0)},e.prototype.resetMoveDiffererByKey=function(e){this.moveDifferer[e].diff=0,this.moveDifferer[e].count=0,this.moveDifferer[e].countDiff=0,this.moveDifferer[e].pos=0,this.moveDifferer[e].vector=0,this.moveDifferer[e].vectorDiff=0,this.moveDifferer.hypotenuseDiff=0,this.moveDifferer.hypotenuse=0},e.prototype.resetMoveDifferer=function(){this.setStat(this.eventsStatus,"move",!1,e.lastTime),this.resetMoveDiffererByKey("x"),this.resetMoveDiffererByKey("y")},e.prototype.resetStat=function(){this.eventsStatus=e.EVENTSSTATUS.data},e.prototype.onTouchStart=function(t){e._eventsStatus=this.eventsStatus;var n=this.getStat(e._eventsStatus,"start");n.stat!==!0&&(this.resetMoveDifferer(),this.setStat(e._eventsStatus,"start",!0,Date.now()),this.setStat(e._eventsStatus,"end",!1,e.lastTime),this.setStat(e._eventsStatus,"move",!1,e.lastTime),this.defineGesture(t,"start"))},e.prototype.onTouchEnd=function(t){e._eventsStatus=this.eventsStatus,this.setStat(e._eventsStatus,"start",!1,Date.now()),this.setStat(e._eventsStatus,"end",!0,e.lastTime),this.defineGesture(t,"end"),this.resetMoveDifferer()},e.prototype.onTouchMove=function(t){e._eventsStatus=this.eventsStatus,this.setStat(e._eventsStatus,"move",!1,Date.now());var n=this.getStat(e._eventsStatus,"start");if(n.stat===!0&&this.getStat(e._eventsStatus,"end").stat===!1){this.checkMediaPreventDefault(t);var i=this.setMoveDifferer(t);i===!0&&(e.clearGlobalTapGestureTimer(),this.setStat(e._eventsStatus,"move",!0,e.lastTime),this.defineGesture(t,"move"))}},e.prototype.checkMediaPreventDefault=function(e){if(this.enableCheckMediaPreventDefault!==!1){var t=e.target,n=t.tagName;if(void 0===n)return void(this.scrollableElement()===!1&&this.ePreventDefault(e));n=n.toLowerCase(),"video"!==n&&"audio"!==n&&this.scrollableElement()===!1&&this.ePreventDefault(e)}},e.prototype.tapGesture=function(t,n){var i=this;if("end"!==n)return!1;e._eventsStatus=this.eventsStatus;var a=this.getStat(e._eventsStatus,"start"),r=this.getStat(e._eventsStatus,"end"),o=this.getStat(e._eventsStatus,"move");return o.stat===!1&&r.stat===!0&&(t.defaultPreventGesture===!0?e.clearGlobalTapGestureTimer():clearTimeout(a.timer),this.overrideEventData(t,e.GESTURESNAME.TAPGESTURE,this.moveDifferer.x.diff,this.moveDifferer.y.diff,this.moveDifferer.x.vectorDiff,this.moveDifferer.y.vectorDiff,this.moveDifferer.x.countDiff,this.moveDifferer.y.countDiff,!1,!1,this.moveDifferer.hypotenuseDiff,t.epubClientX,t.epubClientY),a.timer=setTimeout(function(){i.callGestureEvent(e.GESTURESNAME.TAPGESTURE,t)},e.TAPTIME),e.globalTapGestureTimer.push(a.timer)),!1},e.prototype.dblTapGesture=function(t,n){if("end"!==n)return!1;e._eventsStatus=this.eventsStatus;var i=this.getStat(e._eventsStatus,"start"),a=this.getStat(e._eventsStatus,"end"),r=this.getStat(e._eventsStatus,"move");return r.stat===!1&&a["true"].time-i["true"].lastTime<e.DBLTAPTIME&&(e.clearGlobalTapGestureTimer(),this.overrideEventData(t,e.GESTURESNAME.DBLTAPGESTURE,this.moveDifferer.x.diff,this.moveDifferer.y.diff,this.moveDifferer.x.vectorDiff,this.moveDifferer.y.vectorDiff,this.moveDifferer.x.countDiff,this.moveDifferer.y.countDiff,!1,!1,this.moveDifferer.hypotenuseDiff,t.epubClientX,t.epubClientY),!0)},e.prototype.panGesture=function(t,n){if("end"===n||"start"===n)return!1;e._eventsStatus=this.eventsStatus;var i=this.getStat(e._eventsStatus,"move");return i.stat!==!1&&(this.ePreventDefault(t),this.overrideEventData(t,e.GESTURESNAME.PANGESTURE,this.moveDifferer.x.diff,this.moveDifferer.y.diff,this.moveDifferer.x.vectorDiff,this.moveDifferer.y.vectorDiff,this.moveDifferer.x.countDiff,this.moveDifferer.y.countDiff,!1,!1,this.moveDifferer.hypotenuseDiff,t.epubClientX,t.epubClientY),!0)},e.prototype.pinchGesture=function(e){},e.prototype.pressGesture=function(e){},e.prototype.neutralSwipeGesture=function(t){return(0!==this.moveDifferer.x.vectorDiff||0!==this.moveDifferer.y.vectorDiff)&&(this.ePreventDefault(t),this.overrideEventData(t,e.GESTURESNAME.SWIPEGESTURE,this.moveDifferer.x.diff,this.moveDifferer.y.diff,this.moveDifferer.x.vectorDiff,this.moveDifferer.y.vectorDiff,this.moveDifferer.x.countDiff,this.moveDifferer.y.countDiff,!1,!1,this.moveDifferer.hypotenuseDiff,t.epubClientX,t.epubClientY),!0)},e.prototype.swipeGesture=function(t){e._eventsStatus=this.eventsStatus;var n=!1,i=!1,a=this.getStat(e._eventsStatus,"start"),r=this.getStat(e._eventsStatus,"end"),o=this.getStat(e._eventsStatus,"move");return o.stat!==!1&&r.stat!==!1&&(n=Math.abs(this.moveDifferer.x.vectorDiff)>e.SWIPEGESTURE_AT_PIXELS,n===!1&&(n=Math.abs(this.moveDifferer.x.vectorDiff)>e.SWIPEGESTURE_AT_PIXELS_IN_TIME&&r.time-a.lastTime<=e.SWIPEGESTURE_AT_TIME),i=Math.abs(this.moveDifferer.y.vectorDiff)>e.SWIPEGESTURE_AT_PIXELS,i===!1&&(i=Math.abs(this.moveDifferer.y.vectorDiff)>e.SWIPEGESTURE_AT_PIXELS_IN_TIME&&r.lastTime-a.lastTime<=e.SWIPEGESTURE_AT_TIME),n===!1&&i===!1?this.neutralSwipeGesture(t):(this.overrideEventData(t,e.GESTURESNAME.SWIPEGESTURE,this.moveDifferer.x.diff,this.moveDifferer.y.diff,this.moveDifferer.x.vectorDiff,this.moveDifferer.y.vectorDiff,this.moveDifferer.x.countDiff,this.moveDifferer.y.countDiff,n,i,this.moveDifferer.hypotenuseDiff,t.epubClientX,t.epubClientY),!0))},e.prototype.defineGesture=function(t,n){if(t.defaultPreventGesture===!0||e.PREVENT_ALL===!0)return this.resetStat(),this.resetMoveDifferer(),void e.clearGlobalTapGestureTimer();this.tapGesture(t,n),e._eventsStatus=this.eventsStatus;this.getStat(e._eventsStatus,"start");return this.dblTapGesture(t,n)===!0?(this.callGestureEvent(e.GESTURESNAME.DBLTAPGESTURE,t),void e.clearGlobalTapGestureTimer()):this.swipeGesture(t)===!0?(this.callGestureEvent(e.GESTURESNAME.SWIPEGESTURE,t),void((t.defaultPreventGesture===!0||e.PREVENT_ALL)&&e.clearGlobalTapGestureTimer())):this.panGesture(t,n)===!0?(this.callGestureEvent(e.GESTURESNAME.PANGESTURE,t),void((t.defaultPreventGesture===!0||e.PREVENT_ALL)&&e.clearGlobalTapGestureTimer())):void 0},e.prototype.setEnableScrollElement=function(e){this.enableScrollElement=e},e.prototype.setEnableCheckMediaPreventDefault=function(e){this.enableCheckMediaPreventDefault=e},e.prototype.scrollableElement=function(){return this.enableScrollElement!==!1&&null!==this.element.parentElement},e.prototype.preventAllGesture_reset=function(){e.PREVENT_ALL=!1},e.preventAllGestureStatus=function(){return e.PREVENT_ALL},e.prototype.preventAllGesture=function(){clearTimeout(e.timer),e.PREVENT_ALL=!0,e.timer=setTimeout(this.preventAllGesture_reset,100)},e.prototype.addEventListener=function(e,t){var n="gesture_".concat(e,"_",this.gestureID);return"undefined"==typeof t[n]&&(t[n]=!0,this.gestureEventList[e].push(t),!0)},e.prototype.removeEventListener=function(e,t){var n="gesture_".concat(e,"_",this.gestureID);if("undefined"==typeof t[n])return!1;for(var i=0,a=this.gestureEventList[e].length;i<a;i++)if(void 0!==this.gestureEventList[e][i][n])return this.gestureEventList[e][i][n]=null,delete this.gestureEventList[e][i][n],!0;return!1},e.prototype.resetMoveXDifferer=function(){this.resetMoveDiffererByKey("x")},e.prototype.resetMoveYDifferer=function(){this.resetMoveDiffererByKey("y")},e.EVENTSTYPE=i.getEventsType(),e.UID=0,e.DBLTAPTIME=500,e.TAPTIME=300,e.PREVENT_ALL=!1,e.STARTMOVEAT=10,e.SWIPEGESTURE_AT_TIME=200,e.SWIPEGESTURE_AT_PIXELS_IN_TIME=7,e.SWIPEGESTURE_AT_PIXELS=50,e.EVENTSSTATUS={get data(){return i.getEpubEventStatusManager()}},e.lastTime=0,e.globalTapGestureTimer=[],e.timer=0,e.GESTURESNAME=i.getGesturesName(),e}();n["default"]=o},{"./EpubGesturesEvent/Defs":11,"./EpubGesturesEvent/MouseWheelManager":13,"./utils/isTouchSupported":80}],11:[function(e,t,n){function i(){return{stat:!1,time:0,lastTime:0,timere:0,"true":{time:0,lastTime:0},"false":{time:0,lastTime:0}}}function a(){return{start:i(),end:i(),move:i()}}function r(){return{MOUSE:{MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSELEAVE:"mouseleave",MOUSEMOVE:"mousemove",CLICK:"click"},TOUCH:{TOUCHSTART:"touchstart",TOUCHEND:"touchend",TOUCHMOVE:"touchmove"},MSPOINTER:{POINTERDOWN:"MSPointerDown",POINTERCANCEL:"MSPointerCancel",POINTERLEAVE:"MSPointerLeave",POINTERUP:"MSPointerUp",POINTERMOVE:"MSPointerMove"},POINTER:{POINTERDOWN:"pointerdown",POINTERCANCEL:"pointercancel",POINTERLEAVE:"pointerleave",POINTERUP:"pointerup",POINTERMOVE:"pointermove"},MOUSEWHEEL:"mousewheel",WHEEL:"wheel",DOMMOUSESCROLL:"DOMMouseScroll"}}function o(){return{PINCHGESTURE:"pinchGesture",PRESSGESTURE:"pressGesture",PANGESTURE:"panGesture",TAPGESTURE:"tapGesture",DBLTAPGESTURE:"dblTapGesture",SWIPEGESTURE:"swipeGesture",MOUSEWHEELGESTURE:"mouseWheelGesture"}}function s(){return{x:{diff:0,count:0,countDiff:0,pos:0,vector:0,vectorDiff:0},y:{diff:0,count:0,countDiff:0,pos:0,vector:0,vectorDiff:0},hypotenuse:0,hypotenuseDiff:0}}function l(){return{type:"",pinchZoomDiff:0,wheel:{isX:!1,isY:!1},x:{pointDiff:0,vectorDiff:0,client:0,isVector:!1},y:{pointDiff:0,vectorDiff:0,client:0,isVector:!1}}}function u(){return{timerID:0,currentTime:0,deltaX:0,deltaY:0}}Object.defineProperty(n,"__esModule",{value:!0}),n.getEpubEventStatus=i,n.getEpubEventStatusManager=a,n.getEventsType=r,n.getGesturesName=o,n.getMoveDifferer=s,n.getGestureData=l,n.getWheelData=u},{}],12:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){this.element=e,this.config=t,this.enableKeyBoard=!0,this.isMouseenter=!0,this.spreadDraggable&&(this.keyUp=this.keyUpPre.bind(this),this.element.setAttribute("tabindex","1"),this.setEvents())}return Object.defineProperty(e.prototype,"spreadDraggable",{get:function(){return this.config.spreadDraggable},enumerable:!0,configurable:!0}),e.prototype.setEvents=function(){var e=this;window.addEventListener("keyup",this.keyUp),this.element.addEventListener("mouseenter",function(t){e.isMouseenter=!0}),this.element.addEventListener("mouseleave",function(t){e.isMouseenter=!1})},e.prototype.isEditableElement=function(){var e=document.activeElement;if(null!==e&&"false"!==e.getAttribute("contenteditable")){var t=e.tagName.toLowerCase();if("input"===t||"textarea"===t||"select"===t||"true"===e.getAttribute("contenteditable"))return!0}return!1},e.prototype.keyUpPre=function(e){if(this.config.disableArrowKeys!==!0&&(this.element===document.activeElement||this.isMouseenter!==!1&&(this.isEditableElement()!==!0||document.hasFocus()!==!0))){var t=e.key||e.keyIdentifier;switch(t){case"ArrowLeft":this.pagePrevious();break;case"ArrowUp":this.pagePrevious();break;case"ArrowRight":this.pageNext();break;case"ArrowDown":this.pageNext();break;case"Left":this.pagePrevious();break;case"Up":this.pagePrevious();break;case"Right":this.pageNext();break;case"Down":this.pageNext()}}},e.prototype.pageNext=function(){NIApi.page.openNext()},e.prototype.pagePrevious=function(){NIApi.page.openPrevious()},e}();n.EpubKeyBoardEvent=i},{}],13:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a=t("../EpubGesturesEvent/Defs"),r=t("../EpubEvent"),o=function(){function t(n){this.element=n,this.lastSentWheelTimestamp=0,this.lastHighWheelTimestamp=0,this.lastThreadResponseTimestamp=0,this.lastThreadBlockTimestamp=0,this.browserName=e.Param.userAgent.browser.name,this.epubEvent=new r.EpubEvent;var i="WheelEvent"in window?t.EVENTSTYPE.WHEEL:t.EVENTSTYPE.MOUSEWHEEL;this.element.addEventListener(i,this.mouseWheelHandler.bind(this),!1),this.initCheckThreadBlockDaemon()}return t.prototype.addListeners=function(e,t){this.epubEvent.addListener(r.EPUB_EVENTS.MOUSE_WHEEL,e)},t.prototype.removeListeners=function(e,t){this.epubEvent.removeListener(r.EPUB_EVENTS.MOUSE_WHEEL,e)},t.prototype.initCheckThreadBlockDaemon=function(){var e=this;this.lastThreadResponseTimestamp=Date.now(),setInterval(function(){var t=Date.now(),n=t-e.lastThreadResponseTimestamp;n>50&&(e.lastThreadBlockTimestamp=t),e.lastThreadResponseTimestamp=t},0)},t.prototype.mouseWheelHandler=function(e){this.isWheelDeltaTooLow(e)||(this.updateHighWheelTimestamp(),this.isLastThreadBlockTooClose()||this.isLastSentWheelTooClose()||this.sendWheelEvent(e))},t.prototype.isWheelDeltaTooLow=function(e){var t=15,n=this.getWheelDelta(e),i=0===e.deltaMode;return i&&n<t},t.prototype.getWheelDelta=function(e){return Math.max(Math.abs(e.deltaY),Math.abs(e.deltaX))},t.prototype.updateHighWheelTimestamp=function(){this.lastHighWheelTimestamp=Date.now()},t.prototype.isLastThreadBlockTooClose=function(){var e=250,t=this.lastHighWheelTimestamp-this.lastThreadBlockTimestamp;return t<e},t.prototype.isLastSentWheelTooClose=function(){var e=800,t=this.lastHighWheelTimestamp-this.lastSentWheelTimestamp;return t<e},t.prototype.sendWheelEvent=function(e){
this.lastSentWheelTimestamp=Date.now(),this.dispatchEventsWheel(e)},t.prototype.dispatchEventsWheel=function(e){this.epubEvent.fire({type:r.EPUB_EVENTS.MOUSE_WHEEL,data:e})},t.windowScrollInit=!1,t.windowMouseWheelInit=!1,t.windowScrollStatus=!1,t.EVENTSTYPE=a.getEventsType(),t.GESTURESNAME=a.getGesturesName(),t}();i.MouseWheelManager=o},{"../EpubEvent":8,"../EpubGesturesEvent/Defs":11}],14:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a=t("./EpubManager"),r=t("./EpubDomApi"),o=t("./polyfill/closest");o["default"]();var s;!function(t){var n=function(){function t(){e.EpubDomApi=r["default"],e.Class.EpubManager=a["default"]}return t}();t.EpubMain=n}(s||(s={})),new s.EpubMain},{"./EpubDomApi":7,"./EpubManager":15,"./polyfill/closest":73}],15:[function(t,n,i){var a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,r){function o(e){try{l(i.next(e))}catch(t){r(t)}}function s(e){try{l(i["throw"](e))}catch(t){r(t)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,r&&(o=2&n[0]?r["return"]:n[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,r=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(i){n=[6,i],r=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,r,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(i,"__esModule",{value:!0});var o,s=t("./EpubConfig"),l=t("./EpubCssManager"),u=t("./EpubNavigationTypeManager"),c=t("./EpubSpreads"),p=t("./EpubStatistics"),h=t("./components/pageToast/Controller"),d=t("./EpubEvent"),f=t("./EpubGesturesEvent/EpubKeyBoardEvent"),m=t("./utils/functions"),g=t("./EpubGesturesEvent"),v=t("./EpubConfig/EpubDefaultConfig"),b=t("./EpubGalleryManager"),y=t("./EpubPageEnrichment/Slider/index");!function(e){e.GALLERY="GALLERY",e.APP_CONTAINER="APP_CONTAINER"}(o||(o={}));var E;!function(e){e.GO_TO_PREVIOUS="goToPrevious",e.STAY="stay",e.GO_TO_NEXT="goToNext"}(E||(E={}));var M;!function(e){e.SELF="_self",e.BLANK="_blank",e.POPUP="popup"}(M||(M={})),i.OpenTarget=M;var S;!function(e){e.TOGGLE_SHARE_PANEL="toggleSharePanel",e.TOGGLE_SEARCH_PANEL="toggleSearchPanel",e.TOGGLE_FAVORITE_PANEL="toggleFavoritePanel",e.TOGGLE_THUMBNAIL_PANEL="toggleThumbnailPanel",e.TOGGLE_SUMMARY_PANEL="toggleSummaryPanel",e.MAILTO="mailto",e.GO_TO_PAGE="goToPage",e.POPUP="popup",e.OPEN_NEW_TAB="openNewTab",e.OPEN_SAME_TAB="openSameTab",e.SHOW_TOOLTIP="showTooltip",e.HIDE_TOOLTIP="hideTooltip",e.SLIDER="slider"}(S||(S={}));var P=function(){function t(t,n){this.parent=t,this.viewMain=n,this.epubMode=!0,this.screenSize={width:0,height:0,ratio:0},this.registeredInddPluginEvent={},this.userInteractions(!1),e.epubEvent=e.epubEvent||new d.EpubEvent,this.epubEvent=e.epubEvent,this.userAgent=e.Param.userAgent,this.config=new s["default"](this),this.epubStatistics=new p.EpubStatistics(this),this.galleryManager=new b["default"],this.registerApi(),this.initListeners()}return Object.defineProperty(t.prototype,"defaultPageScaleAt",{get:function(){return this.config.defaultPageScaleAt},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxPageTotalScale",{get:function(){return this.config.maxPageTotalScale},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"navigationAxis",{get:function(){return this.config.navigationAxis},set:function(e){this.config.navigationAxis=e,this.epubSpreads.updateSpreads(0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transitionTime",{get:function(){return this.config.transitionTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPage",{get:function(){return this.config.currentPage},set:function(e){this.config.currentPage=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPageNoAnimation",{get:function(){return this.config.currentPageNoAnimation},set:function(e){this.config.currentPageNoAnimation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageQuantity",{get:function(){return this.config.pageQuantity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pagesBySpreadMax",{get:function(){return this.config.pagesBySpreadMax},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageChangeSource",{set:function(e){this.config.pageChangeSource=e},enumerable:!0,configurable:!0}),t.prototype.registerApi=function(){var e=this;NIApi.register("page.openNext",function(){return e.pageNext(),Promise.resolve()}),NIApi.register("page.openPrevious",function(){return e.pagePrevious(),Promise.resolve()}),NIApi.register("page.openFirst",function(){return e.pageFirst(),Promise.resolve()}),NIApi.register("page.openLast",function(){return e.pageLast(),Promise.resolve()}),NIApi.register("page.open",function(t){return e.goToPage(t),Promise.resolve()}),NIApi.register("event.registerPluginEvent",function(t,n){return e.registeredInddPluginEvent[t]=n,Promise.resolve()})},t.prototype.isFocusable=function(){var e,t,n=document.activeElement;return!n||(e=n.readOnly,t=n.getAttribute("contenteditable"),e!==!1&&"true"!==t)},t.prototype.focusOn=function(){this.isFocusable()===!0&&this.epubSpreads.getMainViewElement().focus()},t.prototype.initListeners=function(){var t=this;document.addEventListener("WebPublicationAction",this.onApiCall.bind(this),!0),this.epubEvent.addListener(d.EPUB_EVENTS.PAGE_CLICK,function(e){t.toggleMenu()}),this.epubEvent.addListener(d.EPUB_EVENTS.PAGE_CHANGE,function(n){n.data.useAnimationTime===!1?t.epubSpreads.updateSpreads(0):t.epubSpreads.updateSpreads(t.transitionTime),e.Main.pageManager.set(t.currentPage),e.Main.pagesLoaderNew.setCurrentPage(t.currentPage),t.setDocumentPagesAttributes(),n.data.pageNeverChanged||(t.focusOn(),setTimeout(function(){t.focusOn()},200))}),e.Main.pageManager.onChange(function(e){e=~~e,t.currentPage!==e&&t.goToPage(e)}),this.epubEvent.addListener(d.EPUB_EVENTS.PAGE_ZOOM,function(n){e.Param.zoom=n.data.status;var i=t.viewMain.classList.contains("epub-view_state-zoom-in");e.Param.zoom===!1&&i?t.viewMain.classList.remove("epub-view_state-zoom-in"):e.Param.zoom!==!0||i||t.viewMain.classList.add("epub-view_state-zoom-in"),e.Utils.callEvent(window,"webpub-zoom")}),this.preventDocumentScroll()},t.prototype.onApiCall=function(e){var t=this,n=this.isFromTapEvent(e),i=this.isFromSpread(e);n&&i?this.callIfClickAuthorized(function(){t.handleInddPluginEvent(e)}):this.handleInddPluginEvent(e)},t.prototype.isOriginalEventSent=function(e){return e.detail&&e.detail.event&&e.detail.event.type},t.prototype.isFromTapEvent=function(e){if(this.isOriginalEventSent(e)){var t=e.detail.event.type,n=[g["default"].EVENTSTYPE.MOUSE.CLICK,g["default"].EVENTSTYPE.TOUCH.TOUCHEND];if(n.includes(t))return!0}return!1},t.prototype.isFromSpread=function(e){if(this.isOriginalEventSent(e))for(var t=e.detail.event.target,n=this.epubSpreads.epubSpreads.map(function(e){return e.element}),i=0;i<n.length;i++){var a=n[i],r=t instanceof Node&&a.contains(t);if(r)return!0}return!1},t.prototype.callIfClickAuthorized=function(e){var t=this;this.epubEvent.fire({type:d.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:!0,action:function(n){return t.clickAction(n,e)}}})},t.prototype.clickAction=function(e,t){e.then(function(e){e&&t()})},t.prototype.handleInddPluginEvent=function(t){var n=t.detail,i=n.type,a=n.params,r=n.event;switch(i){case S.TOGGLE_SHARE_PANEL:return void NIApi.panels.share.toggle();case S.TOGGLE_SEARCH_PANEL:return void NIApi.panels.search.toggle();case S.TOGGLE_FAVORITE_PANEL:return void NIApi.panels.favorites.toggle();case S.TOGGLE_THUMBNAIL_PANEL:return void NIApi.panels.thumbnail.toggle();case S.TOGGLE_SUMMARY_PANEL:return void NIApi.panels.summary.toggle();case S.MAILTO:return void(a&&a.email&&(window.location.href="mailto:"+a.email));case S.GO_TO_PAGE:return void(a&&a.page&&(NIApi.page.open(a.page),NIApi.lightbox.closeAll(),NIApi.menu.close()));case S.POPUP:case S.OPEN_NEW_TAB:case S.OPEN_SAME_TAB:var s=a.assetDriveItem,l=void 0===s?{type:void 0,globalId:void 0}:s,u=a.subAssetDriveItem,c=a.pageNumber,p=a.param,h=this.resolveParams(a),d=[o.GALLERY,o.APP_CONTAINER].includes(l.type);if(d){var f=u&&u.globalId,m=this.getTargetFromEventType(i);return void NIApi.gallery.open(l.globalId,f,c,m)}var g=this.isExternalLink(h);if(e.Param.isApp&&!g||i===S.POPUP)return void this.openPopup(h);var v=this.getTargetFromEventType(i);return p&&!l.globalId&&e.Main.trackerManager.trackEvent({name:"externalLink",variables:{1:h.param}}),void window.open(h.param,v);case S.SHOW_TOOLTIP:if(r){var b={X:r.clientX,Y:r.clientY+25};a.content&&e.Main.tooltipManager.showAfterDelay(a.content,b)}return;case S.HIDE_TOOLTIP:return void e.Main.tooltipManager.hide();case S.SLIDER:var y=a.slides,E=a.settings;this.removeSlider();var M=this.createHiddenElement();return void this.handleSlider(M,y,E)}var P=this.registeredInddPluginEvent[i];return P?void P(a):void console.warn("Plugin event "+i+" not found. Tried to call with params : ",a)},t.prototype.handleSlider=function(t,n,i){var a=new y.Slider(t,n,"mainView",e.Main.pagesLoaderNew.getCurrentPage(),i,y.SliderType.FULLSCREEN_BUTTON),r=document.querySelectorAll(".pswp__img");r.length>0?(Array.from(r).forEach(function(e){e.addEventListener("click",function(e){return e.preventDefault()})}),a.openInFullscreen()):this.removeSlider()},t.prototype.createHiddenElement=function(){var e=document.createElement("div");return e.classList.add("hidden-element","plugin-slider-hidden"),document.body.appendChild(e),e},t.prototype.removeHiddenElement=function(){var e=document.querySelector(".hidden-element");e&&e.remove()},t.prototype.removeSlider=function(){this.removeHiddenElement()},t.prototype.isExternalLink=function(e){return!e||!e.assetDriveItem||"EXTERNAL_LINK"===e.assetDriveItem.type||e.assetDriveItem.isExternalLink===!0},t.prototype.resolveParams=function(t){var n=t.assetDriveItem&&t.assetDriveItem.relUrl&&"EXTERNAL_LINK"!==t.assetDriveItem.type?"${media}"+t.assetDriveItem.relUrl.replace(/^\/?\d+\//g,""):t.param;return!t.assetDriveItem||"PUBLICATION"!==t.assetDriveItem.type&&"COMPONENT"!==t.assetDriveItem.type||(n+="index.html"),t.pageNumber&&(n+="#page="+t.pageNumber),n=e.Utils.resolveVariable(n),t.param=n,t},t.prototype.getTargetFromEventType=function(e){switch(e){case S.POPUP:return M.POPUP;case S.OPEN_SAME_TAB:return M.SELF;case S.OPEN_NEW_TAB:default:return M.BLANK}},t.prototype.openPopup=function(e){e.id="epub-lightbox-"+Date.now().toString();var t=NIApi.lightbox.getOpenList();NIApi.lightbox.openPopup(null,e),setTimeout(function(){t.then(function(e){return e.forEach(function(e){return NIApi.lightbox.close(e)})})},250)},t.prototype.isEditableElementActive=function(){var e=document.activeElement.tagName.toLowerCase();return["input","textarea"].includes(e)},t.prototype.preventDocumentScroll=function(){var e=this,t=!1,n=0,i=function(){return Date.now()-n<100};document.addEventListener("touchend",function(a){if(!e.isEditableElementActive())return i()?void a.preventDefault():void(t===!0&&(n=Date.now(),window.scrollTo(0,0),e.epubNavigationTypeManager.forceResize(),a.preventDefault()))},!0),document.addEventListener("touchmove",function(n){e.isEditableElementActive()||(i()&&n.preventDefault(),t=0!==window.scrollY||0!==window.scrollX)},!1)},t.prototype.setDocumentPagesAttributes=function(){var e=this.getCurrentPages();document.documentElement.setAttribute("pages",e.join("-")),document.documentElement.setAttribute("pages-left",e[0].toString()),e[1]?document.documentElement.setAttribute("pages-right",e[1].toString()):document.documentElement.setAttribute("pages-right","")},t.prototype.showMenu=function(t){return t===!1?(e.Main.menuManager.hideMenu(),void e.Main.menuManager.hideTopnav()):void e.Main.menuManager.showTopnav()},t.prototype.toggleMenu=function(){e.Main.toolsEvents&&(1===e.Main.toolsEvents.showToolsInfo?(e.Main.toolsEvents.showTools(!1),this.showMenu(!1)):(e.Main.toolsEvents.showTools(!0),this.showMenu(!0)))},t.prototype.pageChange=function(e){this.goToPage(e)},t.prototype.pageNext=function(){e.Main.trackerManager.trackEvent({name:"pageNext",variables:{1:this.currentPage}});var t=this.epubSpreads.getNumberOfPageToNextSpread(this.currentPage-1);this.goToPage(this.currentPage+t)},t.prototype.pagePrevious=function(){e.Main.trackerManager.trackEvent({name:"pagePrev",variables:{1:this.currentPage}});var t=this.epubSpreads.getNumberOfPageToPreviousSpread(this.currentPage-1);this.goToPage(this.currentPage-t)},t.prototype.pageFirst=function(){e.Main.trackerManager.trackEvent({name:"pageFirst",variables:{1:this.currentPage}}),this.goToPage(1)},t.prototype.pageLast=function(){e.Main.trackerManager.trackEvent({name:"pageLast",variables:{1:this.currentPage}}),this.goToPage(this.pageQuantity)},t.prototype.goToPage=function(e,t,n){void 0===t&&(t=!0),this.pageChangeSource=n,t?this.currentPage=e:this.currentPageNoAnimation=e},t.prototype.canChangePage=function(e,t){var n=e.isVector,i=e.vectorDiff,a=e.pointDiff,r=Math.abs(i)>Math.abs(t.vectorDiff);return n&&r?i>0?a<0?E.STAY:E.GO_TO_PREVIOUS:i<0?a>0?E.STAY:E.GO_TO_NEXT:E.STAY:E.STAY},t.prototype.userInteractions=function(e){void 0===e&&(e=!0),document.documentElement.style.cursor=e?"default":"progress",document.body.style.pointerEvents=e?"all":"none"},t.prototype.gotoPageByCoordsDiff=function(e,t){void 0===t&&(t=!0);var n=this.navigationAxis===v.NavigationAxis.X?"y":"x",i=this.canChangePage(e[this.navigationAxis],e[n]);return i===E.GO_TO_NEXT?void this.pageNext():i===E.GO_TO_PREVIOUS?void this.pagePrevious():void this.goToPage(this.currentPage,t)},t.prototype.scrollFrame=function(e){"next"===e||1===e?this.pageNext():"prev"!==e&&e!==-1||this.pagePrevious()},t.prototype.getCurrentPages=function(e){return void 0===e&&(e=this.currentPage),void 0===this.epubSpreads?[]:this.epubSpreads.getSpreadPageIndexesByPageIndex(e-1).map(function(e){return e+1})},t.prototype.getPagesOfFrame=function(){return this.getCurrentPages()},t.prototype.getFrameOfPage=function(e){return this.getCurrentPages(e)[0]},t.prototype.setConfig=function(e){this.config.setConfig(e)},t.prototype.updateSpreadsSize=function(){void 0!==this.epubSpreads&&this.epubSpreads.updateSpreadsSize()},t.prototype.switchNavigation=function(e){return e?(this.navigationAxis=e,this.navigationAxis):this.navigationAxis===v.NavigationAxis.X?(this.navigationAxis=v.NavigationAxis.Y,this.navigationAxis):(this.navigationAxis=v.NavigationAxis.X,this.navigationAxis)},t.prototype.isZoomed=function(){return 0!==this.epubSpreads.getScaleFromCurrentSpread()},t.prototype.zoomByStep=function(e){this.epubSpreads.zoomByStep({x:.5,y:0,step:e,animate:!0})},t.prototype.zoomIn=function(){this.epubSpreads.zoomToggle({x:.5,y:0,scale:this.defaultPageScaleAt,animate:!0})},t.prototype.zoomOut=function(){this.epubSpreads.zoomToggle({x:.5,y:0,scale:0,animate:!0})},t.prototype.zoomTo=function(e){this.epubSpreads.zoomToggle({x:.5,y:0,scale:e,animate:!0})},t.prototype.zoomNow=function(e){this.epubSpreads.zoomToggle({x:.5,y:0,scale:e,animate:!1})},t.prototype.initStartingPage=function(){var t="startPage",n=e.Main.urlManager.get(t);n&&this.goToPage(parseInt(n,10))},t.prototype.init=function(t,n){return a(this,void 0,void 0,function(){return r(this,function(i){switch(i.label){case 0:return m.resizeHTMLTagElement(),this.setConfig(t),this.epubCssManager=new l.EpubCssManager(this.config),[4,this.epubCssManager.init(n)];case 1:return i.sent(),this.epubNavigationTypeManager=new u["default"](this,this.config,this.viewMain),this.epubSpreads=new c["default"](this,this.config,this.viewMain,this.epubCssManager),e.Main.startupManager.has("ui.pageToast.enabled",this.userAgent.device.type)&&(this.pageToast=new h.Controller(this)),this.epubSpreads.getMainViewElement().setAttribute("tabindex","1"),this.epubKeyBoardEvent=new f.EpubKeyBoardEvent(this.epubSpreads.getMainViewElement(),this.config),this.screenSize=this.epubNavigationTypeManager.screenSize,this.epubNavigationTypeManager.forceResize(),e.Main.pagesLoaderNew.setCurrentPage(this.currentPage),this.userInteractions(!0),this.initStartingPage(),[2]}})})},t}();i["default"]=P},{"./EpubConfig":4,"./EpubConfig/EpubDefaultConfig":5,"./EpubCssManager":6,"./EpubEvent":8,"./EpubGalleryManager":9,"./EpubGesturesEvent":10,"./EpubGesturesEvent/EpubKeyBoardEvent":12,"./EpubNavigationTypeManager":16,"./EpubPageEnrichment/Slider/index":56,"./EpubSpreads":64,"./EpubStatistics":66,"./components/pageToast/Controller":70,"./utils/functions":78}],16:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a=t("./EpubEvent"),r=t("./utils/functions"),o=function(){function t(t,n,i){var a=this;this.sizeIDString="",this.timers={resize:0,orientationchange:0},this.parent=t,this.config=n,this.epubEvent=e.epubEvent,this.screenSize=this.parent.screenSize,this.onResize=this.onResize.bind(this),this.pageLayout=e.Main.pageLayoutService.get("pageLayout");var r=e.Main.xmlManager.get("common-configuration","contents","zoom","width"),o=e.Main.xmlManager.get("common-configuration","contents","zoom","height");this.isWidePage=r>o,this.pageSize={width:this.pageWidth,height:this.pageHeight,ratio:1.5*this.pageWidth/this.pageHeight},this.updateScreenSize(),this.epubScreenElement=i,window.addEventListener(e.Param.eventResize,this.onResize.bind(this)),window.addEventListener("focus",this.onResize,!1),setTimeout(function(){return a.forceResize()},0),setTimeout(function(){a.localCheckWindowSize()},1e3)}return Object.defineProperty(t.prototype,"timeToRefreshScreenResize",{get:function(){return this.config.timeToRefreshScreenResize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddinigs",{get:function(){return this.config.paddings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pagesBySpreadMax",{get:function(){return this.config.pagesBySpreadMax},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageWidth",{get:function(){return this.config.pageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageHeight",{get:function(){return this.config.pageHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"switchLandScapeUsingPageSize",{get:function(){return this.config.switchLandScapeUsingPageSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerWidth",{get:function(){return window.innerWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerHeight",{get:function(){return window.innerHeight},enumerable:!0,configurable:!0}),t.prototype.needUpdateScreenSize=function(){return this.screenSize.width===this.innerWidth&&this.screenSize.height===this.innerHeight},t.prototype.updateScreenSize=function(){var e=this.needUpdateScreenSize();return this.screenSize.width=this.innerWidth,this.screenSize.height=this.innerHeight,this.screenSize.ratio=this.screenSize.width/this.screenSize.height,e},t.prototype.isWideScreen=function(){if(!e.Param.isDesktop){var t=screen;if(t.orientation)return t.orientation.type.includes("landscape");if(t.msOrientation)return t.msOrientation.type.includes("landscape")}return this.screenSize.width>this.screenSize.height},t.prototype.onResizeSync=function(){var e;return r.resizeHTMLTagElement(),window.scrollTo(0,0),this.config.paddinigsUpdate(),this.sizeIDString=this.innerHeight+"-"+this.innerWidth,this.updateScreenSize()!==!0||(this.parent.updateSpreadsSize(),e=r.isWindowLandscape(),e!==this.windowLandscape&&(this.windowLandscape=e,this.epubEvent.fire({type:a.EPUB_EVENTS.SCREEN_ORIENTATION,data:{landscape:e}})),!1)},t.prototype.onResize=function(e){window.scrollTo(0,0),clearTimeout(this.timers[e.type]),this.onResizeSync()!==!1&&(this.timers[e.type]=setTimeout(this.onResize.bind(this,e),this.timeToRefreshScreenResize))},t.prototype.localCheckWindowSize=function(){var e=this,t=this.innerHeight,n=this.innerWidth;this.sizeIDString!==t+"-"+n&&this.forceResize(),window.setTimeout(function(){e.localCheckWindowSize()},500)},t.prototype.forceResize=function(){this.onResize({type:"resize"})},t}();i["default"]=o},{"./EpubEvent":8,"./utils/functions":78}],17:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),t("es6-promise");var a=t("./utils/enums"),r=t("./utils/XHRPromise"),o=t("./utils/XHRPromise"),s=t("./EpubPage/LinksManager"),l=t("./EpubPageEnrichment"),u=t("./utils/functions"),c=t("./EpubEvent"),p='\\<\\?xml version="1.0" encoding="UTF-8" standalone="no"\\?\\>\\n\\<\\!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"\\>',h=function(){function t(n,i,r,o){this.epubPages=n,this.config=i,this.pageNumber=r,this.epubCssManager=o,this.isVisible=!1,this.loadList=[],this.inCache=!1,this.synchronizedWidthSpread=!1,this.isOnLoad=!1,this._pageContainsCPUElement=!1,this.loadXhrError=function(){this.inCache=!1,this.isOnLoad=!1,this.callCallBackOnload(!1)},this.epubEvent=e.epubEvent,this.pageSizeCoefLinkCallBack=this.pageSizeCoefLinkCallBack.bind(this),this.loadXhrError=this.loadXhrError.bind(this),this.currentPageNumber=r,void 0===t.pageSizeCoefLink&&(t.pageSizeCoefLink=new Promise(this.pageSizeCoefLinkCallBack)),this.elementContainer=this.element=document.createElement("figure"),this.linksManager=new s["default"](this,i,r,this.element),this.setRootElemAttributes(this.element,r),this.readerPageSrcType===a.READER_TYPES.EPUB_HTML&&(this.epubPageEnrichment=new l["default"](this,this.config,this.elementContainer))}return t.prototype.pageSizeCoefLinkCallBack=function(e){t.pageSizeCoefLinkResolve=e},Object.defineProperty(t.prototype,"readerPageSrcType",{get:function(){return this.config.readerPageSrcType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"srcHdpi",{set:function(e){this.urlPageHdpi=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"src",{set:function(e){this.inCache!==!0&&(this.urlPage=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onload",{set:function(e){this._onload(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"atSpreadOffset",{set:function(e){this._spreadOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageContainsCPUElement",{get:function(){return this._pageContainsCPUElement},set:function(e){var t="no";e===!0&&(t="yes"),"yes"===t&&this.pageContainsCPUElement===!0||"no"===t&&this.pageContainsCPUElement===!1||(this._pageContainsCPUElement=e,this.updateAttributesIframe(t))},enumerable:!0,configurable:!0}),t.prototype.updateIframesZoom=function(e){this.epubPageEnrichment&&this.epubPageEnrichment.updateIframesZoom(e),this.linksManager&&this.linksManager.updateIframesZoom(e)},t.prototype.updateAttributesIframe=function(e){this.zoomableParentElement&&this.zoomableParentElement.setAttribute("contains-iframe",e)},t.prototype.innerHTML=function(e,t){e.innerHTML=t},t.prototype.epubPageEnrichmentStat=function(){if(this.inCache!==!1)return this.isVisibleSpread()?void this.onVisible():void this.onNonVisible()},t.prototype.isVisibleSpread=function(){return this.config.isVerticalOnePage?[-2,-1,0,1,2].includes(this._spreadOffset):0===this._spreadOffset},t.prototype.pathToSvg=function(e,t){var n=new RegExp(p,"gmi");return e=e.replace(/(\/[^\/]+)$/g,"/svg/"),t=t.replace(n,""),t.replace(/svg\//gim,e).trim()},t.prototype.parseImage=function(e){var t=this;u.htmlSecureRemoveChildren(e);var n=new Image;n.src=this.urlPage,e.appendChild(n);var i=new Promise(function(i,a){var r=n.onload=n.onerror=n.onabort=function(){i(n),e.classList.add("epub-image-page-loaded"),null!==n.parentElement&&setTimeout(function(){if(null!==n.parentElement){var i=new Image;i.src=t.urlPageHdpi,i.style.width=n.width+"px",i.style.height=n.height+"px",i.onload=function(){null!==n.parentElement&&e.replaceChild(i,n)},t.onFlush.then(function(){i.src=""})}},400)};n.complete===!0&&r()});return this.onFlush.then(function(){e.classList.remove("epub-image-page-loaded"),n.src=""}),i},t.prototype.parseHtmlImgsload=function(e){return new Promise(function(t,n){var i=e.onload=e.onerror=e.onabort=function(){t(e)},a=!e.src&&!e.srcset;(e.complete===!0||a)&&i()})},t.prototype.parseHtml=function(e,t){var n,i=[];this.readerPageSrcType===a.READER_TYPES.EPUB_HTML&&(t=this.updateAttributes(t)),this.readerPageSrcType===a.READER_TYPES.PDF_SVG&&(t=this.pathToSvg(this.urlPage,t)),u.htmlSecureRemoveChildren(e);var r=document.createElement("div");if(this.innerHTML(r,t),this.readerPageSrcType===a.READER_TYPES.EPUB_HTML)for(var o=r.querySelectorAll("iframe"),s=function(e,t){l.pageContainsCPUElement=!0;var n=o[e].getAttribute("src");if(null===n)return"continue";n=n.replace("%num%",l.currentPageNumber.toString()),o[e].removeAttribute("src");var a=NIApi.common.resolveValues(n.toString()).then(function(t){o[e].setAttribute("data-src",t)});i.push(a)},l=this,c=0,p=o.length;c<p;c++)s(c,p);var h=r.childNodes[0],d=h.querySelectorAll("img");e.appendChild(h),(n=e.querySelector("div"))&&(this.readerPageSrcType===a.READER_TYPES.PDF_SVG?n.setAttribute("class","webpub-viewer__epub-container-spread-page-sub epub_content_tag_type-"+a.READER_TYPES[this.readerPageSrcType].toLowerCase()):(n.id="",n.classList.add("webpub-viewer__epub-container-spread-page-sub"),n.classList.add("epub_content_tag_type-"+a.READER_TYPES[this.readerPageSrcType].toLowerCase()))),this.readerPageSrcType===a.READER_TYPES.EPUB_HTML&&(this.parseEpubHyperlinks(e),this.parseEpubVideos(e),this.parseEpubScrolls(e),this.parseEditedTextFields(e));for(var f=[],c=0,p=d.length;c<p;c++)f.push(this.parseHtmlImgsload(d[c]));var m=Promise.all(f);m.then(function(){e.classList.add("epub-image-page-loaded")}),this.onFlush.then(function(){e.classList.remove("epub-image-page-loaded")});var g=new Promise(function(t,n){m.then(function(){Promise.all(i).then(function(){t(e)})})});return g},t.prototype.updateAttributes=function(t){var n=["src","href","poster"];return n.forEach(function(n){var i=new RegExp(n+'="([^"]+)"',"g");if(i.test(t)){i.lastIndex=0;for(var a=void 0;null!==(a=i.exec(t));){var r=a[1],o=e.Utils.resolveVariable(r);t=t.replace(n+'="'+r+'"',n+'="'+o+'"')}}}),t},t.prototype.parseEpubHyperlinks=function(t){for(var n="a[href]",i=[].slice.call(t.querySelectorAll(n)),a=0;a<i.length;a++){var r=i[a];r.addEventListener("click",function(t){var i=t.target.closest(n),a=i.getAttribute("href"),r=["","javascript:void(0)"];r.includes(a)||e.Main.trackerManager.trackEvent({name:"externalLink",variables:{1:a}})})}},t.prototype.parseEpubVideos=function(t){for(var n=[].slice.call(t.querySelectorAll("video")),i=0;i<n.length;i++){var a=n[i];e.Utils.addVideoStats(a),e.Param.userAgent.browser.name!==e.Param.userAgent.BROWSER.SAFARI||a.hasAttribute("autoplay")||(a.setAttribute("autoplay",""),a.dataset.ignoreAutoplay="true",a.pause())}},t.prototype.parseEpubScrolls=function(t){for(var n=["touchstart","touchmove","mousewheel","wheel","DOMMouseScroll"],i=function(e){return e.stopPropagation()},a=function(e){return e.preventDefault()},r='[class*="plugin-animationScrollableBox"], .edited[class*="editable-text"]:not(.is-empty)',o=[].slice.call(t.querySelectorAll(r)),s=function(t){var r=o[t];n.forEach(function(e){r.addEventListener(e,i)}),e.Param.userAgent.browser.name===e.Param.userAgent.BROWSER.FIREFOX&&r.addEventListener("mousedown",a)},l=0;l<o.length;l++)s(l)},t.prototype.parseEditedTextFields=function(e){for(var t='.edited[class*="editable-text"] .rte-subscript, .edited[class*="editable-text"] .rte-superscript',n=[].slice.call(e.querySelectorAll(t)),i=0;i<n.length;i++){var a=n[i],r=u.getNumberFromString(a.style.fontSize);a.style.fontSize=.75*r+"px"}},t.prototype.parsePdf=function(e){u.htmlSecureRemoveChildren(e);var t=document.createElement("embed");return t.src=this.urlPage+"#zoom=200",t.width=1536,t.height=2172,t.style.width=t.width+"px",t.style.height=t.height+"px",t.style.pointerEvents="none",e.appendChild(t),Promise.resolve(e)},t.prototype.setRootElemAttributes=function(e,t){e.classList.add("spread-page-"+t),e.classList.add("webpub-viewer__epub-container-spread-page")},t.prototype.load_loaded=function(e){var t,n=this;return this.inCache=!0,this.isOnLoad=!1,t=this.readerPageSrcType===a.READER_TYPES.PDF_IMG?this.parseImage(this.elementContainer):this.readerPageSrcType===a.READER_TYPES.PDF_PDF?this.parsePdf(this.elementContainer):this.parseHtml(this.elementContainer,e.responseText),t.then(function(){n.epubPageEnrichmentStat(),n.callCallBackOnload(!0),n.linksManager.load().then(function(){n.tryDispatchIsInDom()})}),t},t.prototype.load=function(e){var t=this;if(e&&!e.data.pageChanged)return Promise.resolve();if(this.config.isVerticalOnePage&&!this.isVisibleSpread())return this.element.innerHTML="",this.epubPageEnrichment.stop(),this.inCache=!1,Promise.resolve();if(this.inCache===!0)return this.epubPageEnrichmentStat(),Promise.resolve();if(this.isOnLoad===!0)return Promise.resolve();this.isOnLoad=!0;var n=new o["default"](r.Protocol.GET,this.urlPage).init().then(function(e){t.load_loaded(e).then(function(){return Promise.resolve()})})["catch"](this.loadXhrError);return n},t.prototype.callCallBackOnload=function(e){for(var t=0,n=this.loadList.length;t<n;t++)this.loadList[t].bind(this)(e);this.loadList=[]},t.prototype._onload=function(e){return this.inCache===!0?void e.bind(this)(!0):void this.loadList.push(e)},t.prototype.tryDispatchIsInDom=function(){if(this.inCache!==!1&&this.synchronizedWidthSpread!==!1&&this.linksManager.isLoaded()!==!1){this.epubEvent.fire({type:c.EPUB_EVENTS.PAGE_IN_DOM,data:{epubPage:this}});var e=t.coef;this.setCoefOfPageSizeToLink(),t.pageSizeCoefLinkResolve&&t.coef&&!e&&t.pageSizeCoefLinkResolve()}},t.prototype.syncElemWithSpread=function(e){this.onFlush=u.getSplitedPromise();var t=this.load();return this.zoomableParentElement=e,this.synchronizedWidthSpread=!0,this.tryDispatchIsInDom(),this.config.isVerticalOnePage&&this.epubEvent.addListener(c.EPUB_EVENTS.PAGE_CHANGE,this.load.bind(this)),{element:this.element,loaded:t}},t.prototype.setCoefOfPageSizeToLink=function(){t.coef||(t.coef=this.element.offsetHeight/this.config.linksSizePageHeight)},t.prototype.onVisible=function(){this.isVisible!==!0&&(this.isVisible=!0,this.readerPageSrcType===a.READER_TYPES.EPUB_HTML&&null!==this.epubPageEnrichment&&this.epubPageEnrichment.start(),this.linksManager.start())},t.prototype.onNonVisible=function(){this.isVisible!==!1&&(this.isVisible=!1,this.synchronizedWidthSpread=!1,this.readerPageSrcType===a.READER_TYPES.EPUB_HTML&&null!==this.epubPageEnrichment&&this.epubPageEnrichment.stop(),this.linksManager.stop())},t.prototype.flush=function(){this.onFlush&&this.onFlush.resolve(),this.inCache!==!1&&(this.synchronizedWidthSpread=!1,this.isVisible=!1,this.loadList=[],this.inCache=!1,u.htmlSecureRemoveChildren(this.elementContainer),this.readerPageSrcType===a.READER_TYPES.EPUB_HTML&&null!==this.epubPageEnrichment&&this.epubPageEnrichment.flush(),this.linksManager.flush())},t}();i["default"]=h},{"./EpubEvent":8,"./EpubPage/LinksManager":19,"./EpubPageEnrichment":47,"./utils/XHRPromise":75,"./utils/enums":77,"./utils/functions":78,"es6-promise":1}],18:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a=t("../EpubEvent"),r=t("../EpubPage"),o=t("./shapes/ShapesManager"),s=t("./useracts/UserActs"),l=function(){function t(t,n,i,r,o){this.linksManager=t,
this.config=n,this.data=i,this.container=r,this.pageElement=o,this.events=new a.EpubEvent,this.started=!1,this.status=!1,this.epubEvent=e.epubEvent,this.ePubPage=t.epubPage,this.start()}return t.prototype.createHtmlElement=function(){this.linksElem=this.linksElem||document.createElement("div"),this.linksElem.innerHTML="",this.linksElem.className="epub-links_container-link webpub-viewer__link-clickable"},t.prototype.setShapes=function(){this.shapesManager=new o.ShapesManager(this,this.config,this.data,this.pageElement,this.linksElem,r["default"].coef)},t.prototype.setUserActs=function(){this.userActs=new s.UserActs(this,this.config,this.data.useract,this.linksElem)},t.prototype.start=function(){var e=this;this.status=!0,r["default"].pageSizeCoefLink.then(function(){e.started===!1&&(e.createHtmlElement(),e.setShapes(),e.setUserActs()),e.started=!0,e.container.appendChild(e.linksElem)})},t.prototype.stop=function(){this.status=!1,this.started!==!1&&(this.started=!1,this.shapesManager.stop(),this.userActs.stop())},t.prototype.flush=function(){this.started=!1,this.shapesManager.flush(),this.userActs.flush()},t.prototype.updateZoomIfIframe=function(e){this.shapesManager&&this.shapesManager.updateZoomIfIframe(e)},t}();i["default"]=l},{"../EpubEvent":8,"../EpubPage":17,"./shapes/ShapesManager":29,"./useracts/UserActs":45}],19:[function(t,n,i){var a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Link"),o=t("./../utils/enums"),s=t("../EpubEvent"),l=function(){function t(t,n,i,a){var r=this;this.epubPage=t,this.config=n,this.pageNumber=i,this.container=a,this._src="",this.promise=!1,this.inCache=!1,this.isStarted=!1,this.links=[],this.blinkLink=this.blinkLinkPre.bind(this),this.epubEvent=e.epubEvent,this.linkBoxAspect=this.config.linkBoxAspect,this.epubEvent.addListener(s.EPUB_EVENTS.ADMIN_LINK_CREATE,function(e){e.data.pageNumber===i&&r.loadLink(e.data.linkData)})}return Object.defineProperty(t.prototype,"enableAspLinks",{get:function(){return this.config.enableAspLinks},enumerable:!0,configurable:!0}),t.prototype.blinkLinkPre=function(e){var t=this;this.linksElem.classList.add("epub-links-unreveal"),clearTimeout(this.toggleTimer),this.toggleTimer=setTimeout(function(){t.linksElem.classList.remove("epub-links-unreveal")},0)},t.prototype.initLinksBehaviors=function(){this.linkBoxAspect===o.LinksBehaviors.blink&&this.epubEvent.addListener(s.EPUB_EVENTS.PAGE_CLICK,this.blinkLink)},t.prototype.createHtmlElement=function(){this.linksElem=this.linksElem||document.createElement("div"),this.linksElem.innerHTML="",this.linksElem.className="epub-links_container epub-links_container-behaviour-"+o.LinksBehaviors[this.linkBoxAspect]},t.prototype.removeHtmlElement=function(){void 0!==this.linksElem&&(this.linksElem.innerHTML="")},t.prototype.isEnable=function(){return this.enableAspLinks},t.prototype.loadLink=function(e){for(var t=0,n=e.content.length;t<n;t++){var i=a({},e);i.content=[e.content[t]],this.links.push(new r["default"](this,this.config,i,this.linksElem,this.container))}},t.prototype.loadLinks=function(){this.createHtmlElement();for(var e=0,t=this.data.length;e<t;e++)this.loadLink(this.data[e]);this.initLinksBehaviors()},t.prototype.stopLinks=function(){for(var e=0,t=this.links.length;e<t;e++)this.links[e].stop()},t.prototype.flushLinks=function(){this.epubEvent.removeListener(s.EPUB_EVENTS.PAGE_CLICK,this.blinkLink),this.removeHtmlElement();for(var e=0,t=this.links.length;e<t;e++)this.links[e].flush();this.links=[]},t.prototype.startOnReady=function(){this.isStarted!==!1&&this.inCache!==!1&&(this.loadLinks(),this.container.appendChild(this.linksElem))},t.prototype.load=function(t){var n=this;return void 0===t&&(t=this.pageNumber),this.isEnable()===!1?Promise.resolve():(this.promise=e.Main.pageManager.getLinksPromise(t),this.promise===!0?(this.data=e.Main.pageManager.getRealLinks(t),this.inCache=!0,this.startOnReady(),Promise.resolve()):(this.promise=this.promise,this.promise.then(function(e){n.data=e,n.inCache=!0,n.startOnReady()}),this.promise))},t.prototype.isLoaded=function(){return this.inCache},t.prototype.flush=function(){this.isEnable()!==!1&&(this.isStarted=!1,this.inCache=!1,this.flushLinks())},t.prototype.start=function(){this.isEnable()!==!1&&(this.isStarted=!0,this.startOnReady())},t.prototype.stop=function(){this.isEnable()!==!1&&(this.isStarted=!1,this.stopLinks())},t.prototype.updateIframesZoom=function(e){this.links.forEach(function(t){return t.updateZoomIfIframe(e)})},t}();i["default"]=l},{"../EpubEvent":8,"./../utils/enums":77,"./Link":18}],20:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./Video"),r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.contentTag="audio",t}return i(t,e),t.prototype.setElement=function(){this.element=window.document.createElement("audio"),this.element.className=this.className+"-audio",this.element.setAttribute("controls",""),this.element.src=this.url,this.setPreventGestures(),this.linksElem.appendChild(this.element)},t._name="audio",t}(a.Video);n.Audio=r},{"./Video":30}],21:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./Shape"),r=function(e){function t(t,n,i,a,r){var o=e.call(this,t,n,i,a,r)||this;return o.shapesManager=t,o.config=n,o.data=i,o.linksElem=a,o.coef=r,o.setRadius(),o}return i(t,e),t.prototype.setRadius=function(){var t=[],n=this.content.circle;"undefined"!=typeof n&&(t[0]=n.radius,e.prototype.setRadius.call(this,t,"%"))},t._name="circle",t}(a.Shape);n.Circle=r},{"./Shape":28}],22:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./Shape"),r=e("./utils/IframeInteractions"),o=("ontouchstart"in window,function(e){function t(t,n,i,a,r,o){var s=e.call(this,t,n,i,a,r)||this;return s.shapesManager=t,s.config=n,s.data=i,s.linksElem=a,s.coef=r,s.pageElement=o,s.url="",s.foreground=!1,s.url=s.content.file.url,s.foreground=s.content.file.foreground||!1,s.setInfoToPage(),s.setElement(),s}return i(t,e),t.prototype.setInfoToPage=function(){this.ePubPage.pageContainsCPUElement=!0},t.prototype.setElement=function(){this.element=window.document.createElement("iframe"),this.element.style.opacity="0",this.element.style.pointerEvents="none",this.element.className=this.className+"-iframe",this.element.setAttribute("data-foreground",this.foreground?"true":"false"),this.element.setAttribute("contenteditable","true"),this.iframeInteractions=new r.IframeInteractions(this,this.config,this.element,this.linksElem,this.foreground)},t.prototype.checkLoaded=function(){this.element.addEventListener("load",this.loaded.bind(this))},t.prototype.loaded=function(){this.element.style.opacity="1";try{this.iFrameContentWindow=this.element.contentWindow,this.setAnimationInitIfNot(),this.foreground===!0&&"object"==typeof this.iFrameContentWindow.AdobeAn?this.iframeInteractions.init(this.iFrameContentWindow):this.foreground===!0&&(this.element.style.pointerEvents="all",this.iframeInteractions.setPreventZoomInteraction(this.iFrameContentWindow))}catch(e){}},t.prototype.setAnimationInitIfNot=function(){var e=this;try{var t=this.iFrameContentWindow.document.body,n=t.getAttribute("onload");t.removeAttribute("onload"),n&&t.addEventListener("load",function(){e.iFrameContentWindow.exportRoot||new e.iFrameContentWindow.Function(n)()})}catch(i){}},t.prototype.start=function(){var t=this;this.setInfoToPage(),this.isVisible!==!1&&(this.timerBeforAppend=setTimeout(function(){t.element.src=t.url,t.linksElem.appendChild(t.element)},850),this.checkLoaded(),e.prototype.start.call(this))},t.prototype.stop=function(){var t=this;clearTimeout(this.timerBeforAppend),this.element.parentElement&&setTimeout(function(){t.linksElem.removeChild(t.element)},300),e.prototype.stop.call(this)},t.prototype.flush=function(){this.iframeInteractions.flush(),e.prototype.flush.call(this)},t.prototype.updateZoom=function(e){var t=[this.coef*e,0,0,this.coef*e,this.x*this.coef*e,this.y*this.coef*e];this.linksElem.style.transform="matrix("+t.join(",")+")",this.linksElem.style.zoom=""+1/e},t._name="iframe",t}(a.Shape));n.Iframe=o},{"./Shape":28,"./utils/IframeInteractions":31}],23:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./Shape"),r=function(e){function t(t,n,i,a,r){var o=e.call(this,t,n,i,a,r)||this;return o.shapesManager=t,o.config=n,o.data=i,o.linksElem=a,o.coef=r,o.url="",o.foreground=!1,o.url=o.content.file.url,o.setElement(),o}return i(t,e),t.prototype.setElement=function(){this.linksElem.style.backgroundImage="url('"+this.url+"')"},t._name="image",t}(a.Shape);n.Image=r},{"./Shape":28}],24:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function t(e){this.mediaElement=e,this.enablePlayButton=!0,this.enableSeekBar=!0,this.enableRemainingTime=!0,this.enableCurrentTime=!0,this.enableVolumeButton=!0,this.enableFullScreenButton=!0,this.displayState=!0,this.toggleControls=this.toggleControls.bind(this),this.showControls=this.showControls.bind(this),this.addDelayUnDisplay=this.addDelayUnDisplay.bind(this),this.playState=this.playState.bind(this),this.onPlay=this.onPlay.bind(this),this.seekState=this.seekState.bind(this),this.timeupdate=this.timeupdate.bind(this),this.volumeState=this.volumeState.bind(this),this.onVolume=this.onVolume.bind(this),this.fullScreenState=this.fullScreenState.bind(this),this.eventsList=[],this.init()}return t.prototype.init=function(){this.initRootElement(),this.enablePlayButton===!0&&this.initPlayButton(),this.enableCurrentTime===!0&&this.initCurrentTime(),this.enableSeekBar===!0&&this.initSeekBar(),this.enableRemainingTime===!0&&this.initRemainingTime(),this.enableVolumeButton===!0&&this.initVolumeButton(),this.enableFullScreenButton===!0&&this.initFullScreenButton()},t.prototype.updateView=function(){this.mediaElement.parentElement&&this.mediaElement.parentElement.appendChild(this.rootElement)},t.prototype.stop=function(){this.flush()},t.prototype.flush=function(){this.removeEvents()},t.prototype.initRootElement=function(){this.rootElement=document.createElement("div"),this.initSuperPlayButton(),this.rootElement.classList.add("media_player_custom"),this.itemsElement=document.createElement("div"),this.itemsElement.classList.add("media_player_custom-items"),this.rootElement.appendChild(this.itemsElement),this.addDelayUnDisplay(),this.addEvent(this.mediaElement,"click",this.toggleControls),this.addEvent(this.mediaElement,"touchend",this.toggleControls),this.addEvent(this.mediaElement,"mousemove",this.showControls)},t.prototype.initSuperPlayButton=function(){this.superPlayButton=document.createElement("div"),this.rootElement.appendChild(this.superPlayButton),this.superPlayButton.classList.add("super-play_button-custom"),this.addEvent(this.superPlayButton,"click",this.playState),this.setIcon(this.superPlayButton,"play-bold-v4")},t.prototype.toggleControls=function(e){return e.preventDefault(),this.displayState===!1?void this.showControls(e):void this.hideControls()},t.prototype.showControls=function(e){this.addDelayUnDisplay(),this.rootElement.classList.remove("hide"),this.displayState=!0},t.prototype.hideControls=function(){this.rootElement.classList.add("hide"),this.displayState=!1},t.prototype.addDelayUnDisplay=function(){var e=this;clearTimeout(this.delayDisplayTimer),this.delayDisplayTimer=setTimeout(function(){e.hideControls()},4e3)},t.prototype.initPlayButton=function(){this.playButton=this.createItem(),this.playButton.classList.add("play_button-custom"),this.addEvent(this.playButton,"click",this.playState),this.addEvent(this.mediaElement,"play",this.onPlay),this.addEvent(this.mediaElement,"pause",this.onPlay),this.setIcon(this.playButton,"play-bold-v4"),this.setIcon(this.playButton,"pause")},t.prototype.playState=function(){return this.addDelayUnDisplay(),this.mediaElement.paused?void this.mediaElement.play():void this.mediaElement.pause()},t.prototype.onPlay=function(){return this.mediaElement.paused?(this.playButton.classList.remove("play-enbaled"),void this.superPlayButton.classList.remove("play-enbaled")):(this.playButton.classList.add("play-enbaled"),void this.superPlayButton.classList.add("play-enbaled"))},t.prototype.initCurrentTime=function(){this.currentTimeElement=this.createItem(),this.currentTimeElement.classList.add("current_time-custom"),this.currentTimeElement.classList.add("no-hover")},t.prototype.initSeekBar=function(){this.seekButton=this.createItem(),this.seekButton.classList.add("seek_button-custom"),this.seekButton.classList.add("no-hover"),this.seekButtonRange=document.createElement("input"),this.seekButton.appendChild(this.seekButtonRange),this.seekButtonRange.setAttribute("type","range"),this.seekButtonRange.setAttribute("step","0.1"),this.seekButtonRange.setAttribute("min","0"),this.seekButtonRange.setAttribute("max","100"),this.seekButtonRange.setAttribute("value","0"),this.addEvent(this.seekButtonRange,"touchstart",this.cancelBubble),this.addEvent(this.seekButtonRange,"mousemove",this.cancelBubble),this.seekButtonRange.onchange=this.seekState;try{this.seekButtonRange.oninput=this.seekState}catch(e){console.warn(e)}this.addEvent(this.mediaElement,"timeupdate",this.timeupdate)},t.prototype.initRemainingTime=function(){this.remainingTimeElement=this.createItem(),this.remainingTimeElement.classList.add("remaining_time-custom"),this.remainingTimeElement.classList.add("no-hover")},t.prototype.timeupdate=function(){var e=this.mediaElement.currentTime,t=this.mediaElement.duration-this.mediaElement.currentTime;this.seekButtonRange.value=(e/this.mediaElement.duration*100).toString(),this.onVolume(),this.currentTimeElement&&(this.currentTimeElement.innerHTML=this.getReadableTime(e)),this.remainingTimeElement&&(this.remainingTimeElement.innerHTML="-"+this.getReadableTime(t))},t.prototype.seekState=function(){this.addDelayUnDisplay();var e=parseFloat(this.seekButtonRange.value),t=e/100*this.mediaElement.duration;this.mediaElement.currentTime=t},t.prototype.initVolumeButton=function(){this.volumeButton=this.createItem(),this.volumeButton.classList.add("volume_button-custom"),this.addEvent(this.volumeButton,"click",this.volumeState),this.addEvent(this.mediaElement,"volumechange",this.onVolume),this.onVolume(),this.setIcon(this.volumeButton,"speaker-on"),this.setIcon(this.volumeButton,"speaker-off")},t.prototype.volumeState=function(){return this.addDelayUnDisplay(),0===this.mediaElement.volume||this.mediaElement.muted===!0?(this.mediaElement.muted=!1,void(this.mediaElement.volume=1)):(this.mediaElement.muted=!0,void(this.mediaElement.volume=0))},t.prototype.onVolume=function(){if(this.volumeButton){var e=this.volumeButton.classList.contains("volume-enbaled");return 0===this.mediaElement.volume||this.mediaElement.muted===!0?void(e===!0&&this.volumeButton.classList.remove("volume-enbaled")):void(e===!1&&this.volumeButton.classList.add("volume-enbaled"))}},t.prototype.initFullScreenButton=function(){this.fullscreenButton=this.createItem(),this.fullscreenButton.classList.add("fullscreen_button-custom"),this.addEvent(this.fullscreenButton,"click",this.fullScreenState),this.setIcon(this.fullscreenButton,"fullscreen-v4")},t.prototype.fullScreenState=function(){if(this.mediaElement.requestFullscreen)this.mediaElement.requestFullscreen();else if(this.mediaElement.mozRequestFullScreen)this.mediaElement.mozRequestFullScreen();else if(this.mediaElement.webkitRequestFullscreen)this.mediaElement.webkitRequestFullscreen();else if(this.mediaElement.webkitEnterFullscreen)try{this.mediaElement.webkitEnterFullscreen()}catch(e){}},t.prototype.createItem=function(){var e=document.createElement("div");return e.classList.add("media-item"),this.itemsElement.appendChild(e),e},t.prototype.setIcon=function(t,n){var i=document.createElement("div");e.Utils.svgIcon(i,{icon:n,color:null}),t.innerHTML+=i.innerHTML},t.prototype.getReadableTime=function(e){var t=[],n=parseInt(e.toString(),10),i=Math.floor(n/86400);n-=3600*i*24;var a=Math.floor(n/3600);n-=3600*a;var r=Math.floor(n/60);return n-=60*r,a&&t.push(a),t.push(r),t.push(this.padNumber(n,2)),t.join(":")},t.prototype.padNumber=function(e,t){var n="00"+e;return n.substr(n.length-t)},t.prototype.addEvent=function(e,t,n){this.eventsList.push({element:e,type:t,callBack:n}),e.addEventListener(t,n)},t.prototype.removeEvent=function(e,t,n){for(var i=0;i<this.eventsList.length;i++){var a=this.eventsList[i];if(e===a.element&&t===a.type&&n===a.callBack)return delete this.eventsList[i],this.eventsList.splice(i,1),e.removeEventListener(t,n),void this.removeEvent(e,t,n)}},t.prototype.removeEvents=function(){for(var e=0;e=this.eventsList.length;){var t=this.eventsList[e-1];this.removeEvent(t.element,t.type,t.callBack)}},t.prototype.cancelBubble=function(e){e.cancelBubble=!0},t}();i.MediaPlayer=a},{}],25:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./Shape"),r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t._name="rect",t}(a.Shape);n.Rect=r},{"./Shape":28}],26:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./Shape"),r=function(e){function t(t,n,i,a,r){var o=e.call(this,t,n,i,a,r)||this;return o.shapesManager=t,o.config=n,o.data=i,o.linksElem=a,o.coef=r,o.setRadius(),o}return i(t,e),t.prototype.setRadius=function(){var t=[],n=this.content.roundrect;"undefined"!=typeof n&&(t[0]=n.radius,t[1]=n.radius,t[2]=n.radius,t[3]=n.radius,e.prototype.setRadius.call(this,t))},t._name="roundrect",t}(a.Shape);n.RoundRect=r},{"./Shape":28}],27:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./Shape"),r=function(e){function t(t,n,i,a,r){var o=e.call(this,t,n,i,a,r)||this;return o.shapesManager=t,o.config=n,o.data=i,o.linksElem=a,o.coef=r,o.setRadius(),o}return i(t,e),t.prototype.setRadius=function(){var t=[],n=this.content.roundrectcomplex;"undefined"!=typeof n&&(t[0]=n.tl_radius,t[1]=n.tr_radius,t[2]=n.br_radius,t[3]=n.bl_radius,e.prototype.setRadius.call(this,t))},t._name="roundrectcomplex",t}(a.Shape);n.RoundRectComplex=r},{"./Shape":28}],28:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=e("./../../utils/enums"),a=e("../../utils/functions"),r=function(){function e(t,n,a,r,o,s){this.shapesManager=t,this.config=n,this.data=a,this.linksElem=r,this.coef=o,this.pageElement=s,this.className="",this.width=0,this.height=0,this.x=0,this.y=0,this.radius=[],this.status=i.ShapeActivityStatus.INIT,this.orientation="auto",this.isVisible=!1,this.Id=0,this.Id=e.globalID++,this.ePubPage=t.ePubPage,this.content=this.getDataContent(),this.className="epub-link-type_"+this.data.type,this.width=this.content.width,this.height=this.content.height,this.x=this.content.x,this.y=this.content.y,this.linkBlinkDuration=this.config.linkBlinkDuration,this.linkBoxAspect=this.config.linkBoxAspect,this.orientation=(this.data.orientation||this.orientation).toLowerCase(),this.setSizes(),this.initLinksBehaviors()}return e.prototype.setAnimationDuration=function(e,t){void 0===t&&(t="ms"),this.linksElem.style.webkitAnimationDuration=e+t,this.linksElem.style.animationDuration=e+t},e.prototype.initLinksBehaviors=function(){this.linkBoxAspect===i.LinksBehaviors["static"]&&this.linksElem.classList.add("webpub-viewer__link--focused")},e.prototype.setRadius=function(e,t){void 0===t&&(t="px"),0!==e.length&&(this.linksElem.style.webkitBorderRadius=e.join(t+" ")+t,this.linksElem.style.borderRadius=e.join(t+" ")+t)},e.prototype.setSizes=function(){var e=[this.coef,0,0,this.coef,this.x*this.coef,this.y*this.coef];this.linksElem.style.width=this.width+"px",this.linksElem.style.height=this.height+"px",a.styleTransform(this.linksElem,"matrix("+e.join(",")+")"),this.linksElem.classList.add(this.className)},e.prototype.getDataContent=function(){return this.data.content[0]},e.prototype.display=function(e){if(e===!0&&this.isVisible!==!0)return this.isVisible=!0,this.linksElem.classList.add("epub-link-visible"),void this.start();if(e===!0);else if(e===!1&&this.isVisible!==!1)return this.isVisible=!1,this.linksElem.classList.remove("epub-link-visible"),void this.stop()},e.prototype.start=function(){this.status=i.ShapeActivityStatus.START},e.prototype.stop=function(){this.status=i.ShapeActivityStatus.STOP},e.prototype.flush=function(){this.status=i.ShapeActivityStatus.FLUSH},e.prototype.getType=function(){return this.data.type},e._name="shape",e.globalID=0,e}();n.Shape=r},{"../../utils/functions":78,"./../../utils/enums":77}],29:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a=t("./../../utils/enums"),r=t("../../utils/functions"),o=t("./Rect"),s=t("./RoundRect"),l=t("./RoundRectComplex"),u=t("./Circle"),c=t("./Iframe"),p=t("./Video"),h=t("./Audio"),d=t("./Image"),f=t("../../EpubEvent"),m={Rect:o.Rect,RoundRect:s.RoundRect,RoundRectComplex:l.RoundRectComplex,Circle:u.Circle,Iframe:c.Iframe,Video:p.Video,Audio:h.Audio,Image:d.Image},g=function(){function t(t,n,i,a,r,o){this.link=t,this.config=n,this.data=i,this.pageElement=a,this.linksElem=r,this.coef=o,this.shapes=[],this.epubEvent=e.epubEvent,this.ePubPage=t.ePubPage,this.setShapes(),this.startShapes(),this.setEventOrientations()}return t.prototype.setShapes=function(){for(var e in m)m[e]._name===this.data.type&&this.shapes.push(new m[e](this,this.config,this.data,this.linksElem,this.coef,this.pageElement));0===this.shapes.length&&console.warn("Shape type not supported :"+this.data.type,this.data)},t.prototype.startShapes=function(){for(var e=0,t=this.shapes.length;e<t;e++)this.shapes[e].status!==a.ShapeActivityStatus.START&&this.shapes[e].start()},t.prototype.stopShapes=function(){for(var e=0,t=this.shapes.length;e<t;e++)this.shapes[e].status===a.ShapeActivityStatus.START&&this.shapes[e].stop()},t.prototype.setEventOrientations=function(){var e=this;this.epubEvent.addListener(f.EPUB_EVENTS.SCREEN_ORIENTATION,function(t){e.setOrientations(t.data.landscape)}),this.setOrientations(r.isWindowLandscape())},t.prototype.setOrientations=function(e){for(var t=0,n=this.shapes.length;t<n;t++)this.setOrientation(e,this.shapes[t])},t.prototype.setOrientation=function(e,t){return"auto"===t.orientation?void t.display(!0):"landscape"===t.orientation&&e===!0||"portrait"===t.orientation&&e===!1?void t.display(!0):void t.display(!1)},t.prototype.flushShapes=function(){for(var e=0,t=this.shapes.length;e<t;e++)this.shapes[e].flush()},t.prototype.start=function(){this.startShapes()},t.prototype.stop=function(){this.stopShapes()},t.prototype.flush=function(){this.flushShapes()},t.prototype.updateZoomIfIframe=function(e){this.shapes.filter(function(e){return c.Iframe._name===e.getType()}).forEach(function(t){return t.updateZoom(e)})},t._name="shapes",t}();i.ShapesManager=g},{"../../EpubEvent":8,"../../utils/functions":78,"./../../utils/enums":77,"./Audio":20,"./Circle":21,"./Iframe":22,"./Image":23,"./Rect":25,"./RoundRect":26,"./RoundRectComplex":27,"./Video":30}],30:[function(t,n,i){var a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(i,"__esModule",{value:!0});var r=t("./../../utils/enums"),o=t("./Shape"),s=t("./../../EpubGesturesEvent"),l=t("./MediaPlayer"),u=function(t){function n(n,i,a,r,o,s){var l=t.call(this,n,i,a,r,o)||this;return l.shapesManager=n,l.config=i,l.data=a,l.linksElem=r,l.coef=o,l.pageElement=s,l.url="",l.label="",l.contentTag="video",l._isPlaying=!1,l.enableDefaultControls=!1,l.userAgent=e.Param.userAgent,l.url=l.content[l.contentTag].url,l.label=l.content[l.contentTag].label,l.setInfoToPage(),l.setElement(),l}return a(n,t),n.prototype.setInfoToPage=function(){this.ePubPage.pageContainsCPUElement=!0},n.prototype.setElement=function(){var t=window.document.createElement("source");this.element=window.document.createElement("video"),this.element.className=this.className+"-video",this.enableDefaultControls?this.element.setAttribute("controls",""):this.mediaPlayer=new l.MediaPlayer(this.element),this.element.setAttribute("controlsList","nodownload"),this.element.setAttribute("data-label",this.label),this.userAgent.os.name===e.Param.userAgent.OS.IOS&&this.content.video.autoplay&&this.element.setAttribute("muted",""),t.src=this.url,this.element.appendChild(t),this.setPreventGestures(),this.linksElem.appendChild(this.element),this.mediaPlayer&&this.mediaPlayer.updateView(),e.Utils.addVideoStats(this.element),e.Param.userAgent.browser.name!==e.Param.userAgent.BROWSER.SAFARI||this.element.hasAttribute("autoplay")||(this.element.setAttribute("autoplay",""),this.element.dataset.ignoreAutoplay="true",this.element.pause())},n.prototype.setPreventGestures=function(){this.element.onvolumechange=this.makeDefaultPreventGesture.bind(this),this.element.onseeking=this.element.onvolumechange,this.element.onplay=this.onplay.bind(this),this.element.onpause=this.onpause.bind(this)},n.prototype.makeDefaultPreventGesture=function(){s["default"].prototype.preventAllGesture()},n.prototype.setAnimationDuration=function(e,t){void 0===t&&(t="ms")},n.prototype.initLinksBehaviors=function(){},n.prototype.setRadius=function(e,t){void 0===t&&(t="px")},n.prototype.setSizes=function(){this.linksElem.style.width=Math.round(this.width*this.coef)+"px",this.linksElem.style.height=Math.round(this.height*this.coef)+"px",this.linksElem.style.left=Math.round(this.x*this.coef)+"px",this.linksElem.style.top=Math.round(this.y*this.coef)+"px",this.linksElem.classList.add(this.className)},n.prototype.onplay=function(){this.makeDefaultPreventGesture(),this._isPlaying=!0,this.status!==r.ShapeActivityStatus.STOP&&this.status!==r.ShapeActivityStatus.FLUSH||this.element.pause()},n.prototype.onpause=function(){this.makeDefaultPreventGesture(),this._isPlaying=!1},n.prototype.start=function(){var e=this;this.isVisible!==!1&&(t.prototype.start.call(this),this.setInfoToPage(),this.content.video.autoplay&&this.element.paused&&this._isPlaying===!1&&(this.playPromise=this.element.play(),"object"==typeof this.playPromise&&this.playPromise.then&&this.playPromise.then(function(){})["catch"](function(){var t=e.element.play();t["catch"](function(){})})))},n.prototype.stop=function(){this.mediaPlayer&&this.mediaPlayer.stop(),this.element.paused===!1&&this._isPlaying===!0&&this.element.pause(),t.prototype.stop.call(this)},n.prototype.flush=function(){this.mediaPlayer&&this.mediaPlayer.flush(),t.prototype.flush.call(this)},n._name="video",n}(o.Shape);i.Video=u},{"./../../EpubGesturesEvent":10,"./../../utils/enums":77,"./MediaPlayer":24,"./Shape":28}],31:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a=t("../../../EpubEvent"),r=t("../../../utils/functions"),o="ontouchstart"in window,s=400,l=function(){function t(t,n,i,a,o){this.parent=t,this.config=n,this.element=i,this.linksElem=a,this.foreground=o,this.supportCreateMouseEvent=0,this.eventsListe=["mousemove","mousedown","mouseup","mouseover","mouseout"],this.eventsListeTouch=["touchmove","touchstart","touchend"],this.epubEvent=e.epubEvent,this.removableListeners=[];var s=r.getSplitedPromise();this.waitAction=s,s.resolve()}return t.prototype.init=function(e){try{document.createEvent("MouseEvents"),this.preventZoomInteraction=!1,this.supportCreateMouseEvent=1}catch(t){if("MouseEvent"in window==!1)return this.supportCreateMouseEvent=2,this.element.style.pointerEvents="all",this.linksElem.style.pointerEvents="none",void(this.preventZoomInteraction=!0)}this.iFrameContentWindow=e,this.simulateInteractions()},Object.defineProperty(t.prototype,"zoomSingleClick",{get:function(){return this.config.zoomSingleClick},enumerable:!0,configurable:!0}),t.prototype.createMouseEvent=function(e,t){var n,i=null,a=e.type;return"mouseover"!==a&&"mouseout"!==a||(i=t),1===this.supportCreateMouseEvent?(n=document.createEvent("MouseEvents"),n.initMouseEvent(a,!0,!0,this.iFrameContentWindow,0,e.offsetX,e.offsetY,e.offsetX,e.offsetY,!1,!1,!1,!1,0,i)):n=new MouseEvent(a,{bubbles:!0,cancelable:!0,view:this.iFrameContentWindow,screenX:e.offsetX,screenY:e.offsetY,clientX:e.offsetX,clientY:e.offsetY}),n},t.prototype.getCoordsTouches=function(e){var t=e.touches[0]||e;return this.getCoords(t)},t.prototype.getCoords=function(e){var t=e.currentTarget||e.target,n=t.getBoundingClientRect(),i=t.offsetWidth/n.width;return[(e.pageX-n.left)*i,(e.pageY-n.top)*i]},t.prototype.simulateEvt=function(e){var t=this;e.preventDefault();var n,i=this.canvasElement,l=e.type,u=0,c=0;switch(l){case"touchmove":l="mousemove";break;case"touchend":l="mouseup";break;case"touchstart":l="mousedown"}var p;if(o&&void 0!==e.touches?(p=this.getCoordsTouches(e),c=p[0],u=p[1]):(c=e.offsetX,u=e.offsetY,c||u||(p=this.getCoords(e),c=p[0],u=p[1])),n=this.createMouseEvent({type:l,offsetX:c,offsetY:u},i),this.canvasElement&&("mousemove"===l&&(this.canvasElement.style.cursor?document.body.style.cursor=this.canvasElement.style.cursor:document.body.style.cursor=""),"mouseout"===l&&(document.body.style.cursor="")),"mouseup"===l){var h=r.getSplitedPromise();this.waitAction=h.promise;var d=setTimeout(function(){h.resolve(),t.epubEvent.removeListener(a.EPUB_EVENTS.PAGE_CLICK,f)},s),f=function(){clearTimeout(d),t.epubEvent.removeListener(a.EPUB_EVENTS.PAGE_CLICK,f),i.dispatchEvent(n),n=t.createMouseEvent({type:"click",offsetX:c,offsetY:u},i),i.dispatchEvent(n),h.resolve()};return void this.epubEvent.addListener(a.EPUB_EVENTS.PAGE_CLICK,f)}i.dispatchEvent(n)},t.prototype.simulateInteractions=function(){
var e=this;if(this.canvasElement=this.iFrameContentWindow.document.querySelector("canvas"),this.canvasElement){this.linksElem.style.pointerEvents="all";var t=this.eventsListe;o&&(t=this.eventsListeTouch),t.forEach(function(t){e.removableListeners.push({type:t,action:function(t){e.waitAction.then(function(){e.simulateEvt(t)})}})}),this.removableListeners.forEach(function(t){e.linksElem.addEventListener(t.type,t.action)})}},t.prototype.removeEvents=function(){var e=this;this.removableListeners.forEach(function(t){e.linksElem.removeEventListener(t.type,t.action)}),this.removableListeners=[]},t.prototype.setPreventZoomInteraction=function(e){if(o&&this.preventZoomInteraction!==!1){var t=e.document;t.addEventListener("touchmove",function(e){var t=e;1!==t.scale&&e.preventDefault()},!1);var n=0;t.addEventListener("touchend",function(e){var t=Date.now();t-n<=300&&(e.preventDefault(),e.cancelBubble=!0,e.stopPropagation()),n=t},!0)}},t.prototype.flush=function(){this.removeEvents()},t}();i.IframeInteractions=l},{"../../../EpubEvent":8,"../../../utils/functions":78}],32:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./GotoPage"),r=e("../../EpubEvent"),o=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n._static=t,n}return i(t,e),t.prototype.exec=function(e,t){return this.epubEvent.fire({type:r.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(e){e.then(function(e){e!==!1&&NIApi.page.openFirst()})}}}),this.executedAction(arguments),!1},t._name="firstPage",t}(a.GotoPage);n.FirstPage=o},{"../../EpubEvent":8,"./GotoPage":33}],33:[function(t,n,i){var a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(i,"__esModule",{value:!0});var r=t("./UserAct"),o=t("../../EpubEvent"),s=function(t){function n(e,i,a){var r=t.call(this,e,i,a)||this;return r.data=e,r.linksElem=i,r.index=a,r.pointerEvents="all",r.pointerCursor="pointer",r._static=n,r.init(),r}return a(n,t),n.prototype.exec=function(e,t){return this.epubEvent.fire({type:o.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(t){t.then(function(t){t!==!1&&NIApi.page.open(parseInt(e.param||0))})}}}),this.executedAction(arguments),!1},n.prototype.setTooltip=function(){var n=this.data.param;if(void 0===n)return void t.prototype.setTooltip.call(this);""===n&&(n="1");var i=e.Main.xmlManager.get("locale","tooltip_"+this.data.type),a=parseInt(n,10),r=e.Main.xmlManager.get("common-configuration","config","shift"),o=a-r;i=i.concat(" ",o.toString()),t.prototype.setTooltip.call(this,i)},n._name="gotoPage",n}(r.UserAct);i.GotoPage=s},{"../../EpubEvent":8,"./UserAct":44}],34:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./UserAct"),r=e("../../EpubEvent"),o=function(e){function t(n,i,a){var r=e.call(this,n,i,a)||this;return r.data=n,r.linksElem=i,r.index=a,r.pointerEvents="all",r.pointerCursor="pointer",r._static=t,r.init(),r}return i(t,e),t.prototype.exec=function(e,t){var n=this;return this.epubEvent.fire({type:r.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(t){t.then(function(t){if(t!==!1)return"fwd"===e.param?void n.historyFwd():void n.historyBack()})}}}),this.executedAction(arguments),!1},t.prototype.historyBack=function(){window.history.back()},t.prototype.historyFwd=function(){window.history.forward()},t._name="history",t}(a.UserAct);n.History=o},{"../../EpubEvent":8,"./UserAct":44}],35:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./UserAct"),r=e("../../EpubEvent"),o=function(e){function t(n,i,a){var r=e.call(this,n,i,a)||this;return r.data=n,r.linksElem=i,r.index=a,r.pointerEvents="all",r.pointerCursor="pointer",r._static=t,r.init(),r}return i(t,e),t.prototype.exec=function(e,t){var n=this;return this.epubEvent.fire({type:r.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(t){t.then(function(t){if(t!==!1)try{new Function("linkData","linkElement",e.param)(e,n.linksElem)}catch(t){console.warn(t)}})}}}),this.executedAction(arguments),!1},t._name="javascript",t}(a.UserAct);n.JavaScriptCall=o},{"../../EpubEvent":8,"./UserAct":44}],36:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./GotoPage"),r=e("../../EpubEvent"),o=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n._static=t,n}return i(t,e),t.prototype.exec=function(e,t){return this.epubEvent.fire({type:r.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(e){e.then(function(e){e!==!1&&NIApi.page.openLast()})}}}),this.executedAction(arguments),!1},t._name="lastPage",t}(a.GotoPage);n.LastPage=o},{"../../EpubEvent":8,"./GotoPage":33}],37:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./UserAct"),r=e("../../EpubEvent"),o=function(e){function t(n,i,a){var r=e.call(this,n,i,a)||this;return r.data=n,r.linksElem=i,r.index=a,r.pointerEvents="all",r.pointerCursor="pointer",r._static=t,r.init(),r}return i(t,e),t.prototype.exec=function(e,t){return this.epubEvent.fire({type:r.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(t){t.then(function(t){t!==!1&&NIApi.lightbox.openPopup(null,e)})}}}),this.executedAction(arguments),!1},t._name="lightbox",t}(a.UserAct);n.LightBox=o},{"../../EpubEvent":8,"./UserAct":44}],38:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./UserAct"),r=e("../../EpubEvent"),o=function(e){function t(n,i,a){var r=e.call(this,n,i,a)||this;return r.data=n,r.linksElem=i,r.index=a,r.pointerEvents="all",r.pointerCursor="pointer",r._static=t,r.init(),r}return i(t,e),t.prototype.mailTo=function(e){var t=e.trim(),n="mailto:",i=t.match(/^mailto:|^mailto :/gi);null!==i&&0!==i.length&&(n=""),window.location.href=n+t},t.prototype.exec=function(e,t){var n=this;return this.epubEvent.fire({type:r.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(t){t.then(function(t){t!==!1&&n.mailTo(e.param)})}}}),this.executedAction(arguments),!1},t._name="mailto",t}(a.UserAct);n.MailTo=o},{"../../EpubEvent":8,"./UserAct":44}],39:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./GotoPage"),r=e("../../EpubEvent"),o=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n._static=t,n}return i(t,e),t.prototype.exec=function(e,t){return this.epubEvent.fire({type:r.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(e){e.then(function(e){e!==!1&&NIApi.page.openNext()})}}}),this.executedAction(arguments),!1},t._name="nextPage",t}(a.GotoPage);n.NextPage=o},{"../../EpubEvent":8,"./GotoPage":33}],40:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./UserAct"),r=e("../../EpubEvent"),o=function(e){function t(n,i,a){var r=e.call(this,n,i,a)||this;return r.data=n,r.linksElem=i,r.index=a,r.pointerEvents="all",r.pointerCursor="pointer",r._static=t,r.init(),r}return i(t,e),t.prototype.exec=function(e,t){var n=this;return this.epubEvent.fire({type:r.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(t){t.then(function(t){t!==!1&&(NIApi.navigator.openUrl(e.param),n.successAction(e))})}}}),this.executedAction(arguments),!1},t._name="url",t}(a.UserAct);n.OpenUrl=o},{"../../EpubEvent":8,"./UserAct":44}],41:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./LightBox"),r=e("../../EpubEvent"),o=function(e){function t(n,i,a){var r=e.call(this,n,i,a)||this;return r.data=n,r.linksElem=i,r.index=a,r.pointerEvents="all",r.pointerCursor="pointer",r._static=t,r.init(),r}return i(t,e),t.prototype.exec=function(e,t){return this.epubEvent.fire({type:r.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(t){t.then(function(t){t!==!1&&NIApi.lightbox.openPopup(null,e)})}}}),this.executedAction(arguments),!1},t._name="popup",t}(a.LightBox);n.PopUp=o},{"../../EpubEvent":8,"./LightBox":37}],42:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./GotoPage"),r=e("../../EpubEvent"),o=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.pointerEvents="all",n.pointerCursor="pointer",n._static=t,n}return i(t,e),t.prototype.exec=function(e,t){return this.epubEvent.fire({type:r.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(e){e.then(function(e){e!==!1&&NIApi.page.openPrevious()})}}}),this.executedAction(arguments),!1},t._name="prevPage",t}(a.GotoPage);n.PrevPage=o},{"../../EpubEvent":8,"./GotoPage":33}],43:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./UserAct"),r=e("../../EpubEvent"),o=function(e){function t(n,i,a){var r=e.call(this,n,i,a)||this;return r.data=n,r.linksElem=i,r.index=a,r.pointerEvents="all",r.pointerCursor="pointer",r._static=t,r.init(),r}return i(t,e),t.prototype.mailTo=function(e){var t=e.trim(),n="tel:",i=t.match(/^tel:|^tel :/gi);null!==i&&0!==i.length&&(n=""),window.location.href=n+t},t.prototype.exec=function(e,t){var n=this;return this.epubEvent.fire({type:r.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(t){t.then(function(t){t!==!1&&n.mailTo(e.param)})}}}),this.executedAction(arguments),!1},t._name="tel",t}(a.UserAct);n.Tel=o},{"../../EpubEvent":8,"./UserAct":44}],44:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a=t("../../EpubDomApi"),r=t("../../EpubEvent"),o=function(){function t(n,i,a){this.data=n,this.linksElem=i,this.index=a,this.pointerEvents="none",this.pointerCursor="auto",this._static=t,this.overrideOtherActions=!0,this.epubEvent=e.epubEvent}return t.prototype.init=function(){this.defineAction(),this.setPointers(),this.setTooltip()},t.prototype.defineAction=function(){0===this.index&&this.setActionDefault()},t.prototype.setTooltip=function(t){void 0===t&&(t=""),"string"==typeof this.data.textField&&""!==this.data.textField.trim()&&(t=this.data.textField),""===t&&(t=e.Main.xmlManager.get("locale","tooltip_"+this.data.type)),this.linksElem.setAttribute("data-tooltip",t||""),e.Main.tooltipManager.register(this.linksElem)},t.prototype.setPointers=function(){this.linksElem.style.pointerEvents=this.pointerEvents,this.linksElem.style.cursor=this.pointerCursor},t.prototype.exec=function(e,t){return a["default"](this._static._name,[t,e.param,e]),this.executedAction(arguments),!1},t.prototype.executedAction=function(e){console.log("From LinksManager this action was exectuted",e)},t.prototype.setActionDefault=function(){var e=this.exec.bind(this,this.data,this.linksElem);this.linksElem.onclick=e,this.linksElem.ontouchend=e},t.prototype.successAction=function(e){this.epubEvent.fire({type:r.EPUB_EVENTS.ACTION_LINK_SUCCESS,data:{userAct:e}})},t._name="userAct",t}();i.UserAct=o},{"../../EpubDomApi":7,"../../EpubEvent":8}],45:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=e("./MailTo"),a=e("./Tel"),r=e("./OpenUrl"),o=e("./GotoPage"),s=e("./PrevPage"),l=e("./NextPage"),u=e("./PopUp"),c=e("./LightBox"),p=e("./Youtube"),h=e("./LastPage"),d=e("./FirstPage"),f=e("./JavaScriptCall"),m=e("./History"),g={MailTo:i.MailTo,Tel:a.Tel,OpenUrl:r.OpenUrl,GotoPage:o.GotoPage,PrevPage:s.PrevPage,NextPage:l.NextPage,LastPage:h.LastPage,FirstPage:d.FirstPage,PopUp:u.PopUp,LightBox:c.LightBox,Youtube:p.Youtube,JavaScriptCall:f.JavaScriptCall,History:m.History},v=function(){function e(e,t,n,i){this.link=e,this.config=t,this.data=n,this.linksElem=i,this.userActs=[],this.setUserActs()}return e.prototype.makeActionFromUserAct=function(e,t){var n=[];for(var i in g)g[i]._name===e.type&&n.push(new g[i](e,this.linksElem,t));return n},e.prototype.setUserActs=function(){for(var e,t=0,n=this.data.length;t<n;t++)e=this.makeActionFromUserAct(this.data[t],t),0===e.length&&console.warn("useract type not supported :"+this.data[t].type,this.data[t]),this.userActs=this.userActs.concat(e)},e.prototype.stop=function(){},e.prototype.flush=function(){},e._name="userActs",e}();n.UserActs=v},{"./FirstPage":32,"./GotoPage":33,"./History":34,"./JavaScriptCall":35,"./LastPage":36,"./LightBox":37,"./MailTo":38,"./NextPage":39,"./OpenUrl":40,"./PopUp":41,"./PrevPage":42,"./Tel":43,"./Youtube":46}],46:[function(e,t,n){var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./LightBox"),r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t._name="youtube",t}(a.LightBox);n.Youtube=r},{"./LightBox":37}],47:[function(t,n,i){var a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,r){function o(e){try{l(i.next(e))}catch(t){r(t)}}function s(e){try{l(i["throw"](e))}catch(t){r(t)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,r&&(o=2&n[0]?r["return"]:n[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,r=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(i){n=[6,i],r=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,r,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(i,"__esModule",{value:!0});var o,s=t("./EpubGesturesEvent"),l=t("./EpubPageEnrichment/IFrames"),u=t("./EpubPageEnrichment/Copyables"),c=t("./EpubPageEnrichment/Medias"),p=t("./EpubPageEnrichment/Sliders"),h=t("./EpubEvent"),d=t("./utils/isElementVisible"),f=t("./utils/ScrollUtil");!function(e){e.Scroll="SCROLL"}(o||(o={}));var m="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",g=0,v=100,b=function(){function t(t,n,i){this.epubPage=t,this.config=n,this.element=i,this.eventListeners=[],this.enableRegisterInteractiveHandlers=!1,this.started=!1,this.pendingAnimationMap={},this.setTimeoutIds=[],this.delayedAnimations=[],this.copyables=[],this.buttonTouchPosition={startX:-1,startY:-1,moveX:-1,moveY:-1},this.epubAnimationsHistory=[],this.epubPageEnrichmentID=g++,this.launchVisibleAnimations=this.launchVisibleAnimations.bind(this),this.onScroll=this.onScroll.bind(this),e.epubAnimUtils={goToState:this.goToState.bind(this)}}return Object.defineProperty(t.prototype,"isCrossNavPage",{get:function(){return this.config.isCrossNavPage(this.epubPage.pageNumber)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAnimationTriggeredByScroll",{get:function(){var e=this.config.isVerticalOnePage;return this.isCrossNavPage||e},enumerable:!0,configurable:!0}),t.getActionHistoryTemplate=function(){return{func:null,args:[]}},t.prototype.start=function(){if(!this.started&&0!==this.element.childNodes.length){this.started=!0,this.startGifs();var e=this.element.childNodes[0],t=e.getAttribute("data-onload");if(null!==t&&t.indexOf("RegisterInteractiveHandlers")===-1)return void(this.enableRegisterInteractiveHandlers=!1);this.enableRegisterInteractiveHandlers=!0,this.registerInteractiveHandlers()}},t.prototype.stop=function(){this.clearEnrichmentTimeouts(),this.started!==!1&&(this.started=!1,this.stopGifs(),this.enableRegisterInteractiveHandlers!==!1&&(this.stopMedias(),this.removeEventListeners(),this.reloadActionHistory(),this.stopIFrames(),this.stopSliders(),this.stopCopyables()))},t.prototype.flush=function(){this.stop(),this.gifs=null},t.prototype.updateIframesZoom=function(e){this.iFramesObject&&this.iFramesObject.updateZoom(e)},t.prototype.makeDefaultPreventGesture=function(){s["default"].prototype.preventAllGesture()},t.prototype.clearEnrichmentTimeouts=function(){for(var e=0;e<this.setTimeoutIds.length;e++){var t=this.setTimeoutIds[e];clearTimeout(t)}this.setTimeoutIds=[],clearTimeout(this.crossnavAnimationTimer)},t.prototype.evalActions=function(e,t){new Function("_self","selfContainerID","with(_self){ "+e+" }")(this,t)},t.prototype.removeEventListeners=function(){for(var e=0,t=this.eventListeners.length;e<t;e++)this.eventListeners[e].element.removeEventListener(this.eventListeners[e].type,this.eventListeners[e].func,this.eventListeners[e].useCapture);this.eventListeners=[]},t.prototype.addToEventListeners=function(e,t,n,i){void 0===i&&(i=!1),e.addEventListener(n,t,i),this.eventListeners.push({element:e,type:n,func:t,useCapture:i})},t.prototype.reloadActionHistory=function(){for(var e=this.epubAnimationsHistory.length;e--;)this.epubAnimationsHistory[e].func(this.epubAnimationsHistory[e].args[0],this.epubAnimationsHistory[e].args[1]);this.epubAnimationsHistory=[]},t.prototype.registerInteractiveHandlers=function(){var e=this;this.registerButtonEventHandlers(),this.processAnimations(),this.processMediaGesture(),this.processIFrames(),this.processSliders(),this.processCopyables(),this.crossnavAnimationTimer=setTimeout(function(){if(e.isAnimationTriggeredByScroll){var t=e.isCrossNavPage?".webpub-viewer__epub-container-spread":".webpub-viewer__epub-container";e.scrollableParent=e.element.closest(t),e.registerPublicationEventHandlers(),e.launchVisibleAnimations()}},200)},t.prototype.processMediaGesture=function(){this.medias=this.element.querySelectorAll("video,audio"),0!==this.medias.length&&(this.mediasObject=new c.Medias(this.medias,this.config),this.mediasObject.start())},t.prototype.processIFrames=function(){this.iFrames=this.element.querySelectorAll("iframe"),0!==this.iFrames.length&&(this.iFramesObject=new l.IFrames(this.iFrames,this.config),this.iFramesObject.start())},t.prototype.processSliders=function(){if(this.sliders=this.element.querySelectorAll("[class*="+p.SLIDER_CLASSNAME+']:not([data-hidden="true"])'),0!==this.sliders.length){var t=e.Main.configsJsonManager.getPagesData(["sliders"]),n=t[this.epubPage.pageNumber-1];n&&n.sliders&&(this.slidersObject=new p.Sliders(this.sliders,n.sliders,this.epubPage.pageNumber))}},t.prototype.processCopyables=function(){e.Main.startupManager.get("core.copyableTexts")&&(this.copyables=u.getCopyableElements(this.element),this.copyablesObject=new u.Copyables(this.copyables),this.copyablesObject.start())},t.prototype.startGifs=function(){var e=this;this.gifs=this.gifs||this.element.querySelectorAll("img[src$='.gif']");for(var t=0,n=this.gifs.length;t<n;t++){var i=this.gifs[t];null===i.getAttribute("data-src")&&i.setAttribute("data-src",i.getAttribute("src")),i.src=m,function(t){e.createEnrichmentTimeout(function(){t.src=t.getAttribute("data-src")},0)}(i)}},t.prototype.createEnrichmentTimeout=function(e,t){var n=setTimeout(e,t);return this.setTimeoutIds.push(n),n},t.prototype.stopGifs=function(){this.gifs=this.gifs||this.element.querySelectorAll("img[src$='.gif']");for(var e=0,t=this.gifs.length;e<t;e++){var n=this.gifs[e];null===n.getAttribute("data-src")&&n.setAttribute("data-src",n.getAttribute("src")),n.src=m}},t.prototype.stopIFrames=function(){this.iFramesObject&&this.iFramesObject.stop()},t.prototype.stopMedias=function(){this.mediasObject&&this.mediasObject.stop()},t.prototype.stopSliders=function(){this.slidersObject&&this.slidersObject.stop()},t.prototype.stopCopyables=function(){this.copyablesObject&&this.copyablesObject.stop()},t.prototype.getCSSClass=function(e){return e.getAttribute&&e.getAttribute("class")?e.getAttribute("class"):""},t.prototype.processAnimations=function(){var e=this.element.querySelectorAll("._idGenAnimation");e.length>0&&(this.epubPage.pageContainsCPUElement=!0);for(var t,n,i,a=0;a<e.length;a++)t=e[a].getAttribute("data-animationOnPageLoadActions"),t&&(n=e[a],this.isAnimationTriggeredByScroll?this.delayedAnimations.push({element:n,actions:t,trigger:{type:o.Scroll}}):this.evalActions(t,n)),i=this.getCSSClass(e[a]),i.indexOf("_idGenCurrentState")!=-1&&(t=e[a].getAttribute("data-animationOnStateLoadActions"),t&&(n=e[a],this.evalActions(t,n))),t=e[a].getAttribute("data-animationOnSelfClickActions"),t&&(this.addToEventListeners(e[a],this.onTouchEndForAnimations.bind(this,e[a]),"touchend",!1),this.addToEventListeners(e[a],this.onMouseUpForAnimations.bind(this,e[a]),"mouseup",!1)),t=e[a].getAttribute("data-animationOnSelfRolloverActions"),t&&this.addToEventListeners(e[a],this.onMouseOverForAnimations.bind(this,e[a]),"mouseover",!1);this.addToEventListeners(this.element,this.onPageTouchEndForAnimations.bind(this,this.element),"touchend",!1),this.addToEventListeners(this.element,this.onPageMouseUpForAnimations.bind(this,this.element),"mouseup",!1)},t.prototype.onPageTouchEndForAnimations=function(e,t){for(var n,i,a=this.element.querySelectorAll("._idGenAnimation"),r=0;r<a.length;r++)n=a[r].getAttribute("data-animationOnPageClickActions"),n&&(i=a[r],this.evalActions(n,i))},t.prototype.onPageMouseUpForAnimations=function(e,t){for(var n,i,a=this.element.querySelectorAll("._idGenAnimation"),r=0;r<a.length;r++)n=a[r].getAttribute("data-animationOnPageClickActions"),n&&(i=a[r],this.evalActions(n,i))},t.prototype.onTouchEndForAnimations=function(e,t){t.preventDefault();for(var n,i,a="."+e.getAttribute("data-animationObjectType"),r=this.element.querySelectorAll(a),o=0;o<r.length;o++)n=r[o].getAttribute("data-animationOnSelfClickActions"),n&&(i=r[o],this.evalActions(n,i))},t.prototype.onMouseUpForAnimations=function(e,t){for(var n,i,a="."+e.getAttribute("data-animationObjectType"),r=this.element.querySelectorAll(a),o=0;o<r.length;o++)n=r[o].getAttribute("data-animationOnSelfClickActions"),n&&(i=r[o],this.evalActions(n,i))},t.prototype.onMouseOverForAnimations=function(e,t){var n=e.getAttribute("data-idGenAnimationClass"),i=this.getCSSClass(e);if(null===n||i.indexOf(n)==-1)for(var a,r,o="."+e.getAttribute("data-animationObjectType"),s=this.element.querySelectorAll(o),l=0;l<s.length;l++)a=s[l].getAttribute("data-animationOnSelfRolloverActions"),a&&(r=s[l],this.evalActions(a,r))},t.prototype.registerButtonEventHandlers=function(){for(var e=this.element.querySelectorAll("._idGenButton"),t=0;t<e.length;t++)this.addToEventListeners(e[t],this.onTouchStart.bind(this,e[t]),"touchstart",!1),this.addToEventListeners(e[t],this.onTouchMove.bind(this,e[t]),"touchmove",!1),this.addToEventListeners(e[t],this.onTouchEnd.bind(this,e[t]),"touchend",!1),this.addToEventListeners(e[t],this.onClick.bind(this,e[t]),"click",!1),this.addToEventListeners(e[t],this.onMouseUp.bind(this,e[t]),"mouseup",!1),this.addToEventListeners(e[t],this.onMouseOver.bind(this,e[t]),"mouseover",!1),this.addToEventListeners(e[t],this.onMouseOut.bind(this,e[t]),"mouseout",!1)},t.prototype.onScroll=function(){var e=this.verticalScrollUtil.isScrollDown();this.launchVisibleAnimations(e)},t.prototype.registerPublicationEventHandlers=function(){this.verticalScrollUtil=new f["default"](this.scrollableParent);var t=100;this.scrollableParent.addEventListener("scroll",e.Utils.throttle(this.onScroll,t))},t.prototype.launchVisibleAnimations=function(e){void 0===e&&(e=!0);for(var t={top:this.config.paddingTop,bottom:this.config.paddingBottom},n=d.isElementVisible(this.epubPage.element,d.ElementVisibleMode.BOTTOM,t),i=0;i<this.delayedAnimations.length;i++){var a=this.delayedAnimations[i],r=e?d.ElementVisibleMode.TOP:d.ElementVisibleMode.BOTTOM,o=d.isElementVisible(a.element,r,t);(o||n)&&(this.evalActions(a.actions,a.element),this.delayedAnimations.splice(i,1),i--)}},t.prototype.hasAppearance=function(e,t){for(var n,i=e.children,a=0;a<i.length;a++)if(n=this.getCSSClass(i[a]),n.indexOf(t)!=-1)return!0;return!1},t.prototype.isDescendantOf=function(e,t){for(var n=e;n;){if(n==t)return!0;n=n.parentNode}return!1},t.prototype.addClass=function(e,n){if(null!==n&&e.classList.contains(n)!==!0){var i=t.getActionHistoryTemplate();i.func=this.removeClass.bind(this),i.args.push(e),i.args.push(n),this.epubAnimationsHistory.push(i),e.classList.add(n)}},t.prototype.removeClass=function(e,n){if(null!==n&&e.classList.contains(n)!==!1){var i=t.getActionHistoryTemplate();i.func=this.addClass.bind(this),i.args.push(e),i.args.push(n),this.epubAnimationsHistory.push(i),e.classList.remove(n)}},t.prototype.onClick=function(e,t){this.hasAppearance(e,"_idGen-Appearance-Click")&&this.addClass(e,"_idGenStateClick");var n=e.getAttribute("data-clickactions");n&&this.evalActions(n,null)},t.prototype.onMouseUp=function(e,t){this.removeClass(e,"_idGenStateClick");var n=e.getAttribute("data-releaseactions");n&&this.evalActions(n,null)},t.prototype.onMouseOver=function(e,t){if(!t.relatedTarget||!this.isDescendantOf(t.relatedTarget,e)){this.hasAppearance(e,"_idGen-Appearance-Rollover")&&this.addClass(e,"_idGenStateHover");var n=e.getAttribute("data-rolloveractions");n&&this.evalActions(n,null)}},t.prototype.onMouseOut=function(e,t){if(!t.relatedTarget||!this.isDescendantOf(t.relatedTarget,e)){this.removeClass(e,"_idGenStateHover"),this.removeClass(e,"_idGenStateClick");var n=e.getAttribute("data-rolloffactions");n&&this.evalActions(n,null)}},t.prototype.onTouchStart=function(e,t){this.setButtonTouchStartPosition(t.touches[0].clientX,t.touches[0].clientY),this.hasAppearance(e,"_idGen-Appearance-Click")&&this.addClass(e,"_idGenStateClick");var n=e.getAttribute("data-clickactions");n&&this.evalActions(n,null)},t.prototype.setButtonTouchStartPosition=function(e,t){this.buttonTouchPosition.startX=e,this.buttonTouchPosition.startY=t,this.buttonTouchPosition.moveX=-1,this.buttonTouchPosition.moveY=-1},t.prototype.onTouchMove=function(e,t){this.buttonTouchPosition.moveX=t.touches[0].clientX,this.buttonTouchPosition.moveY=t.touches[0].clientY},t.prototype.onTouchEnd=function(e,t){if(t.preventDefault(),!this.shouldCancelButtonTap()){this.removeClass(e,"_idGenStateClick");var n=e.getAttribute("data-releaseactions");n&&this.evalActions(n,null)}},t.prototype.shouldCancelButtonTap=function(){var e=this.buttonTouchPosition.moveX!==-1&&this.buttonTouchPosition.moveY!==-1,t=Math.abs(this.buttonTouchPosition.startX-this.buttonTouchPosition.moveX)>20,n=Math.abs(this.buttonTouchPosition.startY-this.buttonTouchPosition.moveY)>20,i=t||n;return!(!e||!i)},t.prototype.onHide=function(e){var t=this.element.querySelector("#"+e);null!==t&&(this.handleMSOStateParentOfObject(t),this.addClass(t,"_idGenStateHide"))},t.prototype.onShow=function(e){var t=this.element.querySelector("#"+e);null!==t&&(this.handleMSOStateParentOfObject(t),this.removeClass(t,"_idGenStateHide"))},t.prototype.handleMSOStateParentOfObject=function(e){for(var t,n,i=e,a=i.parentNode;null!==a&&!t;)n=this.getCSSClass(a),n&&n.indexOf("_idGenMSO")!=-1?t=!0:i=a,a=i.parentNode;if(t)for(var r=i,o=a.children,s=0,l=void 0;l=o[s];s++){var u=this.getCSSClass(l).indexOf("_idGenCurrentState")!=-1;if(u&&l!==r)return this.handleMediaInMSOState(l,!1),this.removeClass(l,"_idGenCurrentState"),this.addClass(l,"_idGenStateHide"),this.handleMediaInMSOState(r,!0),this.removeClass(r,"_idGenStateHide"),void this.addClass(r,"_idGenCurrentState")}},t.prototype.goToDestination=function(e){this.callIfClickAuthorized(this.getActionFunction(e))},t.prototype.getActionFunction=function(e){if(e=e.trim(),0===e.indexOf("http"))return this.getEpubDomApiFunction("url",e);if(0===e.indexOf("javascript")||0===e.indexOf("js:")||0===e.indexOf("js :"))return this.getEpubDomApiFunction("javascript",e);if(0===e.indexOf("NIApi"))return this.getEpubDomApiFunction("NIApi",e);
var t=/-([0-9]*).xhtml$/gim,n=t.exec(e)||[];return n.length>0?this.getEpubDomApiFunction("gotoPage",~~n[1]):function(){return null}},t.prototype.getEpubDomApiFunction=function(e,t){return function(){return webpublicationNamespace.EpubDomApi(e,[null,t])}},t.prototype.callIfClickAuthorized=function(t){var n=this;e.epubEvent.fire({type:h.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:!0,action:function(e){return a(n,void 0,void 0,function(){var n;return r(this,function(i){switch(i.label){case 0:return[4,e];case 1:return n=i.sent(),n&&t(),[2]}})})}}})},t.prototype.handleMediaInMSOState=function(e,t){for(var n,i,a=e.getElementsByTagName("*"),r=0;r<a.length;r++)n=a[r],i=n.tagName.toLowerCase(),"video"!=i&&"audio"!=i||(t?n.play():n.pause())},t.prototype.handleAnimationInMSOState=function(e){var t,n,i,a,r=this.getCSSClass(e);r.indexOf("_idGenAnimation")!=-1&&(t=e.getAttribute("data-idGenAnimationStartState"),n=e.getAttribute("data-idGenAnimationEndState"),this.removeClass(e,n),this.addClass(e,t),i=e.getAttribute("data-animationOnStateLoadActions"),i&&(a=e.id,this.evalActions(i,a)));for(var o,s=e.getElementsByTagName("*"),l=0;l<s.length;l++)o=s[l],r=this.getCSSClass(o),r.indexOf("_idGenAnimation")!=-1&&(t=e.getAttribute("data-idGenAnimationStartState"),n=e.getAttribute("data-idGenAnimationEndState"),this.removeClass(e,n),this.addClass(e,t),i=o.getAttribute("data-animationOnStateLoadActions"),i&&(a=o.id,this.evalActions(i,a)))},t.prototype.goToNextState=function(e,t,n){var i=this;this.makeDefaultPreventGesture(),this.createEnrichmentTimeout(function(){i.goToNextStateWrapper(e,t)},1e3*n)},t.prototype.goToNextStateWrapper=function(e,t){var n,i,a,r=this.element.querySelector("#"+e);if(null!==r){this.removeClass(r,"_idGenStateHide"),n=r.children;for(var o=0,s=void 0;s=n[o];o++)if(i=this.getCSSClass(s),i.indexOf("_idGenCurrentState")!=-1)return a=t?o==n.length-1?n[0]:n[o+1]:o==n.length-1?n[o]:n[o+1],this.handleMediaInMSOState(s,!1),this.removeClass(s,"_idGenCurrentState"),this.addClass(s,"_idGenStateHide"),this.handleMediaInMSOState(a,!0),this.removeClass(a,"_idGenStateHide"),this.addClass(a,"_idGenCurrentState"),void this.handleAnimationInMSOState(a)}},t.prototype.goToPreviousState=function(e,t,n){var i=this;this.makeDefaultPreventGesture(),this.createEnrichmentTimeout(function(){i.goToPreviousStateWrapper(e,t)},1e3*n)},t.prototype.goToPreviousStateWrapper=function(e,t){var n,i,a,r=document.getElementById(e);if(r){this.removeClass(r,"_idGenStateHide"),n=r.children;for(var o=0,s=void 0;s=n[o];o++)if(i=this.getCSSClass(s),i.indexOf("_idGenCurrentState")!=-1)return a=t?0==o?n[n.length-1]:n[o-1]:0==o?n[0]:n[o-1],this.handleMediaInMSOState(s,!1),this.removeClass(s,"_idGenCurrentState"),this.addClass(s,"_idGenStateHide"),this.handleMediaInMSOState(a,!0),this.removeClass(a,"_idGenStateHide"),this.addClass(a,"_idGenCurrentState"),void this.handleAnimationInMSOState(a)}},t.prototype.playAnimation=function(e,t,n,i){this.addAnimationToAnimationMap(!1,e,t,n,i)},t.prototype.reverseAnimation=function(e,t,n){this.addAnimationToAnimationMap(!0,e,t,n,"")},t.prototype.pauseAnimation=function(e,t){var n=this.getIdByAnimationId(e),i=this.pendingAnimationMap[n];if(i){for(var a=0;a<i.length;a++)clearTimeout(i[a]);delete this.pendingAnimationMap[n]}},t.prototype.goToState=function(e,t,n,i){var a=this,r=document.querySelectorAll("#"+e);Array.from(r).forEach(function(e){for(var n=e.children,i=0;i<n.length;i++){var r=n[i],o=r.getAttribute("data-idgenobjectstate");o===t?(a.handleMediaInMSOState(r,!0),a.removeClass(r,"_idGenStateHide"),a.addClass(r,"_idGenCurrentState"),a.handleAnimationInMSOState(r)):(a.handleMediaInMSOState(r,!1),a.removeClass(r,"_idGenCurrentState"),a.addClass(r,"_idGenStateHide"))}})},t.prototype.addAnimationToAnimationMap=function(e,t,n,i,a){var r=this,o=this.getIdByAnimationId(t),s=this.createEnrichmentTimeout(function(){var l=r.pendingAnimationMap[o].indexOf(s);r.pendingAnimationMap[o].splice(l,1),r.executeAnimation(e,t,n,i,a)},v);this.pendingAnimationMap[o]=this.pendingAnimationMap[o]||[],this.pendingAnimationMap[o].push(s)},t.prototype.getElementByAnimationId=function(e){return"object"==typeof e?e:this.element.querySelector("#"+e)},t.prototype.getIdByAnimationId=function(e){return"object"==typeof e?e.id:e},t.prototype.animateElement=function(e,t,n,i){var a=this;this.removeClass(t,"_idGenStateHide"),this.removeClass(t,"_idGenPauseAnimation");var r=this.getCSSClass(t),o=t.getAttribute("data-idGenAnimationClass");r.indexOf(n)==-1&&r.indexOf(o)==-1?(this.addClass(t,n),t.setAttribute("data-idGenAnimationClass",n)):(this.removeClass(t,n),this.removeClass(t,o),t.removeEventListener("webkitAnimationEnd",function(n){a.onAnimationEnd(e,t,i,n)}),t.removeEventListener("animationend",function(n){a.onAnimationEnd(e,t,i,n)}),setTimeout(function(){a.addClass(t,n)},10),t.setAttribute("data-idGenAnimationClass",n)),this.addToEventListeners(t,this.onAnimationEnd.bind(this,e,t,i),"webkitAnimationEnd"),this.addToEventListeners(t,this.onAnimationEnd.bind(this,e,t,i),"animationend")},t.prototype.executeAnimation=function(e,t,n,i,a){var r=this,o=this.getElementByAnimationId(t);if(o){this.handleMSOStateParentOfObject(o);var s=o.getAttribute("data-idGenAnimationStartState"),l=o.getAttribute("data-idGenAnimationEndState"),u=o.classList.contains("_idGenStateHide");u&&!o.hasAttribute("data-initially-hidden")&&o.setAttribute("data-initially-hidden","true"),this.removeClass(o,e?s:l),this.addClass(o,e?l:s),this.createEnrichmentTimeout(function(){r.animateElement(e,o,n,a)},1e3*i)}},t.prototype.onAnimationEnd=function(e,t,n,i){var a=t.getAttribute("data-idGenAnimationClass"),r=t.getAttribute("data-idGenAnimationStartState"),o=t.getAttribute("data-idGenAnimationEndState");this.removeClass(t,a),this.removeClass(t,e?o:r);var s=e?r:o;this.addFinishCssClass(t,s),n&&this.addClass(t,"_idGenStateHide"),i.stopPropagation()},t.prototype.addFinishCssClass=function(t,n){var i=this;"safari"===e.Param.userAgent.browser.name&&12===e.Param.userAgent.browser.version?setTimeout(function(){i.addClass(t,n)},0):this.addClass(t,n)},t}();i["default"]=b},{"./EpubEvent":8,"./EpubGesturesEvent":10,"./EpubPageEnrichment/Copyables":49,"./EpubPageEnrichment/IFrames":51,"./EpubPageEnrichment/Medias":53,"./EpubPageEnrichment/Sliders":57,"./utils/ScrollUtil":74,"./utils/isElementVisible":79}],48:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i;!function(e){e.ELEMENT="copyableText",e.BUTTON="copyableTextButton",e.FADE_IN="fadeIn"}(i||(i={}));var a=30,r=function(){function e(e){this.element=e,this.scale=1,this.init(),this.positionButton=this.positionButton.bind(this),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onButtonClick=this.onButtonClick.bind(this)}return e.prototype.init=function(){this.element.classList.add(i.ELEMENT),this.createButton()},e.prototype.start=function(){this.pollUpdateButton(),this.element.addEventListener("mouseenter",this.onMouseEnter),this.element.addEventListener("mouseleave",this.onMouseLeave),this.buttonElement.addEventListener("click",this.onButtonClick)},e.prototype.stop=function(){this.element.removeEventListener("mouseenter",this.onMouseEnter),this.element.removeEventListener("mouseleave",this.onMouseLeave),this.buttonElement.removeEventListener("click",this.onButtonClick),clearInterval(this.updateButtonInterval)},e.prototype.pollUpdateButton=function(){this.updateButtonInterval=setInterval(this.positionButton,100)},e.prototype.onMouseEnter=function(e){this.buttonElement.classList.add(i.FADE_IN)},e.prototype.createButton=function(){this.buttonElement=document.createElement("div"),this.buttonElement.classList.add(i.BUTTON),this.buttonElement.innerHTML=this.getIconHTML(),this.buttonElement.style.width=a+"px",this.buttonElement.style.height=a+"px",this.element.appendChild(this.buttonElement)},e.prototype.getIconHTML=function(){return'<div class="svgicon-new svgicon-copy-v4">\n\t\t\t<svg data-icon="copy-v4">\n\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svgicon-copy-v4"></use>\n\t\t\t</svg>\n\t\t</div>'},e.prototype.positionButton=function(){this.setScale();var e=this.buttonElement.getBoundingClientRect(),t=this.element.getBoundingClientRect();this.buttonElement.style.top=this.getPositionTop(t,e)+"px",this.buttonElement.style.left=this.getPositionLeft(t,e)+"px",this.buttonElement.style.transform="scale("+this.scale+")"},e.prototype.setScale=function(){var e=this.buttonElement.getBoundingClientRect(),t=e.height/this.scale/a;this.scale=1/t},e.prototype.getPositionTop=function(e,t){return this.scale*(e.height-t.height/this.scale/2)},e.prototype.getPositionLeft=function(e,t){return this.scale*(e.width-t.width/this.scale/2)},e.prototype.onMouseLeave=function(){this.buttonElement.classList.remove(i.FADE_IN)},e.prototype.onButtonClick=function(){var e=this.getText();this.copyToClipboard(e)},e.prototype.getText=function(){return this.element.textContent?this.element.textContent.replace(/\n/g," ").replace(/  /g,"\n"):""},e.prototype.copyToClipboard=function(e){var t=new ClipboardItem({"text/plain":new Blob([e],{type:"text/plain"})});navigator.clipboard.write([t])},e}();n.Copyable=r},{}],49:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=e("./Copyable"),a=function(){function e(e){this.htmlCopyables=e,this.copyables=[],this.init()}return e.prototype.init=function(){this.copyables=this.htmlCopyables.map(function(e){return new i.Copyable(e)})},e.prototype.start=function(){for(var e=0,t=this.copyables.length;e<t;e++)this.copyables[e].start()},e.prototype.stop=function(){for(var e=0,t=this.copyables.length;e<t;e++)this.copyables[e].stop()},e}();n.Copyables=a;var r=function(e){var t="div p",n="div, figure",i="DIV",a=Array.from(e.querySelectorAll(t)),r=a.map(function(e){return e.closest(n)}),o=Array.from(new Set(r)),s=o.filter(function(e){return e.tagName===i});return s};n.getCopyableElements=r},{"./Copyable":48}],50:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=e("../EpubPage/shapes/utils/IframeInteractions"),a=e("../utils/enums"),r=e("../utils/youtube"),o=function(){function e(e,t){this.iFrame=e,this.config=t,this.init()}return e.prototype.init=function(){this.element=this.iFrame.parentElement,this.iFrame.style.pointerEvents="none",this.iFrame.dataset.foreground="true",this.iFrame.contentEditable="true",this.iframeInteractions=new i.IframeInteractions(this,this.config,this.iFrame,this.element,(!0)),this.iFrame.addEventListener("load",this.onLoad.bind(this))},e.prototype.onLoad=function(){try{this.iFrameContentWindow=this.iFrame.contentWindow;var e="object"==typeof this.iFrameContentWindow.AdobeAn;if(e)return void this.iframeInteractions.init(this.iFrameContentWindow);this.config.readerPageSrcType===a.READER_TYPES.EPUB_HTML&&this.preventZoomConflict()}catch(t){this.preventZoomConflict()}},e.prototype.preventZoomConflict=function(){this.iFrame.style.pointerEvents="all",this.iframeInteractions.setPreventZoomInteraction(this.iFrameContentWindow)},e.prototype.start=function(){var e=this.iFrame.dataset.src;!this.iFrame.src&&e&&(this.iFrame.src=r.getCorrectYoutubeDomain(e),r.addYoutubeTrackStateChange(this.iFrame))},e.prototype.stop=function(){this.iFrame.removeAttribute("src"),this.iframeInteractions.flush()},e.prototype.updateZoom=function(e){if(!this.iFrame.style.width&&!this.iFrame.style.height){var t=window.getComputedStyle(this.iFrame);this.iFrame.style.width=t.getPropertyValue("width"),this.iFrame.style.height=t.getPropertyValue("height")}this.iFrame.parentElement&&(this.iFrame.style.zoom=""+1/e,this.iFrame.parentElement.style.transform="scale("+e+")",this.iFrame.parentElement.style.transformOrigin="0 0")},e}();n.IFrame=o},{"../EpubPage/shapes/utils/IframeInteractions":31,"../utils/enums":77,"../utils/youtube":81}],51:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=e("./IFrame"),a=function(){function e(e,t){this.htmlIframes=e,this.config=t,this.iFrames=[],this.init()}return e.prototype.init=function(){for(var e=0,t=this.htmlIframes.length;e<t;e++)this.iFrames.push(new i.IFrame(this.htmlIframes[e],this.config))},e.prototype.start=function(){for(var e=0,t=this.iFrames.length;e<t;e++)this.iFrames[e].start()},e.prototype.stop=function(){for(var e=0,t=this.iFrames.length;e<t;e++)this.iFrames[e].stop()},e.prototype.updateZoom=function(e){this.iFrames.forEach(function(t){return t.updateZoom(e)})},e}();n.IFrames=a},{"./IFrame":50}],52:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=e("../EpubGesturesEvent"),a=function(){function e(e,t){this.media=e,this.config=t,this.foreground=!0,this.startableAsyncDate=0,this.status={start:!1},this.init()}return e.prototype.init=function(){this._onMediaChange=this.onMediaChange.bind(this),this.media.setAttribute("controlsList","nodownload"),this.media.addEventListener("volumechange",this._onMediaChange,!0),this.media.addEventListener("seeking",this._onMediaChange,!0)},e.prototype.onMediaChange=function(){i["default"].prototype.preventAllGesture()},e.prototype.onScroll=function(){this.startableAsync()},e.prototype.startableAsync=function(){var e=this;return clearTimeout(this.startableAsyncTimer),Date.now()-this.startableAsyncDate>1e3?(this.startableAsyncDate=Date.now(),void this.startable()):void(this.startableAsyncTimer=setTimeout(function(){e.startableAsyncDate=Date.now(),e.startable()},100))},e.prototype.startable=function(){if(this.status.start===!1)return void this.media.pause();var e=this.media.hasAttribute("autoplay")&&"false"!==this.media.getAttribute("autoplay"),t=this.media.dataset.ignoreAutoplay;e&&!t&&this.media.play()},e.prototype.start=function(){this.status.start=!0,this.startableAsync()},e.prototype.stop=function(){this.media.removeEventListener("volumechange",this._onMediaChange,!0),this.media.removeEventListener("seeking",this._onMediaChange,!0),this.status.start=!1,this.media.pause()},e}();n.Media=a},{"../EpubGesturesEvent":10}],53:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=e("./Media"),a=function(){function e(e,t){this.htmlMedias=e,this.config=t,this.medias=[],this.init()}return e.prototype.init=function(){for(var e=0,t=this.htmlMedias.length;e<t;e++)this.medias.push(new i.Media(this.htmlMedias[e],this.config))},e.prototype.start=function(){for(var e=0,t=this.medias.length;e<t;e++)this.medias[e].start()},e.prototype.stop=function(){for(var e=0,t=this.medias.length;e<t;e++)this.medias[e].stop()},e}();n.Medias=a},{"./Media":52}],54:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=5,a=11,r=3,o={LEVEL_1:1,LEVEL_2:.83,LEVEL_3:.66},s=function(){function e(e,t,n){this.sliderElement=e,this.slidesLength=t,this.prevSlideIndex=n,this.init(),this.update(n)}return e.prototype.init=function(){for(var e=this.sliderElement.querySelector(".webpublication-pswp__dots-line"),t=0;t<this.slidesLength;t++){var n=document.createElement("span");0===t&&n.classList.add("is-active"),this.slidesLength>i?(3===t&&(n.style.transform="scale("+o.LEVEL_2+")"),t>3&&(n.style.transform="scale("+o.LEVEL_3+")")):e.classList.add("is-static"),e.appendChild(n)}},e.prototype.updateActiveDot=function(e){for(var t=[].slice.call(this.sliderElement.querySelectorAll(".webpublication-pswp__dots span")),n=0;n<t.length;n++)t[n].classList.toggle("is-active",n===e)},e.prototype.updateDotsLine=function(e){var t=this.sliderElement.querySelector(".webpublication-pswp__dots-line"),n=e<3,r=e>this.slidesLength-3,o=e===this.slidesLength-1&&0===this.prevSlideIndex;if(n&&(t.style.transform="translateX(0)"),!n&&!r){var s=(e-2)*a;t.style.transform="translateX("+-s+"px)"}if(o||r){var s=(this.slidesLength-i)*a;t.style.transform="translateX("+-s+"px)"}this.prevSlideIndex=e},e.prototype.updateDotsScale=function(e){for(var t=[].slice.call(this.sliderElement.querySelectorAll(".webpublication-pswp__dots span")),n=0;n<t.length;n++)t[n].style.transform="scale("+o.LEVEL_3+")";var i=e<r,a=e>=this.slidesLength-r;if(i){for(var n=0;n<r;n++)t[n].style.transform="scale("+o.LEVEL_1+")";t[r].style.transform="scale("+o.LEVEL_2+")"}else if(a){for(var n=this.slidesLength-1;n>this.slidesLength-1-r;n--)t[n].style.transform="scale("+o.LEVEL_1+")";t[this.slidesLength-1-r].style.transform="scale("+o.LEVEL_2+")"}else t[e].style.transform="scale("+o.LEVEL_1+")",t[e-1].style.transform="scale("+o.LEVEL_1+")",t[e+1].style.transform="scale("+o.LEVEL_1+")",t[e-2].style.transform="scale("+o.LEVEL_2+")",t[e+2].style.transform="scale("+o.LEVEL_2+")"},e.prototype.update=function(e){this.updateActiveDot(e),this.slidesLength>i&&(this.updateDotsLine(e),this.updateDotsScale(e))},e}();n.Pagination=s},{}],55:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i;!function(e){e.LEFT="LEFT",e.CENTER="CENTER",e.RIGHT="RIGHT"}(i||(i={}));var a;!function(e){e.TOP="TOP",e.CENTER="CENTER",e.BOTTOM="BOTTOM",e.ABOVE_SLIDE="ABOVE_SLIDE",e.UNDER_SLIDE="UNDER_SLIDE"}(a||(a={}));var r=function(){function e(e,t){this.parentElement=e,this.isBackground=t,this.insideTextWrapperElement=this.parentElement.querySelector(".webpublication-pswp__text-wrapper.is-inside"),this.insideTextElement=this.parentElement.querySelector(".webpublication-pswp__text.is-inside"),this.outsideTextWrapperElement=this.parentElement.querySelector(".webpublication-pswp__text-wrapper.is-outside"),this.outsideTextElement=this.parentElement.querySelector(".webpublication-pswp__text.is-outside")}return e.prototype.setTextWrapperStyles=function(e,t,n){var r=t.position,o=r.x,s=r.y,l="";switch(o){case i.LEFT:l="flex-start";break;case i.CENTER:l="center";break;case i.RIGHT:l="flex-end"}if(e.style.justifyContent=l,s===a.BOTTOM){var u="0";this.isBackground||(u=n?"50px":"25px"),e.style.bottom=u}else if(s===a.CENTER)e.style.top="50%",e.style.transform="translateY(-50%)";else if(s===a.TOP){var c="45px";e.style.top=this.isBackground?c:"0"}else s===a.ABOVE_SLIDE?e.style.bottom="100%":s===a.UNDER_SLIDE&&(e.style.top="100%")},e.prototype.setTextStyles=function(e,t){e.innerHTML=t.value;var n=t.font,i=n.family,a=n.size,r=n.color,o=n.backgroundColor,s=n.shadowColor,l=t.position;e.style.fontFamily=i,e.style.fontSize=(this.isBackground?this.getBackgroundFontSize(a):a)+"px",e.style.color=r,o&&(e.style.backgroundColor=o),s&&(e.style.textShadow="1px 1px 2px "+s),e.style.textAlign=l.x.toLowerCase()},e.prototype.resetTextElement=function(e,t){e.removeAttribute("style"),t.innerHTML="",t.removeAttribute("style")},e.prototype.getBackgroundFontSize=function(e){var t=1024,n=1.5,i=Math.min(window.innerWidth/t,n);return e*i},e.prototype.removeText=function(){this.resetTextElement(this.insideTextWrapperElement,this.insideTextElement),this.resetTextElement(this.outsideTextWrapperElement,this.outsideTextElement)},e.prototype.updateText=function(e,t){if(!e)return void this.removeText();var n=[a.ABOVE_SLIDE,a.UNDER_SLIDE].includes(e.position.y)||this.isBackground;this.removeText();var i=n?this.outsideTextWrapperElement:this.insideTextWrapperElement,r=n?this.outsideTextElement:this.insideTextElement;this.setTextWrapperStyles(i,e,t),this.setTextStyles(r,e),this.isBackground||this.parentElement.classList.toggle("is-overflow-visible",n)},e}();n.SlideText=r},{}],56:[function(t,n,i){var a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e};Object.defineProperty(i,"__esModule",{value:!0});var r,o=t("./Pagination"),s=t("./SlideText"),l=t("../../utils/youtube"),u=t("../../utils/isTouchSupported");!function(e){e.IN_PAGE="IN_PAGE",e.SPREAD_BACKGROUND="SPREAD_BACKGROUND",e.FULLSCREEN_BUTTON="FULLSCREEN_BUTTON"}(r=i.SliderType||(i.SliderType={}));var c;!function(e){e.IMAGE="IMAGE",e.MOVIE="MOVIE"}(c=i.SlideType||(i.SlideType={}));var p;!function(e){e.IFRAME="IFRAME",e.VIDEO="VIDEO"}(p||(p={}));var h=1e3,d=function(){function t(t,n,i,a,r,o){this.fakeFullscreenElementId="webpublication-pswp-fake-fullscreen",this.options={index:0,loop:!0,closeEl:!1,closeOnScroll:!1,closeOnVerticalDrag:!1,pinchToClose:!1,tapToClose:!1,clickToCloseNonZoomable:!1,closeElClasses:[],escKey:!1,zoomEl:!1,counterEl:!1,arrowEl:!1,captionEl:!1,fullscreenEl:!1,shareEl:!1,preloaderEl:!1,history:!1,barsSize:{top:0,bottom:0},timeToIdle:2e3,modal:!1,getDoubleTapZoom:void 0,arrowKeys:!1,isClickableElement:function(e){return"VIDEO"===e.tagName}},this.OPTIMAL_RESOLUTION=e.Param.isPhone?1024:2048,this.IS_PORTRAIT=e.Param.isPortrait,this.handleBeforeSlideChange=this.handleBeforeSlideChange.bind(this),this.handleAfterSlideChange=this.handleAfterSlideChange.bind(this),this.handleSliderResize=this.handleSliderResize.bind(this),this.handleSliderDestroy=this.handleSliderDestroy.bind(this),this.handleFullscreenChange=this.handleFullscreenChange.bind(this),this.closeFakeFullscreen=this.closeFakeFullscreen.bind(this),this.handleCloseFullscreenButtonClick=this.handleCloseFullscreenButtonClick.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handleVideoPlaying=this.handleVideoPlaying.bind(this),this.handleVideoPause=this.handleVideoPause.bind(this),this.handleVideoEnd=this.handleVideoEnd.bind(this),this.handleYoutubeStateChange=this.handleYoutubeStateChange.bind(this),this.pageNumber=a,this.hasFullscreen=e.Main.fullScreenManager.hasFullScreen(),this.parentElement=t,this.data=n,this.settings=r,this.className=i,this.type=o,this.addSpreadWrapperStyleObserver(),this.init(t,n)}return t.prototype.init=function(e,t,n){var i=this,a=this.getPageWrapper();if(this.type===r.IN_PAGE&&!a)return this.addContainerSubtreeObserver(function(){i.init(e,t,n),i.observeSpreadWrapperStyle()});this.observeSpreadWrapperStyle(),e.innerHTML=this.getTemplate(),this.sliderElement=e.querySelector(".pswp");var o=this.getSlides(t);void 0!==n&&(this.options.index=n),this.slider=new PhotoSwipe(this.sliderElement,PhotoSwipeUI_Default,o,this.options),this.slider.init(),this.initControls(),void 0===n&&this.startSlideshowIfNeeded();var l=this.slider.currItem,u=l.videoType,c=l.text;u&&this.handleVideos();var p=this.isFakeFullscreenOpened?document.querySelector("#"+this.fakeFullscreenElementId):this.parentElement;this.slideText=new s.SlideText(p,this.type===r.SPREAD_BACKGROUND),this.slideText.updateText(c,this.isSliderInFullscreen()),this.settings&&this.settings.scaleImage&&this.parentElement.classList.add("scale-image"),this.settings&&this.settings.autoplay&&this.settings.autoZoom&&this.addAutoZoomStyles(this.settings),this.slider.listen("beforeChange",this.handleBeforeSlideChange),this.slider.listen("afterChange",this.handleAfterSlideChange),this.slider.listen("resize",this.handleSliderResize),this.slider.listen("destroy",this.handleSliderDestroy),this.stopSwipeEventsPropogation()},t.prototype.initSlidesController=function(){var t=this.sliderElement.querySelector(".pswp__top-bar"),n=1===this.slider.items.length,i=this.settings&&this.settings.fullscreenIcon;n&&!i&&t.classList.add("no-controls"),i&&t.classList.add("has-fullscreen-button");var a="desktop"===e.Param.userAgent.device.type,r=!n&&a;r&&t.classList.add("has-arrows");var s=!n&&this.settings&&this.settings.arrowsVisible;if(s&&t.classList.add("is-visible-arrows"),u.isTouchSupported()){var l=this.slider.currItem.videoType;if(l){var c=this.sliderElement.querySelector(".pswp__top-bar");c.classList.add("is-video-slide")}}this.setSlidesControllerSize(),n||(this.pagination=new o.Pagination(this.sliderElement,this.slider.items.length,this.slider.getCurrentIndex()))},t.prototype.openInFullscreen=function(){return this.hasFullscreen||this.isFakeFullscreenOpened?void this.openNativeFullscreen():void this.openFakeFullscreen()},t.prototype.initControls=function(){var e=this;this.initSlidesController();var t=this.sliderElement.querySelector(".webpublication-pswp__arrow.is-prev"),n=this.sliderElement.querySelector(".webpublication-pswp__arrow.is-next"),i=this.sliderElement.querySelector(".webpublication-pswp__button-fullscreen"),a=this.settings&&this.settings.fullscreenIcon;t.addEventListener("click",function(){e.changeSlideWithFadeEffect(!1)}),n.addEventListener("click",function(){e.changeSlideWithFadeEffect(!0)}),a&&i.addEventListener("click",function(){e.openInFullscreen()});var r=[].slice.call(this.sliderElement.querySelectorAll(".pswp__item"));r.forEach(function(t){t.addEventListener("click",function(t){if(!e.slider.isMainScrollAnimating())return e.hasFullscreen||e.isFakeFullscreenOpened?void(e.isSliderInFullscreen()||t.target.classList.contains("pswp__img")&&e.openNativeFullscreen()):void e.openFakeFullscreen()})}),["mouseleave","touchend"].forEach(function(t){e.sliderElement.addEventListener(t,function(){var t=e.slider.currItem.videoType;e.isSliderInFullscreen()||t||e.startSlideshowIfNeeded()})}),["mouseenter","touchstart"].forEach(function(t){e.sliderElement.addEventListener(t,function(){var t=e.slider.currItem.videoType;e.isSliderInFullscreen()||t||e.stopSlideshowIfNeeded()})})},t.prototype.changeSlideWithFadeEffect=function(e){var t=this;this.sliderElement.classList.add("isTransitioning"),setTimeout(function(){e?t.slider.next():t.slider.prev()},h/2),setTimeout(function(){t.sliderElement.classList.remove("isTransitioning")},h)},t.prototype.setSlidesControllerSize=function(){var e=this.sliderElement.querySelector(".webpublication-pswp__arrow.is-prev"),t=this.sliderElement.querySelector(".webpublication-pswp__arrow.is-next"),n=this.sliderElement.querySelector(".webpublication-pswp__dots"),i=this.sliderElement.querySelector(".webpublication-pswp__button-fullscreen");if(this.isSliderInFullscreen())return e.style.transform="",t.style.transform="",n.style.transform="",void(i.style.transform="");var a=this.getSpreadWrapper();if(a){var r=+a.style.transform.replace("matrix(","").split(",")[0];e.style.transform="scale("+1/r+")",t.style.transform="scale("+1/r+")",n.style.transform="translateX(-50%) scale("+1/r+")",i.style.transform="scale("+1/r+")"}},t.prototype.startSlideshowIfNeeded=function(e){var t=this;if(this.isAutoplayEnabled()&&void 0===this.slideshowIntervalId&&this.data.length>1){var n=1e3*this.settings.autoplayDelay;this.slideshowIntervalId=setInterval(function(){t.changeSlideWithFadeEffect(!0)},n),e&&this.changeSlideWithFadeEffect(!0)}},t.prototype.stopSlideshowIfNeeded=function(){this.slideshowIntervalId&&(clearInterval(this.slideshowIntervalId),this.slideshowIntervalId=void 0)},t.prototype.addAutoZoomStyles=function(t){var n=this.slider.currItem.videoType;n&&this.sliderElement.classList.add("is-video-slide"),this.sliderElement.classList.add("auto-zoom");var i="\n\t\t\t@keyframes "+this.className+"-zoomSlide {\n\t\t\t\t0% {\n\t\t\t\t\ttransform: scale(1);\n\t\t\t\t}\n\t\t\t\t50% {\n\t\t\t\t\ttransform: scale("+(t.autoZoomLevel||1.5)+");\n\t\t\t\t}\n\t\t\t\t100% {\n\t\t\t\t\ttransform: scale(1);\n\t\t\t\t}\n\t\t\t}\n\t\t",a=e.Param.userAgent,o=a.browser,s=a.BROWSER,l=o.name===s.SAFARI,u=o.name===s.EDGE&&o.version<=18,c=l||u?"-webkit-full-screen":"fullscreen",p=this.type===r.SPREAD_BACKGROUND?"#"+this.className+" .pswp.auto-zoom:not(.is-video-slide)":"."+this.className+" .pswp.auto-zoom:not(.is-video-slide):not(:"+c+") .pswp__scroll-wrap",h=2*(t.autoplayDelay||2.5),d="\n\t\t\t"+i+"\n\t\t\t"+p+" {\n\t\t\t\tanimation: "+this.className+"-zoomSlide "+h+"s ease infinite;\n\t\t\t}\n\t\t",f=this.className+"-styles";this.styleElement=document.querySelector("#"+f),this.styleElement||(this.styleElement=document.createElement("style"),this.styleElement.id=f,document.head.appendChild(this.styleElement)),this.styleElement.innerHTML=d},t.prototype.openNativeFullscreen=function(){var e=this;this.fullscreenSliderId=this.className,this.isDocumentInFullscreen()?(this.exitFullscreen(),setTimeout(function(){e.requestSliderFullscreen()},1e3)):this.requestSliderFullscreen()},t.prototype.openFakeFullscreen=function(){this.isFakeFullscreenOpened=!0;var e=document.createElement("div");e.id=this.fakeFullscreenElementId;var t=this.slider.currItem.videoType;t&&e.classList.add("is-video-slide"),document.body.appendChild(e),this.slider.destroy(),this.init(e,this.data,this.slider.getCurrentIndex());var n=this.sliderElement.querySelector(".webpublication-pswp__button.is-close");n.classList.remove("display-none"),n.addEventListener("click",this.closeFakeFullscreen),this.slider.options.getDoubleTapZoom=function(){return 1},this.slider.options.arrowKeys=!0,document.addEventListener("keyup",this.handleKeyUp),this.addUIElementObserver()},t.prototype.closeFakeFullscreen=function(){this.isFakeFullscreenOpened=!1;var e=document.querySelector("#"+this.fakeFullscreenElementId);document.body.removeChild(e);var t=this.sliderElement.querySelector(".webpublication-pswp__button.is-close");t.classList.add("display-none"),t.removeEventListener("click",this.closeFakeFullscreen),document.removeEventListener("keyup",this.handleKeyUp),this.removeUIElementObserver(),this.slider.destroy(),this.init(this.parentElement,this.data,this.slider.getCurrentIndex());var n=this.slider.currItem.videoType;n||this.startSlideshowIfNeeded(),this.clearAfterFullscreenClose()},t.prototype.clearAfterFullscreenClose=function(){this.type===r.FULLSCREEN_BUTTON&&this.stop()},t.prototype.getFullScreenElement=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement},t.prototype.isDocumentInFullscreen=function(){var e=this.getFullScreenElement();return!!e&&e===document.documentElement},t.prototype.isSliderInFullscreen=function(){var e=this.getFullScreenElement();return!!e&&e===this.sliderElement||this.isFakeFullscreenOpened},t.prototype.requestSliderFullscreen=function(){this.sliderElement.requestFullscreen?this.sliderElement.requestFullscreen():this.sliderElement.webkitRequestFullscreen?this.sliderElement.webkitRequestFullscreen():this.sliderElement.msRequestFullscreen&&this.sliderElement.msRequestFullscreen(),document.addEventListener(this.getFullscreenChangeEventName(),this.handleFullscreenChange)},t.prototype.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},t.prototype.handleFullscreenChange=function(){this.slider.updateSize(!0);var e=document.fullscreenElement||document.webkitIsFullScreen||document.mozFullScreen;e||(document.removeEventListener(this.getFullscreenChangeEventName(),this.handleFullscreenChange),this.clearAfterFullscreenClose())},t.prototype.getTemplate=function(){return'\n\t\t\t<div class="pswp">\n\t\t\t\t<div class="pswp__bg"></div>\n\t\t\t\t<div class="pswp__scroll-wrap">\n\t\t\t\t\t<div class="pswp__container">\n\t\t\t\t\t\t<div class="pswp__item"></div>\n\t\t\t\t\t\t<div class="pswp__item"></div>\n\t\t\t\t\t\t<div class="pswp__item"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="pswp__ui pswp__ui--hidden"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="webpublication-pswp__text-wrapper is-inside">\n\t\t\t\t\t<span class="webpublication-pswp__text is-inside"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="webpublication-pswp__ui">\n\t\t\t\t\t<div class="pswp__top-bar">\n\t\t\t\t\t\t<button class="webpublication-pswp__button-fullscreen">\n\t\t\t\t\t\t\t<div class="svgicon-new fullscreen-1-v4">\n\t\t\t\t\t\t\t\t<svg data-icon="fullscreen-1-v4">\n\t\t\t\t\t\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svgicon-fullscreen-1-v4"></use>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button type="button" class="webpublication-pswp__arrow is-prev">\n\t\t\t\t\t\t\t<div class="svgicon-new svgicon-back-v4">\n\t\t\t\t\t\t\t\t<svg data-icon="back-v4">\n\t\t\t\t\t\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svgicon-back-v4"></use>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button type="button" class="webpublication-pswp__arrow is-next">\n\t\t\t\t\t\t\t<div class="svgicon-new svgicon-back-v4">\n\t\t\t\t\t\t\t\t<svg data-icon="back-v4">\n\t\t\t\t\t\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svgicon-back-v4"></use>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<div class="webpublication-pswp__dots">\n\t\t\t\t\t\t\t<div class="webpublication-pswp__dots-line"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button type="button" class="webpublication-pswp__button is-close display-none">\n\t\t\t\t\t\t<div class="svgicon-new svgicon-close">\n\t\t\t\t\t\t\t<svg data-icon="close">\n\t\t\t\t\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svgicon-close"></use>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="webpublication-pswp__text-wrapper is-outside">\n\t\t\t\t<span class="webpublication-pswp__text is-outside"></span>\n\t\t\t</div>\n\t\t';
},t.prototype.getSlides=function(t){var n=this;return t.map(function(i,a){var r=i.isExternalLink,o=i.relUrl,s=i.externalRelUrl,l=i.type,u=i.resolution,p=i.resolutions,h=i.label,d=i.slideText,f="";return f=r?s:e.Utils.resolveVariable(n.hasMediaParam(o)?o:"${media}"+o.replace(/^\/?\d+\//g,"")),l===c.MOVIE||r?n.getVideoSlide(f,h,a,r,1===t.length,d):n.getImageSlide(f,u,p,d)})},t.prototype.getImageSlide=function(t,n,i,a){var r=[1920,1080],o=n?n.split("x"):r,s=o[0],l=o[1],u={width:+s,height:+l},c={src:t,w:+s,h:+l,text:a};if(void 0===i)return c;var p=s?this.getResolutionDimensionDiff(+s):1/0,h=l?this.getResolutionDimensionDiff(+l):1/0,d=this.getClosestResolution(i,u);if(!d)return c;var f=Math.min(p,h),m=d.realWidth&&d.realHeight?Math.min(this.getResolutionDimensionDiff(d.realWidth),this.getResolutionDimensionDiff(d.realHeight)):1/0,g=e.Utils.getFileExtension(t);if(f<=m||"png"===g&&"jpg"===d.extension)return c;var v=d.box?"box-":"",b=t.split("."),y=b.slice(0,-1).join("."),E=y+"_"+v+d.width+"x"+d.height+"."+d.extension,M=d.realWidth?d.realWidth:d.width,S=d.realHeight?d.realHeight:d.height;return{src:E,w:M,h:S,text:a}},t.prototype.getClosestResolution=function(e,t){var n=this,i=this.getBiggerResolutions(e,t);return i&&0===i.length?null:i.reduce(function(e,t){var i=n.calculateMinResolutionDiff(e),a=n.calculateMinResolutionDiff(t);return a<i?t:e})},t.prototype.getBiggerResolutions=function(e,t){var n=this;return e.map(function(e){var i=e.box?n.getRealBoxResolution(e,t):e,r=n.IS_PORTRAIT,o=r?i.height>=n.OPTIMAL_RESOLUTION:i.width>=n.OPTIMAL_RESOLUTION;if(o){var s=!!e.box&&(i.width>t.width||i.height>t.height),l=e.box&&s?t.width:i.width,u=e.box&&s?t.height:i.height;return a({},e,{realHeight:u,realWidth:l})}return null}).filter(Boolean)},t.prototype.calculateMinResolutionDiff=function(e){var t=this.getResolutionDimensionDiff(e.width),n=this.getResolutionDimensionDiff(e.height);return Math.min(t,n)},t.prototype.getRealBoxResolution=function(e,t){var n=t.width/t.height,i={width:e.width,height:e.height},a=Math.ceil(e.height*n),r=Math.ceil(e.width/n);if(0===e.width)i.width=a;else if(0===e.height)i.height=r;else{var o=e.width/e.height,s=t.width>e.width||t.height>e.height,l=e.width>t.width&&e.height>t.height;s?n>o?i.height=r:i.width=a:l&&(e.width>e.height?i.height=r:e.width<e.height&&(i.width=a))}return i},t.prototype.getResolutionDimensionDiff=function(e){return Math.abs(e-this.OPTIMAL_RESOLUTION)},t.prototype.getVideoSlide=function(t,n,i,a,o,s){var u='\n\t\t\t<iframe\n\t\t\t\tid="'+this.className+"-"+i+'-frame"\n\t\t\t\tsrc="'+l.getCorrectYoutubeDomain(t)+'?enablejsapi=1"\n\t\t\t\twidth="100%"\n\t\t\t\theight="100%"\n\t\t\t\tframeBorder="0"\n\t\t\t\tallowFullscreen\n\t\t\t\tallow="autoplay; encrypted-media"\n\t\t\t/>\n\t\t',c="\n\t\t\t<video\n\t\t\t\t"+(this.type===r.SPREAD_BACKGROUND?"":"controls")+"\n\t\t\t\tplaysinline\n\t\t\t\t"+(this.isAutoplayEnabled()?"muted":"")+"\n\t\t\t\t"+(this.isAutoplayEnabled()&&o?"loop":"")+'\n\t\t\t\tdata-label="'+n+'"\n\t\t\t\tstyle="width:100%;height:100%"\n\t\t\t\tposter="'+(e.Utils.getFilenameWithoutExtension(t)+"/cover.jpg")+'"\n\t\t\t>\n\t\t\t\t<source src="'+t+'" />\n\t\t\t</video>\n\t\t';return{html:a?u:c,videoType:a?p.IFRAME:p.VIDEO,text:s}},t.prototype.hasMediaParam=function(e){var t=/\$media\$|\${media}|\$%7Bmedia%7D/;return!!e.match(t)},t.prototype.handleBeforeSlideChange=function(){var e=this.slider.currItem.videoType;if(u.isTouchSupported()){var t=this.sliderElement.querySelector(".pswp__top-bar");t.classList.toggle("is-video-slide",!!e)}if(this.pagination.update(this.slider.getCurrentIndex()),this.stopVideos(),this.isFakeFullscreenOpened){var n=document.querySelector("#"+this.fakeFullscreenElementId);n.classList.toggle("is-video-slide",!!e)}this.sliderElement.classList.toggle("is-video-slide",!!e)},t.prototype.handleAfterSlideChange=function(){var e=this.slider.currItem,t=e.videoType,n=e.text;t&&this.handleVideos(),!this.isAutoplayEnabled()||void 0!==this.slideshowIntervalId||t||this.isSliderInFullscreen()||this.startSlideshowIfNeeded(),this.slideText.updateText(n,this.isSliderInFullscreen())},t.prototype.addContainerSubtreeObserver=function(e){var t=this.getContainerElement();if(t){var n=new MutationObserver(function(){e(),n.disconnect()});n.observe(t,{childList:!0,subtree:!0})}},t.prototype.addSpreadWrapperStyleObserver=function(){var e=this;this.spreadWrapperStyleObserver=new MutationObserver(function(){e.setSlidesControllerSize()})},t.prototype.observeSpreadWrapperStyle=function(){var e=this.getSpreadWrapper();e&&this.spreadWrapperStyleObserver.observe(e,{attributes:!0,attributeFilter:["style"]})},t.prototype.addUIElementObserver=function(){if(!this.uiElementObserver){var e=this.isFakeFullscreenOpened?document.querySelector("#"+this.fakeFullscreenElementId):this.parentElement,t=e.querySelector(".pswp__ui"),n=e.querySelector(".webpublication-pswp__ui"),i="pswp__ui--idle";this.uiElementObserver=new MutationObserver(function(e){for(var a=0,r=e;a<r.length;a++){var o=r[a];"attributes"===o.type&&"class"===o.attributeName&&n.classList.toggle(i,t.classList.contains(i))}}),this.uiElementObserver.observe(t,{attributes:!0,attributeFilter:["class"]})}},t.prototype.removeUIElementObserver=function(){this.uiElementObserver&&this.uiElementObserver.disconnect(),this.uiElementObserver=void 0},t.prototype.getContainerElement=function(){return document.querySelector(".webpub-viewer__epub-container")},t.prototype.getPageWrapper=function(){return document.querySelector(".webpub-viewer__epub-container-spread-zoomable [class*=spread-page-"+this.pageNumber+"]")},t.prototype.getSpreadWrapper=function(){var e=this.getPageWrapper();return e?e.closest(".spread-is-visible .webpub-viewer__epub-container-spread-zoomable"):null},t.prototype.handleSliderResize=function(){var t=this;if(this.type===r.SPREAD_BACKGROUND)return void this.stop();if(this.setSlidesControllerSize(),this.isSliderInFullscreen()||(this.addContainerSubtreeObserver(function(){return t.observeSpreadWrapperStyle()}),this.observeSpreadWrapperStyle()),this.fullscreenSliderId===this.className){var n=e.Param.userAgent.os.name===e.Param.userAgent.OS.MAC,i=e.Param.userAgent.os.name===e.Param.userAgent.OS.ANDROID,a=e.Param.userAgent.os.name===e.Param.userAgent.OS.WINDOWS,o=n||i||a&&e.Param.isApp,s=this.sliderElement.querySelector(".webpublication-pswp__button.is-close");this.isSliderInFullscreen()?(this.stopSlideshowIfNeeded(),e.Param.viewHtml.classList.add("is-slider-full-screen"),this.slider.options.getDoubleTapZoom=function(){return 1},this.slider.options.arrowKeys=!0,document.addEventListener("keyup",this.handleKeyUp),this.addUIElementObserver(),o&&(s.classList.remove("display-none"),s.addEventListener("click",this.handleCloseFullscreenButtonClick))):(this.fullscreenSliderId=void 0,this.startSlideshowIfNeeded(),e.Param.viewHtml.classList.remove("is-slider-full-screen"),this.slider.options.getDoubleTapZoom=void 0,this.slider.options.arrowKeys=!1,document.removeEventListener("keyup",this.handleKeyUp),this.removeUIElementObserver(),o&&(s.classList.add("display-none"),s.removeEventListener("click",this.handleCloseFullscreenButtonClick)));var l=this.slider.currItem.text;this.slideText.updateText(l,this.isSliderInFullscreen())}},t.prototype.handleCloseFullscreenButtonClick=function(){this.exitFullscreen()},t.prototype.handleSliderDestroy=function(){this.spreadWrapperStyleObserver.disconnect(),this.stopSlideshowIfNeeded()},t.prototype.getFullscreenChangeEventName=function(){return void 0!==document.onfullscreenchange?"fullscreenchange":void 0!==document.onwebkitfullscreenchange?"webkitfullscreenchange":void 0!==document.onmsfullscreenchange?"MSFullscreenChange":"fullscreenchange"},t.prototype.stopSwipeEventsPropogation=function(){var e=this,t=["touchstart","touchmove","mousewheel","wheel","DOMMouseScroll"],n=function(e){return e.stopPropagation()};t.forEach(function(t){e.sliderElement.addEventListener(t,n)})},t.prototype.handleKeyUp=function(e){["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&e.stopPropagation()},t.prototype.handleVideos=function(){var t=this.slider.currItem,n=t.videoType,i=t.container;if(n===p.VIDEO){var a=i.querySelector("video");e.Utils.addVideoStats(a),e.Param.userAgent.browser.name===e.Param.userAgent.BROWSER.SAFARI&&(a.setAttribute("autoplay",""),a.pause()),this.isAutoplayEnabled()&&(this.stopSlideshowIfNeeded(),a.play(),a.addEventListener("ended",this.handleVideoEnd),a.addEventListener("playing",this.handleVideoPlaying),a.addEventListener("pause",this.handleVideoPause))}else{var r=i.querySelector("iframe");this.isAutoplayEnabled()&&(this.stopSlideshowIfNeeded(),r.src=r.src+"&autoplay=1&mute=1&playsinline=1",document.addEventListener(l.YOUTUBE_STATE_CHANGE_EVENT,this.handleYoutubeStateChange)),this.type&&(r.src=r.src+"&controls=0"),l.addYoutubeTrackStateChange(r)}},t.prototype.handleVideoPlaying=function(){if(u.isTouchSupported()){var e=this.sliderElement.querySelector(".pswp__top-bar");e.classList.add("is-video-playing")}},t.prototype.handleVideoPause=function(){if(u.isTouchSupported()){var e=this.sliderElement.querySelector(".pswp__top-bar");e.classList.remove("is-video-playing")}},t.prototype.handleVideoEnd=function(){this.isSliderInFullscreen()||this.startSlideshowIfNeeded(!0)},t.prototype.handleYoutubeStateChange=function(e){e.detail.state===l.YoutubePlayerState.PLAYING&&this.handleVideoPlaying(),e.detail.state===l.YoutubePlayerState.PAUSED&&this.handleVideoPause(),e.detail.state===l.YoutubePlayerState.ENDED&&this.handleVideoEnd()},t.prototype.stopVideos=function(){var e=this,t=[].slice.call(this.sliderElement.querySelectorAll("video, iframe"));t.forEach(function(t){t instanceof HTMLVideoElement&&(t.pause(),t.removeEventListener("playing",e.handleVideoPlaying),t.removeEventListener("pause",e.handleVideoPause),t.removeEventListener("ended",e.handleVideoEnd)),t instanceof HTMLIFrameElement&&t.contentWindow&&t.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*")})},t.prototype.isAutoplayEnabled=function(){return!!(this.settings&&this.settings.autoplay&&this.settings.autoplayDelay)},t.prototype.stop=function(){this.slider&&(this.stopVideos(),this.slider.close(),this.stopSlideshowIfNeeded(),document.removeEventListener(l.YOUTUBE_STATE_CHANGE_EVENT,this.handleYoutubeStateChange),this.styleElement&&this.styleElement.remove(),this.sliderElement.remove(),this.slideText.removeText())},t}();i.Slider=d},{"../../utils/isTouchSupported":80,"../../utils/youtube":81,"./Pagination":54,"./SlideText":55}],57:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=e("./Slider/index"),a="plugin-slider";n.SLIDER_CLASSNAME=a;var r=function(){function e(e,t,n){this.htmlSliders=e,this.data=t,this.sliders=[],this.init(n)}return e.prototype.init=function(e){for(var t=0,n=this.htmlSliders.length;t<n;t++){var r=[].slice.call(this.htmlSliders[t].classList),o=r.find(function(e){return e.includes(a)});if(o){var s=this.data[o],l=null;s&&("settings"in s&&(l=s.settings),"slides"in s&&(s=s.slides),s.length>0&&this.sliders.push(new i.Slider(this.htmlSliders[t],s,o,e,l,i.SliderType.IN_PAGE)))}}},e.prototype.stop=function(){for(var e=0,t=this.sliders.length;e<t;e++)this.sliders[e].stop()},e}();n.Sliders=r},{"./Slider/index":56}],58:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a=t("./EpubPage"),r=t("./utils/enums"),o=function(){function t(e,t,n){this.epubSpreads=e,this.config=t,this.epubCssManager=n,this.currentPage=0,this.pageQuantity=0,this.imagesMdpi=r.PagesImagesQualities[r.PagesImagesQualities.mdpi],this.imagesHdpi=r.PagesImagesQualities[r.PagesImagesQualities.hdpi],this.parent=this.epubSpreads,this.currentPage=this.config.currentPage,this.pageQuantity=this.config.pageQuantity,this.setPagesObject()}return Object.defineProperty(t.prototype,"readerPageSrcType",{get:function(){return this.config.readerPageSrcType},enumerable:!0,configurable:!0}),t.prototype.setPagesQty=function(){this.epubPages=new Array(this.pageQuantity),this.epubPagesRequested=new Array(this.pageQuantity)},t.prototype.setPageObject=function(t,n){return this.readerPageSrcType===r.READER_TYPES.EPUB_HTML?void(t.src=e.Main.pageManager.getEpubHtml(n)):this.readerPageSrcType===r.READER_TYPES.PDF_HTML?void(t.src=e.Main.pageManager.getPdfHtml(n)):this.readerPageSrcType===r.READER_TYPES.PDF_SVG?void(t.src=e.Main.pageManager.getSvg(n)):this.readerPageSrcType===r.READER_TYPES.PDF_IMG?(t.srcHdpi=e.Main.pageManager.getImage(this.imagesHdpi,n),void(t.src=e.Main.pageManager.getImage(this.imagesMdpi,n))):this.readerPageSrcType===r.READER_TYPES.PDF_PDF?void(t.src=e.Main.pageManager.getPdf(n)):void 0},t.prototype.setPagesObject=function(){this.setPagesQty();for(var e=0;e<this.pageQuantity;e++)this.epubPages[e]=new a["default"](this,this.config,e+1,this.epubCssManager),this.setPageObject(this.epubPages[e],e+1)},t.prototype.pageExist=function(e){return"undefined"!=typeof this.epubPages[e]},t.prototype.pageGetForSpread=function(e){return this.epubPagesRequested[e]=!0,this.epubPages[e]},t.prototype.pageGet=function(e){return this.epubPages[e]},t.prototype.resetRequested=function(){for(var e=0,t=this.pageQuantity;e<t;e++)this.epubPagesRequested[e]=!1},t.prototype.flushNotRequested=function(){for(var e=0,t=this.pageQuantity;e<t;e++)this.epubPagesRequested[e]===!1&&this.epubPages[e].flush()},t}();i["default"]=o},{"./EpubPage":17,"./utils/enums":77}],59:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t,n){this.epubScrollables=e,this.config=t,this.epubSpread=n,this.x=0,this.y=0,this.parent=this.epubScrollables,this.screenSize=this.parent.screenSize,this.mainViewElementSize=this.parent.mainViewElementSize}return e}();n["default"]=i},{}],60:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=e("./EpubScrollable"),a=e("./EpubGesturesEvent"),r=e("./EpubConfig/EpubDefaultConfig"),o=function(){function e(e,t,n,i){this.epubSpreads=e,this.config=t,this.mainViewElement=n,this.clickPermissionManager=i,this.xStart=0,this.yStart=0,this.parent=this.epubSpreads,this.screenSize=this.epubSpreads.screenSize,this.mainViewElementSize=this.epubSpreads.mainViewElementSize,this.element=n,this.scrollables=[],this.epubGesturesEvent=new a["default"](this,this.element),this.spreadDraggable&&(this.epubGesturesEvent.addEventListener(a["default"].GESTURESNAME.SWIPEGESTURE,this.trySwip.bind(this)),this.epubGesturesEvent.addEventListener(a["default"].GESTURESNAME.PANGESTURE,this.tryDrag.bind(this)),this.epubGesturesEvent.addEventListener(a["default"].GESTURESNAME.MOUSEWHEELGESTURE,this.onMouseWheel.bind(this))),this.setEnableScrollElement()}return e.prototype.setEnableScrollElement=function(){this.epubGesturesEvent.setEnableScrollElement(this.config.hasCrossNavPage())},Object.defineProperty(e.prototype,"spreadDraggable",{get:function(){return this.config.spreadDraggable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"navigationAxis",{get:function(){return this.config.navigationAxis},enumerable:!0,configurable:!0}),e.prototype.onMouseWheel=function(t){var n=Date.now(),i=0;this.navigationAxis===r.NavigationAxis.X&&t.gestureData.wheel.isX?i=t.deltaX:this.navigationAxis===r.NavigationAxis.Y&&t.gestureData.wheel.isY&&(i=t.deltaY),i>0?i=1:i<0&&(i=-1),e.mouseWheelLastDelta=i,e.mouseWheelLast=n,i>0?this.epubSpreads.epubManager.pageNext():i<0&&this.epubSpreads.epubManager.pagePrevious()},e.prototype.initDrag=function(e,t){this.xStart=e,this.yStart=t},e.prototype.drag=function(e,t){return[e-this.xStart,t-this.yStart]},e.prototype.updateScrollablesDrop=function(e,t){0===t[0]&&0===t[1]||this.epubSpreads.gotoPageByCoordsDiff(e.gestureData)},e.prototype.updateScrollables=function(e,t){this.epubSpreads.scrollTo(t[0],t[1])},e.prototype.trySwip=function(e){this.clickPermissionManager.resetActions(),e.defaultPreventGesture=!0,this.updateScrollablesDrop(e,this.drag(e.epubClientX,e.epubClientY))},e.prototype.tryDrag=function(e){this.clickPermissionManager.resetActions(),e.defaultPreventGesture=!0,0===e.gestureData.x.pointDiff&&0===e.gestureData.y.pointDiff&&this.initDrag(e.epubClientX,e.epubClientY),this.updateScrollables(e,this.drag(e.epubClientX,e.epubClientY))},e.prototype.addScrollable=function(e){this.scrollables.push(new i["default"](this,this.config,e))},e.mouseWheelLast=0,e.mouseWheelLastDelta=0,e}();n["default"]=o},{"./EpubConfig/EpubDefaultConfig":5,"./EpubGesturesEvent":10,"./EpubScrollable":59}],61:[function(t,n,i){var a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,r){function o(e){try{l(i.next(e))}catch(t){r(t)}}function s(e){try{l(i["throw"](e))}catch(t){r(t)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,r&&(o=2&n[0]?r["return"]:n[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,r=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(i){n=[6,i],r=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,r,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(i,"__esModule",{value:!0});var o,s=t("./EpubSpreadZoomable"),l=t("./ProtoHTMLElement"),u=t("./EpubEvent");!function(e){e.LEFT="left",e.CENTER="center",e.RIGHT="right"}(o=i.SpreadAlignment||(i.SpreadAlignment={}));var c=function(){function t(t,n,i,a){var r=this;this.epubSpreads=t,this.config=n,this.spreadIndex=i,this.mainViewElement=a,this.optimizeQuality=!0,this.cssClassSpreadVisible="spread-is-visible",this.lastOffset=0,this.pageIndexes=[],this.spreadOffset=0,this.initSpreadContent=this.initSpreadContent.bind(this),this.parent=this.epubSpreads,this.epubEvent=e.epubEvent,this.screenSize=this.parent.screenSize,this.mainViewElementSize=this.parent.mainViewElementSize,this.pagesInSpread=[],this.elementSize={width:0,height:0},this.epubSpreadZoomable=new s["default"](this,this.config),this.spreadHTMLElement=new l["default"](this.config),this.spreadHTMLElement.initSpread(this,this.config,this.epubSpreadZoomable,this.spreadIndex),this.element=this.spreadHTMLElement.element,this.spreadHTMLElement.optimizeQuality=this.optimizeQuality,this.config.isVerticalOnePage?this.epubEvent.addListener(u.EPUB_EVENTS.VISIBLE_SPREADS_CHANGE,function(e){r.updateContent(e.data.pageNumbers)}):this.epubEvent.addListener(u.EPUB_EVENTS.PAGE_CHANGE,function(e){e.data.pageChanged&&r.updateContent([e.data.pageNumber])});var o="configsJson.pageDataUpdated";document.addEventListener(o,this.onPageDataUpdate.bind(this))}return t.prototype.initSpreadContent=function(e){var t=this;if(this.spreadHTMLElement.setSpreadScrollable(this.config.isCrossNavPage(this.currentPage)),this.element){var n=this.element.querySelector("video.spread-bgVideo");if(n){var i=e.some(function(e){return t.pageIndexes.includes(e-1)});if(i){try{n.paused&&(n.currentTime=0)}catch(a){}n.play()}else n.pause()}}},Object.defineProperty(t.prototype,"width",{get:function(){return this.elementSize.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.elementSize.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPage",{get:function(){return this.config.currentPage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageQuantity",{get:function(){return this.config.pageQuantity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstSpreadSize",{get:function(){return this.config.firstSpreadSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"epubPages",{get:function(){return this.parent.epubPages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pagesBySpread",{get:function(){return this.pageIndexes.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"coverPageCenter",{get:function(){return this.config.coverPageCenter},enumerable:!0,configurable:!0}),t.prototype.getSpreadAlignment=function(t,n){var i=2===n;if(i)return o.CENTER;var a=e.Main.configsJsonManager.getPageData(["showAlone","showAloneSide"],t-1),r=a.showAlone,s=a.showAloneSide;if(r){if("left"===s)return o.LEFT;if("right"===s)return o.RIGHT}var l=1===t&&this.coverPageCenter===!1;return l?o.RIGHT:o.CENTER},t.prototype.updatePages=function(e){return a(this,void 0,void 0,function(){var t,n,i,a,o,s,l=this;return r(this,function(r){if(t=0,n=e.length,i=!1,0===n)return this.epubSpreadZoomable.resetContent(),this.epubSpreadZoomable.element.classList.contains("epub-all-pages-loaded")&&this.epubSpreadZoomable.element.classList.remove("epub-all-pages-loaded"),[2];for(this.config.isVerticalOnePage||this.updateContent([this.currentPage]),this.pagesInSpread=e,this.epubSpreadZoomable.contentLength!==n&&(i=!0);t<n;t++)this.epubSpreadZoomable.lastContentIDs.indexOf(this.pagesInSpread[t].pageNumber)===-1&&(i=!0);for(i===!0&&(this.epubSpreadZoomable.resetContent(),this.epubSpreadZoomable.element.classList.contains("epub-all-pages-loaded")&&this.epubSpreadZoomable.element.classList.remove("epub-all-pages-loaded")),this.epubSpreadZoomable.contentLength=n,a=this.getSpreadAlignment(this.pagesInSpread[0].pageNumber,n),this.epubSpreadZoomable.contentPosition=a,o=[],s=!1,t=0;t<n;t++)this.pagesInSpread[t].atSpreadOffset=this.spreadOffset,i===!0?o.push(this.epubSpreadZoomable.updateContent(this.pagesInSpread[t])):this.pagesInSpread[t].epubPageEnrichmentStat(),this.pagesInSpread[t].pageContainsCPUElement===!0&&(s=!0);return this.epubSpreadZoomable.setContainIframe(s),Promise.all(o).then(function(){0!==n&&l.epubSpreadZoomable.element.classList.contains("epub-all-pages-loaded")===!1&&l.epubSpreadZoomable.element.classList.add("epub-all-pages-loaded")}),[2]})})},t.prototype.displaySpread=function(){this.mainViewElement.appendChild(this.element)},t.prototype.updateSpread=function(e,t){var n;this.lastOffset=this.spreadOffset,this.spreadOffset=e,this.pageIndexes=t,n=this.getPages(this.pageIndexes),this.epubSpreadZoomable.reset(),this.spreadHTMLElement.element.setAttribute("pages",n.length.toString()),this.updatePages(n)},t.prototype.updateSpreadSize=function(){this.elementSize.width=this.element.offsetWidth,this.elementSize.height=this.element.offsetHeight,this.epubSpreadZoomable.updateSize(),this.elementSize.width=this.element.offsetWidth,this.elementSize.height=this.element.offsetHeight},t.prototype.getPages=function(e){var t=this;return e.map(function(e){return t.epubPages.pageGetForSpread(e)})},t.prototype.updateContent=function(e){this.updateVisibility(e),this.initSpreadContent(e)},t.prototype.updateVisibility=function(e){var t=this.isVisibleSpread(e);this.updateVisibleSpreadClass(t),this.setBackgrounds()},t.prototype.isVisibleSpread=function(e){var t=this.getPages(this.pageIndexes),n=t.map(function(e){return e.pageNumber}),i=n.filter(function(t){return e.includes(t)});return i.length>0},t.prototype.updateVisibleSpreadClass=function(e){this.spreadHTMLElement.element.classList.toggle(this.cssClassSpreadVisible,e)},t.prototype.setBackgrounds=function(){var e=this.getPages(this.pageIndexes),t=e.map(function(e){return e.pageNumber});this.spreadHTMLElement.setBackground(t)},t.prototype.onPageDataUpdate=function(){this.setBackgrounds()},t.prototype.updateIframesZoom=function(e){this.pagesInSpread.forEach(function(t){return t.updateIframesZoom(e)})},t}();i["default"]=c},{"./EpubEvent":8,"./EpubSpreadZoomable":62,"./ProtoHTMLElement":69}],62:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a=t("./EpubConfig/EpubDefaultConfig"),r=t("./EpubEvent"),o=t("./EpubSpread"),s=t("./ProtoHTMLElement"),l=t("./EpubSpreadZoomableAnimations"),u=t("./EpubZoom"),c=t("./EpubGesturesEvent"),p=t("./utils/functions"),h=function(){function t(t,n){var i,p=this;this.epubSpread=t,this.config=n,this.contentLength=0,this.contentPosition=o.SpreadAlignment.CENTER,this.scale=0,this._x=0,this._y=0,this.widthScaled=0,this.heightScaled=0,this.savedEvent=null,this.paddingLeft=0,this.paddingRight=0,this.paddingTop=0,this.paddingBottom=0,this.epubEvent=e.epubEvent,this.parent=this.epubSpread,this.screenSize=this.epubSpread.screenSize,this.mainViewElementSize=this.epubSpread.mainViewElementSize,this.updateSize=this.updateSize.bind(this),this.lastContentIDs=[],this._pageSizeType=(i={},i[a.PagesSizeTypes.CONTAIN]=this.pageTypeContain.bind(this),i[a.PagesSizeTypes.COVER_HORIZONTALLY]=this.coverHorizontally.bind(this),i),this.elementSize={width:0,height:0},this.epubZoom=new u["default"](this,this.config),this.spreadZoomableHTMLElement=new s["default"](this.config),this.spreadZoomableHTMLElement.initZoomable(this,this.config),this.element=this.spreadZoomableHTMLElement.element,this.epubSpreadZoomableAnimations=new l["default"](this,this.config,this.spreadZoomableHTMLElement),this.epubGesturesEvent=new c["default"](this,this.spreadZoomableHTMLElement.element),this.zoomDoubleClick===!0&&this.epubGesturesEvent.addEventListener(c["default"].GESTURESNAME.DBLTAPGESTURE,this.tryZoom.bind(this)),this.zoomSingleClick===!0&&(this.epubEvent.addListener(r.EPUB_EVENTS.PAGE_CLICK,this.tryZoomOneClick.bind(this)),this.epubGesturesEvent.addEventListener(c["default"].GESTURESNAME.TAPGESTURE,this.saveEvent.bind(this))),this.epubGesturesEvent.addEventListener(c["default"].GESTURESNAME.PANGESTURE,this.tryDrag.bind(this)),this.setEnableScrollElement(),this.epubEvent.addListener(r.EPUB_EVENTS.PAGE_CHANGE,function(){p.setEnableScrollElement(),p.updateSize()})}return t.prototype.setEnableScrollElement=function(){this.epubGesturesEvent.setEnableScrollElement(this.config.isCrossNavPage(this.spreadFirstPage))},Object.defineProperty(t.prototype,"spreadFirstPage",{get:function(){return this.parent.pageIndexes[0]+1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomDoubleClick",{get:function(){return this.config.zoomDoubleClick},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomSingleClick",{get:function(){return this.config.zoomSingleClick},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultPageScaleAt",{get:function(){return this.config.defaultPageScaleAt},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentWidth",{get:function(){return this.parent.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentHeight",{get:function(){return this.parent.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spreadOffset",{get:function(){return this.parent.spreadOffset},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.config.isVerticalOnePage?e.Main.xmlManager.get("common-configuration","contents","epub-HTML","width")*this.epubSpread.pageIndexes.length:this.elementSize.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.config.isVerticalOnePage?e.Main.xmlManager.get("common-configuration","contents","epub-HTML","height"):this.elementSize.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageSizeType",{get:function(){var e=this.config.pageSizeType,t=this.config.isCrossNavPage(this.spreadFirstPage);return t&&(e=a.PagesSizeTypes.COVER_HORIZONTALLY),"function"==typeof this._pageSizeType[e]?this._pageSizeType[e]:this._pageSizeType.contain},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useMatrixTransform",{get:function(){return this.config.useMatrixTransformZoomable},enumerable:!0,configurable:!0}),t.prototype.roundPxDevice=function(e){return~~(100*e)/100},t.prototype.coverHorizontally=function(){return this.updateEpubContainerForCrossNav(),this.updateSpreadPositioning(!0)},t.prototype.pageTypeContain=function(){return this.updateSpreadPositioning(!1)},t.prototype.updateEpubContainerForCrossNav=function(){var e=".webpub-viewer__epub-container-spread-page",t=this.spreadZoomableHTMLElement.element.querySelector(e);if(t){var n=".webpub-viewer__epub-container-spread-page-sub",i=t.querySelector(n);if(i){var a=this.getPageHeight(t,i);i.style.height=a+"px"}}},t.prototype.getPageHeight=function(t,n){var i=t.className,a=i.match(/spread-page-(\d+)/);if(a){var r=Number(a[1])-1,o=e.Main.configsJsonManager.getPageData(["height"],r).height;if(o)return o}return this.calculatePageHeight(n)},t.prototype.calculatePageHeight=function(e){var t=this.spreadZoomableHTMLElement.scale,n=e.getAttribute("data-original-height");n||(n=e.offsetHeight.toString(),e.setAttribute("data-original-height",n));for(var i=parseInt(n),a=e.children,r=this.spreadZoomableHTMLElement.element.getBoundingClientRect().top,o=0;o<a.length;o++){var s=a[o],l=s.getBoundingClientRect(),u=(l.height+l.top-r)/t;i=Math.max(i,u)}return i},t.prototype.updateSpreadPositioning=function(t){var n=0,i=0,a=0;if(0===this.width||0===this.height)return!1;var r=this.config.isVerticalOnePage;n=Math.min(this.getHorizontalScale(),this.getVerticalScale(t,r));var o=e.Main.startupManager.get("core.maxPageScale");return o&&(n=Math.min(n,o)),this.widthScaled=n*this.width,this.heightScaled=n*this.height,r&&(this.epubSpread.element.style.height=this.heightScaled+"px"),i=this.getSpreadXCoordinate(),a=this.getSpreadYCoordinate(r),this.scale!==n&&(this.scale=n,this._x=i,this._y=a,this.updateSizeFromPoint([n,0,0,i,a])),!0},t.prototype.getHorizontalScale=function(){return(this.parentWidth-this.paddingLeft-this.paddingRight)/this.width},t.prototype.getVerticalScale=function(e,t){return e||t?1:(this.parentHeight-this.paddingTop-this.paddingBottom)/this.height},t.prototype.getSpreadXCoordinate=function(){var e=.5*(this.parentWidth+this.paddingLeft-this.paddingRight);if(this.contentPosition===o.SpreadAlignment.LEFT){var t=e-this.widthScaled,n=this.paddingLeft,i=Math.max(n,t);return this.roundPxDevice(i)}if(this.contentPosition===o.SpreadAlignment.RIGHT){var a=this.parentWidth-this.paddingRight-this.widthScaled,i=Math.min(a,e);return this.roundPxDevice(i)}var r=e-.5*this.widthScaled;return this.roundPxDevice(r)},t.prototype.getSpreadYCoordinate=function(e){if(e)return 0;var t=.5*(this.parentHeight+this.paddingTop-this.paddingBottom),n=this.heightScaled+this.paddingTop+this.paddingBottom>=this.parentHeight;if(n)return this.paddingTop;var i=t-.5*this.heightScaled;return this.roundPxDevice(i)},t.prototype.updateSizeFromPointAnimation=function(e){this.epubSpreadZoomableAnimations.animateScale(e,this.spreadOffset)},t.prototype.updateSizeFromPoint=function(e){this.epubSpreadZoomableAnimations.scaleDrag(e,this.spreadOffset)},t.prototype.saveEvent=function(e){if(e.target.classList.contains("epub-link-type_iframe")!==!0||e.target.classList.contains("epub-link-visible")!==!0){var t=e.target;return c["default"].preventAllGestureStatus()===!0||p.isMediaElement(t)?void(this.savedEvent=null):void(this.savedEvent=e)}},t.prototype.tryZoomOneClick=function(e){var t=this.savedEvent;return null===t||c["default"].preventAllGestureStatus()===!0?void(this.savedEvent=null):(this.savedEvent=null,void this.tryZoom(t))},t.prototype.tryZoom=function(e){var t=p.getBoundingClientRect(this.spreadZoomableHTMLElement.element,this.useMatrixTransform?1:this.scale),n=this.epubZoom.scale;return e.defaultPreventGesture=!0,0!==n?(this.updateSizeFromPointAnimation(this.epubZoom.resetZoom()),void this.epubEvent.fire({type:r.EPUB_EVENTS.PAGE_ZOOM,
data:{status:!1,scale:this.epubZoom.scale}})):void(0===this.spreadOffset&&(this.updateSizeFromPointAnimation(this.epubZoom.getZoom(e,this.defaultPageScaleAt,e.epubClientX,e.epubClientY,t)),0===n&&this.epubEvent.fire({type:r.EPUB_EVENTS.PAGE_ZOOM,data:{status:!0,scale:this.epubZoom.scale}})))},t.prototype.getBoundingClientRect=function(e){return void 0===e&&(e=this.spreadZoomableHTMLElement.element),p.getBoundingClientRect(e,this.useMatrixTransform?1:this.scale)},t.prototype.zoomToggle=function(e){var t=this.getBoundingClientRect(),n=t.left+t.width*e.x,i=t.top+t.height*e.y,a=e.scale;return 0===a?(e.animate===!0?this.updateSizeFromPointAnimation(this.epubZoom.resetZoom()):this.updateSizeFromPoint(this.epubZoom.resetZoom()),void this.epubEvent.fire({type:r.EPUB_EVENTS.PAGE_ZOOM,data:{status:!1,scale:this.epubZoom.scale}})):(e.animate===!0?this.updateSizeFromPointAnimation(this.epubZoom.getZoomNoEvent(a,n,i,t)):this.updateSizeFromPoint(this.epubZoom.getZoomNoEvent(a,n,i,t)),void this.epubEvent.fire({type:r.EPUB_EVENTS.PAGE_ZOOM,data:{status:!0,scale:this.epubZoom.scale}}))},t.prototype.zoomByStep=function(e){var t={x:e.x,y:e.y,scale:this.epubZoom.scale+e.step,animate:e.animate};this.zoomToggle(t)},t.prototype.zoomProgress=function(e){this.zoomToggle(e)},t.prototype.tryDrag=function(e){var t,n;this.config.isVerticalOnePage||0===this.epubZoom.scale&&0===e.gestureData.pinchZoomDiff||(t=this.getBoundingClientRect(),e.defaultPreventGesture=!0,0===e.gestureData.x.pointDiff&&0===e.gestureData.y.pointDiff?this.epubZoom.initdrag(e,e.epubClientX,e.epubClientY,t):(0===e.gestureData.x.pointDiff&&this.epubZoom.initdragX(e,e.epubClientX,t),0===e.gestureData.y.pointDiff&&this.epubZoom.initdragY(e,e.epubClientY,t)),n=this.epubZoom.scale+e.gestureData.pinchZoomDiff*this.config.zoomFactor,this.epubZoom.getZoom(e,n,e.epubClientX,e.epubClientY,t),this.updateSizeFromPoint(this.epubZoom.drag(e,e.epubClientX,e.epubClientY)))},t.prototype.reset=function(){var e=this.epubZoom.scale;this.updateSizeFromPoint(this.epubZoom.resetZoom()),0===e&&this.epubEvent.fire({type:r.EPUB_EVENTS.PAGE_ZOOM,data:{status:!1,scale:this.epubZoom.scale}})},t.prototype.resetContent=function(){this.lastContentIDs=[],this.spreadZoomableHTMLElement.removeChilren()},t.prototype.updateContent=function(e){var t=this;this.lastContentIDs.push(e.pageNumber);var n=e.syncElemWithSpread(this.spreadZoomableHTMLElement.element);return this.spreadZoomableHTMLElement.element.appendChild(n.element),this.config.isCrossNavPage(this.parent.currentPage)&&(clearTimeout(this.timeoutId2),this.timeoutId2=setTimeout(function(){t.spreadZoomableHTMLElement.scrollToTop()},0)),e.onload=this.updateSize,n.loaded},t.prototype.setContainIframe=function(e){var t=this;this.spreadZoomableHTMLElement.element.setAttribute("contains-iframe",e?"yes":"no"),setTimeout(function(){return t.updateIframesZoomIfNeeded(t.scale)},100)},t.prototype.getElement=function(){return this.spreadZoomableHTMLElement.element},t.prototype.updateSize=function(){var e=this;this.scale=0,this.paddingLeft=this.config.paddingLeft,this.paddingRight=this.config.paddingRight,this.paddingTop=this.config.paddingTop,this.paddingBottom=this.config.paddingBottom,this.elementSize.width=this.spreadZoomableHTMLElement.element.offsetWidth,this.elementSize.height=this.spreadZoomableHTMLElement.element.offsetHeight,this.pageSizeType()===!1?(clearTimeout(this.timeoutId),this.timeoutId=setTimeout(this.updateSize,16)):setTimeout(function(){return e.updateIframesZoomIfNeeded(e.scale)},100)},t.prototype.updateIframesZoomIfNeeded=function(e){this.config.useMatrixTransformZoomable||this.epubSpread.updateIframesZoom(e)},t}();i["default"]=h},{"./EpubConfig/EpubDefaultConfig":5,"./EpubEvent":8,"./EpubGesturesEvent":10,"./EpubSpread":61,"./EpubSpreadZoomableAnimations":63,"./EpubZoom":67,"./ProtoHTMLElement":69,"./utils/functions":78}],63:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=e("./utils/cssAnimations"),a=1e-4,r=.3,o=function(){function e(e,t,n){this.epubSpreadZoomable=e,this.config=t,this.spreadZoomableHTMLElement=n,this.fromPosition={x:0,y:0,scale:0},this.toPosition={x:0,y:0,scale:0},this.elementData={prc:0},this.epubTweens=new Tween(this.elementData,"prc",Tween.regularEaseInOut,0,0,a),this.epubTweens.onMotionChanged=this.tweenUpdate.bind(this)}return e.prototype.animationDomAsync=function(e,t,n,a,r){this.config.useMatrixTransformZoomable?i.matrixAsync(this.config.use3DMatrixTransform,e,t,n,a,r):i.positionDomAsync(e,t,n,a,r),this.epubSpreadZoomable.updateIframesZoomIfNeeded(t)},e.prototype.tweenUpdate=function(e){this.fromPosition.scale+=(this.toPosition.scale-this.fromPosition.scale)*e.target._pos,this.fromPosition.x+=(this.toPosition.x-this.fromPosition.x)*e.target._pos,this.fromPosition.y+=(this.toPosition.y-this.fromPosition.y)*e.target._pos,this.animationDomAsync(this.spreadZoomableHTMLElement,this.fromPosition.scale,this.fromPosition.x,this.fromPosition.y,0)},e.prototype.tweenUpdateZero=function(){this.animationDomAsync(this.spreadZoomableHTMLElement,this.toPosition.scale,this.toPosition.x,this.toPosition.y,0)},e.prototype.setOptimizequality=function(e){return 0===e?void(this.spreadZoomableHTMLElement.optimizeQuality=!0):void(this.spreadZoomableHTMLElement.optimizeQuality=!1)},e.prototype.animateScale=function(e,t){this.setOptimizequality(t),this.toPosition.scale=e[0],this.toPosition.x=e[3],this.toPosition.y=e[4],this.epubTweens.stop(),this.epubTweens._pos=0,this.epubTweens.continueTo(1,r)},e.prototype.scaleDrag=function(e,t){this.setOptimizequality(t),this.fromPosition.scale=this.toPosition.scale=e[0],this.fromPosition.x=this.toPosition.x=e[3],this.fromPosition.y=this.toPosition.y=e[4],this.epubTweens.stop(),this.epubTweens._pos=1,this.tweenUpdateZero()},e}();n["default"]=o},{"./utils/cssAnimations":76}],64:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a=t("./EpubEvent"),r=t("./EpubSpread"),o=t("./EpubSpreadsAnimations"),s=t("./EpubPages"),l=t("./EpubScrollables"),u=t("./utils/functions"),c=t("./utils/isElementVisible"),p=t("./EpubConfig/EpubDefaultConfig"),h=t("./utils/ScrollUtil"),d=t("./EpubClickPermission"),f=function(){function t(t,n,i,a){this.epubManager=t,this.config=n,this.viewMain=i,this.epubCssManager=a,this.onPublicationScroll=this.onPublicationScroll.bind(this),this.onPageChange=this.onPageChange.bind(this),this.parent=this.epubManager,this.epubEvent=e.epubEvent,this.screenSize=this.epubManager.screenSize,this.mainViewElementSize={width:0,height:0},this.mainViewElementClassName=this.config.mainViewElementClassName,this.epubPages=new s["default"](this,this.config,this.epubCssManager),this.setMainViewElement(),this.generatePublicationSpreads(),this.appendMainViewElementToViewMain();var r=new d["default"](this.mainViewElement);this.config.isVerticalOnePage?this.handleVerticalOnePage():this.epubScrollables=new l["default"](this,this.config,this.mainViewElement,r)}return Object.defineProperty(t.prototype,"currentPage",{get:function(){return this.config.currentPage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastPage",{get:function(){return this.config.lastPage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstSpreadSize",{get:function(){return this.config.firstSpreadSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageQuantity",{get:function(){return this.config.pageQuantity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spreadsLength",{get:function(){return void 0==this.publicationSpreads?-1:this.config.isVerticalOnePage?this.publicationSpreads.length:Math.min(this.publicationSpreads.length,this.config.maxSpreadsLength)},enumerable:!0,configurable:!0}),t.prototype.setVisibleSpreadPages=function(e){var t=this.visibleSpreadsPages,n=!this.areArrayEquals(t,e);n&&(this.visibleSpreadsPages=e,this.epubEvent.fire({type:a.EPUB_EVENTS.VISIBLE_SPREADS_CHANGE,data:{pageNumbers:e}}))},t.prototype.areArrayEquals=function(e,t){return!e&&!t||!(!e||!t)&&(e.length===t.length&&e.every(function(e){return!!t.includes(e)}))},t.prototype.onPageChange=function(e){var t=e.data,n=t.pageNumber,i=t.source;i!==p.PageChangeSource.VERTICAL_ONE_PAGE&&this.scrollToPageNumber(n)},t.prototype.scrollToPageNumber=function(e){var t=this.getSpreadByPageNumber(e);t.element.scrollIntoView()},t.prototype.handleVerticalOnePage=function(){this.verticalScrollUtil=new h["default"](this.mainViewElement);var t=100;this.mainViewElement.addEventListener("scroll",e.Utils.throttle(this.onPublicationScroll,t)),this.epubEvent.addListener(a.EPUB_EVENTS.PAGE_CHANGE,this.onPageChange),this.updateVisibleSpreads(),this.setVerticalOnePageCSS()},t.prototype.setVerticalOnePageCSS=function(){for(var e=0;e<this.epubSpreads.length;e++){var t=this.epubSpreads[e].element;t.style.top="-"+e+"px"}},t.prototype.onPublicationScroll=function(){var e=this.updateVisibleSpreads(),t=!this.verticalScrollUtil.isScrollDown(),n=this.getCurrentSpreadOnScroll(e,t);this.epubManager.goToPage(n.pageIndexes[0]+1,!0,p.PageChangeSource.VERTICAL_ONE_PAGE)},t.prototype.updateVisibleSpreads=function(){var e={top:this.config.paddingTop,bottom:this.config.paddingBottom},t=this.epubSpreads.filter(function(t){return c.isElementVisible(t.element,c.ElementVisibleMode.ANY,e)});return this.setVisibleSpreadPages(t.reduce(function(e,t){return e.concat(t.pageIndexes)},[]).map(function(e){return e+1})),t},t.prototype.getCurrentSpreadOnScroll=function(e,t){var n=Math.floor(e.length/2),i=e.length%2===0;return i&&t&&(n-=1),e[n]},t.prototype.initSpreads=function(e,t){this.clearSpreadsElements();for(var n=0,i=e.length;n<i;n++)e[n]=new r["default"](this,this.config,n,t),this.epubScrollables&&this.epubScrollables.addScrollable(e[n]);this.updateSpreads(0),this.displaySpreads(e)},t.prototype.clearSpreadsElements=function(){for(;this.mainViewElement.lastChild;)this.mainViewElement.removeChild(this.mainViewElement.lastChild)},t.prototype.displaySpreads=function(e){for(var t=0,n=e.length;t<n;t++)e[t].displaySpread()},t.prototype.getMainViewElement=function(){return this.mainViewElement},t.prototype.setMainViewElement=function(){this.mainViewElement=document.createElement("div"),this.mainViewElement.classList.add(this.mainViewElementClassName)},t.prototype.updateMainViewElementSize=function(){this.mainViewElementSize.width=this.mainViewElement.offsetWidth,this.mainViewElementSize.height=this.mainViewElement.offsetHeight,this.mainViewElementSize.rect=u.getBoundingClientRect(this.mainViewElement)},t.prototype.appendMainViewElementToViewMain=function(){this.viewMain.appendChild(this.mainViewElement)},t.prototype.getSpreadByPageNumber=function(e){var t=this.spreadsPageIndexes.findIndex(function(t){return t&&t.includes(e-1)});return this.epubSpreads[t]},t.prototype.getPagesFromSpreadByPageIndex=function(e){return this.publicationSpreads.find(function(t){return t.includes(e)})},t.prototype.getScaleFromCurrentSpread=function(){return this.getSpreadByPageNumber(this.currentPage).epubSpreadZoomable.epubZoom.scale},t.prototype.zoomToggle=function(e){this.getSpreadByPageNumber(this.currentPage).epubSpreadZoomable.zoomToggle(e)},t.prototype.zoomByStep=function(e){this.getSpreadByPageNumber(this.currentPage).epubSpreadZoomable.zoomByStep(e)},t.prototype.updateSpreads=function(e){var t=this;this.epubPages.resetRequested();var n=this.publicationSpreads.findIndex(function(e){return e.includes(t.currentPage-1)}),i=this.lastSpreadIndex;this.lastSpreadIndex=n,this.updateSpreadOffsets(n,i),this.updateSpreadsPageIndexes(n);for(var a=this.epubSpreads.length,r=0;r<a;r++){var o=this.spreadOffsets[r],s=this.spreadsPageIndexes[r];s&&this.epubSpreads[r].updateSpread(o,s)}this.epubSpreadsAnimations&&(Math.abs(n-this.lastSpreadIndex)>1?this.epubSpreadsAnimations.updatePositionSizeOffset():this.epubSpreadsAnimations.animatePositionOffset(e)),this.epubPages.flushNotRequested()},t.prototype.updateSpreadOffsets=function(e,t){if(this.config.isVerticalOnePage)return void(this.spreadOffsets=this.publicationSpreads.map(function(t,n){return n-e}));if(1===this.spreadsLength)return void(this.spreadOffsets=[0]);if(2===this.spreadsLength)return 0===e?void(this.spreadOffsets=[0,1]):void(this.spreadOffsets=[-1,0]);var n=this.getThreeSpreadOffsets(e),i=this.spreadOffsets.map(function(e){return t+e}),a=n.map(function(t){return e+t}),r=[void 0,void 0,void 0];r=this.fillWithLoadedSpreads(r,n,i,a),r=this.fillWithNeededSpreads(r,n),this.spreadOffsets=r},t.prototype.getThreeSpreadOffsets=function(e){return 0===e?[0,1,2]:e===this.publicationSpreads.length-1?[-2,-1,0]:[-1,0,1]},t.prototype.fillWithLoadedSpreads=function(e,t,n,i){for(var a=function(a){var r=n[a],o=i.findIndex(function(e){return r===e});o!==-1&&(e[a]=t[o])},r=0;r<n.length;r++)a(r);return e},t.prototype.fillWithNeededSpreads=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(void 0===i)for(var a=0;a<t.length;a++){var r=t[a];e.includes(r)||(e[n]=r)}}return e},t.prototype.updateSpreadsPageIndexes=function(e){var t=this;this.spreadsPageIndexes=this.spreadOffsets.map(function(n){return t.publicationSpreads[e+n]})},t.prototype.updateSpreadsSize=function(){var e=0,t=0;for(this.updateMainViewElementSize(),this.epubSpreadsAnimations&&this.epubSpreadsAnimations.updatePositionSizeOffset(),this.generatePublicationSpreads(),this.spreadsPageIndexes=this.publicationSpreads.slice(0,this.config.maxSpreadsLength),this.goToPage(this.currentPage,!1),e=0,t=this.epubSpreads.length;e<t;e++)this.epubSpreads[e].updateSpreadSize()},t.prototype.generatePublicationSpreads=function(){var e=this.isWideScreen();if(this.lastIsWideScreen!==e){this.lastIsWideScreen=e,this.publicationSpreads=[];for(var t=0;t<this.pageQuantity;){var n=this.getSpreadPageIndexes(t);this.publicationSpreads.push(n),t+=n.length}this.initLoadedSpreads()}},t.prototype.getSpreadPageIndexes=function(e){var t=[e,e+1],n=this.getSpreadPageNumber(t);return 1===n?[e]:t},t.prototype.getSpreadPageNumber=function(t){var n=e.Main.xmlManager.get("common-configuration","contents","zoom","width"),i=e.Main.xmlManager.get("common-configuration","contents","zoom","height"),a=n>i,r=this.parent.epubNavigationTypeManager.pageLayout,o=["best","auto"].indexOf(r)!==-1,s="single"===r,l="double"===r,u=this.isWideScreen(),c=t[0]<0||t[1]>=this.pageQuantity,p=1===this.config.firstSpreadSize&&t.includes(0),h=e.Main.xmlManager.get("comboPages","forcedSinglePages").map(function(e){return e-1}),d=e.Main.configsJsonManager.getPagesData(["showAlone"]),f=d.map(function(e,t){return t}).filter(function(e){return d[e].showAlone}),m=h.some(function(e){return t.includes(e)}),g=f.some(function(e){return t.includes(e)}),v=m||g;return s||c||p||v?1:l?2:o===!0&&a?1:o===!0&&u?2:1},t.prototype.initLoadedSpreads=function(){var e=this.config.isVerticalOnePage;this.epubSpreads=new Array(this.spreadsLength),this.spreadOffsets=[];for(var t=0;t<this.spreadsLength;t++)this.spreadOffsets.push(t);e||(this.epubSpreadsAnimations=new o["default"](this,this.config,this.epubSpreads,this.mainViewElement)),this.initSpreads(this.epubSpreads,this.mainViewElement)},t.prototype.scrollTo=function(e,t){this.epubSpreadsAnimations&&this.epubSpreadsAnimations.updatePosition(e,t)},t.prototype.gotoPageByCoordsDiff=function(e){this.epubManager.gotoPageByCoordsDiff(e)},t.prototype.goToPage=function(e,t){void 0===t&&(t=!0),this.epubManager.goToPage(e,t)},t.prototype.getSpreadPageNumberByOffset=function(e){var t=this.spreadOffsets.findIndex(function(t){return t===e});return t!==-1?this.spreadsPageIndexes[t].length:0},t.prototype.getSpreadPageIndexesByPageIndex=function(e){return this.publicationSpreads.find(function(t){return t.includes(e)})||[1]},t.prototype.getNumberOfPageToNextSpread=function(e){return this.getNumberOfPageToChangeSpread(e,!0)},t.prototype.getNumberOfPageToPreviousSpread=function(e){return this.getNumberOfPageToChangeSpread(e,!1)},t.prototype.getNumberOfPageToChangeSpread=function(e,t){var n=this.getSpreadPageIndexesByPageIndex(e),i=n.indexOf(e);return t?n.length-i:i+1},t.prototype.isWideScreen=function(){var t=window.parent!==window;if(!e.Param.isDesktop&&!t){var n=screen;if(n.orientation)return n.orientation.type.includes("landscape");if(n.msOrientation)return n.msOrientation.type.includes("landscape")}return this.screenSize.width>this.screenSize.height},t}();i["default"]=f},{"./EpubClickPermission":3,"./EpubConfig/EpubDefaultConfig":5,"./EpubEvent":8,"./EpubPages":58,"./EpubScrollables":60,"./EpubSpread":61,"./EpubSpreadsAnimations":65,"./utils/ScrollUtil":74,"./utils/functions":78,"./utils/isElementVisible":79}],65:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=e("./utils/cssAnimations"),a=e("./EpubConfig/EpubDefaultConfig"),r=1,o=function(){function e(e,t,n,i){this.parent=e,this.config=t,this.epubSpreads=n,this.mainViewElement=i,this.epubSpreadsLength=n.length,this.screenSize=this.parent.screenSize,this.mainViewElementSize=this.parent.mainViewElementSize,this.epubSpreadsData=new Array(this.epubSpreads.length),this.makeSpreadData(this.epubSpreadsData),this.pixelTimeData={x:0,w:0,y:0,h:0,date:0,time:0},this.currentPosition={width:0,height:0,inX:0,inY:0,diffCoord:0}}return Object.defineProperty(e.prototype,"navigationAxis",{get:function(){return this.config.navigationAxis},enumerable:!0,configurable:!0}),e.prototype.setPixelTime=function(e,t){var n=e-this.pixelTimeData.x,i=t-this.pixelTimeData.y,a=Date.now(),r=a-this.pixelTimeData.date;this.pixelTimeData.x=e,this.pixelTimeData.w=n,this.pixelTimeData.y=t,this.pixelTimeData.h=i,this.pixelTimeData.date=a,this.pixelTimeData.time=r},e.prototype.getPixelTime=function(e,t){var n={w:~~Math.abs(e/this.pixelTimeData.w*this.pixelTimeData.time),h:~~Math.abs(t/this.pixelTimeData.y*this.pixelTimeData.time)};return this.pixelTimeData.x=0,this.pixelTimeData.w=0,this.pixelTimeData.y=0,this.pixelTimeData.h=0,this.pixelTimeData.date=0,this.pixelTimeData.time=0,n},e.prototype.makeSpreadData=function(e){for(var t=0,n=e.length;t<n;t++)e[t]={spreadOffset:0}},e.prototype.animationDomAsyncZero=function(e,t,n,a){this.config.useMatrixTransformScrollable?i.matrixAsync(this.config.use3DMatrixTransform,e,r,t,n,a):i.positionDomAsync(e,r,t,n,a)},e.prototype.animateSpreads=function(e,t,n,i,a,r,o){for(var s,l=0,u=this.epubSpreadsLength,c=0,p=0,h=0,d=0,f=0,m=0,g=0;l<u;l++)g=o,m=r,s=this.epubSpreads[l],0!==s.spreadOffset&&0!==s.lastOffset&&(m=1,g=0),f=s.spreadOffset-s.lastOffset,h=s.lastOffset*e+f*e*m+a*(1-m),d=s.lastOffset*t+f*t*m+a*(1-m),c=n*h,p=i*d,this.animationDomAsyncZero(s.spreadHTMLElement,c,p,g)},e.prototype.updatePositionSizeOffset=function(){this.updatePosition(0,0)},e.prototype.animatePositionOffset=function(e){var t=0,n=0,i=0,r=0;e=e||0,this.navigationAxis===a.NavigationAxis.X?(t=1,n=0):(t=0,n=1),i=this.mainViewElementSize.width,r=this.mainViewElementSize.height,this.currentPosition.width=i,this.currentPosition.height=r,this.currentPosition.inX=t,this.currentPosition.inY=n,this.animateSpreads(this.currentPosition.width,this.currentPosition.height,this.currentPosition.inX,this.currentPosition.inY,this.currentPosition.diffCoord,1,1e3*e)},e.prototype.updatePosition=function(e,t){var n,i=0,r=0,o=0,s=0,l=0,u=0,c=0,p=this.epubSpreadsLength;for(l=this.mainViewElementSize.width,u=this.mainViewElementSize.height,this.navigationAxis===a.NavigationAxis.X?(i=1,r=0,this.currentPosition.diffCoord=e):(i=0,r=1,this.currentPosition.diffCoord=t);c<p;c++)n=this.epubSpreads[c],this.epubSpreadsData[c].spreadOffset=n.spreadOffset,o=i*(n.spreadOffset*l+e),s=r*(n.spreadOffset*u+t),0!==n.spreadOffset&&((n.spreadOffset>0&&o>n.spreadOffset*l||n.spreadOffset<0&&o<n.spreadOffset*l)&&(o=n.spreadOffset*l),(n.spreadOffset>0&&s>n.spreadOffset*u||n.spreadOffset<0&&s<n.spreadOffset*u)&&(s=n.spreadOffset*u)),this.animationDomAsyncZero(n.spreadHTMLElement,o,s,0)},e}();n["default"]=o},{"./EpubConfig/EpubDefaultConfig":5,"./utils/cssAnimations":76}],66:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a=t("./EpubEvent"),r=function(){function t(t){this.epubManager=t,this.trackDateMaxTime=500,this.trackPageDate=0,this.previousPages=[],this.epubEvent=e.epubEvent,this.epubEvent.addListener(a.EPUB_EVENTS.PAGE_CHANGE,this.trackPages.bind(this)),this.epubEvent.addListener(a.EPUB_EVENTS.PAGE_ZOOM,this.trackPagesZoom.bind(this)),this.epubEvent.addListener(a.EPUB_EVENTS.ACTION_LINK_SUCCESS,this.trackLinks.bind(this))}return t.prototype.trackPages=function(t){var n=this.epubManager.getCurrentPages(t.data.pageNumber);if(JSON.stringify(n)!==JSON.stringify(this.previousPages)){if(Date.now()-this.trackPageDate<this.trackDateMaxTime)return void(this.trackPageDate=Date.now());this.trackPageDate=Date.now(),this.previousPages=n,e.Main.trackerManager.trackPage({name:"page",variables:{1:n}}),n.forEach(function(t){return e.Main.trackerManager.trackEvent({name:"pageView",variables:{1:t}})})}},t.prototype.trackPagesZoom=function(t){var n=this.epubManager.getCurrentPages(),i="zoomIn",a={1:""};a[1]=n.join("-"),t.data.status!==!0&&(i="zoomOut"),this.lastZoomScale===t.data.scale&&this.lastZoomedPages===a[1]||0===t.data.scale&&this.lastZoomedPages!==a[1]||(this.lastZoomedPages=a[1],this.lastZoomScale=t.data.scale,e.Main.trackerManager.trackEvent({name:i,variables:a}))},t.prototype.trackLinks=function(t){var n=t.data.userAct;e.Main.trackerManager.trackEvent({name:"link",variables:{1:n.type,2:n.param}})},t}();i.EpubStatistics=r},{"./EpubEvent":8}],67:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=e("./EpubZoomDraggable"),a=function(){function e(e,t){this.epubSpreadZoomable=e,this.config=t,this.totalScale=0,this.totalWidth=0,this.totalHeight=0,this.totalX=0,this.totalY=0,this._scale=0,this._x=0,this._y=0,this.xLimited=!1,this.yLimited=!1,this.xLimit=0,this.yLimit=0,this.elastic={axisMax:100,coef:10},this.parent=this.epubSpreadZoomable,this.maxTotalScale=this.config.maxPageTotalScale,this.screenSize=this.parent.screenSize,this.mainViewElementSize=this.parent.mainViewElementSize,this.epubZoomDraggable=new i["default"](this,this.config)}return Object.defineProperty(e.prototype,"element",{get:function(){return this.parent.element},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleOrig",{get:function(){return this.parent.scale},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xOrig",{get:function(){return this.parent._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yOrig",{get:function(){return this.parent._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"widthOrig",{get:function(){return this.parent.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"heightOrig",{get:function(){return this.parent.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paddingLeft",{get:function(){return this.parent.paddingLeft},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paddingTop",{get:function(){return this.parent.paddingTop},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paddingRight",{get:function(){return this.parent.paddingRight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paddingBottom",{get:function(){return this.parent.paddingBottom},enumerable:!0,configurable:!0}),e.prototype.getBoundingClientRect=function(){return this.parent.getBoundingClientRect()},e.prototype.calcMaxCoord=function(e,t,n,i,a,r){return void 0===a&&(a=0),void 0===r&&(r=0),i.status=!1,t+a+r<n?(i.status=!0,n/2-(t+a+r)/2):e},e.prototype.setMaxX=function(){var e={status:!0},t=this.paddingLeft,n=this.paddingRight;return this.totalX=this.calcMaxCoord(this.totalX,this.totalWidth,this.mainViewElementSize.width,e,t,n),e.status},e.prototype.setMaxY=function(){var e={status:!0},t=this.paddingTop,n=this.paddingBottom;return this.totalY=this.calcMaxCoord(this.totalY,this.totalHeight,this.mainViewElementSize.height,e,t,n),e.status},e.prototype.calcMaxOnDragCoord=function(e,t,n,i,a,r,o){var s=t+n-r>-1,l=t+n+i+o<a+1;if(1===e)s===!0&&l===!0||(s===!0?n=r-t:l===!0&&(n=a-(t+i+o)));else{var u=i/2-(r/2-o/2);n=a/2-u}return n},e.prototype.getZoomNoEvent=function(e,t,n,i){return this.getZoom(null,e,t,n,i)},e.prototype.setZoomY=function(e,t,n){var i=this.paddingTop,a=this.paddingBottom,r=this.y,o=t-n.top||0,s=o/(this.heightOrig*e),l=this.heightOrig*this.totalScale;this.y=(this.heightOrig*e-l)*s+r,this.totalY=this.yOrig+this.y,this.totalHeight=l,this.yLimited=this.setMaxY(),this.yLimit=this.yLimited?0:1,this.totalY=this.calcMaxOnDragCoord(this.yLimit,this.epubZoomDraggable.y,this.totalY,l,this.mainViewElementSize.height,i,a)},e.prototype.setZoomX=function(e,t,n){var i=this.paddingLeft,a=this.paddingRight,r=this.x,o=t-n.left||0,s=o/(this.widthOrig*e),l=this.widthOrig*this.totalScale;this.x=(this.widthOrig*e-l)*s+r,this.totalX=this.xOrig+this.x,this.totalWidth=l,this.xLimited=this.setMaxX(),this.xLimit=this.xLimited?0:1,this.totalX=this.calcMaxOnDragCoord(this.xLimit,this.epubZoomDraggable.x,this.totalX,l,this.mainViewElementSize.width,i,a)},e.prototype.makeScale_=function(e){var t=this.scale;return e=e||1,this.scale=e,this.scale>this.maxTotalScale?this.scale=this.maxTotalScale:this.scale<1&&(this.scale=1),this.totalScale=this.scaleOrig*this.scale,this.scaleOrig*t},e.prototype.makeScale=function(e){var t=this.scale;return e=e||0,this.scale=e,this.scale+this.scaleOrig<this.scaleOrig?this.scale=0:this.scale+this.scaleOrig>this.maxTotalScale+this.scaleOrig&&(this.scale=this.maxTotalScale),this.totalScale=this.scale+this.scaleOrig,this.scaleOrig+t},e.prototype.getZoom=function(e,t,n,i,a){var r=0;this.paddingTop,this.paddingBottom;return r=this.makeScale(t),this.setZoomX(r,n,a),this.setZoomY(r,i,a),[this.totalScale,0,0,this.epubZoomDraggable.x+this.totalX,this.epubZoomDraggable.y+this.totalY]},e.prototype.resetZoom=function(){return this.epubZoomDraggable.resetdrag(),this.scale=0,this.x=0,this.y=0,this.totalX=0,this.totalY=0,this.totalScale=0,[this.scaleOrig,0,0,this.xOrig,this.yOrig]},e.prototype.initdrag=function(e,t,n,i){return this.epubZoomDraggable.initdrag(t,n,i)},e.prototype.initdragX=function(e,t,n){return this.epubZoomDraggable.initdragX(t,n.left)},e.prototype.initdragY=function(e,t,n){return this.epubZoomDraggable.initdragY(t,n.top)},e.prototype.drag=function(e,t,n){return this.epubZoomDraggable.drag(e,t,n)},e.prototype.resetdrag=function(){this.epubZoomDraggable.resetdrag()},e}();n["default"]=a},{"./EpubZoomDraggable":68}],68:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){this.epubZoom=e,this.config=t,this.xRect=0,this.yRect=0,this.xStart=0,this.yStart=0,this._x=0,this._y=0,this.correctionX=0,this.correctionY=0,this.parent=this.epubZoom,this.screenSize=this.parent.screenSize,this.mainViewElementSize=this.parent.mainViewElementSize,this.dragedData=[1,0,0,0,0]}return Object.defineProperty(e.prototype,"element",{get:function(){return this.parent.element},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paddingLeft",{get:function(){return this.parent.paddingLeft},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paddingTop",{get:function(){return this.parent.paddingTop},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paddingRight",{get:function(){return this.parent.paddingRight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paddingBottom",{get:function(){return this.parent.paddingBottom},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleOrig",{get:function(){return this.parent.scale},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xOrig",{get:function(){return this.parent.xOrig},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yOrig",{get:function(){return this.parent.yOrig},enumerable:!0,configurable:!0}),e.prototype.calcMaxOnDragCoord=function(e,t,n,i,a,r,o){if(1===e){var s=t+n-r>0,l=t+n+i+o<a;s===!0?n=r-t:l===!0&&(n=a-(t+i+o))}return n},e.prototype.initdragX=function(e,t){this.correctionX=0,this.xRect=t,this.xStart=e-this.xRect-this.x},e.prototype.initdragY=function(e,t){this.correctionY=0,this.yRect=t,this.yStart=e-this.yRect-this.y},e.prototype.getBoundingClientRect=function(){return this.parent.getBoundingClientRect()},e.prototype.initdrag=function(e,t,n){this.initdragX(e,n.left),this.initdragY(t,n.top)},e.prototype.dragY=function(e,t){var n=this.paddingTop,i=this.paddingBottom,a=0,r=this.parent.yLimited?0:1;this.y=(t-this.yRect-this.yStart)*r,a=this.epubZoom.totalY||this.yOrig;var o=this.calcMaxOnDragCoord(r,a,this.y,this.parent.totalHeight,this.mainViewElementSize.height,n,i);return o!==this.y&&(this.y>0&&this.y<this.correctionY?(this.correctionY=this.y-1,e.gestureData.resetAxis("y")):this.y<0&&this.y>this.correctionY?(this.correctionY=this.y+1,e.gestureData.resetAxis("y")):this.correctionY=this.y),this.y=o,a+this.y},e.prototype.dragX=function(e,t){var n=this.paddingLeft,i=this.paddingRight,a=0,r=this.parent.xLimited?0:1;this.x=(t-this.xRect-this.xStart)*r,a=this.epubZoom.totalX||this.xOrig;var o=this.calcMaxOnDragCoord(r,a,this.x,this.parent.totalWidth,this.mainViewElementSize.width,n,i);return o!==this.x&&(this.x>0&&this.x<this.correctionX?(this.correctionX=this.x-1,e.gestureData.resetAxis("x")):this.x<0&&this.x>this.correctionX?(this.correctionX=this.x+1,e.gestureData.resetAxis("x")):this.correctionX=this.x),this.x=o,a+this.x},e.prototype.drag=function(e,t,n){return this.dragedData=[this.epubZoom.totalScale||this.epubZoom.scaleOrig,0,0,this.dragX(e,t),this.dragY(e,n)],this.dragedData},e.prototype.resetdragY=function(){this.yStart=0,this.y=0},e.prototype.resetdragX=function(){this.xStart=0,this.x=0},e.prototype.resetdrag=function(){this.resetdragX(),this.resetdragY()},e}();n["default"]=i},{}],69:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a,r=t("./EpubPageEnrichment/Slider/index"),o=t("./utils/functions"),s=t("./utils/youtube");!function(e){e.IMAGE="IMAGE",e.MOVIE="MOVIE",e.SLIDER="SLIDER"}(a||(a={}));var l=function(){function t(e){this.config=e,this.optimizeQuality=!1,this.optimizeQualityStat=!1,this.scale=1,this.scaleLastMax=1,this.x=0,this.y=0,this.backgroundSlider=null}return Object.defineProperty(t.prototype,"spreadViewElementClassName",{get:function(){return this.config.spreadViewElementClassName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomableViewElementClassName",{get:function(){return this.config.zoomableViewElementClassName},enumerable:!0,configurable:!0}),t.prototype.getBackgroundColor=function(e){return e&&e.backgroundColor?e.backgroundColor:"transparent"},t.prototype.getBackgroundImageUrl=function(t){return t&&t.backgroundImage&&t.backgroundImage.relUrl?e.Utils.resolveVariable(t.backgroundImage.relUrl):""},t.prototype.getBackgroundMediaUrl=function(t,n){return t&&t.backgroundMedia&&t.backgroundMedia.type===n&&"relUrl"in t.backgroundMedia?e.Utils.resolveVariable(t.backgroundMedia.relUrl):null},t.prototype.getBackgroundSliderPreviewUrl=function(t){var n=t.slides[0],i=n.relUrl,a=n.iconName,o=n.type,l=n.isExternalLink,u=n.externalRelUrl,c="";return o===r.SlideType.IMAGE?c=e.Utils.resolveVariable(i):o===r.SlideType.MOVIE&&a?c=e.Utils.resolveVariable(a):l&&(c=s.getYoutubeVideoCover(u)),c},t.prototype.getBackgroundPosition=function(e){return e&&e.backgroundMedia&&"position"in e.backgroundMedia&&e.backgroundMedia.position},t.prototype.getGeneralBackgroundStyle=function(){
return e.Main.configsJsonManager.get("generalData.bgStyle.epubStyle")},t.prototype.getPageBackgroundStyle=function(t){var n=t-1,i=e.Main.configsJsonManager.getPageData(["bgStyle"],n).bgStyle;return i&&i.epubStyle?i.epubStyle:null},t.prototype.getEpubBackgroundStyle=function(e){var t=this.getPageBackgroundStyle(e),n=t&&(t.backgroundMedia||t.backgroundColor||t.backgroundImage);return n?this.getPageBackgroundStyle(e):this.getGeneralBackgroundStyle()},t.prototype.getBackgroundElement=function(){var e=this.element.querySelector(".spread-background");return e||(e=document.createElement("div"),e.id="spread-background-"+this.spreadIndex,e.className="spread-background",this.element.appendChild(e)),e},t.prototype.getBackgroundColors=function(t){var n=this.getEpubBackgroundStyle(t[0]),i=n?this.getBackgroundColor(n):e.Main.pageManager.getBackgroundColor(t[0]),a=i;if(t.length>1){var r=this.getEpubBackgroundStyle(t[1]);a=r?this.getBackgroundColor(r):e.Main.pageManager.getBackgroundColor(t[1])}return{left:i,right:a}},t.prototype.isBackgroundSlider=function(e){return e&&e.backgroundMedia&&e.backgroundMedia.type===a.SLIDER},t.prototype.setBackgroundSlider=function(e,t,n){var i=this.isBackgroundSlider(e),a=this.element.classList.contains("spread-is-visible"),o=this.backgroundSlider&&this.backgroundSlider.page===t[0];if(!this.backgroundSlider||a&&o||this.clearBackgroundSliders(),i&&a&&(!this.backgroundSlider||!o)){var s="spread-background-"+this.spreadIndex,l=e.backgroundMedia,u=l.slides,c=l.settings;this.backgroundSlider={instance:new r.Slider(n,u,s,t[0],c,r.SliderType.SPREAD_BACKGROUND),page:t[0]}}},t.prototype.setBackgroundCSSStyle=function(e,t,n){var i=this.getCSSBackground(e,t);this.background!==i&&(this.background=i,n.style.backgroundImage=i)},t.prototype.getVideoCover=function(t){return e.Utils.getFilenameWithoutExtension(t)+"/cover.jpg"},t.prototype.getCSSBackground=function(e,t){var n=this.isBackgroundSlider(e);if(n)return"url("+this.getBackgroundSliderPreviewUrl(e.backgroundMedia)+")";var i=this.getBackgroundMediaUrl(e,a.MOVIE);if(i){var r=this.getVideoCover(i);return"url("+r+")"}var o=this.getBackgroundImageUrl(e),s=this.getBackgroundMediaUrl(e,a.IMAGE),l=o||s;if(l)return"url("+l+")";var u=this.getBackgroundColors(t),c=u.left,p=u.right;return"linear-gradient(90deg,"+c+" 50%, "+p+" 50%)"},t.prototype.setBackgroundVideo=function(e){var t=this.getBackgroundMediaUrl(e,a.MOVIE),n=this.element.querySelector("video.spread-bgVideo"),i=!this.config.isVerticalOnePage||this.element.classList.contains("spread-is-visible");if(null===n&&i&&t&&(n=document.createElement("video"),n.id="spread-background-"+this.spreadIndex,n.classList.add("spread-bgVideo"),n.autoplay=!1,n.muted=!0,n.setAttribute("playsinline",""),n.loop=!0,this.element.insertBefore(n,this.element.firstChild)),n)if(i&&t){var r=n.src.split("/"),o=r[r.length-1],s=t.split("/"),l=s[s.length-1],u=o===l;u||(n.src=t,n.poster=this.getVideoCover(t))}else n.parentNode&&n.parentNode.removeChild(n)},t.prototype.setBackgroundPosition=function(t){var n=this.getBackgroundPosition(t),i="spread-background-styles-"+this.spreadIndex,r=this.element.querySelector("#"+i),o=this.getBackgroundMediaUrl(t,a.MOVIE);if(n){r||(r=document.createElement("style"),r.id=i);var s=1,l=50,u=50,c=992,p=o?"object-position":"background-position",h=function(e,t){return void 0===e?t:e},d=h(n.phone&&n.phone.left,u),f=h(n.phone&&n.phone.top,l),m=h(n.phone&&n.phone.scale,s),g=h(n.desktop&&n.desktop.left,u),v=h(n.desktop&&n.desktop.top,l),b=h(n.desktop&&n.desktop.scale,s),y="\n\t\t\t\t#spread-background-"+this.spreadIndex+" {\n\t\t\t\t\t"+p+": "+d+"% "+f+"%;\n\t\t\t\t\ttransform: scale("+m+");\n\t\t\t\t}\n\n\t\t\t\t@media screen and (min-width: "+c+"px) {\n\t\t\t\t\t#spread-background-"+this.spreadIndex+" {\n\t\t\t\t\t\t"+p+": "+g+"% "+v+"%;\n\t\t\t\t\t\ttransform: scale("+b+");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t",E=e.Param.userAgent,M=E.browser,S=E.BROWSER,P=M.name===S.IE||M.name===S.EDGE&&M.version<=18;o&&P&&(y+="\n\t\t\t\t\t#spread-background-"+this.spreadIndex+".spread-bgVideo {\n\t\t\t\t\t\ttop: "+f+"%;\n\t\t\t\t\t\tleft: "+d+"%;\n\t\t\t\t\t\ttransform: translate(-"+d+"%, -"+f+"%) scale("+m+");\n\t\t\t\t\t}\n\n\t\t\t\t\t@media screen and (min-width: "+c+"px) {\n\t\t\t\t\t\t#spread-background-"+this.spreadIndex+".spread-bgVideo {\n\t\t\t\t\t\t\ttop: "+v+"%;\n\t\t\t\t\t\t\tleft: "+g+"%;\n\t\t\t\t\t\t\ttransform: translate(-"+g+"%, -"+v+"%) scale("+b+");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t"),r.innerHTML=y,this.element.appendChild(r)}else r&&this.element.removeChild(r)},t.prototype.setBackground=function(e){if(0!==e.length){var t=this.getEpubBackgroundStyle(e[0]),n=this.getBackgroundElement();this.setBackgroundSlider(t,e,n),this.setBackgroundCSSStyle(t,e,n),this.setBackgroundVideo(t),this.setBackgroundPosition(t)}},t.prototype.clearBackgroundSliders=function(){this.backgroundSlider&&(this.backgroundSlider.instance.stop(),this.backgroundSlider=null)},t.prototype.initSpread=function(e,t,n,i){this.config=t,this.epubSpreadZoomable=n,this.spreadIndex=i,this.element=document.createElement("div"),this.element.classList.add(this.spreadViewElementClassName),this.element.classList.add(this.spreadViewElementClassName+"-"+this.spreadIndex),this.element.innerHTML="",this.element.appendChild(this.epubSpreadZoomable.getElement())},t.prototype.initZoomable=function(e,t){this.element=document.createElement("div"),this.element.classList.add(this.zoomableViewElementClassName)},t.prototype.removeChilren=function(){o.htmlSecureRemoveChildren(this.element)},t.prototype.scrollToTop=function(){this.element.scrollTop=0},t.prototype.setSpreadScrollable=function(e){return e===!0?(this.element.style["overflow-y"]="auto",void(this.element.style.webkitOverflowScrolling="touch")):(this.element.style["overflow-y"]="hidden",void(this.element.style.webkitOverflowScrolling="auto"))},t}();i["default"]=l},{"./EpubPageEnrichment/Slider/index":56,"./utils/functions":78,"./utils/youtube":81}],70:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a=t("../../EpubEvent"),r=t("./View"),o=function(){function t(t){this.epubManager=t,this.didPageChange=!1,this.isMouseNearEdge=!1,this.hasFocus=!1,this.hasMouseOver=!1,this.userAgent=e.Param.userAgent,this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this),this.onInputChange=this.onInputChange.bind(this),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onPageChange=this.onPageChange.bind(this),this.updateMousePosition=this.updateMousePosition.bind(this),this.config=this.epubManager.config,this.epubEvent=e.epubEvent,this.viewPageToastParams={parentElement:this.epubManager.viewMain,values:{currentPage:this.currentPage,pageQuantity:this.config.pageQuantity},listeners:{onFocus:this.onFocus,onBlur:this.onBlur,onInputChange:this.onInputChange,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave}},this.init()}return Object.defineProperty(t.prototype,"currentPage",{get:function(){return this.epubManager.currentPage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVisible",{get:function(){return this.didPageChange||this.isMouseNearEdge||this.hasFocus||this.hasMouseOver},enumerable:!0,configurable:!0}),t.prototype.updateVisiblity=function(){this.panel.updateVisibility(this.isVisible)},t.prototype.updateFocus=function(){this.panel.updateFocus(this.hasFocus)},t.prototype.setDidPageChange=function(e){this.didPageChange=e,this.updateVisiblity()},t.prototype.init=function(){var t=this;this.panel=new r.View(this.viewPageToastParams),this.panel.init().then(function(){if(t.epubEvent.addListener(a.EPUB_EVENTS.PAGE_CHANGE,t.onPageChange),t.userAgent.isDesktop()){var n=100;document.addEventListener("mousemove",e.Utils.throttle(t.updateMousePosition,n))}})},t.prototype.onPageChange=function(e){var t=this,n=e.data,i=n.pageNumber,a=n.pageChanged;a&&(this.panel.updateCurrentPage(i),1!==i&&(this.setDidPageChange(!0),clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(function(){return t.setDidPageChange(!1)},2e3)))},t.prototype.updateMousePosition=function(e){var t=10,n=.45,i=e.y>=document.body.offsetHeight-t,a=document.body.offsetWidth*(1-n)/2,r=e.x>a&&e.x<document.body.offsetWidth-a;this.isMouseNearEdge=i&&r,this.updateVisiblity()},t.prototype.onMouseEnter=function(){this.hasMouseOver=!0,this.updateFocus()},t.prototype.onMouseLeave=function(){this.hasMouseOver=!1,this.updateFocus()},t.prototype.onFocus=function(){this.hasFocus=!0,this.updateFocus()},t.prototype.onBlur=function(){this.hasFocus=!1,this.updateFocus()},t.prototype.onInputChange=function(t){t.currentTarget&&(this.epubManager.currentPage=e.Utils.byOffsetIndex(t.currentTarget.value,!0))},t}();i.Controller=o},{"../../EpubEvent":8,"./View":71}],71:[function(t,n,i){var a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(i,"__esModule",{value:!0});var r=t("../panel/View"),o=function(t){function n(n){var i=t.call(this,n)||this;return i.params=n,i.classElement="epub-page-toast",i.pageToastPath=e.Param.pathTemplate+"epub/component/pageToast/index.html",i.userAgent=e.Param.userAgent,i}return a(n,t),n.prototype.updateCurrentPage=function(e){this.updateCurrentPageElement(e),this.updateInputElement(e)},n.prototype.updateVisibility=function(e){this.pageToastElement.classList.toggle("visible",e)},n.prototype.updateFocus=function(e){this.pageToastElement.classList.toggle("focused",e)},n.prototype.setView=function(){var n=this,i=this.params.values,a=i.currentPage,r=i.pageQuantity,o=[];o.push(t.prototype.setView.call(this)),o.push(this.loadTemplate(this.pageToastPath,{currentPage:e.Utils.byOffsetIndex(a),pageQuantity:e.Utils.byOffsetIndex(r),hasInput:this.userAgent.isDesktop()})),o[1].then(function(e){n.pageToastElement=e});var s=Promise.all(o);return s.then(function(){n.setElements()}),s},n.prototype.createCurrentPageElement=function(){this.currentPageElement=this.pageToastElement.querySelector(".current_page")},n.prototype.createInputElement=function(){var e=this.params.listeners,t=e.onFocus,n=e.onBlur,i=e.onInputChange;this.inputElement=this.pageToastElement.querySelector("input#page_toast-page"),this.inputElement&&(this.inputElement.addEventListener("focus",t),this.inputElement.addEventListener("blur",n),this.inputElement.addEventListener("change",i))},n.prototype.updateCurrentPageElement=function(t){this.currentPageElement.innerHTML=e.Utils.byOffsetIndex(t)},n.prototype.updateInputElement=function(t){this.inputElement&&(this.inputElement.value=e.Utils.byOffsetIndex(t))},n.prototype.setElements=function(){var e=this.params.listeners,t=e.onMouseEnter,n=e.onMouseLeave;this.view.appendChild(this.pageToastElement),this.createCurrentPageElement(),this.createInputElement(),this.pageToastElement.addEventListener("mouseenter",t),this.pageToastElement.addEventListener("mouseleave",n)},n}(r.View);i.View=o},{"../panel/View":72}],72:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function t(t){this.params=t,this.classElement="epub-page_control-button",this.shown=!1,this.opened=!1,this.panelTemplatePath=e.Param.pathTemplate+"epub/component/panel/index.html",this.htmlPlaceHolder=document.createElement("div"),this.htmlPlaceHolder.style.display="none",this.params.parentElement.appendChild(this.htmlPlaceHolder)}return t.prototype.init=function(){var e=this,t=this.setView();return t.then(function(){e.addView()}),t},t.prototype.addToView=function(e){this.view.replaceChild(this.htmlPlaceHolder,e)},t.prototype.loadTemplate=function(t,n){var i=document.createElement("div"),a=new Promise(function(a,r){e.Main.templateManager.load(t,i,n).then(function(e){a(e[0])})});return a},t.prototype.setView=function(){var e=this,t=this.loadTemplate(this.panelTemplatePath,{});return t.then(function(t){e.view=t,e.view.classList.add.apply(e.view.classList,e.classElement.split(" "))}),t},t.prototype.addView=function(){this.params.parentElement.replaceChild(this.view,this.htmlPlaceHolder)},t.prototype.show=function(e){e===!0&&this.shown===!1||e===!1&&this.shown===!0},t.prototype.open=function(e){e===!0&&this.opened===!1||e===!1&&this.opened===!0},t}();i.View=a},{}],73:[function(e,t,n){function i(){function e(e,t){var i=n.prototype,a=i.matches||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||function(e){return[].indexOf.call(document.querySelectorAll(e),this)!==-1};return a.call(e,t)}function t(t){for(var n;n=this.parentElement;)if(e(n,t))return n}var n=window.Element;n&&!n.prototype.closest&&(n.prototype.closest=t)}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i},{}],74:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e){this.element=e,this.lastScrollTop=this.element.scrollTop}return e.prototype.isScrollDown=function(){var e=this.element.scrollTop,t=e>this.lastScrollTop;return this.lastScrollTop=e,t},e}();n["default"]=i},{}],75:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),e("es6-promise");var i=function(){function e(){}return e.GET="GET",e.get="GET",e.POST="POST",e.post="POST",e}();n.Protocol=i;var a=function(){function e(e,t,n){void 0===e&&(e=i.GET),void 0===t&&(t=""),void 0===n&&(n=null),this.protocol=e,this.url=t,this.data=n,this.xhr=new XMLHttpRequest}return e.prototype.onreadystatechange=function(){if(4===this.xhr.readyState)return 404===this.xhr.status?void this.reject(this):void this.resolve(this.xhr)},e.prototype.executeur=function(e,t){this.resolve=e,this.reject=t,this.xhr.open(this.protocol,this.url,!0),this.xhr.onreadystatechange=this.onreadystatechange.bind(this),this.xhr.send(this.data)},e.prototype.init=function(){return new Promise(this.executeur.bind(this))},e}();n["default"]=a},{"es6-promise":1}],76:[function(e,t,n){function i(e){if(e.element.style.transitionDuration="0",e.optimizeQualityStat!==!0){var t=e.scale;e.optimizeQualityStat=!0,l[0]=t,l[3]=t,l[4]=e.x,l[5]=e.y,e.frameTimer2d=o.styleTransform(e.element,"matrix("+l.join(",")+")")}}function a(e,t,n,a,r,u){if(n=~~(1e3*n)/1e3,a=~~a,r=~~r,t.scale!==n||t.x!==a||t.y!==r||t.optimizeQualityStat!==!0){t.scale=n,t.x=a,t.y=r,t.matrix2d=t.matrix2d||i.bind(null,t);var c;e?(s[0]=n,s[5]=n,s[12]=a,s[13]=r,c="matrix3d("+s.join(",")+")"):(l[0]=n,l[3]=n,l[4]=a,l[5]=r,c="matrix("+l.join(",")+")"),cancelAnimationFrame(t.frameTimer3d),t.frameTimer3d=o.styleTransform(t.element,c,function(){t.element.style.transitionDuration=(u||"0")+"ms"}),t.optimizeQualityStat=!1,cancelAnimationFrame(t.frameTimer2d),clearTimeout(t.timer)}}function r(e,t,n,i,a){e.scale===t&&e.x===n&&e.y===i||(e.scale=t,e.x=n,e.y=i,e.element.style.cssText+="transition-duration:"+(a+"ms"||"0")+" ;transform: none; left: "+n/t+"px; top: "+i/t+"px; zoom: "+t+";",e.optimizeQualityStat=!1)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./functions"),s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l=[1,0,0,1,0,0];n.matrixAsync=a,n.positionDomAsync=r},{"./functions":78}],77:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i;!function(e){e[e.EPUB_HTML=0]="EPUB_HTML",e[e.PDF_HTML=1]="PDF_HTML",e[e.PDF_SVG=2]="PDF_SVG",e[e.PDF_IMG=3]="PDF_IMG",e[e.PDF_PDF=4]="PDF_PDF"}(i=n.READER_TYPES||(n.READER_TYPES={}));var a;!function(e){e[e.INIT=0]="INIT",e[e.START=1]="START",e[e.STOP=2]="STOP",e[e.FLUSH=3]="FLUSH"}(a=n.ShapeActivityStatus||(n.ShapeActivityStatus={}));var r;!function(e){e[e.blink=0]="blink",e[e["static"]=1]="static",e[e.none=2]="none",e[e.revealOnTap=3]="revealOnTap"}(r=n.LinksBehaviors||(n.LinksBehaviors={}));var o;!function(e){e[e.hdpi=0]="hdpi",e[e.mdpi=1]="mdpi",e[e.ldpi=2]="ldpi",e[e.svg=3]="svg"}(o=n.PagesImagesQualities||(n.PagesImagesQualities={}))},{}],78:[function(t,n,i){function a(e,t){void 0===t&&(t=1);var n=e.getBoundingClientRect();return{bottom:n.bottom*t,height:n.height*t,left:n.left*t,top:n.top*t,width:n.width*t}}function r(e){for(var t;t=e.lastChild;)e.removeChild(t)}function o(e){var t=e.tagName.toLowerCase();return"video"===t||"audio"===t}function s(){return e.Param.isPortrait=window.innerWidth<=window.innerHeight,!e.Param.isPortrait}function l(){var e=window.innerHeight/document.documentElement.clientHeight*100;document.documentElement.style.height=e+"%"}function u(){var e={promise:null,resolve:null,reject:null,then:function(){}};e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n});var t=e.promise;return e.then=t.then.bind(t),e}function c(e){var t=/[+-]?\d+(\.\d+)?/g,n=e.match(t);return n?+n[0]:0}Object.defineProperty(i,"__esModule",{value:!0}),i.getBoundingClientRect=a;var p=function(){var e="transform";return"transform"in document.body.style?e="transform":"webkitTransform"in document.body.style?e="webkitTransform":"msTransform"in document.body.style&&(e="msTransform"),function(t,n,i){return window.requestAnimationFrame(function(){i&&i(),t.style[e]=n})}}();i.styleTransform=p,i.htmlSecureRemoveChildren=r,i.isMediaElement=o,i.isWindowLandscape=s,i.resizeHTMLTagElement=l,i.getSplitedPromise=u,i.getNumberFromString=c},{}],79:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i;!function(e){e.ANY="any",e.BOTTOM="bottom",e.TOP="top"}(i||(i={})),n.ElementVisibleMode=i;var a=function(e,t,n){var a=e.getBoundingClientRect(),r=a.bottom,o=a.top,s=n&&n.bottom||0,l=n&&n.top||0,u=window.innerHeight,c=o<l,p=o>u-s,h=r<l,d=r>u-s;switch(t){case i.ANY:var f=c&&h,m=p&&d;return!(f||m);case i.BOTTOM:return!(h||d);case i.TOP:return!(c||p)}};n.isElementVisible=a},{}],80:[function(e,t,n){function i(){return"ontouchstart"in window||navigator.maxTouchPoints>0}Object.defineProperty(n,"__esModule",{value:!0}),n.isTouchSupported=i},{}],81:[function(t,n,i){var a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,r){function o(e){try{l(i.next(e))}catch(t){r(t)}}function s(e){try{l(i["throw"](e))}catch(t){r(t)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,r&&(o=2&n[0]?r["return"]:n[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,r=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(i){n=[6,i],r=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,r,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},o=this;Object.defineProperty(i,"__esModule",{value:!0});var s;!function(e){e[e.UNSTARTED=-1]="UNSTARTED",e[e.ENDED=0]="ENDED",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED",e[e.BUFFERING=3]="BUFFERING",e[e.VIDEO_CUED=5]="VIDEO_CUED"}(s||(s={})),i.YoutubePlayerState=s;var l="youtubeStateChange";i.YOUTUBE_STATE_CHANGE_EVENT=l;var u=function(e,t){return t?t.video_id+"-"+t.title:e},c=function(t){return function(n){var i=n.target.getVideoData&&n.target.getVideoData(),a=u(t,i);document.dispatchEvent(new CustomEvent(l,{detail:{state:n.data}})),n.data===s.PLAYING?e.Main.trackerManager.trackEvent({name:"videoPlay",variables:{1:a,2:n.target.playerInfo&&n.target.playerInfo.currentTime}}):n.data===s.PAUSED?e.Main.trackerManager.trackEvent({name:"videoPause",variables:{1:a,2:n.target.playerInfo&&n.target.playerInfo.currentTime}}):n.data===s.ENDED&&e.Main.trackerManager.trackEvent({name:"videoEnd",variables:{1:a}})}},p=function(e){return a(o,void 0,void 0,function(){var t;return r(this,function(n){switch(n.label){case 0:return e.dataset.isTracked?[2]:(e.dataset.isTracked="true",t=e.closest("[id]").id,[4,loadYouTubePlayerAPI()]);case 1:return n.sent(),YT_ready(function(){var n=getFrameID(t);n&&new YT.Player(n,{events:{onStateChange:c(e.src)}})}),[2]}})})};i.addYoutubeTrackStateChange=p;var h=function(t){return e.Main.consentManager&&e.Main.consentManager.getServiceConsent("webpublicationYoutube")===!0?t:t.replace("www.youtube.com","www.youtube-nocookie.com")};i.getCorrectYoutubeDomain=h;var d=function(e){var t="https://i.ytimg.com/vi/",n=f(e);return""+t+n+"/maxresdefault.jpg"};i.getYoutubeVideoCover=d;var f=function(e){var t=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,n=e.match(t);return n?n[2].split('" ')[0]:""}},{}]},{},[14])}(window.webpublicationNamespace||window.w);