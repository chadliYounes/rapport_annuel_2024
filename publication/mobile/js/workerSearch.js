"use strict";!function(e){function t(){this.pageLength=0,this.stringSize=50,this.stringPrefix="...",this.stringSuffix="...",this.xmlUrl="",this.currentSearch=""}var r={};t.prototype.loadXml=function(){var e=this.xmlUrl,t=new XMLHttpRequest;t.open("GET",e,!0),t.onreadystatechange=function(){4===t.readyState&&self.postMessage({method:"parse",data:t.responseText})},t.send()},t.prototype.normalize=function(e){for(var t=["ßàáâãäåæçèéêëìíîïðñòóôõöøšùúûüýýþÿž","saaaaaaaceeeeiiiidnoooooosuuuuyybyz"],r={},a=0,n=t[0].length;a<n;a++)r[t[0][a]]=new RegExp(t[0][a],"g");return function(e){if(void 0===e)return"";if("string"!=typeof e)return e;e=e.toLowerCase();for(var a=0,n=t[0].length;a<n;a++)e=e.replace(r[t[0][a]],t[1][a]);return e.replace(/[^\w\u4E00-\uFA29\u0621-\u064A]]/g,"-")}}(),t.prototype.parseJson=function(e){var t=e.texts.page;t=t instanceof Array?t:[t];for(var a=0;a<t.length;a++){var n=t[a]["@label"]||t[a]["@l"],i=t[a].keyValue,s=t[a].container;s instanceof Array||(s=void 0===s?[]:[s]);var o=s.map(function(e){return{text:e.keyValue,id:e["@id"],parentId:e["@parent_id"]}});r[t[a]["@num"]]={pageText:i,containers:o,label:n}}},t.prototype.prepareCache=function(){this.loadXml()},t.prototype.setPageLength=function(e){this.pageLength=e},t.prototype.setXmlUrl=function(e){this.xmlUrl=e},t.prototype.setPrefix=function(e){"undefined"!=typeof e&&(this.stringPrefix=e)},t.prototype.setWordSearch=function(e){"undefined"!=typeof e&&(this.wordSearch=e)},t.prototype.setSuffix=function(e){"undefined"!=typeof e&&(this.stringSuffix=e)},t.prototype.setStringSize=function(e){"undefined"!=typeof e&&(this.stringSize=e)},t.prototype.getSearchMessage=function(e,t,a,n,i){function s(e,t){return e.indexOf(t)>-1&&(o=e.indexOf(t),!0)}var o,h,c=this.normalize(t),p=this.normalize(e);if(i?(o=c.indexOf(p),h=o!==-1):h=p.split("-").every(s.bind(this,c)),h){var f=Math.min(t.length+p.length,o+p.length+this.stringSize),d=Math.max(o-this.stringSize,0),g=t.substring(d,f);if(d>0&&(g=this.stringPrefix+g),f<t.length&&(g+=this.stringSuffix),g=i?g.replace(new RegExp("("+p+"|"+e+")","igm"),"<b>$1</b>"):g.replace(new RegExp("("+p.split("-").join("[^a-zA-Z0-9]")+"|"+p.replace(/-/gim,"|")+"|"+e.replace(/-/gim,"|")+")","igm"),"<b>$1</b>"),this.normalize(this.currentSearch)===p){var u={method:"result",page:a,string:g,isStrict:i,container:n,label:r[a].label};return u}}},t.prototype.start=function(e){this.currentSearch=e;for(var t=Object.keys(r),a=0;a<t.length;a++){var n=t[a],i=r[n];this.search(e,i.pageText,n,void 0),this.searchInContainers(e,i.containers,n)}self.postMessage({method:"end"})},t.prototype.searchInContainers=function(e,t,r){for(var a=0;a<t.length;a++){var n=t[a];this.search(e,n.text,r,{id:n.id,parentId:n.parentId})}},t.prototype.search=function(e,t,r,a){var n=this.searchAndPost(e,t,r,a,!0);n||this.searchAndPost(e,t,r,a,!1)},t.prototype.searchAndPost=function(e,t,r,a,n){var i=this.getSearchMessage(e,t,r,a,n);return i&&self.postMessage(i),!!i},e.Search=t}(self);var search=new Search;self.addEventListener("message",function(e){"config"===e.data.method?(search.setPageLength(e.data.pageLength),search.setXmlUrl(e.data.xmlUrl),search.setPrefix(e.data.prefix),search.setSuffix(e.data.suffix),search.setStringSize(e.data.stringSize),search.setWordSearch(e.data.wordSearch),search.prepareCache()):"search"===e.data.method?search.start(e.data.search):"parsedString"===e.data.method&&search.parseJson(e.data.data)},!1);