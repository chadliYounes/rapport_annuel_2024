!function e(t,n,r){function i(s,u){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!u&&c)return c(s,!0);if(o)return o(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){(function(r,i){!function(e,r){"object"==typeof n&&"undefined"!=typeof t?t.exports=r():"function"==typeof define&&define.amd?define(r):e.ES6Promise=r()}(this,function(){"use strict";function t(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function n(e){return"function"==typeof e}function o(e){z=e}function s(e){Q=e}function u(){return function(){return r.nextTick(p)}}function c(){return"undefined"!=typeof W?function(){W(p)}:f()}function a(){var e=0,t=new $(p),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function l(){var e=new MessageChannel;return e.port1.onmessage=p,function(){return e.port2.postMessage(0)}}function f(){var e=setTimeout;return function(){return e(p,1)}}function p(){for(var e=0;e<K;e+=2){var t=ne[e],n=ne[e+1];t(n),ne[e]=void 0,ne[e+1]=void 0}K=0}function h(){try{var t=e,n=t("vertx");return W=n.runOnLoop||n.runOnContext,c()}catch(r){return f()}}function d(e,t){var n=arguments,r=this,i=new this.constructor(y);void 0===i[ie]&&x(i);var o=r._state;return o?!function(){var e=n[o-1];Q(function(){return M(o,i,e,r._result)})}():P(r,i,e,t),i}function v(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(y);return E(n,e),n}function y(){}function g(){return new TypeError("You cannot resolve a promise with itself")}function m(){return new TypeError("A promises callback cannot return that same promise.")}function w(e){try{return e.then}catch(t){return ce.error=t,ce}}function _(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function b(e,t,n){Q(function(e){var r=!1,i=_(n,t,function(n){r||(r=!0,t!==n?E(e,n):T(e,n))},function(t){r||(r=!0,O(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,O(e,i))},e)}function A(e,t){t._state===se?T(e,t._result):t._state===ue?O(e,t._result):P(t,void 0,function(t){return E(e,t)},function(t){return O(e,t)})}function j(e,t,r){t.constructor===e.constructor&&r===d&&t.constructor.resolve===v?A(e,t):r===ce?(O(e,ce.error),ce.error=null):void 0===r?T(e,t):n(r)?b(e,t,r):T(e,t)}function E(e,n){e===n?O(e,g()):t(n)?j(e,n,w(n)):T(e,n)}function L(e){e._onerror&&e._onerror(e._result),R(e)}function T(e,t){e._state===oe&&(e._result=t,e._state=se,0!==e._subscribers.length&&Q(R,e))}function O(e,t){e._state===oe&&(e._state=ue,e._result=t,Q(L,e))}function P(e,t,n,r){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+se]=n,i[o+ue]=r,0===o&&e._state&&Q(R,e)}function R(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,i=void 0,o=e._result,s=0;s<t.length;s+=3)r=t[s],i=t[s+n],r?M(n,r,i,o):i(o);e._subscribers.length=0}}function C(){this.error=null}function k(e,t){try{return e(t)}catch(n){return ae.error=n,ae}}function M(e,t,r,i){var o=n(r),s=void 0,u=void 0,c=void 0,a=void 0;if(o){if(s=k(r,i),s===ae?(a=!0,u=s.error,s.error=null):c=!0,t===s)return void O(t,m())}else s=i,c=!0;t._state!==oe||(o&&c?E(t,s):a?O(t,u):e===se?T(t,s):e===ue&&O(t,s))}function N(e,t){try{t(function(t){E(e,t)},function(t){O(e,t)})}catch(n){O(e,n)}}function S(){return le++}function x(e){e[ie]=le++,e._state=void 0,e._result=void 0,e._subscribers=[]}function I(e,t){this._instanceConstructor=e,this.promise=new e(y),this.promise[ie]||x(this.promise),H(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?T(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&T(this.promise,this._result))):O(this.promise,D())}function D(){return new Error("Array Methods must be provided an Array")}function V(e){return new I(this,e).promise}function q(e){var t=this;return new t(H(e)?function(n,r){for(var i=e.length,o=0;o<i;o++)t.resolve(e[o]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function B(e){var t=this,n=new t(y);return O(n,e),n}function J(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function U(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function F(e){this[ie]=S(),this._result=this._state=void 0,this._subscribers=[],y!==e&&("function"!=typeof e&&J(),this instanceof F?N(this,e):U())}function G(){var e=void 0;if("undefined"!=typeof i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;if(n){var r=null;try{r=Object.prototype.toString.call(n.resolve())}catch(t){}if("[object Promise]"===r&&!n.cast)return}e.Promise=F}var Y=void 0;Y=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var H=Y,K=0,W=void 0,z=void 0,Q=function(e,t){ne[K]=e,ne[K+1]=t,K+=2,2===K&&(z?z(p):re())},X="undefined"!=typeof window?window:void 0,Z=X||{},$=Z.MutationObserver||Z.WebKitMutationObserver,ee="undefined"==typeof self&&"undefined"!=typeof r&&"[object process]"==={}.toString.call(r),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ne=new Array(1e3),re=void 0;re=ee?u():$?a():te?l():void 0===X&&"function"==typeof e?h():f();var ie=Math.random().toString(36).substring(16),oe=void 0,se=1,ue=2,ce=new C,ae=new C,le=0;return I.prototype._enumerate=function(e){for(var t=0;this._state===oe&&t<e.length;t++)this._eachEntry(e[t],t)},I.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===v){var i=w(e);if(i===d&&e._state!==oe)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(n===F){var o=new n(y);j(o,e,i),this._willSettleAt(o,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},I.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===oe&&(this._remaining--,e===ue?O(r,n):this._result[t]=n),0===this._remaining&&T(r,this._result)},I.prototype._willSettleAt=function(e,t){var n=this;P(e,void 0,function(e){return n._settledAt(se,t,e)},function(e){return n._settledAt(ue,t,e)})},F.all=V,F.race=q,F.resolve=v,F.reject=B,F._setScheduler=o,F._setAsap=s,F._asap=Q,F.prototype={constructor:F,then:d,"catch":function(e){return this.then(null,e)}},F.polyfill=G,F.Promise=F,F})}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:2}],2:[function(e,t,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(f===setTimeout)return setTimeout(e,0);if((f===r||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function s(e){if(p===clearTimeout)return clearTimeout(e);if((p===i||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function u(){y&&d&&(y=!1,d.length?v=d.concat(v):g=-1,v.length&&c())}function c(){if(!y){var e=o(u);y=!0;for(var t=v.length;t;){for(d=v,v=[];++g<t;)d&&d[g].run();g=-1,t=v.length}d=null,y=!1,s(e)}}function a(e,t){this.fun=e,this.array=t}function l(){}var f,p,h=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:r}catch(e){f=r}try{p="function"==typeof clearTimeout?clearTimeout:i}catch(e){p=i}}();var d,v=[],y=!1,g=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];v.push(new a(e,t)),1!==v.length||y||o(c)},a.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=l,h.addListener=l,h.once=l,h.off=l,h.removeListener=l,h.removeAllListeners=l,h.emit=l,h.prependListener=l,h.prependOnceListener=l,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){this.listeners={},this.iName="ApiEvent"}return e.prototype.addListener=function(e,t){"undefined"==typeof this.listeners[e]&&(this.listeners[e]=[]),this.listeners[e].indexOf(t)===-1&&this.listeners[e].push(t)},e.prototype.fire=function(e){var t,n,r=0,i=0;if(e.target||(e.target=this),e.context||(e.context=this),this.listeners[e.type]instanceof Array){t=this.listeners[e.type],n=[];var o=void 0;for(i=t.length;r<i;r++)n.push(t[r]);for(;o=n.shift();)t.indexOf(o)!==-1&&o(e)}},e.prototype.removeListener=function(e,t){var n,r=0,i=0;if(this.listeners[e]instanceof Array)for(n=this.listeners[e],r=n.length;i<r;i++){if(null!==t&&n[i]===t){n.splice(i,1);break}null===t&&n.splice(i,1)}},e}();n.ApiEvents=r},{}],4:[function(e,t,n){"use strict";function r(e,t){return e===t}Object.defineProperty(n,"__esModule",{value:!0}),e("es6-promise");var i=e("../../../javascript/system/ts/utils/ApiEvents"),o=function(){function e(){this.isConnected=!1,this.listeners=[],this.listenersBind=[],this.tasks=[],this.isConnected=!1,this.actionReceiver=this.actionReceiver.bind(this),this.apiEvents=new i.ApiEvents}return e.prototype.init=function(){var e=this,t=new Promise(function(t,n){e.ApiReadyResolve=t,e.ApiReadyReject=n});return this.addListener("getConnection",function(t){e.isConnected=!0,t.resolve(),e.ApiReadyResolve(t)}),this.requestConnection(),this.addMessageListeners(),t},e.prototype.call=function(e,t){var n,r,i,o=this;return n={task:e,arguments:t,id:s(),type:"call",responseType:"resolve",responseValue:"",resolve:null,reject:null},i=new Promise(function(e,t){r=Object.assign({},n),r.resolve=e,r.reject=t,o.tasks.push(r)}),this.postMessage(n),i},e.prototype.addListener=function(e,t){var n=function(e){t(e.data)};this.listeners.push(t),this.listenersBind.push(n),this.apiEvents.addListener(e,n)},e.prototype.removeListener=function(e,t){var n=this.listeners,r=this.listenersBind;this.listeners=[],this.listenersBind=[];for(var i=0,o=n.length;i<o;i++)n[i]!==t?(this.listeners.push(n[i]),this.listenersBind.push(r[i])):this.apiEvents.removeListener(e,r[i])},e.prototype.flush=function(){this.removeMessageListeners()},e.prototype.___responseCall=function(e){({task:e.task,arguments:e.arguments,id:e.id,type:"response",responseType:e.responseType,responseValue:e.responseValue})},e.prototype.responseCall=function(e){var t=Object.assign({},e);this.postMessage(Object.assign(t,{resolve:null,reject:null,type:"response"}))},e.prototype.dispatchEvent=function(e){this.apiEvents.fire({type:e.task,data:{arguments:e.arguments,resolve:e.resolve,reject:e.reject}})},e.prototype.postMessage=function(e){return r(window,window.parent)===!0?void this.ApiReadyReject("there is no child or parent window"):void window.parent.postMessage(e,"*")},e.prototype.requestConnection=function(){var e=this;this.call("getConnection","Reader try to make connection with backoffice").then(function(t){e.isConnected=!0,e.ApiReadyResolve(t)})},e.prototype.addMessageListeners=function(){window.addEventListener("message",this.actionReceiver,!1)},e.prototype.removeMessageListeners=function(){window.removeEventListener("message",this.actionReceiver,!1)},e.prototype.actionReceiver=function(e){var t,n,i,o=this;if(!r(window.parent,e.source)||e.data instanceof Object==!1)return void console.log("Receive canceled message",e);if(i=e.data,t=this.tasks.length,this.tasks=this.tasks.filter(function(e){return e.id!==i.id?e:void("resolve"===i.responseType?e.resolve(i.arguments):e.reject(i.responseValue))}),t===this.tasks.length){if("response"===i.type)return;n=new Promise(function(e,t){i.resolve=e,i.reject=t}),n.then(function(e){i.arguments=e,i.responseType="resolve",i.responseValue="",o.responseCall(i)})["catch"](function(e){i.arguments=[],i.responseType="reject",i.responseValue=e,o.responseCall(i)}),this.dispatchEvent(i)}},e}(),s=function(){var e=0;return function(){return"reader-"+e++ +Date.now()}}();n["default"]=o},{"../../../javascript/system/ts/utils/ApiEvents":3,"es6-promise":1}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./ReaderApi");!function(){var e=new Promise(function(e){window.addEventListener("webpub-show",function(){e()})});e.then(function(){var e=new r["default"];e.init().then(function(t){console.log("Reader connected with backoffice"),webpublicationNamespace.epubEvent.addListener("PAGE_CHANGE",function(){NIApi.page.getVisiblePages().then(function(t){e.call("page.change",[t]).then(function(e){console.log(e)})})}),e.addListener("page.change",function(e){NIApi.page.open(e.arguments[0]),e.resolve("READER listener : changed page to : "+e.arguments[0])}),e.addListener("styleSheet.getObject",function(e){try{e.resolve(NIApi.styleSheet.getObject())}catch(t){e.reject(t)}}),e.addListener("styleSheet.reParse",function(e){try{NIApi.styleSheet.reParse(e.arguments[0]),e.resolve(NIApi.styleSheet.getObject())}catch(t){e.reject(t)}}),e.addListener("brand.logo.getObject",function(e){try{NIApi.menu.ready().then(function(){e.resolve(NIApi.styleSheet.logoGetObject())})}catch(t){e.reject(t)}}),e.addListener("brand.logo.update",function(e){try{NIApi.menu.ready().then(function(){e.resolve(NIApi.styleSheet.logoUpdate(e.arguments[0]))})}catch(t){e.reject(t)}}),e.addListener("pagination.verticalArrowPosition.update",function(e){try{e.resolve(NIApi.pagination.setVerticalArrowPosition(e.arguments[0].toLowerCase()))}catch(t){e.reject(t)}}),e.addListener("pagination.verticalArrowPosition.get",function(e){try{e.resolve(NIApi.pagination.getVerticalArrowPosition())}catch(t){e.reject(t)}}),e.addListener("configsJson.pagesData.update",function(e){try{console.warn("readerApi update pagesData",e),e.resolve(NIApi.configsJson.setPageData(e.arguments[0],e.arguments[1]))}catch(t){e.reject(t)}}),e.addListener("configsJson.pagesData.get",function(e){try{e.resolve(NIApi.configsJson.getPagesData())}catch(t){e.reject(t)}})})["catch"](function(e){console.log(e)})})}()},{"./ReaderApi":4}]},{},[5]);