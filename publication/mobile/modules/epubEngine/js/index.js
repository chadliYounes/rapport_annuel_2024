function getFrameID(t){var e=document.getElementById(t);if(e){if(/^iframe$/i.test(e.tagName))return t;var i=e.getElementsByTagName("iframe");if(!i.length)return null;for(var n=0;n<i.length&&!/^https?:\/\/(?:www\.)?youtube(?:-nocookie)?\.com(\/|$)/i.test(i[n].src);n++);if(e=i[n],!e)return null;if(e.id)return e.id;do t+="-frame";while(document.getElementById(t));return e.id=t,t}return null}function onYouTubePlayerAPIReady(){YT_ready(!0)}function loadYouTubePlayerAPI(){return loadPromise?loadPromise:loadPromise=new Promise(function(t,e){var i=document.createElement("script"),n=document.getElementsByTagName("script")[0];i.onload=t,i.onerror=function(){console.error("Failed to load youtube player API",proxyUrl),e()},i.src=proxyUrl,n.parentNode.insertBefore(i,n)})}var CSSJSON=new function(){var t=this;t.init=function(){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.repeat=function(t){return new Array(1+t).join(this)}},t.init();var e=/\/\*[\s\S]*?\*\//g,n=/([^\:]+):([^\;]*);/,s=/(\/\*[\s\S]*?\*\/)|([^\s\;\{\}][^\;\{\}]*(?=\{))|(\})|([^\;\{\}]+\;(?!\s*\*\/))/gim,o=1,r=2,a=3,u=4,l=function(t){return"undefined"==typeof t||0==t.length||null==t},h=function(t){return!l(t)&&(t.attributes&&t.children)};t.toJSON=function(h,p){var c={children:{},attributes:{}},d=null,f=0;if("undefined"==typeof p)var p={ordered:!1,comments:!1,stripComments:!1,split:!1};for(p.stripComments&&(p.comments=!1,h=h.replace(e,""));null!=(d=s.exec(h));)if(!l(d[o])&&p.comments){var m=d[o].trim();c[f++]=m}else if(l(d[r])){if(!l(d[a]))return c;if(!l(d[u])){var g=d[u].trim(),v=n.exec(g);if(v){var y=v[1].trim(),b=v[2].trim();if(p.ordered){var E={};E.name=y,E.value=b,E.type="attr",c[f++]=E}else if(y in c.attributes){var S=c.attributes[y];S instanceof Array||(c.attributes[y]=[S]),c.attributes[y].push(b)}else c.attributes[y]=b}else c[f++]=g}}else{var y=d[r].trim(),P=t.toJSON(h,p);if(p.ordered){var E={};E.name=y,E.value=P,E.type="rule",c[f++]=E}else{if(p.split)var _=y.split(",");else var _=[y];for(i in _){var T=_[i].trim();if(T in c.children)for(var w in P.attributes)c.children[T].attributes[w]=P.attributes[w];else c.children[T]=P}}}return c},t.toCSS=function(t,e,n){var s="";if("undefined"==typeof e&&(e=0),"undefined"==typeof n&&(n=!1),t.attributes)for(i in t.attributes){var o=t.attributes[i];if(o instanceof Array)for(var r=0;r<o.length;r++)s+=d(i,o[r],e);else s+=d(i,o,e)}if(t.children){var a=!0;for(i in t.children)n&&!a?s+="\n":a=!1,s+=f(i,t.children[i],e)}return s},t.toHEAD=function(e,i,n){var s=document.getElementsByTagName("head")[0],o=document.getElementById(i),r=null!==o&&o instanceof HTMLStyleElement;if(!l(e)&&s instanceof HTMLHeadElement){if(r){if(n!==!0&&!l(n))return;o.removeAttribute("id")}h(e)&&(e=t.toCSS(e));var a=document.createElement("style");if(a.type="text/css",l(i)?a.id="cssjson_"+c():a.id=i,a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e)),s.appendChild(a),p(a))r&&o.parentNode.removeChild(o);else{if(a.parentNode.removeChild(a),!r)return;o.setAttribute("id",i),a=o}return a}},"undefined"!=typeof window&&(window.createCSS=t.toHEAD);var p=function(t){return t instanceof HTMLStyleElement&&t.sheet.cssRules.length>0},c=function(){return Date.now()||+new Date},d=function(t,e,i){return"\t".repeat(i)+t+": "+e+";\n"},f=function(e,i,n){var s="\t".repeat(n)+e+" {\n";return s+=t.toCSS(i,n+1),s+="\t".repeat(n)+"}\n"}},Tween=function(){function t(){}t.create=function(){var t=null,e=null,i=null;return function(n,s){for(t=[],e=arguments.length,i=2;i<e;i++)t[i-2]=arguments[i];return function(){s.apply(n,[].concat(arguments,t))}}}();var e=function(t,e,i,n,s,o,r){this.init(t,e,i,n,s,o,r)},i=e.prototype;return i.obj={},i.prop="",i.func=function(t,e,i,n){return i*t/n+e},i.begin=0,i.change=0,i.prevTime=0,i.prevPos=0,i.looping=!1,i._duration=0,i._time=0,i._pos=0,i._position=0,i._startTime=0,i._finish=0,i.name="",i.suffixe="",i._listeners=[],i.setTime=function(t){this.prevTime=this._time,t>this.getDuration()?this.looping?(this.rewind(t-this._duration),this.update(),this.broadcastMessage("onMotionLooped",{target:this,type:"onMotionLooped"})):(this._time=this._duration,this.update(),this.stop(),this.broadcastMessage("onMotionFinished",{target:this,type:"onMotionFinished"})):t<0?(this.rewind(),this.update()):(this._time=t,this.update())},i.getTime=function(){return this._time},i.setDuration=function(t){this._duration=null==t||t<0?1e5:t},i.getDuration=function(){return this._duration},i.setPosition=function(){var t=null;return function(e){this.prevPos=this._pos,t=""!=this.suffixe?this.suffixe:"",this.obj[this.prop]=Math.round(e)+t,this._pos=e,this.broadcastMessage("onMotionChanged",{target:this,type:"onMotionChanged"})}}(),i.getPosition=function(t){return void 0==t&&(t=this._time),this.func(t,this.begin,this.change,this._duration)},i.setFinish=function(t){this.change=t-this.begin},i.getFinish=function(){return this.begin+this.change},i.init=function(t,e,i,n,s,o,r){arguments.length&&(this._listeners=new Array,this.addListener(this),r&&(this.suffixe=r),this.obj=t,this.prop=e,this.begin=n,this._pos=n,this.setDuration(o),null!=i&&""!=i&&(this.func=i),this.setFinish(s))},i.start=function(){this.rewind(),this.startEnterFrame(),this.broadcastMessage("onMotionStarted",{target:this,type:"onMotionStarted"})},i.rewind=function(t){this.stop(),this._time=void 0==t?0:t,this.fixTime(),this.update()},i.fforward=function(){this._time=this._duration,this.fixTime(),this.update()},i.update=function(){this.setPosition(this.getPosition(this._time))},i.startEnterFrame=function(){this.stopEnterFrame(),this.isPlaying=!0,this.onEnterFrame()},i.onEnterFrame=function(){this.isPlaying&&(this.nextFrame(),window.requestAnimationFrame(t.create(this,this.onEnterFrame)))},i.nextFrame=function(){this.setTime((this.getTimer()-this._startTime)/1e3)},i.stop=function(){this.stopEnterFrame(),this.broadcastMessage("onMotionStopped",{target:this,type:"onMotionStopped"})},i.stopEnterFrame=function(){this.isPlaying=!1},i.continueTo=function(t,e){this.begin=this._pos,this.setFinish(t),void 0!=this._duration&&this.setDuration(e),this.start()},i.resume=function(){this.fixTime(),this.startEnterFrame(),this.broadcastMessage("onMotionResumed",{target:this,type:"onMotionResumed"})},i.yoyo=function(){this.continueTo(this.begin,this._time)},i.addListener=function(t){return this.removeListener(t),this._listeners.push(t)},i.removeListener=function(){var t=null,e=null;return function(i){for(t=this._listeners,e=t.length;e--;)if(t[e]==i)return t.splice(e,1),!0;return!1}}(),i.broadcastMessage=function(){var t=null,e=null,i=null,n=null,s=null,o=null;return function(){for(t=[],e=o=arguments.length;o--;)t.push(arguments[e-(o+1)]);for(i=t.shift(),n=this._listeners,s=n.length;s--;)n[s][i]&&n[s][i].apply(n[s],t)}}(),i.fixTime=function(){this._startTime=this.getTimer()-1e3*this._time},i.getTimer=function(){return(new Date).getTime()-this._time},e.backEaseIn=function(t,e,i,n,s,o){if(void 0==r)var r=1.70158;return i*(t/=n)*t*((r+1)*t-r)+e},e.backEaseOut=function(t,e,i,n,s,o){if(void 0==r)var r=1.70158;return i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},e.backEaseInOut=function(t,e,i,n,s,o){if(void 0==r)var r=1.70158;return(t/=n/2)<1?i/2*(t*t*(((r*=1.525)+1)*t-r))+e:i/2*((t-=2)*t*(((r*=1.525)+1)*t+r)+2)+e},e.elasticEaseIn=function(t,e,i,n,s,o){if(0==t)return e;if(1==(t/=n))return e+i;if(o||(o=.3*n),!s||s<Math.abs(i)){s=i;var r=o/4}else var r=o/(2*Math.PI)*Math.asin(i/s);return-(s*Math.pow(2,10*(t-=1))*Math.sin((t*n-r)*(2*Math.PI)/o))+e},e.elasticEaseOut=function(t,e,i,n,s,o){if(0==t)return e;if(1==(t/=n))return e+i;if(o||(o=.3*n),!s||s<Math.abs(i)){s=i;var r=o/4}else var r=o/(2*Math.PI)*Math.asin(i/s);return s*Math.pow(2,-10*t)*Math.sin((t*n-r)*(2*Math.PI)/o)+i+e},e.elasticEaseInOut=function(t,e,i,n,s,o){if(0==t)return e;if(2==(t/=n/2))return e+i;if(!o)var o=n*(.3*1.5);if(!s||s<Math.abs(i))var s=i,r=o/4;else var r=o/(2*Math.PI)*Math.asin(i/s);return t<1?-.5*(s*Math.pow(2,10*(t-=1))*Math.sin((t*n-r)*(2*Math.PI)/o))+e:s*Math.pow(2,-10*(t-=1))*Math.sin((t*n-r)*(2*Math.PI)/o)*.5+i+e},e.bounceEaseOut=function(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},e.bounceEaseIn=function(t,i,n,s){return n-e.bounceEaseOut(s-t,0,n,s)+i},e.bounceEaseInOut=function(t,i,n,s){return t<s/2?.5*e.bounceEaseIn(2*t,0,n,s)+i:.5*e.bounceEaseOut(2*t-s,0,n,s)+.5*n+i},e.strongEaseInOut=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},e.regularEaseIn=function(t,e,i,n){return i*(t/=n)*t+e},e.regularEaseOut=function(t,e,i,n){return-i*(t/=n)*(t-2)+e},e.regularEaseInOut=function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},e.strongEaseIn=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},e.strongEaseOut=function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},e.strongEaseInOut=function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},e}(),YT_ready=function(){var t=[],e=!1;return function(i,n){if(i===!0)for(e=!0;t.length;)t.shift()();else"function"==typeof i&&(e?i():t[n?"unshift":"push"](i))}}(),proxyUrl="https://yt.zone-secure.net/player_api",loadPromise=null;!function t(e,i,n){function s(r,a){if(!i[r]){if(!e[r]){var u="function"==typeof require&&require;if(!a&&u)return u(r,!0);if(o)return o(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[r]={exports:{}};e[r][0].call(h.exports,function(t){var i=e[r][1][t];return s(i?i:t)},h,h.exports,t,e,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(t,e,i){(function(n,s){!function(t,n){"object"==typeof i&&"undefined"!=typeof e?e.exports=n():"function"==typeof define&&define.amd?define(n):t.ES6Promise=n()}(this,function(){"use strict";function e(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}function i(t){return"function"==typeof t}function o(t){q=t}function r(t){K=t}function a(){return function(){return n.nextTick(c)}}function u(){return"undefined"!=typeof X?function(){X(c)}:p()}function l(){var t=0,e=new $(c),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}function h(){var t=new MessageChannel;return t.port1.onmessage=c,function(){return t.port2.postMessage(0)}}function p(){var t=setTimeout;return function(){return t(c,1)}}function c(){for(var t=0;t<Z;t+=2){var e=it[t],i=it[t+1];e(i),it[t]=void 0,it[t+1]=void 0}Z=0}function d(){try{var e=t,i=e("vertx");return X=i.runOnLoop||i.runOnContext,u()}catch(n){return p()}}function f(t,e){var i=arguments,n=this,s=new this.constructor(g);void 0===s[st]&&N(s);var o=n._state;return o?!function(){var t=i[o-1];K(function(){return I(o,s,t,n._result)})}():C(n,s,t,e),s}function m(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var i=new e(g);return T(i,t),i}function g(){}function v(){return new TypeError("You cannot resolve a promise with itself")}function y(){return new TypeError("A promises callback cannot return that same promise.")}function b(t){try{return t.then}catch(e){return ut.error=e,ut}}function E(t,e,i,n){try{t.call(e,i,n)}catch(s){return s}}function S(t,e,i){K(function(t){var n=!1,s=E(i,e,function(i){n||(n=!0,e!==i?T(t,i):A(t,i))},function(e){n||(n=!0,O(t,e))},"Settle: "+(t._label||" unknown promise"));!n&&s&&(n=!0,O(t,s))},t)}function P(t,e){e._state===rt?A(t,e._result):e._state===at?O(t,e._result):C(e,void 0,function(e){return T(t,e)},function(e){return O(t,e)})}function _(t,e,n){e.constructor===t.constructor&&n===f&&e.constructor.resolve===m?P(t,e):n===ut?(O(t,ut.error),ut.error=null):void 0===n?A(t,e):i(n)?S(t,e,n):A(t,e)}function T(t,i){t===i?O(t,v()):e(i)?_(t,i,b(i)):A(t,i)}function w(t){t._onerror&&t._onerror(t._result),M(t)}function A(t,e){t._state===ot&&(t._result=e,t._state=rt,0!==t._subscribers.length&&K(M,t))}function O(t,e){t._state===ot&&(t._state=at,t._result=e,K(w,t))}function C(t,e,i,n){var s=t._subscribers,o=s.length;t._onerror=null,s[o]=e,s[o+rt]=i,s[o+at]=n,0===o&&t._state&&K(M,t)}function M(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var n=void 0,s=void 0,o=t._result,r=0;r<e.length;r+=3)n=e[r],s=e[r+i],n?I(i,n,s,o):s(o);t._subscribers.length=0}}function L(){this.error=null}function x(t,e){try{return t(e)}catch(i){return lt.error=i,lt}}function I(t,e,n,s){var o=i(n),r=void 0,a=void 0,u=void 0,l=void 0;if(o){if(r=x(n,s),r===lt?(l=!0,a=r.error,r.error=null):u=!0,e===r)return void O(e,y())}else r=s,u=!0;e._state!==ot||(o&&u?T(e,r):l?O(e,a):t===rt?A(e,r):t===at&&O(e,r))}function D(t,e){try{e(function(e){T(t,e)},function(e){O(t,e)})}catch(i){O(t,i)}}function k(){return ht++}function N(t){t[st]=ht++,t._state=void 0,t._result=void 0,t._subscribers=[]}function R(t,e){this._instanceConstructor=t,this.promise=new t(g),this.promise[st]||N(this.promise),Y(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?A(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&A(this.promise,this._result))):O(this.promise,B())}function B(){return new Error("Array Methods must be provided an Array")}function U(t){return new R(this,t).promise}function G(t){var e=this;return new e(Y(t)?function(i,n){for(var s=t.length,o=0;o<s;o++)e.resolve(t[o]).then(i,n)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function V(t){var e=this,i=new e(g);return O(i,t),i}function F(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function j(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function H(t){this[st]=k(),this._result=this._state=void 0,this._subscribers=[],g!==t&&("function"!=typeof t&&F(),this instanceof H?D(this,t):j())}function z(){var t=void 0;if("undefined"!=typeof s)t=s;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var i=t.Promise;if(i){var n=null;try{n=Object.prototype.toString.call(i.resolve())}catch(e){}if("[object Promise]"===n&&!i.cast)return}t.Promise=H}var W=void 0;W=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var Y=W,Z=0,X=void 0,q=void 0,K=function(t,e){it[Z]=t,it[Z+1]=e,Z+=2,2===Z&&(q?q(c):nt())},Q="undefined"!=typeof window?window:void 0,J=Q||{},$=J.MutationObserver||J.WebKitMutationObserver,tt="undefined"==typeof self&&"undefined"!=typeof n&&"[object process]"==={}.toString.call(n),et="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,it=new Array(1e3),nt=void 0;nt=tt?a():$?l():et?h():void 0===Q&&"function"==typeof t?d():p();var st=Math.random().toString(36).substring(16),ot=void 0,rt=1,at=2,ut=new L,lt=new L,ht=0;return R.prototype._enumerate=function(t){for(var e=0;this._state===ot&&e<t.length;e++)this._eachEntry(t[e],e)},R.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,n=i.resolve;if(n===m){var s=b(t);if(s===f&&t._state!==ot)this._settledAt(t._state,e,t._result);else if("function"!=typeof s)this._remaining--,this._result[e]=t;else if(i===H){var o=new i(g);_(o,t,s),this._willSettleAt(o,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(n(t),e)},R.prototype._settledAt=function(t,e,i){var n=this.promise;n._state===ot&&(this._remaining--,t===at?O(n,i):this._result[e]=i),0===this._remaining&&A(n,this._result)},R.prototype._willSettleAt=function(t,e){var i=this;C(t,void 0,function(t){return i._settledAt(rt,e,t)},function(t){return i._settledAt(at,e,t)})},H.all=U,H.race=G,H.resolve=m,H.reject=V,H._setScheduler=o,H._setAsap=r,H._asap=K,H.prototype={constructor:H,then:f,"catch":function(t){return this.then(null,t)}},H.polyfill=z,H.Promise=H,H})}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:2}],2:[function(t,e,i){function n(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(t){if(p===setTimeout)return setTimeout(t,0);if((p===n||!p)&&setTimeout)return p=setTimeout,setTimeout(t,0);try{return p(t,0)}catch(e){try{return p.call(null,t,0)}catch(e){return p.call(this,t,0)}}}function r(t){if(c===clearTimeout)return clearTimeout(t);if((c===s||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(t);try{return c(t)}catch(e){try{return c.call(null,t)}catch(e){return c.call(this,t)}}}function a(){g&&f&&(g=!1,f.length?m=f.concat(m):v=-1,m.length&&u())}function u(){if(!g){var t=o(a);g=!0;for(var e=m.length;e;){for(f=m,m=[];++v<e;)f&&f[v].run();v=-1,e=m.length}f=null,g=!1,r(t)}}function l(t,e){this.fun=t,this.array=e}function h(){}var p,c,d=e.exports={};!function(){try{p="function"==typeof setTimeout?setTimeout:n}catch(t){p=n}try{c="function"==typeof clearTimeout?clearTimeout:s}catch(t){c=s}}();var f,m=[],g=!1,v=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];m.push(new l(t,e)),1!==m.length||g||o(u)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=h,d.addListener=h,d.once=h,d.off=h,d.removeListener=h,d.removeAllListeners=h,d.emit=h,d.prependListener=h,d.prependOnceListener=h,d.listeners=function(t){return[]},d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],3:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./EpubEvent"),s=t("./EpubGesturesEvent"),o=400;i.EVENT_FORCE_CHECK_LAST_ACTION="forceCheckLastAction";var r=function(){function t(t){this.epubEvent=w.epubEvent,this.resetActions(),this.epubGesturesEvent=new s["default"](this,t),this.epubGesturesEvent.addEventListener(s["default"].GESTURESNAME.TAPGESTURE,this.checkLastActions.bind(this)),document.addEventListener(i.EVENT_FORCE_CHECK_LAST_ACTION,this.checkLastActions.bind(this)),this.epubEvent.addListener(n.EPUB_EVENTS.PAGE_CLICK_PERMISSION,this.addAction.bind(this))}return t.prototype.resetActions=function(){this.actions=[]},t.prototype.addAction=function(t){this.actions.push({action:t.data.action,date:Date.now()})},t.prototype.checkLastActions=function(t){for(var e=!1,i=0,s=this.actions.length;i<s;i++){var r=Date.now()-this.actions[i].date<o;r&&(e=!0),this.actions[i].action(Promise.resolve(r))}if(this.actions=[],!e)return void("pointercancel"!==t.type&&this.epubEvent.fire({type:n.EPUB_EVENTS.PAGE_CLICK,data:{}}))},t}();i["default"]=r},{"./EpubEvent":8,"./EpubGesturesEvent":10}],4:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./EpubConfig/EpubDefaultConfig"),o=t("./utils/enums"),r=function(t){function e(e){return t.call(this,e)||this}return n(e,t),e.prototype.setConfig=function(e){t.prototype.setConfig.call(this,e),this.device=this.userAgent.device.type,this.browser=this.userAgent.browser.name,this.os=this.userAgent.os.name;var i="device_"+this.device,n="browser_"+this.browser,s="os_"+this.os;document.documentElement.classList.add("pagetype-"+o.READER_TYPES[this.readerPageSrcType].toLowerCase()),"function"==typeof this[i]&&this[i](),"function"==typeof this[n]&&this[n](),"function"==typeof this[s]&&this[s]()},e.prototype.device_phone=function(){},e.prototype.device_tab=function(){},e.prototype.device_desktop=function(){this.timeToRefreshScreenResize=0},e.prototype.browser_safari=function(){},e.prototype.browser_chrome=function(){},e.prototype.browser_firefox=function(){},e.prototype.browser_ie=function(){},e.prototype.browser_edge=function(){},e.prototype.browser_android=function(){},e.prototype.os_windows=function(){},e.prototype.os_mac=function(){},e.prototype.os_iOS=function(){},e.prototype.os_android=function(){},e}(s["default"]);i["default"]=r},{"./EpubConfig/EpubDefaultConfig":5,"./utils/enums":77}],5:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,s=t("../utils/enums"),o=t("../EpubEvent");!function(t){t.CONTAIN="contain",t.COVER_HORIZONTALLY="coverHorizontally"}(n=i.PagesSizeTypes||(i.PagesSizeTypes={}));var r;!function(t){t.X="x",t.Y="y"}(r=i.NavigationAxis||(i.NavigationAxis={}));var a;!function(t){t.VERTICAL_ONE_PAGE="verticalOnePage"}(a=i.PageChangeSource||(i.PageChangeSource={}));var u=function(){function t(t){this._linksSizePageWidth=0,this._linksSizePageHeight=0,this._paddingBottom=0,this._paddingTop=0,this._paddingLeft=0,this._paddingRight=0,this._maxSpreadsLength=3,this._pageQuantity=0,this._firstSpreadSize=1,this._pageSizeType=n.CONTAIN,this._pageSizeMaxHeight=0,this._coverPageCenter=!1,this._currentPageAtInit=1,this.countPageChange=0,this._currentPage=1,this._pageChangeSource=void 0,this.lastPage=1,this.domMode="html",this._spreadDraggable=!0,this.highQualityKey="hdpi",this._linkBoxAspect=s.LinksBehaviors.blink,this._linkBlinkDuration=1e3,this._pdfHTMLMaxFontLoad=0,this.pageBgColor="#fff",this.pagesRetina=!0,this._verticalSlider=!1,this._isVerticalOnePage=!1,this.timeToRefreshScreenResize=50,this.switchLandScapeUsingPageSize=!1,this.pagesBySpreadMax=2,this.pagesBySpreadUseApiPageManager=!1,this.scrollablePages=[],this.disableArrowKeys=!1,this._zoomDoubleClick=!0,this._zoomSingleClick=!1,this.zoomPinch=!0,this.zoomRetina=!0,this._zoomFactor=.008,this._maxZoom=1,this.defaultPageScaleAt=.75,this.maxPageTotalScale=1.5,this._transitionTime=.2,this._use3DMatrixTransform=!1,this._useMatrixTransformZoomable=!0,this._useMatrixTransformScrollable=!0,this._enableAspLinks=!0,this._readerPageSrcType=s.READER_TYPES.EPUB_HTML,this.pageNeverChanged=!0,this.mainViewElementClassName="webpub-viewer__epub-container",this.spreadViewElementClassName="webpub-viewer__epub-container-spread",this.zoomableViewElementClassName="webpub-viewer__epub-container-spread-zoomable";this._currentPageAtInit=parseInt(w.Main.urlManager.get("page")||this._currentPage,10),this.epubEvent=w.epubEvent,this.userAgent=w.Param.userAgent,this.pageMargin=[0,0,0,0],this.linksSizePageWidth=parseFloat(w.Main.xmlManager.get("common-configuration","contents","swf","width")),this.linksSizePageHeight=parseFloat(w.Main.xmlManager.get("common-configuration","contents","swf","height")),this.menuViewPageControlItems=w.Main.xmlManager.get("common-ui","panelViewControlItems"),this.scrollablePages=w.Main.xmlManager.get("comboPages","scrollablePages"),this._firstSpreadSize=w.Main.pageLayoutService.get("pagesOnFirstFrame"),this.handleTransparentPageConfig(),this.handleEcoRatinConfig()}return t.prototype.paddinigsUpdate=function(){var t=this.paddings;this.paddingLeft=~~t.paddingLeft+this.pageMargin[0],this.paddingTop=~~t.paddingTop+this.pageMargin[1],this.paddingRight=~~t.paddingRight+this.pageMargin[2],this.paddingBottom=~~t.paddingBottom+this.pageMargin[3]},Object.defineProperty(t.prototype,"paddings",{get:function(){return w.Main.viewerService.getPadding()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCrossNavPublication",{get:function(){return this.pageSizeType===n.COVER_HORIZONTALLY},enumerable:!0,configurable:!0}),t.prototype.isCrossNavPage=function(t){var e=this.scrollablePages.includes(t);return this.isCrossNavPublication||e},t.prototype.hasCrossNavPage=function(){var t=this.scrollablePages.length>0;return this.isCrossNavPublication||t},Object.defineProperty(t.prototype,"paddingBottom",{get:function(){return this._paddingBottom},set:function(t){this._paddingBottom=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingTop",{get:function(){return this._paddingTop},set:function(t){this._paddingTop=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingLeft",{get:function(){return this._paddingLeft},set:function(t){this._paddingLeft=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingRight",{get:function(){return this._paddingRight},set:function(t){this._paddingRight=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linksSizePageHeight",{get:function(){return this._linksSizePageHeight},set:function(t){this._linksSizePageHeight=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linksSizePageWidth",{get:function(){return this._linksSizePageWidth/2},set:function(t){this._linksSizePageWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkBoxAspect",{get:function(){return this._linkBoxAspect},set:function(t){this._linkBoxAspect=s.LinksBehaviors[t]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkBlinkDuration",{get:function(){return this._linkBlinkDuration},set:function(t){this._linkBlinkDuration=t,this.addLinkStyleTags()},enumerable:!0,configurable:!0}),t.prototype.handleEcoRatinConfig=function(){var t=w.Main.xmlManager.get("common-ui","configs","ecoRating");t.enabled&&(this.disableArrowKeys=t.disableArrowKeys,this._maxSpreadsLength=t.disablePreload?1:3)},t.prototype.handleTransparentPageConfig=function(){var t=w.Main.configsJsonManager.getPagesData(["isTransparent"]);if(t){for(var e="",i=0;i<t.length;i++){var n=t[i];n&&n.isTransparent&&(e+=".pagetype-epub_html .webpub-viewer__epub-container-spread-page.spread-page-"+(i+1)+":before{display: none}")}var s=document.head.appendChild(document.createElement("style"));s.innerHTML=e}},t.prototype.addLinkStyleTags=function(t){void 0===t&&(t="ms"),void 0===this.styleElement&&(this.styleElement=document.createElement("style"),document.head.appendChild(this.styleElement));var e=".webpub-viewer__epub-container .epub-links_container-link{-webkit-animation-duration: "+(this.linkBlinkDuration+t)+"!important;animation-duration: "+(this.linkBlinkDuration+t)+"!important;}";this.styleElement.type="text/css",this.styleElement.innerText=e},Object.defineProperty(t.prototype,"navigationAxis",{get:function(){return this.verticalSlider===!1?r.X:r.Y},set:function(t){t===r.X?this.verticalSlider=!1:this.verticalSlider=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"verticalSlider",{get:function(){return this._verticalSlider},set:function(t){this._verticalSlider=t;var e="webpub-viewer__container-vertical";w.Param.viewMain.classList.toggle(e,this._verticalSlider)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVerticalOnePage",{get:function(){return this._isVerticalOnePage},set:function(t){this._isVerticalOnePage=t;var e="webpub-viewer__container-verticalOnePage";w.Param.viewMain.classList.toggle(e,this._isVerticalOnePage)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transitionTime",{get:function(){return this._transitionTime},set:function(t){isNaN(t)||(t=Math.max(t,1e-4),this._transitionTime=t||0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageQuantity",{get:function(){return this._pageQuantity},set:function(t){this._pageQuantity=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageChangeSource",{get:function(){return this._pageChangeSource},set:function(t){this._pageChangeSource=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPage",{get:function(){return 0===this.countPageChange&&(this._currentPage=this._currentPageAtInit),this._currentPage},set:function(t){this.changePage(t,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPageNoAnimation",{get:function(){return 0===this.countPageChange&&(this._currentPage=this._currentPageAtInit),this._currentPage},set:function(t){this.changePage(t,!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstSpreadSize",{get:function(){return this._firstSpreadSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"coverPageCenter",{get:function(){return this._coverPageCenter},set:function(t){this._coverPageCenter=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"use3DMatrixTransform",{get:function(){return this._use3DMatrixTransform},set:function(t){this._use3DMatrixTransform=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useMatrixTransformZoomable",{get:function(){return this._useMatrixTransformZoomable},set:function(t){this._useMatrixTransformZoomable=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxZoom",{get:function(){return this._maxZoom},set:function(t){this._maxZoom=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomFactor",{get:function(){return this._zoomFactor},set:function(t){this._zoomFactor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomDoubleClick",{get:function(){return this._zoomDoubleClick},set:function(t){this._zoomDoubleClick=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomSingleClick",{get:function(){return this._zoomSingleClick},set:function(t){this._zoomSingleClick=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"menuViewPageControlItems",{get:function(){return this._menuViewPageControlItems},set:function(t){this._menuViewPageControlItems=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useMatrixTransformScrollable",{get:function(){return this._useMatrixTransformScrollable},set:function(t){this._useMatrixTransformScrollable=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxSpreadsLength",{get:function(){return this._maxSpreadsLength},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageWidth",{get:function(){return this.ePubConfig.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageHeight",{get:function(){return this.ePubConfig.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageSizeType",{get:function(){return this._pageSizeType},set:function(t){this._pageSizeType=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageMargin",{get:function(){return this._pageMargin},set:function(t){this._pageMargin=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readerPageSrcType",{get:function(){return this._readerPageSrcType},set:function(t){"string"==typeof t&&(t=s.READER_TYPES[t]),this._readerPageSrcType=s.READER_TYPES[t]?t:this.readerPageSrcType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableAspLinks",{get:function(){return this._enableAspLinks},set:function(t){this._enableAspLinks=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mustLoadEpubHtmlCss",{get:function(){return this.readerPageSrcType===s.READER_TYPES.EPUB_HTML},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mustLoadPdfHtmlCss",{get:function(){return this.readerPageSrcType===s.READER_TYPES.PDF_HTML},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spreadDraggable",{get:function(){return this._spreadDraggable},set:function(t){this._spreadDraggable=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pdfHTMLMaxFontLoad",{get:function(){return this._pdfHTMLMaxFontLoad},set:function(t){this._pdfHTMLMaxFontLoad=t||0},enumerable:!0,configurable:!0}),t.prototype.checkEnableAspLinks=function(){switch(this.enableAspLinks=!1,this.readerPageSrcType){case s.READER_TYPES.PDF_SVG:this.enableAspLinks=!0;break;case s.READER_TYPES.PDF_HTML:this.enableAspLinks=!0;break;case s.READER_TYPES.PDF_IMG:this.enableAspLinks=!0;break;case s.READER_TYPES.PDF_PDF:this.enableAspLinks=!0;
}},t.prototype.updateConfigFromUrlData=function(){var t=w.Main.urlManager.get("reader-params");try{t=window.decodeURI(t),"undefined"!=typeof t&&this.setConfigLoc(new window.Function("return "+t)())}catch(e){}},t.prototype.setConfigLoc=function(t){var e="";for(e in t)"undefined"!=typeof this[e]&&(this[e]=t[e])},t.prototype.checkZoomLevel=function(){this.menuViewPageControlItems&&"true"===this.menuViewPageControlItems.enable&&w.Main.viewerService.get("zoom","max-scale")?(this.maxPageTotalScale=w.Main.viewerService.get("zoom","max-scale")/1.666,this.defaultPageScaleAt=this.maxPageTotalScale/2):w.Main.viewerService.get("zoom","max-scale")&&(this.maxPageTotalScale=this.defaultPageScaleAt=w.Main.viewerService.get("zoom","max-scale")/1.666)},t.prototype.changePage=function(t,e){this.countPageChange++,this.pageNeverChanged&&t!==this._currentPageAtInit&&(this.pageNeverChanged=!1),t=~~t,t>this.pageQuantity?t=this.pageQuantity:t<1&&(t=1),this.lastPage=this._currentPage,this._currentPage=t,this.epubEvent.fire({type:o.EPUB_EVENTS.PAGE_CHANGE,data:{pageNumber:t,useAnimationTime:e,pageNeverChanged:this.pageNeverChanged,pageChanged:this.lastPage!==t,source:this.pageChangeSource}})},t.prototype.setConfig=function(t){this.setConfigLoc(t),this.checkEnableAspLinks(),this.updateConfigFromUrlData(),this.checkZoomLevel(),this.ePubConfig instanceof Object==!1&&(this.ePubConfig={})},t}();i["default"]=u},{"../EpubEvent":8,"../utils/enums":77}],6:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./utils/XHRPromise"),s=t("./utils/XHRPromise"),o=function(){function t(t){this.config=t,this.parseCss=!0,this.shadowSelector="",this.urls=[],this.styles=[],this.fontList=[]}return Object.defineProperty(t.prototype,"pdfHTMLMaxFontLoad",{get:function(){return this.config.pdfHTMLMaxFontLoad},enumerable:!0,configurable:!0}),t.prototype.init=function(t){var e=this;this.onProgressPercentage=t;var i=window.document.querySelector(".force-font-load");this.setUrls();var n=this.load();return n.then(function(){e.appendStyle(),null===i&&(e.styles.forEach(function(t){e.parse(t)}),e.fontsLettersAppend()),e.clearUnNeeded()}),n},t.prototype.setUrls=function(){var t;this.config.mustLoadEpubHtmlCss&&(t=w.Main.xmlManager.get("common-ui","assets","epub-idGeneratedStyles"),t&&(this.urls=this.urls.concat(w.Utils.resolveVariable(t.url).split(",")))),this.config.mustLoadPdfHtmlCss&&(t=w.Main.xmlManager.get("common-ui","assets","pdf-HTML-idGeneratedStyles"),t&&(this.urls=this.urls.concat(w.Utils.resolveVariable(t.url).split(","))))},t.prototype.load=function(){for(var t=this,e=[],i=0,o=this.urls.length;i<o;i++)e.push(new n["default"](s.Protocol.GET,this.urls[i]).init());return e.length?Promise.all(e).then(function(e){e.forEach(function(e){t.styles.push(e.responseText)})}):Promise.resolve()},t.prototype.parse=function(t){var e=CSSJSON.toJSON(t,{ordered:!0,comments:!1,stripComments:!1,split:!1}),i={};return this.cloneCssObject(e,i),t},t.prototype.cloneCssObject=function(t,e){var i;for(var n in t)isNaN(Number(n))||(i=this.shadowSelector,0===t[n].name.indexOf("@")&&(this.fontsExtractFromCssObject(t[n]),i=""),e[n]=e[n]||{},e[n].type=t[n].type,e[n].name=i+t[n].name,e[n].value=e[n].value||{},this.cloneCssObjectValues(t[n].value,e[n].value))},t.prototype.cloneCssObjectValues=function(t,e){for(var i in t)isNaN(Number(i))||this.cloneCssObject(e[i],t[i])},t.prototype.fontsExtractFromCssObject=function(t){if(0===t.name.indexOf("@font-face")){var e,i=t.value[1].value,n=i.match(/\([^)]*/gi);n&&(e=n[0].replace("(",""),this.fontList.push(t))}},t.prototype.fontsLettersAppend=function(){var t=[],e=document.createElement("div");e.className="force-font-load";for(var i=function(i,s){if(i>=n.pdfHTMLMaxFontLoad&&0!==n.pdfHTMLMaxFontLoad)return"break";var o=n.fontList[i].value,r=o[0].value,a=o[1].value,u=document.createElement("span");u.style.fontFamily=r,setTimeout(function(){e.appendChild(u)},100*i),t.push("@font-face {"),t.push("font-family: '"+r+"';"),t.push("src: "+a+";}")},n=this,s=0,o=this.fontList.length;s<o;s++){var r=i(s,o);if("break"===r)break}document.body.appendChild(e),this.fontFaces=t.join(" ")},t.prototype.appendStyle=function(){CSSJSON.toHEAD(this.styles.join("\n"))},t.prototype.clearUnNeeded=function(){this.urls=[],this.fontList=[],this.shadowSelector="",this.fontFaces=""},t.prototype.getStyleElement=function(t){return void 0===t&&(t=""),"<style>"+this.styles.join("")+t+"</style>"},t}();i.EpubCssManager=o},{"./utils/XHRPromise":75}],7:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),t("es6-promise");var n=t("./EpubEvent"),s=t("./EpubClickPermission"),o=function(){function t(t,e){w.epubEvent=w.epubEvent||new n.EpubEvent,this.epubEvent=w.epubEvent,"string"==typeof t&&"object"==typeof e&&this.onFire(t,e)}return t.prototype.onFire=function(t,e){return this["allowed_"+t]&&(this.epubEvent.fire({type:n.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:!0,action:this["allowed_"+t].bind(this,e)}}),document.dispatchEvent(new CustomEvent(s.EVENT_FORCE_CHECK_LAST_ACTION))),!1},t.prototype.allowed_action=function(t,e){var i=this;e.then(function(){var n,s,o,r=t[1].trim();return 0===r.indexOf("http")?void i.allowed_url([null,r],e):0===r.indexOf("javascript")||0===r.indexOf("js:")||0===r.indexOf("js :")?void i.allowed_javascript([null,r],e):0===r.indexOf("NIApi")?void i.allowed_NIApi([null,r],e):(o=r.match(/^mailto:|^mailto :/gi),null!==o&&0!==o.length?void i.allowed_mailto([null,r],e):(n=/-([0-9]*).xhtml$/gim,s=n.exec(r)||[],void(s.length>0&&i.allowed_gotoPage([null,~~s[1]],e))))})},t.prototype.allowed_gotoPage=function(t,e){e.then(function(e){e===!0&&NIApi.page.open(t[1])})},t.prototype.allowed_nextPage=function(t,e){e.then(function(t){t===!0&&NIApi.page.openNext()})},t.prototype.allowed_prevPage=function(t,e){e.then(function(t){t===!0&&NIApi.page.openPrevious()})},t.prototype.allowed_lastPage=function(t,e){e.then(function(t){t===!0&&NIApi.page.openLast()})},t.prototype.allowed_firstPage=function(t,e){e.then(function(t){t===!0&&NIApi.page.openFirst()})},t.prototype.allowed_mailto=function(t,e){e.then(function(e){if(e===!0){var i=t[1].trim(),n="mailto:",s=i.match(/^mailto:|^mailto :/gi);null!==s&&0!==s.length&&(n=""),window.location.href=n+i}})},t.prototype.allowed_url=function(t,e){e.then(function(e){if(e===!0){var i=t[1];w.Main.trackerManager.trackEvent({name:"externalLink",variables:{1:i}}),NIApi.navigator.openUrl(i)}})},t.prototype.allowed_popup=function(t,e){e.then(function(e){e===!0&&NIApi.lightbox.openPopup(null,t[2])})},t.prototype.allowed_lightbox=function(t,e){e.then(function(e){e===!0&&NIApi.lightbox.openPopup(null,t[2])})},t.prototype.allowed_javascript=function(t,e){e.then(function(e){if(e===!0){var i,n=t[1].split(":");n.shift(),i=n.join(":").trim(),new Function(i)()}})},t.prototype.allowed_NIApi=function(t,e){e.then(function(e){if(e===!0){var i=t[1];new Function(i)()}})},t}();i.EpubDomApi=o;var r=new o,a=r.onFire.bind(r);i["default"]=a},{"./EpubClickPermission":3,"./EpubEvent":8,"es6-promise":1}],8:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n;!function(t){t[t.SCREEN_ORIENTATION=0]="SCREEN_ORIENTATION",t[t.PAGE_CHANGE=1]="PAGE_CHANGE",t[t.VISIBLE_SPREADS_CHANGE=2]="VISIBLE_SPREADS_CHANGE",t[t.PAGE_ZOOM=3]="PAGE_ZOOM",t[t.PAGE_CLICK=4]="PAGE_CLICK",t[t.PAGE_CLICK_PERMISSION=5]="PAGE_CLICK_PERMISSION",t[t.PAGE_IN_DOM=6]="PAGE_IN_DOM",t[t.MOUSE_WHEEL=7]="MOUSE_WHEEL",t[t.ELEMENT_SCROLL=8]="ELEMENT_SCROLL",t[t.TOUCH_POINTERDOWN=9]="TOUCH_POINTERDOWN",t[t.TOUCH_POINTERCANCEL=10]="TOUCH_POINTERCANCEL",t[t.TOUCH_POINTERLEAVE=11]="TOUCH_POINTERLEAVE",t[t.TOUCH_POINTERUP=12]="TOUCH_POINTERUP",t[t.TOUCH_POINTERMOVE=13]="TOUCH_POINTERMOVE",t[t.ZOOM_CONTROLLER_RANGE=14]="ZOOM_CONTROLLER_RANGE",t[t.ZOOM_CONTROLLER_LEVEL_CLICK=15]="ZOOM_CONTROLLER_LEVEL_CLICK",t[t.FULLSCREEN_TOGGLE=16]="FULLSCREEN_TOGGLE",t[t.ADMIN_LINK_CREATE=17]="ADMIN_LINK_CREATE",t[t.ACTION_LINK_SUCCESS=18]="ACTION_LINK_SUCCESS"}(n=i.EPUB_EVENTS||(i.EPUB_EVENTS={}));var s=function(){function t(){this.listeners={},this.iName="EpubEvent"}return t.prototype.addListener=function(t,e){"string"==typeof t&&(t=n[t]),"undefined"==typeof this.listeners[t]&&(this.listeners[t]=[]),this.listeners[t].indexOf(e)===-1&&this.listeners[t].push(e)},t.prototype.fire=function(t){var e,i,s,o=0,r=0;if(t.target||(t.target=this),t.context||(t.context=this),e=t.type,"string"==typeof t.type&&(e=t.type,e=n[e]),this.listeners[e]instanceof Array){i=this.listeners[e],s=[];var a=void 0;for(r=i.length;o<r;o++)s.push(i[o]);for(;a=s.shift();)i.indexOf(a)!==-1&&a(t)}},t.prototype.removeListener=function(t,e){var i,s=0,o=0;if("string"==typeof t&&(t=n[t]),this.listeners[t]instanceof Array)for(i=this.listeners[t],s=i.length;o<s;o++){if(null!==e&&i[o]===e){i.splice(o,1);break}null===e&&i.splice(o,1)}},t}();i.EpubEvent=s},{}],9:[function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(s,o){function r(t){try{u(n.next(t))}catch(e){o(e)}}function a(t){try{u(n["throw"](t))}catch(e){o(e)}}function u(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(r,a)}u((n=n.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,o=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(r=u.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){u.label=i[1];break}if(6===i[0]&&u.label<r[1]){u.label=r[1],r=i;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(i);break}r[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(n){i=[6,n],o=0}finally{s=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,o,r,a,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(i,"__esModule",{value:!0});var o,r=t("./EpubManager");!function(t){t.NONE="none",t.VIEW_DRIVE_ITEM="viewDriveItem"}(o||(o={}));var a=function(){function t(){w.Class.EpubGalleryManager=t,this.registerApi()}return t.prototype.registerApi=function(){NIApi.register("gallery.open",this.open.bind(this)),NIApi.register("gallery.openAssetInApp",this.openAssetInApp.bind(this)),NIApi.register("gallery.doActionInApp",this.doActionInApp.bind(this))},t.prototype.open=function(t,e,i,o){return void 0===o&&(o=r.OpenTarget.BLANK),n(this,void 0,void 0,function(){var n,a,u,l,h;return s(this,function(s){switch(s.label){case 0:w.API.menuClose(),n=this.getGalleryConfigUrl(t),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,fetch(n)];case 2:return u=s.sent(),a=u.ok,[3,4];case 3:return l=s.sent(),a=!1,[3,4];case 4:return h=this.getAssetUrl(t,e,i,a),w.Main.trackerManager.trackEvent({name:"externalLink",variables:{1:h}}),w.Param.isApp?(this.openAssetInApp(e,i),[2]):o===r.OpenTarget.POPUP?(this.openAsPopup(h),[2]):(window.open(h,o),[2])}})})},t.prototype.openAssetInApp=function(t,e){var i=this.getAction(t,e);this.doActionInApp(i)},t.prototype.getIsInWindowsWebview2=function(){var t=w.Param.isApp&&w.Param.userAgent.os.name===w.Param.userAgent.OS.WINDOWS,e=window.external&&window.external.hasOwnProperty("notify"),i=window.chrome&&window.chrome.webview;return t&&!e&&i},t.prototype.doActionInApp=function(t){var e=w.Starter.main.backHomeParamString,i="-"+w.Starter.main.backHomeString,n={action:t,currentPage:w.Main.pagesLoaderNew.getCurrentPage()},s=this.getIsInWindowsWebview2();if(s){var o={method:"closeFrame","args[]":[n]},r=JSON.stringify(o);return void window.chrome.webview.postMessage(r)}var a=encodeURI(JSON.stringify(n));document.location.href=""+e+a+i},t.prototype.getAssetUrl=function(t,e,i,n){if(!n&&e){var s=w.Utils.resolveVariable("${media}"+e);return i&&(s+="#page="+i),s}var o=this.getRootGalleryUrl(t);return e&&(o+="#/view/"+e,i&&(o+="/"+i)),o},t.prototype.getGalleryConfigUrl=function(t){return this.getRootGalleryUrl(t)+".gallery/config/config.json?preventRedirect=true"},t.prototype.getRootGalleryUrl=function(t){return t?w.Utils.resolveVariable("${media}"+t+"/"):w.Main.xmlManager.get("common-configuration","contents","gallery","path")},t.prototype.openAsPopup=function(t){new w.Class.LightboxManagerNew({animation:"none",header:"visible",id:"drivePopup",url:t})},t.prototype.getAction=function(t,e){return t?this.getViewDriveItemAction(t,e):this.getNoneAction()},t.prototype.getViewDriveItemAction=function(t,e){return{type:o.VIEW_DRIVE_ITEM,assetId:t,page:e}},t.prototype.getNoneAction=function(){return{type:o.NONE}},t}();i.EpubGalleryManager=a,i["default"]=a},{"./EpubManager":15}],10:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./EpubGesturesEvent/Defs"),s=t("./EpubGesturesEvent/MouseWheelManager"),o=t("./utils/isTouchSupported"),r=function(){function t(e,i){this.gestureEventList={},this.moveDifferer=n.getMoveDifferer(),this.gestureData=n.getGestureData(),this.preventDefaultOnMove=!1,this.wheelData=n.getWheelData(),this._enableScrollElement=!1,this._enableCheckMediaPreventDefault=!0,this.touchConvert=function(t,e){for(var i=e.length,n=0,s=0,o=0,r=0,a=0,u=0;u<i;u++)s+=e[u].clientX,o+=e[u].clientY,r=r||e[0].clientX,a=a||e[0].clientY,r-=e[u].clientX,a-=e[u].clientY,n+=this.touchConvert_getDistance(r,a),r=e[u].clientX,a=e[u].clientY;t.hypotenuse=n,t.epubClientX=s/i,t.epubClientY=o/i},this.parent=e,this.element=i,this.element.epubGesturesEvent=this,this.resetMoveDiffererByKeyBinded=this.resetMoveDiffererByKey.bind(this),this.gestureID=Date.now().toString().concat("_UID_",(t.UID++).toString()),this.touchStart=this.touchStart.bind(this),this.touchEnd=this.touchEnd.bind(this),this.touchMove=this.touchMove.bind(this),this.mouseDown=this.mouseDown.bind(this),this.mouseUp=this.mouseUp.bind(this),this.mouseMove=this.mouseMove.bind(this),this.pointerDown=this.pointerDown.bind(this),this.pointerUp=this.pointerUp.bind(this),this.pointerMove=this.pointerMove.bind(this),this.gestureEventList[t.GESTURESNAME.PINCHGESTURE]=[],this.gestureEventList[t.GESTURESNAME.PRESSGESTURE]=[],this.gestureEventList[t.GESTURESNAME.PANGESTURE]=[],this.gestureEventList[t.GESTURESNAME.TAPGESTURE]=[],this.gestureEventList[t.GESTURESNAME.DBLTAPGESTURE]=[],this.gestureEventList[t.GESTURESNAME.SWIPEGESTURE]=[],this.gestureEventList[t.GESTURESNAME.MOUSEWHEELGESTURE]=[],this.eventsStatus=t.EVENTSSTATUS.data,this.initEvent()}return Object.defineProperty(t.prototype,"enableScrollElement",{get:function(){return this._enableScrollElement},set:function(t){this._enableScrollElement=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableCheckMediaPreventDefault",{get:function(){return this._enableCheckMediaPreventDefault},set:function(t){this._enableCheckMediaPreventDefault=t},enumerable:!0,configurable:!0}),t.prototype.initEvent=function(){var e=this;if(o.isTouchSupported()){var i={capture:!1,passive:!0};this.element.addEventListener(t.EVENTSTYPE.TOUCH.TOUCHSTART,this.touchStart,!1),this.element.addEventListener(t.EVENTSTYPE.TOUCH.TOUCHEND,this.touchEnd,i),this.element.addEventListener(t.EVENTSTYPE.TOUCH.TOUCHMOVE,this.touchMove,i)}this.element.addEventListener(t.EVENTSTYPE.MOUSE.MOUSEDOWN,this.mouseDown),this.element.addEventListener(t.EVENTSTYPE.MOUSE.MOUSEUP,this.mouseUp),this.element.addEventListener(t.EVENTSTYPE.MOUSE.MOUSEMOVE,this.mouseMove),document.addEventListener("mouseup",function(t){e.mouseUpDoc(t)},!0),this.mouseWheelManager=new s.MouseWheelManager(this.element),this.mouseWheelHandler=this.mouseWheelHandler.bind(this),this.onScroll=this.onScroll.bind(this),this.mouseWheelManager.addListeners(this.mouseWheelHandler,this.onScroll)},t.prototype.ePreventDefault=function(t){t.preventDefault()},t.prototype.mouseWheelHandler=function(e){var i=e.data,n=i.deltaX*this.wheelData.deltaX<0,s=i.deltaY*this.wheelData.deltaY<0;0===i.deltaX&&(n=!1),0===i.deltaY&&(s=!1),i.gestureData=this.gestureData,Math.abs(i.deltaX)>Math.abs(i.deltaY)?(n=!0,s=!1):Math.abs(i.deltaX)<Math.abs(i.deltaY)&&(n=!1,s=!0),this.gestureData.wheel.isX=n,this.gestureData.wheel.isY=s,this.callGestureEvent(t.GESTURESNAME.MOUSEWHEELGESTURE,i),this.wheelData.deltaX=i.deltaX||this.wheelData.deltaX,this.wheelData.deltaY=i.deltaY||this.wheelData.deltaY},t.prototype.onScroll=function(t){this.preventAllGesture()},t.prototype.mouseDown=function(t){t.hypotenuse=0,t.epubClientX=t.clientX,t.epubClientY=t.clientY,this.onTouchStart(t)},t.prototype.mouseUpDoc=function(e){t._eventsStatus=this.eventsStatus;var i=this.getStat(t._eventsStatus,"start");i.stat!==!1&&(e.hypotenuse=0,e.epubClientX=e.clientX,e.epubClientY=e.clientY,this.onTouchEnd(e))},t.prototype.mouseUp=function(t){t.hypotenuse=0,t.epubClientX=t.clientX,t.epubClientY=t.clientY,this.onTouchEnd(t)},t.prototype.mouseMove=function(t){t.hypotenuse=0,t.epubClientX=t.clientX,t.epubClientY=t.clientY,this.onTouchMove(t)},t.prototype.touchStart=function(t){t.changedTouches.length>0&&this.resetMoveDifferer(),this.touchConvert(t,t.touches),this.onTouchStart(t)},t.prototype.touchEnd=function(t){return 0===t.touches.length?(this.touchConvert(t,t.changedTouches),void this.onTouchEnd(t)):void this.resetMoveDifferer()},t.prototype.touchMove=function(t){this.preventDefaultOnMove&&this.ePreventDefault(t),this.touchConvert(t,t.touches),this.onTouchMove(t)},t.prototype.pointerDown=function(t){var e=t.data.currentEvent,i=t.data.touches,n=t.data.changedTouches;n.length>0&&this.resetMoveDifferer(),this.touchConvert(e,i),this.onTouchStart(e)},t.prototype.pointerUp=function(t){var e=t.data.currentEvent,i=t.data.touches,n=t.data.changedTouches;return 0===i.length?(this.touchConvert(e,n),void this.onTouchEnd(e)):void this.resetMoveDifferer()},t.prototype.pointerMove=function(t){var e=t.data.currentEvent,i=t.data.touches;this.preventDefaultOnMove&&this.ePreventDefault(e),this.touchConvert(e,i),this.onTouchMove(e)},t.prototype.overrideEventData=function(t,e,i,n,s,o,r,a,u,l,h,p,c){this.gestureData.resetAxis=this.resetMoveDiffererByKeyBinded,this.gestureData.type=e,this.gestureData.pinchZoomDiff=h,this.gestureData.x.pointDiff=i,this.gestureData.x.vectorDiff=s,this.gestureData.x.countDiff=r,this.gestureData.x.isVector=u,this.gestureData.x.client=p,this.gestureData.y.pointDiff=n,this.gestureData.y.vectorDiff=o,this.gestureData.y.countDiff=a,this.gestureData.y.isVector=l,this.gestureData.y.client=c,t.gestureData=this.gestureData},t.clearGlobalTapGestureTimer=function(){for(var e=t.globalTapGestureTimer.length,i=0;i<e;i++)clearTimeout(t.globalTapGestureTimer[i]);t.globalTapGestureTimer=[]},t.prototype.callGestureEvent=function(t,e,i){for(var n=this.gestureEventList[t].length,s=0;s<n;s++)this.gestureEventList[t][s](e,i)},t.prototype.touchConvert_getDistance=function(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))},t.prototype.getStat=function(t,e){return t[e]},t.prototype.setStat=function(e,i,n,s){t.lastTime=s,e[i].stat=n;var o=n?"true":"false";e[i].lastTime=e[i].time,e[i].time=s,e[i][o]=e[i][o],e[i][o].lastTime=e[i][o].time,e[i][o].time=s,clearTimeout(e[i].timer)},t.prototype.setMoveDifferer=function(e){return this.moveDifferer.x.count=this.moveDifferer.x.count||e.epubClientX,this.moveDifferer.x.countDiff+=Math.abs(e.epubClientX-this.moveDifferer.x.count),this.moveDifferer.x.count=e.epubClientX,this.moveDifferer.y.count=this.moveDifferer.y.count||e.epubClientY,this.moveDifferer.y.countDiff+=Math.abs(e.epubClientY-this.moveDifferer.y.count),this.moveDifferer.y.count=e.epubClientY,this.moveDifferer.hypotenuse=this.moveDifferer.hypotenuse||e.hypotenuse,this.moveDifferer.hypotenuseDiff=e.hypotenuse-this.moveDifferer.hypotenuse,this.moveDifferer.hypotenuse=e.hypotenuse,!(this.moveDifferer.x.countDiff<t.STARTMOVEAT&&this.moveDifferer.y.countDiff<t.STARTMOVEAT&&0===this.moveDifferer.hypotenuseDiff)&&(this.moveDifferer.x.pos=this.moveDifferer.x.pos||e.epubClientX,this.moveDifferer.x.diff=e.epubClientX-this.moveDifferer.x.pos,this.moveDifferer.x.vector=this.moveDifferer.x.vector||e.epubClientX,Math.abs(e.epubClientX-this.moveDifferer.x.vector)<Math.abs(this.moveDifferer.x.vectorDiff)&&(this.moveDifferer.x.vector=e.epubClientX),this.moveDifferer.y.pos=this.moveDifferer.y.pos||e.epubClientY,this.moveDifferer.y.diff=e.epubClientY-this.moveDifferer.y.pos,this.moveDifferer.y.vector=this.moveDifferer.y.vector||e.epubClientY,Math.abs(e.epubClientY-this.moveDifferer.y.vector)<Math.abs(this.moveDifferer.y.vectorDiff)&&(this.moveDifferer.y.vector=e.epubClientY),this.moveDifferer.x.vectorDiff=e.epubClientX-this.moveDifferer.x.vector,this.moveDifferer.y.vectorDiff=e.epubClientY-this.moveDifferer.y.vector,!0)},t.prototype.resetMoveDiffererByKey=function(t){this.moveDifferer[t].diff=0,this.moveDifferer[t].count=0,this.moveDifferer[t].countDiff=0,this.moveDifferer[t].pos=0,this.moveDifferer[t].vector=0,this.moveDifferer[t].vectorDiff=0,this.moveDifferer.hypotenuseDiff=0,this.moveDifferer.hypotenuse=0},t.prototype.resetMoveDifferer=function(){this.setStat(this.eventsStatus,"move",!1,t.lastTime),this.resetMoveDiffererByKey("x"),this.resetMoveDiffererByKey("y")},t.prototype.resetStat=function(){this.eventsStatus=t.EVENTSSTATUS.data},t.prototype.onTouchStart=function(e){t._eventsStatus=this.eventsStatus;var i=this.getStat(t._eventsStatus,"start");i.stat!==!0&&(this.resetMoveDifferer(),this.setStat(t._eventsStatus,"start",!0,Date.now()),this.setStat(t._eventsStatus,"end",!1,t.lastTime),this.setStat(t._eventsStatus,"move",!1,t.lastTime),this.defineGesture(e,"start"))},t.prototype.onTouchEnd=function(e){t._eventsStatus=this.eventsStatus,this.setStat(t._eventsStatus,"start",!1,Date.now()),this.setStat(t._eventsStatus,"end",!0,t.lastTime),this.defineGesture(e,"end"),this.resetMoveDifferer()},t.prototype.onTouchMove=function(e){t._eventsStatus=this.eventsStatus,this.setStat(t._eventsStatus,"move",!1,Date.now());var i=this.getStat(t._eventsStatus,"start");if(i.stat===!0&&this.getStat(t._eventsStatus,"end").stat===!1){this.checkMediaPreventDefault(e);var n=this.setMoveDifferer(e);n===!0&&(t.clearGlobalTapGestureTimer(),this.setStat(t._eventsStatus,"move",!0,t.lastTime),this.defineGesture(e,"move"))}},t.prototype.checkMediaPreventDefault=function(t){if(this.enableCheckMediaPreventDefault!==!1){var e=t.target,i=e.tagName;if(void 0===i)return void(this.scrollableElement()===!1&&this.ePreventDefault(t));i=i.toLowerCase(),"video"!==i&&"audio"!==i&&this.scrollableElement()===!1&&this.ePreventDefault(t)}},t.prototype.tapGesture=function(e,i){var n=this;if("end"!==i)return!1;t._eventsStatus=this.eventsStatus;var s=this.getStat(t._eventsStatus,"start"),o=this.getStat(t._eventsStatus,"end"),r=this.getStat(t._eventsStatus,"move");return r.stat===!1&&o.stat===!0&&(e.defaultPreventGesture===!0?t.clearGlobalTapGestureTimer():clearTimeout(s.timer),this.overrideEventData(e,t.GESTURESNAME.TAPGESTURE,this.moveDifferer.x.diff,this.moveDifferer.y.diff,this.moveDifferer.x.vectorDiff,this.moveDifferer.y.vectorDiff,this.moveDifferer.x.countDiff,this.moveDifferer.y.countDiff,!1,!1,this.moveDifferer.hypotenuseDiff,e.epubClientX,e.epubClientY),s.timer=setTimeout(function(){n.callGestureEvent(t.GESTURESNAME.TAPGESTURE,e)},t.TAPTIME),t.globalTapGestureTimer.push(s.timer)),!1},t.prototype.dblTapGesture=function(e,i){if("end"!==i)return!1;t._eventsStatus=this.eventsStatus;var n=this.getStat(t._eventsStatus,"start"),s=this.getStat(t._eventsStatus,"end"),o=this.getStat(t._eventsStatus,"move");return o.stat===!1&&s["true"].time-n["true"].lastTime<t.DBLTAPTIME&&(t.clearGlobalTapGestureTimer(),this.overrideEventData(e,t.GESTURESNAME.DBLTAPGESTURE,this.moveDifferer.x.diff,this.moveDifferer.y.diff,this.moveDifferer.x.vectorDiff,this.moveDifferer.y.vectorDiff,this.moveDifferer.x.countDiff,this.moveDifferer.y.countDiff,!1,!1,this.moveDifferer.hypotenuseDiff,e.epubClientX,e.epubClientY),!0)},t.prototype.panGesture=function(e,i){if("end"===i||"start"===i)return!1;t._eventsStatus=this.eventsStatus;var n=this.getStat(t._eventsStatus,"move");return n.stat!==!1&&(this.ePreventDefault(e),this.overrideEventData(e,t.GESTURESNAME.PANGESTURE,this.moveDifferer.x.diff,this.moveDifferer.y.diff,this.moveDifferer.x.vectorDiff,this.moveDifferer.y.vectorDiff,this.moveDifferer.x.countDiff,this.moveDifferer.y.countDiff,!1,!1,this.moveDifferer.hypotenuseDiff,e.epubClientX,e.epubClientY),!0)},t.prototype.pinchGesture=function(t){},t.prototype.pressGesture=function(t){},t.prototype.neutralSwipeGesture=function(e){return(0!==this.moveDifferer.x.vectorDiff||0!==this.moveDifferer.y.vectorDiff)&&(this.ePreventDefault(e),this.overrideEventData(e,t.GESTURESNAME.SWIPEGESTURE,this.moveDifferer.x.diff,this.moveDifferer.y.diff,this.moveDifferer.x.vectorDiff,this.moveDifferer.y.vectorDiff,this.moveDifferer.x.countDiff,this.moveDifferer.y.countDiff,!1,!1,this.moveDifferer.hypotenuseDiff,e.epubClientX,e.epubClientY),!0)},t.prototype.swipeGesture=function(e){t._eventsStatus=this.eventsStatus;var i=!1,n=!1,s=this.getStat(t._eventsStatus,"start"),o=this.getStat(t._eventsStatus,"end"),r=this.getStat(t._eventsStatus,"move");return r.stat!==!1&&o.stat!==!1&&(i=Math.abs(this.moveDifferer.x.vectorDiff)>t.SWIPEGESTURE_AT_PIXELS,i===!1&&(i=Math.abs(this.moveDifferer.x.vectorDiff)>t.SWIPEGESTURE_AT_PIXELS_IN_TIME&&o.time-s.lastTime<=t.SWIPEGESTURE_AT_TIME),n=Math.abs(this.moveDifferer.y.vectorDiff)>t.SWIPEGESTURE_AT_PIXELS,n===!1&&(n=Math.abs(this.moveDifferer.y.vectorDiff)>t.SWIPEGESTURE_AT_PIXELS_IN_TIME&&o.lastTime-s.lastTime<=t.SWIPEGESTURE_AT_TIME),i===!1&&n===!1?this.neutralSwipeGesture(e):(this.overrideEventData(e,t.GESTURESNAME.SWIPEGESTURE,this.moveDifferer.x.diff,this.moveDifferer.y.diff,this.moveDifferer.x.vectorDiff,this.moveDifferer.y.vectorDiff,this.moveDifferer.x.countDiff,this.moveDifferer.y.countDiff,i,n,this.moveDifferer.hypotenuseDiff,e.epubClientX,e.epubClientY),!0))},t.prototype.defineGesture=function(e,i){if(e.defaultPreventGesture===!0||t.PREVENT_ALL===!0)return this.resetStat(),this.resetMoveDifferer(),void t.clearGlobalTapGestureTimer();this.tapGesture(e,i),t._eventsStatus=this.eventsStatus;this.getStat(t._eventsStatus,"start");return this.dblTapGesture(e,i)===!0?(this.callGestureEvent(t.GESTURESNAME.DBLTAPGESTURE,e),void t.clearGlobalTapGestureTimer()):this.swipeGesture(e)===!0?(this.callGestureEvent(t.GESTURESNAME.SWIPEGESTURE,e),void((e.defaultPreventGesture===!0||t.PREVENT_ALL)&&t.clearGlobalTapGestureTimer())):this.panGesture(e,i)===!0?(this.callGestureEvent(t.GESTURESNAME.PANGESTURE,e),void((e.defaultPreventGesture===!0||t.PREVENT_ALL)&&t.clearGlobalTapGestureTimer())):void 0},t.prototype.setEnableScrollElement=function(t){this.enableScrollElement=t},t.prototype.setEnableCheckMediaPreventDefault=function(t){this.enableCheckMediaPreventDefault=t},t.prototype.scrollableElement=function(){return this.enableScrollElement!==!1&&null!==this.element.parentElement},t.prototype.preventAllGesture_reset=function(){t.PREVENT_ALL=!1},t.preventAllGestureStatus=function(){return t.PREVENT_ALL},t.prototype.preventAllGesture=function(){clearTimeout(t.timer),t.PREVENT_ALL=!0,t.timer=setTimeout(this.preventAllGesture_reset,100)},t.prototype.addEventListener=function(t,e){var i="gesture_".concat(t,"_",this.gestureID);return"undefined"==typeof e[i]&&(e[i]=!0,this.gestureEventList[t].push(e),!0)},t.prototype.removeEventListener=function(t,e){var i="gesture_".concat(t,"_",this.gestureID);if("undefined"==typeof e[i])return!1;for(var n=0,s=this.gestureEventList[t].length;n<s;n++)if(void 0!==this.gestureEventList[t][n][i])return this.gestureEventList[t][n][i]=null,delete this.gestureEventList[t][n][i],!0;return!1},t.prototype.resetMoveXDifferer=function(){this.resetMoveDiffererByKey("x")},t.prototype.resetMoveYDifferer=function(){this.resetMoveDiffererByKey("y")},t.EVENTSTYPE=n.getEventsType(),t.UID=0,t.DBLTAPTIME=500,t.TAPTIME=300,t.PREVENT_ALL=!1,t.STARTMOVEAT=10,t.SWIPEGESTURE_AT_TIME=200,t.SWIPEGESTURE_AT_PIXELS_IN_TIME=7,t.SWIPEGESTURE_AT_PIXELS=50,t.EVENTSSTATUS={get data(){return n.getEpubEventStatusManager()}},t.lastTime=0,t.globalTapGestureTimer=[],t.timer=0,t.GESTURESNAME=n.getGesturesName(),t}();i["default"]=r},{"./EpubGesturesEvent/Defs":11,"./EpubGesturesEvent/MouseWheelManager":13,"./utils/isTouchSupported":80}],11:[function(t,e,i){"use strict";function n(){return{stat:!1,time:0,lastTime:0,timere:0,"true":{time:0,lastTime:0},"false":{time:0,lastTime:0}}}function s(){return{start:n(),end:n(),move:n()}}function o(){return{MOUSE:{MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSELEAVE:"mouseleave",MOUSEMOVE:"mousemove",CLICK:"click"},TOUCH:{TOUCHSTART:"touchstart",TOUCHEND:"touchend",TOUCHMOVE:"touchmove"},MSPOINTER:{POINTERDOWN:"MSPointerDown",POINTERCANCEL:"MSPointerCancel",POINTERLEAVE:"MSPointerLeave",POINTERUP:"MSPointerUp",POINTERMOVE:"MSPointerMove"},POINTER:{POINTERDOWN:"pointerdown",POINTERCANCEL:"pointercancel",POINTERLEAVE:"pointerleave",POINTERUP:"pointerup",POINTERMOVE:"pointermove"},MOUSEWHEEL:"mousewheel",WHEEL:"wheel",DOMMOUSESCROLL:"DOMMouseScroll"}}function r(){return{PINCHGESTURE:"pinchGesture",PRESSGESTURE:"pressGesture",PANGESTURE:"panGesture",TAPGESTURE:"tapGesture",DBLTAPGESTURE:"dblTapGesture",SWIPEGESTURE:"swipeGesture",MOUSEWHEELGESTURE:"mouseWheelGesture"}}function a(){return{x:{diff:0,count:0,countDiff:0,pos:0,vector:0,vectorDiff:0},y:{diff:0,count:0,countDiff:0,pos:0,vector:0,vectorDiff:0},hypotenuse:0,hypotenuseDiff:0}}function u(){return{type:"",pinchZoomDiff:0,wheel:{isX:!1,isY:!1},x:{pointDiff:0,vectorDiff:0,client:0,isVector:!1},y:{pointDiff:0,vectorDiff:0,client:0,isVector:!1}}}function l(){return{timerID:0,currentTime:0,deltaX:0,deltaY:0}}Object.defineProperty(i,"__esModule",{value:!0}),i.getEpubEventStatus=n,i.getEpubEventStatusManager=s,i.getEventsType=o,i.getGesturesName=r,i.getMoveDifferer=a,i.getGestureData=u,i.getWheelData=l},{}],12:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(t,e){this.element=t,this.config=e,this.enableKeyBoard=!0,this.isMouseenter=!0,this.spreadDraggable&&(this.keyUp=this.keyUpPre.bind(this),this.element.setAttribute("tabindex","1"),this.setEvents())}return Object.defineProperty(t.prototype,"spreadDraggable",{get:function(){return this.config.spreadDraggable},enumerable:!0,configurable:!0}),t.prototype.setEvents=function(){var t=this;window.addEventListener("keyup",this.keyUp),this.element.addEventListener("mouseenter",function(e){t.isMouseenter=!0}),this.element.addEventListener("mouseleave",function(e){t.isMouseenter=!1})},t.prototype.isEditableElement=function(){var t=document.activeElement;if(null!==t&&"false"!==t.getAttribute("contenteditable")){var e=t.tagName.toLowerCase();if("input"===e||"textarea"===e||"select"===e||"true"===t.getAttribute("contenteditable"))return!0}return!1},t.prototype.keyUpPre=function(t){if(this.config.disableArrowKeys!==!0&&(this.element===document.activeElement||this.isMouseenter!==!1&&(this.isEditableElement()!==!0||document.hasFocus()!==!0))){var e=t.key||t.keyIdentifier;switch(e){case"ArrowLeft":this.pagePrevious();break;case"ArrowUp":this.pagePrevious();break;case"ArrowRight":this.pageNext();break;case"ArrowDown":this.pageNext();break;case"Left":this.pagePrevious();break;case"Up":this.pagePrevious();break;case"Right":this.pageNext();break;case"Down":this.pageNext()}}},t.prototype.pageNext=function(){NIApi.page.openNext()},t.prototype.pagePrevious=function(){NIApi.page.openPrevious()},t}();i.EpubKeyBoardEvent=n},{}],13:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../EpubGesturesEvent/Defs"),s=t("../EpubEvent"),o=function(){function t(e){this.element=e,this.lastSentWheelTimestamp=0,this.lastHighWheelTimestamp=0,this.lastThreadResponseTimestamp=0,
this.lastThreadBlockTimestamp=0,this.browserName=w.Param.userAgent.browser.name,this.epubEvent=new s.EpubEvent;var i="WheelEvent"in window?t.EVENTSTYPE.WHEEL:t.EVENTSTYPE.MOUSEWHEEL;this.element.addEventListener(i,this.mouseWheelHandler.bind(this),!1),this.initCheckThreadBlockDaemon()}return t.prototype.addListeners=function(t,e){this.epubEvent.addListener(s.EPUB_EVENTS.MOUSE_WHEEL,t)},t.prototype.removeListeners=function(t,e){this.epubEvent.removeListener(s.EPUB_EVENTS.MOUSE_WHEEL,t)},t.prototype.initCheckThreadBlockDaemon=function(){var t=this;this.lastThreadResponseTimestamp=Date.now(),setInterval(function(){var e=Date.now(),i=e-t.lastThreadResponseTimestamp;i>50&&(t.lastThreadBlockTimestamp=e),t.lastThreadResponseTimestamp=e},0)},t.prototype.mouseWheelHandler=function(t){this.isWheelDeltaTooLow(t)||(this.updateHighWheelTimestamp(),this.isLastThreadBlockTooClose()||this.isLastSentWheelTooClose()||this.sendWheelEvent(t))},t.prototype.isWheelDeltaTooLow=function(t){var e=15,i=this.getWheelDelta(t),n=0===t.deltaMode;return n&&i<e},t.prototype.getWheelDelta=function(t){return Math.max(Math.abs(t.deltaY),Math.abs(t.deltaX))},t.prototype.updateHighWheelTimestamp=function(){this.lastHighWheelTimestamp=Date.now()},t.prototype.isLastThreadBlockTooClose=function(){var t=250,e=this.lastHighWheelTimestamp-this.lastThreadBlockTimestamp;return e<t},t.prototype.isLastSentWheelTooClose=function(){var t=800,e=this.lastHighWheelTimestamp-this.lastSentWheelTimestamp;return e<t},t.prototype.sendWheelEvent=function(t){this.lastSentWheelTimestamp=Date.now(),this.dispatchEventsWheel(t)},t.prototype.dispatchEventsWheel=function(t){this.epubEvent.fire({type:s.EPUB_EVENTS.MOUSE_WHEEL,data:t})},t.windowScrollInit=!1,t.windowMouseWheelInit=!1,t.windowScrollStatus=!1,t.EVENTSTYPE=n.getEventsType(),t.GESTURESNAME=n.getGesturesName(),t}();i.MouseWheelManager=o},{"../EpubEvent":8,"../EpubGesturesEvent/Defs":11}],14:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./EpubManager"),s=t("./EpubDomApi"),o=t("./polyfill/closest");o["default"]();var r;!function(t){var e=function(){function t(){w.EpubDomApi=s["default"],w.Class.EpubManager=n["default"]}return t}();t.EpubMain=e}(r||(r={})),new r.EpubMain},{"./EpubDomApi":7,"./EpubManager":15,"./polyfill/closest":73}],15:[function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(s,o){function r(t){try{u(n.next(t))}catch(e){o(e)}}function a(t){try{u(n["throw"](t))}catch(e){o(e)}}function u(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(r,a)}u((n=n.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,o=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(r=u.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){u.label=i[1];break}if(6===i[0]&&u.label<r[1]){u.label=r[1],r=i;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(i);break}r[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(n){i=[6,n],o=0}finally{s=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,o,r,a,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(i,"__esModule",{value:!0});var o,r=t("./EpubConfig"),a=t("./EpubCssManager"),u=t("./EpubNavigationTypeManager"),l=t("./EpubSpreads"),h=t("./EpubStatistics"),p=t("./components/pageToast/Controller"),c=t("./EpubEvent"),d=t("./EpubGesturesEvent/EpubKeyBoardEvent"),f=t("./utils/functions"),m=t("./EpubGesturesEvent"),g=t("./EpubConfig/EpubDefaultConfig"),v=t("./EpubGalleryManager"),y=t("./EpubPageEnrichment/Slider/index");!function(t){t.GALLERY="GALLERY",t.APP_CONTAINER="APP_CONTAINER"}(o||(o={}));var b;!function(t){t.GO_TO_PREVIOUS="goToPrevious",t.STAY="stay",t.GO_TO_NEXT="goToNext"}(b||(b={}));var E;!function(t){t.SELF="_self",t.BLANK="_blank",t.POPUP="popup"}(E||(E={})),i.OpenTarget=E;var S;!function(t){t.TOGGLE_SHARE_PANEL="toggleSharePanel",t.TOGGLE_SEARCH_PANEL="toggleSearchPanel",t.TOGGLE_FAVORITE_PANEL="toggleFavoritePanel",t.TOGGLE_THUMBNAIL_PANEL="toggleThumbnailPanel",t.TOGGLE_SUMMARY_PANEL="toggleSummaryPanel",t.MAILTO="mailto",t.GO_TO_PAGE="goToPage",t.POPUP="popup",t.OPEN_NEW_TAB="openNewTab",t.OPEN_SAME_TAB="openSameTab",t.SHOW_TOOLTIP="showTooltip",t.HIDE_TOOLTIP="hideTooltip",t.SLIDER="slider"}(S||(S={}));var P=function(){function t(t,e){this.parent=t,this.viewMain=e,this.epubMode=!0,this.screenSize={width:0,height:0,ratio:0},this.registeredInddPluginEvent={},this.userInteractions(!1),w.epubEvent=w.epubEvent||new c.EpubEvent,this.epubEvent=w.epubEvent,this.userAgent=w.Param.userAgent,this.config=new r["default"](this),this.epubStatistics=new h.EpubStatistics(this),this.galleryManager=new v["default"],this.registerApi(),this.initListeners()}return Object.defineProperty(t.prototype,"defaultPageScaleAt",{get:function(){return this.config.defaultPageScaleAt},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxPageTotalScale",{get:function(){return this.config.maxPageTotalScale},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"navigationAxis",{get:function(){return this.config.navigationAxis},set:function(t){this.config.navigationAxis=t,this.epubSpreads.updateSpreads(0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transitionTime",{get:function(){return this.config.transitionTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPage",{get:function(){return this.config.currentPage},set:function(t){this.config.currentPage=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPageNoAnimation",{get:function(){return this.config.currentPageNoAnimation},set:function(t){this.config.currentPageNoAnimation=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageQuantity",{get:function(){return this.config.pageQuantity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pagesBySpreadMax",{get:function(){return this.config.pagesBySpreadMax},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageChangeSource",{set:function(t){this.config.pageChangeSource=t},enumerable:!0,configurable:!0}),t.prototype.registerApi=function(){var t=this;NIApi.register("page.openNext",function(){return t.pageNext(),Promise.resolve()}),NIApi.register("page.openPrevious",function(){return t.pagePrevious(),Promise.resolve()}),NIApi.register("page.openFirst",function(){return t.pageFirst(),Promise.resolve()}),NIApi.register("page.openLast",function(){return t.pageLast(),Promise.resolve()}),NIApi.register("page.open",function(e){return t.goToPage(e),Promise.resolve()}),NIApi.register("event.registerPluginEvent",function(e,i){return t.registeredInddPluginEvent[e]=i,Promise.resolve()})},t.prototype.isFocusable=function(){var t,e,i=document.activeElement;return!i||(t=i.readOnly,e=i.getAttribute("contenteditable"),t!==!1&&"true"!==e)},t.prototype.focusOn=function(){this.isFocusable()===!0&&this.epubSpreads.getMainViewElement().focus()},t.prototype.initListeners=function(){var t=this;document.addEventListener("WebPublicationAction",this.onApiCall.bind(this),!0),this.epubEvent.addListener(c.EPUB_EVENTS.PAGE_CLICK,function(e){t.toggleMenu()}),this.epubEvent.addListener(c.EPUB_EVENTS.PAGE_CHANGE,function(e){e.data.useAnimationTime===!1?t.epubSpreads.updateSpreads(0):t.epubSpreads.updateSpreads(t.transitionTime),w.Main.pageManager.set(t.currentPage),w.Main.pagesLoaderNew.setCurrentPage(t.currentPage),t.setDocumentPagesAttributes(),e.data.pageNeverChanged||(t.focusOn(),setTimeout(function(){t.focusOn()},200))}),w.Main.pageManager.onChange(function(e){e=~~e,t.currentPage!==e&&t.goToPage(e)}),this.epubEvent.addListener(c.EPUB_EVENTS.PAGE_ZOOM,function(e){w.Param.zoom=e.data.status;var i=t.viewMain.classList.contains("epub-view_state-zoom-in");w.Param.zoom===!1&&i?t.viewMain.classList.remove("epub-view_state-zoom-in"):w.Param.zoom!==!0||i||t.viewMain.classList.add("epub-view_state-zoom-in"),w.Utils.callEvent(window,"webpub-zoom")}),this.preventDocumentScroll()},t.prototype.onApiCall=function(t){var e=this,i=this.isFromTapEvent(t),n=this.isFromSpread(t);i&&n?this.callIfClickAuthorized(function(){e.handleInddPluginEvent(t)}):this.handleInddPluginEvent(t)},t.prototype.isOriginalEventSent=function(t){return t.detail&&t.detail.event&&t.detail.event.type},t.prototype.isFromTapEvent=function(t){if(this.isOriginalEventSent(t)){var e=t.detail.event.type,i=[m["default"].EVENTSTYPE.MOUSE.CLICK,m["default"].EVENTSTYPE.TOUCH.TOUCHEND];if(i.includes(e))return!0}return!1},t.prototype.isFromSpread=function(t){if(this.isOriginalEventSent(t))for(var e=t.detail.event.target,i=this.epubSpreads.epubSpreads.map(function(t){return t.element}),n=0;n<i.length;n++){var s=i[n],o=e instanceof Node&&s.contains(e);if(o)return!0}return!1},t.prototype.callIfClickAuthorized=function(t){var e=this;this.epubEvent.fire({type:c.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:!0,action:function(i){return e.clickAction(i,t)}}})},t.prototype.clickAction=function(t,e){t.then(function(t){t&&e()})},t.prototype.handleInddPluginEvent=function(t){var e=t.detail,i=e.type,n=e.params,s=e.event;switch(i){case S.TOGGLE_SHARE_PANEL:return void NIApi.panels.share.toggle();case S.TOGGLE_SEARCH_PANEL:return void NIApi.panels.search.toggle();case S.TOGGLE_FAVORITE_PANEL:return void NIApi.panels.favorites.toggle();case S.TOGGLE_THUMBNAIL_PANEL:return void NIApi.panels.thumbnail.toggle();case S.TOGGLE_SUMMARY_PANEL:return void NIApi.panels.summary.toggle();case S.MAILTO:return void(n&&n.email&&(window.location.href="mailto:"+n.email));case S.GO_TO_PAGE:return void(n&&n.page&&(NIApi.page.open(n.page),NIApi.lightbox.closeAll(),NIApi.menu.close()));case S.POPUP:case S.OPEN_NEW_TAB:case S.OPEN_SAME_TAB:var r=n.assetDriveItem,a=void 0===r?{type:void 0,globalId:void 0}:r,u=n.subAssetDriveItem,l=n.pageNumber,h=n.param,p=this.resolveParams(n),c=[o.GALLERY,o.APP_CONTAINER].includes(a.type);if(c){var d=u&&u.globalId,f=this.getTargetFromEventType(i);return void NIApi.gallery.open(a.globalId,d,l,f)}var m=this.isExternalLink(p);if(w.Param.isApp&&!m||i===S.POPUP)return void this.openPopup(p);var g=this.getTargetFromEventType(i);return h&&!a.globalId&&w.Main.trackerManager.trackEvent({name:"externalLink",variables:{1:p.param}}),void window.open(p.param,g);case S.SHOW_TOOLTIP:if(s){var v={X:s.clientX,Y:s.clientY+25};n.content&&w.Main.tooltipManager.showAfterDelay(n.content,v)}return;case S.HIDE_TOOLTIP:return void w.Main.tooltipManager.hide();case S.SLIDER:var y=n.slides,b=n.settings;this.removeSlider();var E=this.createHiddenElement();return void this.handleSlider(E,y,b)}var P=this.registeredInddPluginEvent[i];return P?void P(n):void console.warn("Plugin event "+i+" not found. Tried to call with params : ",n)},t.prototype.handleSlider=function(t,e,i){var n=new y.Slider(t,e,"mainView",w.Main.pagesLoaderNew.getCurrentPage(),i,y.SliderType.FULLSCREEN_BUTTON),s=document.querySelectorAll(".pswp__img");s.length>0?(Array.from(s).forEach(function(t){t.addEventListener("click",function(t){return t.preventDefault()})}),n.openInFullscreen()):this.removeSlider()},t.prototype.createHiddenElement=function(){var t=document.createElement("div");return t.classList.add("hidden-element","plugin-slider-hidden"),document.body.appendChild(t),t},t.prototype.removeHiddenElement=function(){var t=document.querySelector(".hidden-element");t&&t.remove()},t.prototype.removeSlider=function(){this.removeHiddenElement()},t.prototype.isExternalLink=function(t){return!t||!t.assetDriveItem||"EXTERNAL_LINK"===t.assetDriveItem.type||t.assetDriveItem.isExternalLink===!0},t.prototype.resolveParams=function(t){var e=t.assetDriveItem&&t.assetDriveItem.relUrl&&"EXTERNAL_LINK"!==t.assetDriveItem.type?"${media}"+t.assetDriveItem.relUrl.replace(/^\/?\d+\//g,""):t.param;return!t.assetDriveItem||"PUBLICATION"!==t.assetDriveItem.type&&"COMPONENT"!==t.assetDriveItem.type||(e+="index.html"),t.pageNumber&&(e+="#page="+t.pageNumber),e=w.Utils.resolveVariable(e),t.param=e,t},t.prototype.getTargetFromEventType=function(t){switch(t){case S.POPUP:return E.POPUP;case S.OPEN_SAME_TAB:return E.SELF;case S.OPEN_NEW_TAB:default:return E.BLANK}},t.prototype.openPopup=function(t){t.id="epub-lightbox-"+Date.now().toString();var e=NIApi.lightbox.getOpenList();NIApi.lightbox.openPopup(null,t),setTimeout(function(){e.then(function(t){return t.forEach(function(t){return NIApi.lightbox.close(t)})})},250)},t.prototype.isEditableElementActive=function(){var t=document.activeElement.tagName.toLowerCase();return["input","textarea"].includes(t)},t.prototype.preventDocumentScroll=function(){var t=this,e=!1,i=0,n=function(){return Date.now()-i<100};document.addEventListener("touchend",function(s){if(!t.isEditableElementActive())return n()?void s.preventDefault():void(e===!0&&(i=Date.now(),window.scrollTo(0,0),t.epubNavigationTypeManager.forceResize(),s.preventDefault()))},!0),document.addEventListener("touchmove",function(i){t.isEditableElementActive()||(n()&&i.preventDefault(),e=0!==window.scrollY||0!==window.scrollX)},!1)},t.prototype.setDocumentPagesAttributes=function(){var t=this.getCurrentPages();document.documentElement.setAttribute("pages",t.join("-")),document.documentElement.setAttribute("pages-left",t[0].toString()),t[1]?document.documentElement.setAttribute("pages-right",t[1].toString()):document.documentElement.setAttribute("pages-right","")},t.prototype.showMenu=function(t){return t===!1?(w.Main.menuManager.hideMenu(),void w.Main.menuManager.hideTopnav()):void w.Main.menuManager.showTopnav()},t.prototype.toggleMenu=function(){w.Main.toolsEvents&&(1===w.Main.toolsEvents.showToolsInfo?(w.Main.toolsEvents.showTools(!1),this.showMenu(!1)):(w.Main.toolsEvents.showTools(!0),this.showMenu(!0)))},t.prototype.pageChange=function(t){this.goToPage(t)},t.prototype.pageNext=function(){w.Main.trackerManager.trackEvent({name:"pageNext",variables:{1:this.currentPage}});var t=this.epubSpreads.getNumberOfPageToNextSpread(this.currentPage-1);this.goToPage(this.currentPage+t)},t.prototype.pagePrevious=function(){w.Main.trackerManager.trackEvent({name:"pagePrev",variables:{1:this.currentPage}});var t=this.epubSpreads.getNumberOfPageToPreviousSpread(this.currentPage-1);this.goToPage(this.currentPage-t)},t.prototype.pageFirst=function(){w.Main.trackerManager.trackEvent({name:"pageFirst",variables:{1:this.currentPage}}),this.goToPage(1)},t.prototype.pageLast=function(){w.Main.trackerManager.trackEvent({name:"pageLast",variables:{1:this.currentPage}}),this.goToPage(this.pageQuantity)},t.prototype.goToPage=function(t,e,i){void 0===e&&(e=!0),this.pageChangeSource=i,e?this.currentPage=t:this.currentPageNoAnimation=t},t.prototype.canChangePage=function(t,e){var i=t.isVector,n=t.vectorDiff,s=t.pointDiff,o=Math.abs(n)>Math.abs(e.vectorDiff);return i&&o?n>0?s<0?b.STAY:b.GO_TO_PREVIOUS:n<0?s>0?b.STAY:b.GO_TO_NEXT:b.STAY:b.STAY},t.prototype.userInteractions=function(t){void 0===t&&(t=!0),document.documentElement.style.cursor=t?"default":"progress",document.body.style.pointerEvents=t?"all":"none"},t.prototype.gotoPageByCoordsDiff=function(t,e){void 0===e&&(e=!0);var i=this.navigationAxis===g.NavigationAxis.X?"y":"x",n=this.canChangePage(t[this.navigationAxis],t[i]);return n===b.GO_TO_NEXT?void this.pageNext():n===b.GO_TO_PREVIOUS?void this.pagePrevious():void this.goToPage(this.currentPage,e)},t.prototype.scrollFrame=function(t){"next"===t||1===t?this.pageNext():"prev"!==t&&t!==-1||this.pagePrevious()},t.prototype.getCurrentPages=function(t){return void 0===t&&(t=this.currentPage),void 0===this.epubSpreads?[]:this.epubSpreads.getSpreadPageIndexesByPageIndex(t-1).map(function(t){return t+1})},t.prototype.getPagesOfFrame=function(){return this.getCurrentPages()},t.prototype.getFrameOfPage=function(t){return this.getCurrentPages(t)[0]},t.prototype.setConfig=function(t){this.config.setConfig(t)},t.prototype.updateSpreadsSize=function(){void 0!==this.epubSpreads&&this.epubSpreads.updateSpreadsSize()},t.prototype.switchNavigation=function(t){return t?(this.navigationAxis=t,this.navigationAxis):this.navigationAxis===g.NavigationAxis.X?(this.navigationAxis=g.NavigationAxis.Y,this.navigationAxis):(this.navigationAxis=g.NavigationAxis.X,this.navigationAxis)},t.prototype.isZoomed=function(){return 0!==this.epubSpreads.getScaleFromCurrentSpread()},t.prototype.zoomByStep=function(t){this.epubSpreads.zoomByStep({x:.5,y:0,step:t,animate:!0})},t.prototype.zoomIn=function(){this.epubSpreads.zoomToggle({x:.5,y:0,scale:this.defaultPageScaleAt,animate:!0})},t.prototype.zoomOut=function(){this.epubSpreads.zoomToggle({x:.5,y:0,scale:0,animate:!0})},t.prototype.zoomTo=function(t){this.epubSpreads.zoomToggle({x:.5,y:0,scale:t,animate:!0})},t.prototype.zoomNow=function(t){this.epubSpreads.zoomToggle({x:.5,y:0,scale:t,animate:!1})},t.prototype.initStartingPage=function(){var t="startPage",e=w.Main.urlManager.get(t);e&&this.goToPage(parseInt(e,10))},t.prototype.init=function(t,e){return n(this,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return f.resizeHTMLTagElement(),this.setConfig(t),this.epubCssManager=new a.EpubCssManager(this.config),[4,this.epubCssManager.init(e)];case 1:return i.sent(),this.epubNavigationTypeManager=new u["default"](this,this.config,this.viewMain),this.epubSpreads=new l["default"](this,this.config,this.viewMain,this.epubCssManager),w.Main.startupManager.has("ui.pageToast.enabled",this.userAgent.device.type)&&(this.pageToast=new p.Controller(this)),this.epubSpreads.getMainViewElement().setAttribute("tabindex","1"),this.epubKeyBoardEvent=new d.EpubKeyBoardEvent(this.epubSpreads.getMainViewElement(),this.config),this.screenSize=this.epubNavigationTypeManager.screenSize,this.epubNavigationTypeManager.forceResize(),w.Main.pagesLoaderNew.setCurrentPage(this.currentPage),this.userInteractions(!0),this.initStartingPage(),[2]}})})},t}();i["default"]=P},{"./EpubConfig":4,"./EpubConfig/EpubDefaultConfig":5,"./EpubCssManager":6,"./EpubEvent":8,"./EpubGalleryManager":9,"./EpubGesturesEvent":10,"./EpubGesturesEvent/EpubKeyBoardEvent":12,"./EpubNavigationTypeManager":16,"./EpubPageEnrichment/Slider/index":56,"./EpubSpreads":64,"./EpubStatistics":66,"./components/pageToast/Controller":70,"./utils/functions":78}],16:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./EpubEvent"),s=t("./utils/functions"),o=function(){function t(t,e,i){var n=this;this.sizeIDString="",this.timers={resize:0,orientationchange:0},this.parent=t,this.config=e,this.epubEvent=w.epubEvent,this.screenSize=this.parent.screenSize,this.onResize=this.onResize.bind(this),this.pageLayout=w.Main.pageLayoutService.get("pageLayout");var s=w.Main.xmlManager.get("common-configuration","contents","zoom","width"),o=w.Main.xmlManager.get("common-configuration","contents","zoom","height");this.isWidePage=s>o,this.pageSize={width:this.pageWidth,height:this.pageHeight,ratio:1.5*this.pageWidth/this.pageHeight},this.updateScreenSize(),this.epubScreenElement=i,window.addEventListener(w.Param.eventResize,this.onResize.bind(this)),window.addEventListener("focus",this.onResize,!1),setTimeout(function(){return n.forceResize()},0),setTimeout(function(){n.localCheckWindowSize()},1e3)}return Object.defineProperty(t.prototype,"timeToRefreshScreenResize",{get:function(){return this.config.timeToRefreshScreenResize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddinigs",{get:function(){return this.config.paddings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pagesBySpreadMax",{get:function(){return this.config.pagesBySpreadMax},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageWidth",{get:function(){return this.config.pageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageHeight",{get:function(){return this.config.pageHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"switchLandScapeUsingPageSize",{get:function(){return this.config.switchLandScapeUsingPageSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerWidth",{get:function(){return window.innerWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerHeight",{get:function(){return window.innerHeight},enumerable:!0,configurable:!0}),t.prototype.needUpdateScreenSize=function(){return this.screenSize.width===this.innerWidth&&this.screenSize.height===this.innerHeight},t.prototype.updateScreenSize=function(){var t=this.needUpdateScreenSize();return this.screenSize.width=this.innerWidth,this.screenSize.height=this.innerHeight,this.screenSize.ratio=this.screenSize.width/this.screenSize.height,t},t.prototype.isWideScreen=function(){if(!w.Param.isDesktop){var t=screen;if(t.orientation)return t.orientation.type.includes("landscape");if(t.msOrientation)return t.msOrientation.type.includes("landscape")}return this.screenSize.width>this.screenSize.height},t.prototype.onResizeSync=function(){var t;return s.resizeHTMLTagElement(),window.scrollTo(0,0),this.config.paddinigsUpdate(),this.sizeIDString=this.innerHeight+"-"+this.innerWidth,this.updateScreenSize()!==!0||(this.parent.updateSpreadsSize(),t=s.isWindowLandscape(),t!==this.windowLandscape&&(this.windowLandscape=t,this.epubEvent.fire({type:n.EPUB_EVENTS.SCREEN_ORIENTATION,data:{landscape:t}})),!1)},t.prototype.onResize=function(t){window.scrollTo(0,0),clearTimeout(this.timers[t.type]),this.onResizeSync()!==!1&&(this.timers[t.type]=setTimeout(this.onResize.bind(this,t),this.timeToRefreshScreenResize))},t.prototype.localCheckWindowSize=function(){var t=this,e=this.innerHeight,i=this.innerWidth;this.sizeIDString!==e+"-"+i&&this.forceResize(),window.setTimeout(function(){t.localCheckWindowSize()},500)},t.prototype.forceResize=function(){this.onResize({type:"resize"})},t}();i["default"]=o},{"./EpubEvent":8,"./utils/functions":78}],17:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),t("es6-promise");var n=t("./utils/enums"),s=t("./utils/XHRPromise"),o=t("./utils/XHRPromise"),r=t("./EpubPage/LinksManager"),a=t("./EpubPageEnrichment"),u=t("./utils/functions"),l=t("./EpubEvent"),h='\\<\\?xml version="1.0" encoding="UTF-8" standalone="no"\\?\\>\\n\\<\\!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"\\>',p=function(){function t(e,i,s,o){this.epubPages=e,this.config=i,this.pageNumber=s,this.epubCssManager=o,this.isVisible=!1,this.loadList=[],this.inCache=!1,this.synchronizedWidthSpread=!1,this.isOnLoad=!1,this._pageContainsCPUElement=!1,this.loadXhrError=function(){this.inCache=!1,this.isOnLoad=!1,this.callCallBackOnload(!1)},this.epubEvent=w.epubEvent,this.pageSizeCoefLinkCallBack=this.pageSizeCoefLinkCallBack.bind(this),this.loadXhrError=this.loadXhrError.bind(this),this.currentPageNumber=s,void 0===t.pageSizeCoefLink&&(t.pageSizeCoefLink=new Promise(this.pageSizeCoefLinkCallBack)),this.elementContainer=this.element=document.createElement("figure"),this.linksManager=new r["default"](this,i,s,this.element),this.setRootElemAttributes(this.element,s),this.readerPageSrcType===n.READER_TYPES.EPUB_HTML&&(this.epubPageEnrichment=new a["default"](this,this.config,this.elementContainer))}return t.prototype.pageSizeCoefLinkCallBack=function(e){t.pageSizeCoefLinkResolve=e},Object.defineProperty(t.prototype,"readerPageSrcType",{get:function(){return this.config.readerPageSrcType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"srcHdpi",{set:function(t){this.urlPageHdpi=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"src",{set:function(t){this.inCache!==!0&&(this.urlPage=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onload",{set:function(t){this._onload(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"atSpreadOffset",{set:function(t){this._spreadOffset=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageContainsCPUElement",{get:function(){return this._pageContainsCPUElement},set:function(t){var e="no";t===!0&&(e="yes"),"yes"===e&&this.pageContainsCPUElement===!0||"no"===e&&this.pageContainsCPUElement===!1||(this._pageContainsCPUElement=t,this.updateAttributesIframe(e))},enumerable:!0,configurable:!0}),t.prototype.updateIframesZoom=function(t){this.epubPageEnrichment&&this.epubPageEnrichment.updateIframesZoom(t),this.linksManager&&this.linksManager.updateIframesZoom(t)},t.prototype.updateAttributesIframe=function(t){this.zoomableParentElement&&this.zoomableParentElement.setAttribute("contains-iframe",t)},t.prototype.innerHTML=function(t,e){t.innerHTML=e},t.prototype.epubPageEnrichmentStat=function(){if(this.inCache!==!1)return this.isVisibleSpread()?void this.onVisible():void this.onNonVisible()},t.prototype.isVisibleSpread=function(){return this.config.isVerticalOnePage?[-2,-1,0,1,2].includes(this._spreadOffset):0===this._spreadOffset},t.prototype.pathToSvg=function(t,e){var i=new RegExp(h,"gmi");return t=t.replace(/(\/[^\/]+)$/g,"/svg/"),e=e.replace(i,""),e.replace(/svg\//gim,t).trim()},t.prototype.parseImage=function(t){var e=this;u.htmlSecureRemoveChildren(t);var i=new Image;i.src=this.urlPage,t.appendChild(i);var n=new Promise(function(n,s){var o=i.onload=i.onerror=i.onabort=function(){n(i),t.classList.add("epub-image-page-loaded"),null!==i.parentElement&&setTimeout(function(){if(null!==i.parentElement){var n=new Image;n.src=e.urlPageHdpi,n.style.width=i.width+"px",n.style.height=i.height+"px",n.onload=function(){null!==i.parentElement&&t.replaceChild(n,i)},e.onFlush.then(function(){n.src=""})}},400)};i.complete===!0&&o()});return this.onFlush.then(function(){t.classList.remove("epub-image-page-loaded"),i.src=""}),n},t.prototype.parseHtmlImgsload=function(t){return new Promise(function(e,i){var n=t.onload=t.onerror=t.onabort=function(){e(t)},s=!t.src&&!t.srcset;(t.complete===!0||s)&&n()})},t.prototype.parseHtml=function(t,e){var i,s=[];this.readerPageSrcType===n.READER_TYPES.EPUB_HTML&&(e=this.updateAttributes(e)),this.readerPageSrcType===n.READER_TYPES.PDF_SVG&&(e=this.pathToSvg(this.urlPage,e)),u.htmlSecureRemoveChildren(t);var o=document.createElement("div");if(this.innerHTML(o,e),this.readerPageSrcType===n.READER_TYPES.EPUB_HTML)for(var r=o.querySelectorAll("iframe"),a=function(t,e){l.pageContainsCPUElement=!0;var i=r[t].getAttribute("src");if(null===i)return"continue";i=i.replace("%num%",l.currentPageNumber.toString()),r[t].removeAttribute("src");var n=NIApi.common.resolveValues(i.toString()).then(function(e){r[t].setAttribute("data-src",e)});s.push(n)},l=this,h=0,p=r.length;h<p;h++)a(h,p);var c=o.childNodes[0],d=c.querySelectorAll("img");t.appendChild(c),(i=t.querySelector("div"))&&(this.readerPageSrcType===n.READER_TYPES.PDF_SVG?i.setAttribute("class","webpub-viewer__epub-container-spread-page-sub epub_content_tag_type-"+n.READER_TYPES[this.readerPageSrcType].toLowerCase()):(i.id="",i.classList.add("webpub-viewer__epub-container-spread-page-sub"),i.classList.add("epub_content_tag_type-"+n.READER_TYPES[this.readerPageSrcType].toLowerCase()))),this.readerPageSrcType===n.READER_TYPES.EPUB_HTML&&(this.parseEpubHyperlinks(t),this.parseEpubVideos(t),this.parseEpubScrolls(t),this.parseEditedTextFields(t));for(var f=[],h=0,p=d.length;h<p;h++)f.push(this.parseHtmlImgsload(d[h]));var m=Promise.all(f);m.then(function(){t.classList.add("epub-image-page-loaded")}),this.onFlush.then(function(){t.classList.remove("epub-image-page-loaded")});var g=new Promise(function(e,i){m.then(function(){Promise.all(s).then(function(){e(t)})})});return g},t.prototype.updateAttributes=function(t){var e=["src","href","poster"];return e.forEach(function(e){var i=new RegExp(e+'="([^"]+)"',"g");if(i.test(t)){i.lastIndex=0;for(var n=void 0;null!==(n=i.exec(t));){var s=n[1],o=w.Utils.resolveVariable(s);t=t.replace(e+'="'+s+'"',e+'="'+o+'"')}}}),t},t.prototype.parseEpubHyperlinks=function(t){for(var e="a[href]",i=[].slice.call(t.querySelectorAll(e)),n=0;n<i.length;n++){var s=i[n];s.addEventListener("click",function(t){var i=t.target.closest(e),n=i.getAttribute("href"),s=["","javascript:void(0)"];s.includes(n)||w.Main.trackerManager.trackEvent({name:"externalLink",variables:{1:n}})})}},t.prototype.parseEpubVideos=function(t){for(var e=[].slice.call(t.querySelectorAll("video")),i=0;i<e.length;i++){var n=e[i];w.Utils.addVideoStats(n),w.Param.userAgent.browser.name!==w.Param.userAgent.BROWSER.SAFARI||n.hasAttribute("autoplay")||(n.setAttribute("autoplay",""),n.dataset.ignoreAutoplay="true",n.pause())}},t.prototype.parseEpubScrolls=function(t){for(var e=["touchstart","touchmove","mousewheel","wheel","DOMMouseScroll"],i=function(t){return t.stopPropagation()},n=function(t){return t.preventDefault()},s='[class*="plugin-animationScrollableBox"], .edited[class*="editable-text"]:not(.is-empty)',o=[].slice.call(t.querySelectorAll(s)),r=function(t){var s=o[t];e.forEach(function(t){s.addEventListener(t,i)}),w.Param.userAgent.browser.name===w.Param.userAgent.BROWSER.FIREFOX&&s.addEventListener("mousedown",n)},a=0;a<o.length;a++)r(a)},t.prototype.parseEditedTextFields=function(t){for(var e='.edited[class*="editable-text"] .rte-subscript, .edited[class*="editable-text"] .rte-superscript',i=[].slice.call(t.querySelectorAll(e)),n=0;n<i.length;n++){var s=i[n],o=u.getNumberFromString(s.style.fontSize);s.style.fontSize=.75*o+"px"}},t.prototype.parsePdf=function(t){u.htmlSecureRemoveChildren(t);var e=document.createElement("embed");return e.src=this.urlPage+"#zoom=200",e.width=1536,e.height=2172,e.style.width=e.width+"px",e.style.height=e.height+"px",e.style.pointerEvents="none",t.appendChild(e),Promise.resolve(t)},t.prototype.setRootElemAttributes=function(t,e){t.classList.add("spread-page-"+e),t.classList.add("webpub-viewer__epub-container-spread-page")},t.prototype.load_loaded=function(t){var e,i=this;return this.inCache=!0,this.isOnLoad=!1,e=this.readerPageSrcType===n.READER_TYPES.PDF_IMG?this.parseImage(this.elementContainer):this.readerPageSrcType===n.READER_TYPES.PDF_PDF?this.parsePdf(this.elementContainer):this.parseHtml(this.elementContainer,t.responseText),e.then(function(){i.epubPageEnrichmentStat(),i.callCallBackOnload(!0),i.linksManager.load().then(function(){i.tryDispatchIsInDom()})}),e},t.prototype.load=function(t){var e=this;if(t&&!t.data.pageChanged)return Promise.resolve();if(this.config.isVerticalOnePage&&!this.isVisibleSpread())return this.element.innerHTML="",this.epubPageEnrichment.stop(),this.inCache=!1,Promise.resolve();if(this.inCache===!0)return this.epubPageEnrichmentStat(),Promise.resolve();if(this.isOnLoad===!0)return Promise.resolve();this.isOnLoad=!0;var i=new o["default"](s.Protocol.GET,this.urlPage).init().then(function(t){e.load_loaded(t).then(function(){return Promise.resolve()})})["catch"](this.loadXhrError);return i},t.prototype.callCallBackOnload=function(t){for(var e=0,i=this.loadList.length;e<i;e++)this.loadList[e].bind(this)(t);this.loadList=[]},t.prototype._onload=function(t){return this.inCache===!0?void t.bind(this)(!0):void this.loadList.push(t)},t.prototype.tryDispatchIsInDom=function(){if(this.inCache!==!1&&this.synchronizedWidthSpread!==!1&&this.linksManager.isLoaded()!==!1){this.epubEvent.fire({type:l.EPUB_EVENTS.PAGE_IN_DOM,data:{epubPage:this}});var e=t.coef;this.setCoefOfPageSizeToLink(),t.pageSizeCoefLinkResolve&&t.coef&&!e&&t.pageSizeCoefLinkResolve()}},t.prototype.syncElemWithSpread=function(t){this.onFlush=u.getSplitedPromise();var e=this.load();
return this.zoomableParentElement=t,this.synchronizedWidthSpread=!0,this.tryDispatchIsInDom(),this.config.isVerticalOnePage&&this.epubEvent.addListener(l.EPUB_EVENTS.PAGE_CHANGE,this.load.bind(this)),{element:this.element,loaded:e}},t.prototype.setCoefOfPageSizeToLink=function(){t.coef||(t.coef=this.element.offsetHeight/this.config.linksSizePageHeight)},t.prototype.onVisible=function(){this.isVisible!==!0&&(this.isVisible=!0,this.readerPageSrcType===n.READER_TYPES.EPUB_HTML&&null!==this.epubPageEnrichment&&this.epubPageEnrichment.start(),this.linksManager.start())},t.prototype.onNonVisible=function(){this.isVisible!==!1&&(this.isVisible=!1,this.synchronizedWidthSpread=!1,this.readerPageSrcType===n.READER_TYPES.EPUB_HTML&&null!==this.epubPageEnrichment&&this.epubPageEnrichment.stop(),this.linksManager.stop())},t.prototype.flush=function(){this.onFlush&&this.onFlush.resolve(),this.inCache!==!1&&(this.synchronizedWidthSpread=!1,this.isVisible=!1,this.loadList=[],this.inCache=!1,u.htmlSecureRemoveChildren(this.elementContainer),this.readerPageSrcType===n.READER_TYPES.EPUB_HTML&&null!==this.epubPageEnrichment&&this.epubPageEnrichment.flush(),this.linksManager.flush())},t}();i["default"]=p},{"./EpubEvent":8,"./EpubPage/LinksManager":19,"./EpubPageEnrichment":47,"./utils/XHRPromise":75,"./utils/enums":77,"./utils/functions":78,"es6-promise":1}],18:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../EpubEvent"),s=t("../EpubPage"),o=t("./shapes/ShapesManager"),r=t("./useracts/UserActs"),a=function(){function t(t,e,i,s,o){this.linksManager=t,this.config=e,this.data=i,this.container=s,this.pageElement=o,this.events=new n.EpubEvent,this.started=!1,this.status=!1,this.epubEvent=w.epubEvent,this.ePubPage=t.epubPage,this.start()}return t.prototype.createHtmlElement=function(){this.linksElem=this.linksElem||document.createElement("div"),this.linksElem.innerHTML="",this.linksElem.className="epub-links_container-link webpub-viewer__link-clickable"},t.prototype.setShapes=function(){this.shapesManager=new o.ShapesManager(this,this.config,this.data,this.pageElement,this.linksElem,s["default"].coef)},t.prototype.setUserActs=function(){this.userActs=new r.UserActs(this,this.config,this.data.useract,this.linksElem)},t.prototype.start=function(){var t=this;this.status=!0,s["default"].pageSizeCoefLink.then(function(){t.started===!1&&(t.createHtmlElement(),t.setShapes(),t.setUserActs()),t.started=!0,t.container.appendChild(t.linksElem)})},t.prototype.stop=function(){this.status=!1,this.started!==!1&&(this.started=!1,this.shapesManager.stop(),this.userActs.stop())},t.prototype.flush=function(){this.started=!1,this.shapesManager.flush(),this.userActs.flush()},t.prototype.updateZoomIfIframe=function(t){this.shapesManager&&this.shapesManager.updateZoomIfIframe(t)},t}();i["default"]=a},{"../EpubEvent":8,"../EpubPage":17,"./shapes/ShapesManager":29,"./useracts/UserActs":45}],19:[function(t,e,i){"use strict";var n=this&&this.__assign||Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++){e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t};Object.defineProperty(i,"__esModule",{value:!0});var s=t("./Link"),o=t("./../utils/enums"),r=t("../EpubEvent"),a=function(){function t(t,e,i,n){var s=this;this.epubPage=t,this.config=e,this.pageNumber=i,this.container=n,this._src="",this.promise=!1,this.inCache=!1,this.isStarted=!1,this.links=[],this.blinkLink=this.blinkLinkPre.bind(this),this.epubEvent=w.epubEvent,this.linkBoxAspect=this.config.linkBoxAspect,this.epubEvent.addListener(r.EPUB_EVENTS.ADMIN_LINK_CREATE,function(t){t.data.pageNumber===i&&s.loadLink(t.data.linkData)})}return Object.defineProperty(t.prototype,"enableAspLinks",{get:function(){return this.config.enableAspLinks},enumerable:!0,configurable:!0}),t.prototype.blinkLinkPre=function(t){var e=this;this.linksElem.classList.add("epub-links-unreveal"),clearTimeout(this.toggleTimer),this.toggleTimer=setTimeout(function(){e.linksElem.classList.remove("epub-links-unreveal")},0)},t.prototype.initLinksBehaviors=function(){this.linkBoxAspect===o.LinksBehaviors.blink&&this.epubEvent.addListener(r.EPUB_EVENTS.PAGE_CLICK,this.blinkLink)},t.prototype.createHtmlElement=function(){this.linksElem=this.linksElem||document.createElement("div"),this.linksElem.innerHTML="",this.linksElem.className="epub-links_container epub-links_container-behaviour-"+o.LinksBehaviors[this.linkBoxAspect]},t.prototype.removeHtmlElement=function(){void 0!==this.linksElem&&(this.linksElem.innerHTML="")},t.prototype.isEnable=function(){return this.enableAspLinks},t.prototype.loadLink=function(t){for(var e=0,i=t.content.length;e<i;e++){var o=n({},t);o.content=[t.content[e]],this.links.push(new s["default"](this,this.config,o,this.linksElem,this.container))}},t.prototype.loadLinks=function(){this.createHtmlElement();for(var t=0,e=this.data.length;t<e;t++)this.loadLink(this.data[t]);this.initLinksBehaviors()},t.prototype.stopLinks=function(){for(var t=0,e=this.links.length;t<e;t++)this.links[t].stop()},t.prototype.flushLinks=function(){this.epubEvent.removeListener(r.EPUB_EVENTS.PAGE_CLICK,this.blinkLink),this.removeHtmlElement();for(var t=0,e=this.links.length;t<e;t++)this.links[t].flush();this.links=[]},t.prototype.startOnReady=function(){this.isStarted!==!1&&this.inCache!==!1&&(this.loadLinks(),this.container.appendChild(this.linksElem))},t.prototype.load=function(t){var e=this;return void 0===t&&(t=this.pageNumber),this.isEnable()===!1?Promise.resolve():(this.promise=w.Main.pageManager.getLinksPromise(t),this.promise===!0?(this.data=w.Main.pageManager.getRealLinks(t),this.inCache=!0,this.startOnReady(),Promise.resolve()):(this.promise=this.promise,this.promise.then(function(t){e.data=t,e.inCache=!0,e.startOnReady()}),this.promise))},t.prototype.isLoaded=function(){return this.inCache},t.prototype.flush=function(){this.isEnable()!==!1&&(this.isStarted=!1,this.inCache=!1,this.flushLinks())},t.prototype.start=function(){this.isEnable()!==!1&&(this.isStarted=!0,this.startOnReady())},t.prototype.stop=function(){this.isEnable()!==!1&&(this.isStarted=!1,this.stopLinks())},t.prototype.updateIframesZoom=function(t){this.links.forEach(function(e){return e.updateZoomIfIframe(t)})},t}();i["default"]=a},{"../EpubEvent":8,"./../utils/enums":77,"./Link":18}],20:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./Video"),o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.contentTag="audio",e}return n(e,t),e.prototype.setElement=function(){this.element=window.document.createElement("audio"),this.element.className=this.className+"-audio",this.element.setAttribute("controls",""),this.element.src=this.url,this.setPreventGestures(),this.linksElem.appendChild(this.element)},e._name="audio",e}(s.Video);i.Audio=o},{"./Video":30}],21:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./Shape"),o=function(t){function e(e,i,n,s,o){var r=t.call(this,e,i,n,s,o)||this;return r.shapesManager=e,r.config=i,r.data=n,r.linksElem=s,r.coef=o,r.setRadius(),r}return n(e,t),e.prototype.setRadius=function(){var e=[],i=this.content.circle;"undefined"!=typeof i&&(e[0]=i.radius,t.prototype.setRadius.call(this,e,"%"))},e._name="circle",e}(s.Shape);i.Circle=o},{"./Shape":28}],22:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./Shape"),o=t("./utils/IframeInteractions"),r=("ontouchstart"in window,function(t){function e(e,i,n,s,o,r){var a=t.call(this,e,i,n,s,o)||this;return a.shapesManager=e,a.config=i,a.data=n,a.linksElem=s,a.coef=o,a.pageElement=r,a.url="",a.foreground=!1,a.url=a.content.file.url,a.foreground=a.content.file.foreground||!1,a.setInfoToPage(),a.setElement(),a}return n(e,t),e.prototype.setInfoToPage=function(){this.ePubPage.pageContainsCPUElement=!0},e.prototype.setElement=function(){this.element=window.document.createElement("iframe"),this.element.style.opacity="0",this.element.style.pointerEvents="none",this.element.className=this.className+"-iframe",this.element.setAttribute("data-foreground",this.foreground?"true":"false"),this.element.setAttribute("contenteditable","true"),this.iframeInteractions=new o.IframeInteractions(this,this.config,this.element,this.linksElem,this.foreground)},e.prototype.checkLoaded=function(){this.element.addEventListener("load",this.loaded.bind(this))},e.prototype.loaded=function(){this.element.style.opacity="1";try{this.iFrameContentWindow=this.element.contentWindow,this.setAnimationInitIfNot(),this.foreground===!0&&"object"==typeof this.iFrameContentWindow.AdobeAn?this.iframeInteractions.init(this.iFrameContentWindow):this.foreground===!0&&(this.element.style.pointerEvents="all",this.iframeInteractions.setPreventZoomInteraction(this.iFrameContentWindow))}catch(t){}},e.prototype.setAnimationInitIfNot=function(){var t=this;try{var e=this.iFrameContentWindow.document.body,i=e.getAttribute("onload");e.removeAttribute("onload"),i&&e.addEventListener("load",function(){t.iFrameContentWindow.exportRoot||new t.iFrameContentWindow.Function(i)()})}catch(n){}},e.prototype.start=function(){var e=this;this.setInfoToPage(),this.isVisible!==!1&&(this.timerBeforAppend=setTimeout(function(){e.element.src=e.url,e.linksElem.appendChild(e.element)},850),this.checkLoaded(),t.prototype.start.call(this))},e.prototype.stop=function(){var e=this;clearTimeout(this.timerBeforAppend),this.element.parentElement&&setTimeout(function(){e.linksElem.removeChild(e.element)},300),t.prototype.stop.call(this)},e.prototype.flush=function(){this.iframeInteractions.flush(),t.prototype.flush.call(this)},e.prototype.updateZoom=function(t){var e=[this.coef*t,0,0,this.coef*t,this.x*this.coef*t,this.y*this.coef*t];this.linksElem.style.transform="matrix("+e.join(",")+")",this.linksElem.style.zoom=""+1/t},e._name="iframe",e}(s.Shape));i.Iframe=r},{"./Shape":28,"./utils/IframeInteractions":31}],23:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./Shape"),o=function(t){function e(e,i,n,s,o){var r=t.call(this,e,i,n,s,o)||this;return r.shapesManager=e,r.config=i,r.data=n,r.linksElem=s,r.coef=o,r.url="",r.foreground=!1,r.url=r.content.file.url,r.setElement(),r}return n(e,t),e.prototype.setElement=function(){this.linksElem.style.backgroundImage="url('"+this.url+"')"},e._name="image",e}(s.Shape);i.Image=o},{"./Shape":28}],24:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(t){this.mediaElement=t,this.enablePlayButton=!0,this.enableSeekBar=!0,this.enableRemainingTime=!0,this.enableCurrentTime=!0,this.enableVolumeButton=!0,this.enableFullScreenButton=!0,this.displayState=!0,this.toggleControls=this.toggleControls.bind(this),this.showControls=this.showControls.bind(this),this.addDelayUnDisplay=this.addDelayUnDisplay.bind(this),this.playState=this.playState.bind(this),this.onPlay=this.onPlay.bind(this),this.seekState=this.seekState.bind(this),this.timeupdate=this.timeupdate.bind(this),this.volumeState=this.volumeState.bind(this),this.onVolume=this.onVolume.bind(this),this.fullScreenState=this.fullScreenState.bind(this),this.eventsList=[],this.init()}return t.prototype.init=function(){this.initRootElement(),this.enablePlayButton===!0&&this.initPlayButton(),this.enableCurrentTime===!0&&this.initCurrentTime(),this.enableSeekBar===!0&&this.initSeekBar(),this.enableRemainingTime===!0&&this.initRemainingTime(),this.enableVolumeButton===!0&&this.initVolumeButton(),this.enableFullScreenButton===!0&&this.initFullScreenButton()},t.prototype.updateView=function(){this.mediaElement.parentElement&&this.mediaElement.parentElement.appendChild(this.rootElement)},t.prototype.stop=function(){this.flush()},t.prototype.flush=function(){this.removeEvents()},t.prototype.initRootElement=function(){this.rootElement=document.createElement("div"),this.initSuperPlayButton(),this.rootElement.classList.add("media_player_custom"),this.itemsElement=document.createElement("div"),this.itemsElement.classList.add("media_player_custom-items"),this.rootElement.appendChild(this.itemsElement),this.addDelayUnDisplay(),this.addEvent(this.mediaElement,"click",this.toggleControls),this.addEvent(this.mediaElement,"touchend",this.toggleControls),this.addEvent(this.mediaElement,"mousemove",this.showControls)},t.prototype.initSuperPlayButton=function(){this.superPlayButton=document.createElement("div"),this.rootElement.appendChild(this.superPlayButton),this.superPlayButton.classList.add("super-play_button-custom"),this.addEvent(this.superPlayButton,"click",this.playState),this.setIcon(this.superPlayButton,"play-bold-v4")},t.prototype.toggleControls=function(t){return t.preventDefault(),this.displayState===!1?void this.showControls(t):void this.hideControls()},t.prototype.showControls=function(t){this.addDelayUnDisplay(),this.rootElement.classList.remove("hide"),this.displayState=!0},t.prototype.hideControls=function(){this.rootElement.classList.add("hide"),this.displayState=!1},t.prototype.addDelayUnDisplay=function(){var t=this;clearTimeout(this.delayDisplayTimer),this.delayDisplayTimer=setTimeout(function(){t.hideControls()},4e3)},t.prototype.initPlayButton=function(){this.playButton=this.createItem(),this.playButton.classList.add("play_button-custom"),this.addEvent(this.playButton,"click",this.playState),this.addEvent(this.mediaElement,"play",this.onPlay),this.addEvent(this.mediaElement,"pause",this.onPlay),this.setIcon(this.playButton,"play-bold-v4"),this.setIcon(this.playButton,"pause")},t.prototype.playState=function(){return this.addDelayUnDisplay(),this.mediaElement.paused?void this.mediaElement.play():void this.mediaElement.pause()},t.prototype.onPlay=function(){return this.mediaElement.paused?(this.playButton.classList.remove("play-enbaled"),void this.superPlayButton.classList.remove("play-enbaled")):(this.playButton.classList.add("play-enbaled"),void this.superPlayButton.classList.add("play-enbaled"))},t.prototype.initCurrentTime=function(){this.currentTimeElement=this.createItem(),this.currentTimeElement.classList.add("current_time-custom"),this.currentTimeElement.classList.add("no-hover")},t.prototype.initSeekBar=function(){this.seekButton=this.createItem(),this.seekButton.classList.add("seek_button-custom"),this.seekButton.classList.add("no-hover"),this.seekButtonRange=document.createElement("input"),this.seekButton.appendChild(this.seekButtonRange),this.seekButtonRange.setAttribute("type","range"),this.seekButtonRange.setAttribute("step","0.1"),this.seekButtonRange.setAttribute("min","0"),this.seekButtonRange.setAttribute("max","100"),this.seekButtonRange.setAttribute("value","0"),this.addEvent(this.seekButtonRange,"touchstart",this.cancelBubble),this.addEvent(this.seekButtonRange,"mousemove",this.cancelBubble),this.seekButtonRange.onchange=this.seekState;try{this.seekButtonRange.oninput=this.seekState}catch(t){console.warn(t)}this.addEvent(this.mediaElement,"timeupdate",this.timeupdate)},t.prototype.initRemainingTime=function(){this.remainingTimeElement=this.createItem(),this.remainingTimeElement.classList.add("remaining_time-custom"),this.remainingTimeElement.classList.add("no-hover")},t.prototype.timeupdate=function(){var t=this.mediaElement.currentTime,e=this.mediaElement.duration-this.mediaElement.currentTime;this.seekButtonRange.value=(t/this.mediaElement.duration*100).toString(),this.onVolume(),this.currentTimeElement&&(this.currentTimeElement.innerHTML=this.getReadableTime(t)),this.remainingTimeElement&&(this.remainingTimeElement.innerHTML="-"+this.getReadableTime(e))},t.prototype.seekState=function(){this.addDelayUnDisplay();var t=parseFloat(this.seekButtonRange.value),e=t/100*this.mediaElement.duration;this.mediaElement.currentTime=e},t.prototype.initVolumeButton=function(){this.volumeButton=this.createItem(),this.volumeButton.classList.add("volume_button-custom"),this.addEvent(this.volumeButton,"click",this.volumeState),this.addEvent(this.mediaElement,"volumechange",this.onVolume),this.onVolume(),this.setIcon(this.volumeButton,"speaker-on"),this.setIcon(this.volumeButton,"speaker-off")},t.prototype.volumeState=function(){return this.addDelayUnDisplay(),0===this.mediaElement.volume||this.mediaElement.muted===!0?(this.mediaElement.muted=!1,void(this.mediaElement.volume=1)):(this.mediaElement.muted=!0,void(this.mediaElement.volume=0))},t.prototype.onVolume=function(){if(this.volumeButton){var t=this.volumeButton.classList.contains("volume-enbaled");return 0===this.mediaElement.volume||this.mediaElement.muted===!0?void(t===!0&&this.volumeButton.classList.remove("volume-enbaled")):void(t===!1&&this.volumeButton.classList.add("volume-enbaled"))}},t.prototype.initFullScreenButton=function(){this.fullscreenButton=this.createItem(),this.fullscreenButton.classList.add("fullscreen_button-custom"),this.addEvent(this.fullscreenButton,"click",this.fullScreenState),this.setIcon(this.fullscreenButton,"fullscreen-v4")},t.prototype.fullScreenState=function(){if(this.mediaElement.requestFullscreen)this.mediaElement.requestFullscreen();else if(this.mediaElement.mozRequestFullScreen)this.mediaElement.mozRequestFullScreen();else if(this.mediaElement.webkitRequestFullscreen)this.mediaElement.webkitRequestFullscreen();else if(this.mediaElement.webkitEnterFullscreen)try{this.mediaElement.webkitEnterFullscreen()}catch(t){}},t.prototype.createItem=function(){var t=document.createElement("div");return t.classList.add("media-item"),this.itemsElement.appendChild(t),t},t.prototype.setIcon=function(t,e){var i=document.createElement("div");w.Utils.svgIcon(i,{icon:e,color:null}),t.innerHTML+=i.innerHTML},t.prototype.getReadableTime=function(t){var e=[],i=parseInt(t.toString(),10),n=Math.floor(i/86400);i-=3600*n*24;var s=Math.floor(i/3600);i-=3600*s;var o=Math.floor(i/60);return i-=60*o,s&&e.push(s),e.push(o),e.push(this.padNumber(i,2)),e.join(":")},t.prototype.padNumber=function(t,e){var i="00"+t;return i.substr(i.length-e)},t.prototype.addEvent=function(t,e,i){this.eventsList.push({element:t,type:e,callBack:i}),t.addEventListener(e,i)},t.prototype.removeEvent=function(t,e,i){for(var n=0;n<this.eventsList.length;n++){var s=this.eventsList[n];if(t===s.element&&e===s.type&&i===s.callBack)return delete this.eventsList[n],this.eventsList.splice(n,1),t.removeEventListener(e,i),void this.removeEvent(t,e,i)}},t.prototype.removeEvents=function(){for(var t=0;t=this.eventsList.length;){var e=this.eventsList[t-1];this.removeEvent(e.element,e.type,e.callBack)}},t.prototype.cancelBubble=function(t){t.cancelBubble=!0},t}();i.MediaPlayer=n},{}],25:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./Shape"),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e._name="rect",e}(s.Shape);i.Rect=o},{"./Shape":28}],26:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./Shape"),o=function(t){function e(e,i,n,s,o){var r=t.call(this,e,i,n,s,o)||this;return r.shapesManager=e,r.config=i,r.data=n,r.linksElem=s,r.coef=o,r.setRadius(),r}return n(e,t),e.prototype.setRadius=function(){var e=[],i=this.content.roundrect;"undefined"!=typeof i&&(e[0]=i.radius,e[1]=i.radius,e[2]=i.radius,e[3]=i.radius,t.prototype.setRadius.call(this,e))},e._name="roundrect",e}(s.Shape);i.RoundRect=o},{"./Shape":28}],27:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./Shape"),o=function(t){function e(e,i,n,s,o){var r=t.call(this,e,i,n,s,o)||this;return r.shapesManager=e,r.config=i,r.data=n,r.linksElem=s,r.coef=o,r.setRadius(),r}return n(e,t),e.prototype.setRadius=function(){var e=[],i=this.content.roundrectcomplex;"undefined"!=typeof i&&(e[0]=i.tl_radius,e[1]=i.tr_radius,e[2]=i.br_radius,e[3]=i.bl_radius,t.prototype.setRadius.call(this,e))},e._name="roundrectcomplex",e}(s.Shape);i.RoundRectComplex=o},{"./Shape":28}],28:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./../../utils/enums"),s=t("../../utils/functions"),o=function(){function t(e,i,s,o,r,a){this.shapesManager=e,this.config=i,this.data=s,this.linksElem=o,this.coef=r,this.pageElement=a,this.className="",this.width=0,this.height=0,this.x=0,this.y=0,this.radius=[],this.status=n.ShapeActivityStatus.INIT,this.orientation="auto",this.isVisible=!1,this.Id=0,this.Id=t.globalID++,this.ePubPage=e.ePubPage,this.content=this.getDataContent(),this.className="epub-link-type_"+this.data.type,this.width=this.content.width,this.height=this.content.height,this.x=this.content.x,this.y=this.content.y,this.linkBlinkDuration=this.config.linkBlinkDuration,this.linkBoxAspect=this.config.linkBoxAspect,this.orientation=(this.data.orientation||this.orientation).toLowerCase(),this.setSizes(),this.initLinksBehaviors()}return t.prototype.setAnimationDuration=function(t,e){void 0===e&&(e="ms"),this.linksElem.style.webkitAnimationDuration=t+e,this.linksElem.style.animationDuration=t+e},t.prototype.initLinksBehaviors=function(){this.linkBoxAspect===n.LinksBehaviors["static"]&&this.linksElem.classList.add("webpub-viewer__link--focused")},t.prototype.setRadius=function(t,e){void 0===e&&(e="px"),0!==t.length&&(this.linksElem.style.webkitBorderRadius=t.join(e+" ")+e,this.linksElem.style.borderRadius=t.join(e+" ")+e)},t.prototype.setSizes=function(){var t=[this.coef,0,0,this.coef,this.x*this.coef,this.y*this.coef];this.linksElem.style.width=this.width+"px",this.linksElem.style.height=this.height+"px",s.styleTransform(this.linksElem,"matrix("+t.join(",")+")"),this.linksElem.classList.add(this.className)},t.prototype.getDataContent=function(){return this.data.content[0]},t.prototype.display=function(t){if(t===!0&&this.isVisible!==!0)return this.isVisible=!0,this.linksElem.classList.add("epub-link-visible"),void this.start();if(t===!0);else if(t===!1&&this.isVisible!==!1)return this.isVisible=!1,this.linksElem.classList.remove("epub-link-visible"),void this.stop()},t.prototype.start=function(){this.status=n.ShapeActivityStatus.START},t.prototype.stop=function(){this.status=n.ShapeActivityStatus.STOP},t.prototype.flush=function(){this.status=n.ShapeActivityStatus.FLUSH},t.prototype.getType=function(){return this.data.type},t._name="shape",t.globalID=0,t}();i.Shape=o},{"../../utils/functions":78,"./../../utils/enums":77}],29:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./../../utils/enums"),s=t("../../utils/functions"),o=t("./Rect"),r=t("./RoundRect"),a=t("./RoundRectComplex"),u=t("./Circle"),l=t("./Iframe"),h=t("./Video"),p=t("./Audio"),c=t("./Image"),d=t("../../EpubEvent"),f={Rect:o.Rect,RoundRect:r.RoundRect,RoundRectComplex:a.RoundRectComplex,Circle:u.Circle,Iframe:l.Iframe,Video:h.Video,Audio:p.Audio,Image:c.Image},m=function(){function t(t,e,i,n,s,o){this.link=t,this.config=e,this.data=i,this.pageElement=n,this.linksElem=s,this.coef=o,this.shapes=[],this.epubEvent=w.epubEvent,this.ePubPage=t.ePubPage,this.setShapes(),this.startShapes(),this.setEventOrientations()}return t.prototype.setShapes=function(){for(var t in f)f[t]._name===this.data.type&&this.shapes.push(new f[t](this,this.config,this.data,this.linksElem,this.coef,this.pageElement));0===this.shapes.length&&console.warn("Shape type not supported :"+this.data.type,this.data)},t.prototype.startShapes=function(){for(var t=0,e=this.shapes.length;t<e;t++)this.shapes[t].status!==n.ShapeActivityStatus.START&&this.shapes[t].start()},t.prototype.stopShapes=function(){for(var t=0,e=this.shapes.length;t<e;t++)this.shapes[t].status===n.ShapeActivityStatus.START&&this.shapes[t].stop()},t.prototype.setEventOrientations=function(){var t=this;this.epubEvent.addListener(d.EPUB_EVENTS.SCREEN_ORIENTATION,function(e){t.setOrientations(e.data.landscape)}),this.setOrientations(s.isWindowLandscape())},t.prototype.setOrientations=function(t){for(var e=0,i=this.shapes.length;e<i;e++)this.setOrientation(t,this.shapes[e])},t.prototype.setOrientation=function(t,e){return"auto"===e.orientation?void e.display(!0):"landscape"===e.orientation&&t===!0||"portrait"===e.orientation&&t===!1?void e.display(!0):void e.display(!1)},t.prototype.flushShapes=function(){for(var t=0,e=this.shapes.length;t<e;t++)this.shapes[t].flush()},t.prototype.start=function(){this.startShapes()},t.prototype.stop=function(){this.stopShapes()},t.prototype.flush=function(){this.flushShapes()},t.prototype.updateZoomIfIframe=function(t){this.shapes.filter(function(t){return l.Iframe._name===t.getType()}).forEach(function(e){return e.updateZoom(t)})},t._name="shapes",t}();i.ShapesManager=m},{"../../EpubEvent":8,"../../utils/functions":78,"./../../utils/enums":77,"./Audio":20,"./Circle":21,"./Iframe":22,"./Image":23,"./Rect":25,"./RoundRect":26,"./RoundRectComplex":27,"./Video":30}],30:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./../../utils/enums"),o=t("./Shape"),r=t("./../../EpubGesturesEvent"),a=t("./MediaPlayer"),u=function(t){function e(e,i,n,s,o,r){var a=t.call(this,e,i,n,s,o)||this;return a.shapesManager=e,a.config=i,a.data=n,a.linksElem=s,a.coef=o,a.pageElement=r,a.url="",a.label="",a.contentTag="video",a._isPlaying=!1,a.enableDefaultControls=!1,a.userAgent=w.Param.userAgent,a.url=a.content[a.contentTag].url,a.label=a.content[a.contentTag].label,a.setInfoToPage(),a.setElement(),a}return n(e,t),e.prototype.setInfoToPage=function(){this.ePubPage.pageContainsCPUElement=!0},e.prototype.setElement=function(){var t=window.document.createElement("source");this.element=window.document.createElement("video"),this.element.className=this.className+"-video",this.enableDefaultControls?this.element.setAttribute("controls",""):this.mediaPlayer=new a.MediaPlayer(this.element),this.element.setAttribute("controlsList","nodownload"),this.element.setAttribute("data-label",this.label),this.userAgent.os.name===w.Param.userAgent.OS.IOS&&this.content.video.autoplay&&this.element.setAttribute("muted",""),t.src=this.url,this.element.appendChild(t),this.setPreventGestures(),this.linksElem.appendChild(this.element),this.mediaPlayer&&this.mediaPlayer.updateView(),w.Utils.addVideoStats(this.element),w.Param.userAgent.browser.name!==w.Param.userAgent.BROWSER.SAFARI||this.element.hasAttribute("autoplay")||(this.element.setAttribute("autoplay",""),this.element.dataset.ignoreAutoplay="true",this.element.pause())},e.prototype.setPreventGestures=function(){this.element.onvolumechange=this.makeDefaultPreventGesture.bind(this),this.element.onseeking=this.element.onvolumechange,this.element.onplay=this.onplay.bind(this),this.element.onpause=this.onpause.bind(this)},e.prototype.makeDefaultPreventGesture=function(){r["default"].prototype.preventAllGesture()},e.prototype.setAnimationDuration=function(t,e){void 0===e&&(e="ms")},e.prototype.initLinksBehaviors=function(){},e.prototype.setRadius=function(t,e){void 0===e&&(e="px")},e.prototype.setSizes=function(){this.linksElem.style.width=Math.round(this.width*this.coef)+"px",this.linksElem.style.height=Math.round(this.height*this.coef)+"px",this.linksElem.style.left=Math.round(this.x*this.coef)+"px",this.linksElem.style.top=Math.round(this.y*this.coef)+"px",this.linksElem.classList.add(this.className)},e.prototype.onplay=function(){this.makeDefaultPreventGesture(),this._isPlaying=!0,this.status!==s.ShapeActivityStatus.STOP&&this.status!==s.ShapeActivityStatus.FLUSH||this.element.pause()},e.prototype.onpause=function(){this.makeDefaultPreventGesture(),this._isPlaying=!1},e.prototype.start=function(){var e=this;this.isVisible!==!1&&(t.prototype.start.call(this),this.setInfoToPage(),this.content.video.autoplay&&this.element.paused&&this._isPlaying===!1&&(this.playPromise=this.element.play(),"object"==typeof this.playPromise&&this.playPromise.then&&this.playPromise.then(function(){})["catch"](function(){var t=e.element.play();t["catch"](function(){})})))},e.prototype.stop=function(){this.mediaPlayer&&this.mediaPlayer.stop(),this.element.paused===!1&&this._isPlaying===!0&&this.element.pause(),t.prototype.stop.call(this)},e.prototype.flush=function(){this.mediaPlayer&&this.mediaPlayer.flush(),t.prototype.flush.call(this)},e._name="video",e}(o.Shape);i.Video=u},{"./../../EpubGesturesEvent":10,"./../../utils/enums":77,"./MediaPlayer":24,"./Shape":28}],31:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../../EpubEvent"),s=t("../../../utils/functions"),o="ontouchstart"in window,r=400,a=function(){function t(t,e,i,n,o){this.parent=t,this.config=e,this.element=i,this.linksElem=n,this.foreground=o,this.supportCreateMouseEvent=0,this.eventsListe=["mousemove","mousedown","mouseup","mouseover","mouseout"],this.eventsListeTouch=["touchmove","touchstart","touchend"],this.epubEvent=w.epubEvent,this.removableListeners=[];var r=s.getSplitedPromise();this.waitAction=r,r.resolve()}return t.prototype.init=function(t){try{document.createEvent("MouseEvents"),this.preventZoomInteraction=!1,this.supportCreateMouseEvent=1}catch(e){if("MouseEvent"in window==!1)return this.supportCreateMouseEvent=2,this.element.style.pointerEvents="all",this.linksElem.style.pointerEvents="none",void(this.preventZoomInteraction=!0)}this.iFrameContentWindow=t,this.simulateInteractions()},Object.defineProperty(t.prototype,"zoomSingleClick",{get:function(){return this.config.zoomSingleClick},enumerable:!0,configurable:!0}),t.prototype.createMouseEvent=function(t,e){
var i,n=null,s=t.type;return"mouseover"!==s&&"mouseout"!==s||(n=e),1===this.supportCreateMouseEvent?(i=document.createEvent("MouseEvents"),i.initMouseEvent(s,!0,!0,this.iFrameContentWindow,0,t.offsetX,t.offsetY,t.offsetX,t.offsetY,!1,!1,!1,!1,0,n)):i=new MouseEvent(s,{bubbles:!0,cancelable:!0,view:this.iFrameContentWindow,screenX:t.offsetX,screenY:t.offsetY,clientX:t.offsetX,clientY:t.offsetY}),i},t.prototype.getCoordsTouches=function(t){var e=t.touches[0]||t;return this.getCoords(e)},t.prototype.getCoords=function(t){var e=t.currentTarget||t.target,i=e.getBoundingClientRect(),n=e.offsetWidth/i.width;return[(t.pageX-i.left)*n,(t.pageY-i.top)*n]},t.prototype.simulateEvt=function(t){var e=this;t.preventDefault();var i,a=this.canvasElement,u=t.type,l=0,h=0;switch(u){case"touchmove":u="mousemove";break;case"touchend":u="mouseup";break;case"touchstart":u="mousedown"}var p;if(o&&void 0!==t.touches?(p=this.getCoordsTouches(t),h=p[0],l=p[1]):(h=t.offsetX,l=t.offsetY,h||l||(p=this.getCoords(t),h=p[0],l=p[1])),i=this.createMouseEvent({type:u,offsetX:h,offsetY:l},a),this.canvasElement&&("mousemove"===u&&(this.canvasElement.style.cursor?document.body.style.cursor=this.canvasElement.style.cursor:document.body.style.cursor=""),"mouseout"===u&&(document.body.style.cursor="")),"mouseup"===u){var c=s.getSplitedPromise();this.waitAction=c.promise;var d=setTimeout(function(){c.resolve(),e.epubEvent.removeListener(n.EPUB_EVENTS.PAGE_CLICK,f)},r),f=function(){clearTimeout(d),e.epubEvent.removeListener(n.EPUB_EVENTS.PAGE_CLICK,f),a.dispatchEvent(i),i=e.createMouseEvent({type:"click",offsetX:h,offsetY:l},a),a.dispatchEvent(i),c.resolve()};return void this.epubEvent.addListener(n.EPUB_EVENTS.PAGE_CLICK,f)}a.dispatchEvent(i)},t.prototype.simulateInteractions=function(){var t=this;if(this.canvasElement=this.iFrameContentWindow.document.querySelector("canvas"),this.canvasElement){this.linksElem.style.pointerEvents="all";var e=this.eventsListe;o&&(e=this.eventsListeTouch),e.forEach(function(e){t.removableListeners.push({type:e,action:function(e){t.waitAction.then(function(){t.simulateEvt(e)})}})}),this.removableListeners.forEach(function(e){t.linksElem.addEventListener(e.type,e.action)})}},t.prototype.removeEvents=function(){var t=this;this.removableListeners.forEach(function(e){t.linksElem.removeEventListener(e.type,e.action)}),this.removableListeners=[]},t.prototype.setPreventZoomInteraction=function(t){if(o&&this.preventZoomInteraction!==!1){var e=t.document;e.addEventListener("touchmove",function(t){var e=t;1!==e.scale&&t.preventDefault()},!1);var i=0;e.addEventListener("touchend",function(t){var e=Date.now();e-i<=300&&(t.preventDefault(),t.cancelBubble=!0,t.stopPropagation()),i=e},!0)}},t.prototype.flush=function(){this.removeEvents()},t}();i.IframeInteractions=a},{"../../../EpubEvent":8,"../../../utils/functions":78}],32:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./GotoPage"),o=t("../../EpubEvent"),r=function(t){function e(){var i=null!==t&&t.apply(this,arguments)||this;return i._static=e,i}return n(e,t),e.prototype.exec=function(t,e){return this.epubEvent.fire({type:o.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(t){t.then(function(t){t!==!1&&NIApi.page.openFirst()})}}}),this.executedAction(arguments),!1},e._name="firstPage",e}(s.GotoPage);i.FirstPage=r},{"../../EpubEvent":8,"./GotoPage":33}],33:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./UserAct"),o=t("../../EpubEvent"),r=function(t){function e(i,n,s){var o=t.call(this,i,n,s)||this;return o.data=i,o.linksElem=n,o.index=s,o.pointerEvents="all",o.pointerCursor="pointer",o._static=e,o.init(),o}return n(e,t),e.prototype.exec=function(t,e){return this.epubEvent.fire({type:o.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(e){e.then(function(e){e!==!1&&NIApi.page.open(parseInt(t.param||0))})}}}),this.executedAction(arguments),!1},e.prototype.setTooltip=function(){var e=this.data.param;if(void 0===e)return void t.prototype.setTooltip.call(this);""===e&&(e="1");var i=w.Main.xmlManager.get("locale","tooltip_"+this.data.type),n=parseInt(e,10),s=w.Main.xmlManager.get("common-configuration","config","shift"),o=n-s;i=i.concat(" ",o.toString()),t.prototype.setTooltip.call(this,i)},e._name="gotoPage",e}(s.UserAct);i.GotoPage=r},{"../../EpubEvent":8,"./UserAct":44}],34:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./UserAct"),o=t("../../EpubEvent"),r=function(t){function e(i,n,s){var o=t.call(this,i,n,s)||this;return o.data=i,o.linksElem=n,o.index=s,o.pointerEvents="all",o.pointerCursor="pointer",o._static=e,o.init(),o}return n(e,t),e.prototype.exec=function(t,e){var i=this;return this.epubEvent.fire({type:o.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(e){e.then(function(e){if(e!==!1)return"fwd"===t.param?void i.historyFwd():void i.historyBack()})}}}),this.executedAction(arguments),!1},e.prototype.historyBack=function(){window.history.back()},e.prototype.historyFwd=function(){window.history.forward()},e._name="history",e}(s.UserAct);i.History=r},{"../../EpubEvent":8,"./UserAct":44}],35:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./UserAct"),o=t("../../EpubEvent"),r=function(t){function e(i,n,s){var o=t.call(this,i,n,s)||this;return o.data=i,o.linksElem=n,o.index=s,o.pointerEvents="all",o.pointerCursor="pointer",o._static=e,o.init(),o}return n(e,t),e.prototype.exec=function(t,e){var i=this;return this.epubEvent.fire({type:o.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(e){e.then(function(e){if(e!==!1)try{new Function("linkData","linkElement",t.param)(t,i.linksElem)}catch(e){console.warn(e)}})}}}),this.executedAction(arguments),!1},e._name="javascript",e}(s.UserAct);i.JavaScriptCall=r},{"../../EpubEvent":8,"./UserAct":44}],36:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./GotoPage"),o=t("../../EpubEvent"),r=function(t){function e(){var i=null!==t&&t.apply(this,arguments)||this;return i._static=e,i}return n(e,t),e.prototype.exec=function(t,e){return this.epubEvent.fire({type:o.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(t){t.then(function(t){t!==!1&&NIApi.page.openLast()})}}}),this.executedAction(arguments),!1},e._name="lastPage",e}(s.GotoPage);i.LastPage=r},{"../../EpubEvent":8,"./GotoPage":33}],37:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./UserAct"),o=t("../../EpubEvent"),r=function(t){function e(i,n,s){var o=t.call(this,i,n,s)||this;return o.data=i,o.linksElem=n,o.index=s,o.pointerEvents="all",o.pointerCursor="pointer",o._static=e,o.init(),o}return n(e,t),e.prototype.exec=function(t,e){return this.epubEvent.fire({type:o.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(e){e.then(function(e){e!==!1&&NIApi.lightbox.openPopup(null,t)})}}}),this.executedAction(arguments),!1},e._name="lightbox",e}(s.UserAct);i.LightBox=r},{"../../EpubEvent":8,"./UserAct":44}],38:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./UserAct"),o=t("../../EpubEvent"),r=function(t){function e(i,n,s){var o=t.call(this,i,n,s)||this;return o.data=i,o.linksElem=n,o.index=s,o.pointerEvents="all",o.pointerCursor="pointer",o._static=e,o.init(),o}return n(e,t),e.prototype.mailTo=function(t){var e=t.trim(),i="mailto:",n=e.match(/^mailto:|^mailto :/gi);null!==n&&0!==n.length&&(i=""),window.location.href=i+e},e.prototype.exec=function(t,e){var i=this;return this.epubEvent.fire({type:o.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(e){e.then(function(e){e!==!1&&i.mailTo(t.param)})}}}),this.executedAction(arguments),!1},e._name="mailto",e}(s.UserAct);i.MailTo=r},{"../../EpubEvent":8,"./UserAct":44}],39:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./GotoPage"),o=t("../../EpubEvent"),r=function(t){function e(){var i=null!==t&&t.apply(this,arguments)||this;return i._static=e,i}return n(e,t),e.prototype.exec=function(t,e){return this.epubEvent.fire({type:o.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(t){t.then(function(t){t!==!1&&NIApi.page.openNext()})}}}),this.executedAction(arguments),!1},e._name="nextPage",e}(s.GotoPage);i.NextPage=r},{"../../EpubEvent":8,"./GotoPage":33}],40:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./UserAct"),o=t("../../EpubEvent"),r=function(t){function e(i,n,s){var o=t.call(this,i,n,s)||this;return o.data=i,o.linksElem=n,o.index=s,o.pointerEvents="all",o.pointerCursor="pointer",o._static=e,o.init(),o}return n(e,t),e.prototype.exec=function(t,e){var i=this;return this.epubEvent.fire({type:o.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(e){e.then(function(e){e!==!1&&(NIApi.navigator.openUrl(t.param),i.successAction(t))})}}}),this.executedAction(arguments),!1},e._name="url",e}(s.UserAct);i.OpenUrl=r},{"../../EpubEvent":8,"./UserAct":44}],41:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./LightBox"),o=t("../../EpubEvent"),r=function(t){function e(i,n,s){var o=t.call(this,i,n,s)||this;return o.data=i,o.linksElem=n,o.index=s,o.pointerEvents="all",o.pointerCursor="pointer",o._static=e,o.init(),o}return n(e,t),e.prototype.exec=function(t,e){return this.epubEvent.fire({type:o.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(e){e.then(function(e){e!==!1&&NIApi.lightbox.openPopup(null,t)})}}}),this.executedAction(arguments),!1},e._name="popup",e}(s.LightBox);i.PopUp=r},{"../../EpubEvent":8,"./LightBox":37}],42:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./GotoPage"),o=t("../../EpubEvent"),r=function(t){function e(){var i=null!==t&&t.apply(this,arguments)||this;return i.pointerEvents="all",i.pointerCursor="pointer",i._static=e,i}return n(e,t),e.prototype.exec=function(t,e){return this.epubEvent.fire({type:o.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(t){t.then(function(t){t!==!1&&NIApi.page.openPrevious()})}}}),this.executedAction(arguments),!1},e._name="prevPage",e}(s.GotoPage);i.PrevPage=r},{"../../EpubEvent":8,"./GotoPage":33}],43:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./UserAct"),o=t("../../EpubEvent"),r=function(t){function e(i,n,s){var o=t.call(this,i,n,s)||this;return o.data=i,o.linksElem=n,o.index=s,o.pointerEvents="all",o.pointerCursor="pointer",o._static=e,o.init(),o}return n(e,t),e.prototype.mailTo=function(t){var e=t.trim(),i="tel:",n=e.match(/^tel:|^tel :/gi);null!==n&&0!==n.length&&(i=""),window.location.href=i+e},e.prototype.exec=function(t,e){var i=this;return this.epubEvent.fire({type:o.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:this.overrideOtherActions,action:function(e){e.then(function(e){e!==!1&&i.mailTo(t.param)})}}}),this.executedAction(arguments),!1},e._name="tel",e}(s.UserAct);i.Tel=r},{"../../EpubEvent":8,"./UserAct":44}],44:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../EpubDomApi"),s=t("../../EpubEvent"),o=function(){function t(e,i,n){this.data=e,this.linksElem=i,this.index=n,this.pointerEvents="none",this.pointerCursor="auto",this._static=t,this.overrideOtherActions=!0,this.epubEvent=w.epubEvent}return t.prototype.init=function(){this.defineAction(),this.setPointers(),this.setTooltip()},t.prototype.defineAction=function(){0===this.index&&this.setActionDefault()},t.prototype.setTooltip=function(t){void 0===t&&(t=""),"string"==typeof this.data.textField&&""!==this.data.textField.trim()&&(t=this.data.textField),""===t&&(t=w.Main.xmlManager.get("locale","tooltip_"+this.data.type)),this.linksElem.setAttribute("data-tooltip",t||""),w.Main.tooltipManager.register(this.linksElem)},t.prototype.setPointers=function(){this.linksElem.style.pointerEvents=this.pointerEvents,this.linksElem.style.cursor=this.pointerCursor},t.prototype.exec=function(t,e){return n["default"](this._static._name,[e,t.param,t]),this.executedAction(arguments),!1},t.prototype.executedAction=function(t){console.log("From LinksManager this action was exectuted",t)},t.prototype.setActionDefault=function(){var t=this.exec.bind(this,this.data,this.linksElem);this.linksElem.onclick=t,this.linksElem.ontouchend=t},t.prototype.successAction=function(t){this.epubEvent.fire({type:s.EPUB_EVENTS.ACTION_LINK_SUCCESS,data:{userAct:t}})},t._name="userAct",t}();i.UserAct=o},{"../../EpubDomApi":7,"../../EpubEvent":8}],45:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./MailTo"),s=t("./Tel"),o=t("./OpenUrl"),r=t("./GotoPage"),a=t("./PrevPage"),u=t("./NextPage"),l=t("./PopUp"),h=t("./LightBox"),p=t("./Youtube"),c=t("./LastPage"),d=t("./FirstPage"),f=t("./JavaScriptCall"),m=t("./History"),g={MailTo:n.MailTo,Tel:s.Tel,OpenUrl:o.OpenUrl,GotoPage:r.GotoPage,PrevPage:a.PrevPage,NextPage:u.NextPage,LastPage:c.LastPage,FirstPage:d.FirstPage,PopUp:l.PopUp,LightBox:h.LightBox,Youtube:p.Youtube,JavaScriptCall:f.JavaScriptCall,History:m.History},v=function(){function t(t,e,i,n){this.link=t,this.config=e,this.data=i,this.linksElem=n,this.userActs=[],this.setUserActs()}return t.prototype.makeActionFromUserAct=function(t,e){var i=[];for(var n in g)g[n]._name===t.type&&i.push(new g[n](t,this.linksElem,e));return i},t.prototype.setUserActs=function(){for(var t,e=0,i=this.data.length;e<i;e++)t=this.makeActionFromUserAct(this.data[e],e),0===t.length&&console.warn("useract type not supported :"+this.data[e].type,this.data[e]),this.userActs=this.userActs.concat(t)},t.prototype.stop=function(){},t.prototype.flush=function(){},t._name="userActs",t}();i.UserActs=v},{"./FirstPage":32,"./GotoPage":33,"./History":34,"./JavaScriptCall":35,"./LastPage":36,"./LightBox":37,"./MailTo":38,"./NextPage":39,"./OpenUrl":40,"./PopUp":41,"./PrevPage":42,"./Tel":43,"./Youtube":46}],46:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("./LightBox"),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e._name="youtube",e}(s.LightBox);i.Youtube=o},{"./LightBox":37}],47:[function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(s,o){function r(t){try{u(n.next(t))}catch(e){o(e)}}function a(t){try{u(n["throw"](t))}catch(e){o(e)}}function u(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(r,a)}u((n=n.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,o=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(r=u.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){u.label=i[1];break}if(6===i[0]&&u.label<r[1]){u.label=r[1],r=i;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(i);break}r[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(n){i=[6,n],o=0}finally{s=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,o,r,a,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(i,"__esModule",{value:!0});var o,r=t("./EpubGesturesEvent"),a=t("./EpubPageEnrichment/IFrames"),u=t("./EpubPageEnrichment/Copyables"),l=t("./EpubPageEnrichment/Medias"),h=t("./EpubPageEnrichment/Sliders"),p=t("./EpubEvent"),c=t("./utils/isElementVisible"),d=t("./utils/ScrollUtil");!function(t){t.Scroll="SCROLL"}(o||(o={}));var f="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",m=0,g=100,v=function(){function t(t,e,i){this.epubPage=t,this.config=e,this.element=i,this.eventListeners=[],this.enableRegisterInteractiveHandlers=!1,this.started=!1,this.pendingAnimationMap={},this.setTimeoutIds=[],this.delayedAnimations=[],this.copyables=[],this.buttonTouchPosition={startX:-1,startY:-1,moveX:-1,moveY:-1},this.epubAnimationsHistory=[],this.epubPageEnrichmentID=m++,this.launchVisibleAnimations=this.launchVisibleAnimations.bind(this),this.onScroll=this.onScroll.bind(this),w.epubAnimUtils={goToState:this.goToState.bind(this)}}return Object.defineProperty(t.prototype,"isCrossNavPage",{get:function(){return this.config.isCrossNavPage(this.epubPage.pageNumber)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAnimationTriggeredByScroll",{get:function(){var t=this.config.isVerticalOnePage;return this.isCrossNavPage||t},enumerable:!0,configurable:!0}),t.getActionHistoryTemplate=function(){return{func:null,args:[]}},t.prototype.start=function(){if(!this.started&&0!==this.element.childNodes.length){this.started=!0,this.startGifs();var t=this.element.childNodes[0],e=t.getAttribute("data-onload");if(null!==e&&e.indexOf("RegisterInteractiveHandlers")===-1)return void(this.enableRegisterInteractiveHandlers=!1);this.enableRegisterInteractiveHandlers=!0,this.registerInteractiveHandlers()}},t.prototype.stop=function(){this.clearEnrichmentTimeouts(),this.started!==!1&&(this.started=!1,this.stopGifs(),this.enableRegisterInteractiveHandlers!==!1&&(this.stopMedias(),this.removeEventListeners(),this.reloadActionHistory(),this.stopIFrames(),this.stopSliders(),this.stopCopyables()))},t.prototype.flush=function(){this.stop(),this.gifs=null},t.prototype.updateIframesZoom=function(t){this.iFramesObject&&this.iFramesObject.updateZoom(t)},t.prototype.makeDefaultPreventGesture=function(){r["default"].prototype.preventAllGesture()},t.prototype.clearEnrichmentTimeouts=function(){for(var t=0;t<this.setTimeoutIds.length;t++){var e=this.setTimeoutIds[t];clearTimeout(e)}this.setTimeoutIds=[],clearTimeout(this.crossnavAnimationTimer)},t.prototype.evalActions=function(t,e){new Function("_self","selfContainerID","with(_self){ "+t+" }")(this,e)},t.prototype.removeEventListeners=function(){for(var t=0,e=this.eventListeners.length;t<e;t++)this.eventListeners[t].element.removeEventListener(this.eventListeners[t].type,this.eventListeners[t].func,this.eventListeners[t].useCapture);this.eventListeners=[]},t.prototype.addToEventListeners=function(t,e,i,n){void 0===n&&(n=!1),t.addEventListener(i,e,n),this.eventListeners.push({element:t,type:i,func:e,useCapture:n})},t.prototype.reloadActionHistory=function(){for(var t=this.epubAnimationsHistory.length;t--;)this.epubAnimationsHistory[t].func(this.epubAnimationsHistory[t].args[0],this.epubAnimationsHistory[t].args[1]);this.epubAnimationsHistory=[]},t.prototype.registerInteractiveHandlers=function(){var t=this;this.registerButtonEventHandlers(),this.processAnimations(),this.processMediaGesture(),this.processIFrames(),this.processSliders(),this.processCopyables(),this.crossnavAnimationTimer=setTimeout(function(){if(t.isAnimationTriggeredByScroll){var e=t.isCrossNavPage?".webpub-viewer__epub-container-spread":".webpub-viewer__epub-container";t.scrollableParent=t.element.closest(e),t.registerPublicationEventHandlers(),t.launchVisibleAnimations()}},200)},t.prototype.processMediaGesture=function(){this.medias=this.element.querySelectorAll("video,audio"),0!==this.medias.length&&(this.mediasObject=new l.Medias(this.medias,this.config),this.mediasObject.start())},t.prototype.processIFrames=function(){this.iFrames=this.element.querySelectorAll("iframe"),0!==this.iFrames.length&&(this.iFramesObject=new a.IFrames(this.iFrames,this.config),this.iFramesObject.start())},t.prototype.processSliders=function(){if(this.sliders=this.element.querySelectorAll("[class*="+h.SLIDER_CLASSNAME+']:not([data-hidden="true"])'),0!==this.sliders.length){var t=w.Main.configsJsonManager.getPagesData(["sliders"]),e=t[this.epubPage.pageNumber-1];e&&e.sliders&&(this.slidersObject=new h.Sliders(this.sliders,e.sliders,this.epubPage.pageNumber))}},t.prototype.processCopyables=function(){w.Main.startupManager.get("core.copyableTexts")&&(this.copyables=u.getCopyableElements(this.element),this.copyablesObject=new u.Copyables(this.copyables),this.copyablesObject.start())},t.prototype.startGifs=function(){var t=this;this.gifs=this.gifs||this.element.querySelectorAll("img[src$='.gif']");for(var e=0,i=this.gifs.length;e<i;e++){var n=this.gifs[e];null===n.getAttribute("data-src")&&n.setAttribute("data-src",n.getAttribute("src")),n.src=f,function(e){t.createEnrichmentTimeout(function(){e.src=e.getAttribute("data-src")},0)}(n)}},t.prototype.createEnrichmentTimeout=function(t,e){var i=setTimeout(t,e);return this.setTimeoutIds.push(i),i},t.prototype.stopGifs=function(){this.gifs=this.gifs||this.element.querySelectorAll("img[src$='.gif']");for(var t=0,e=this.gifs.length;t<e;t++){var i=this.gifs[t];null===i.getAttribute("data-src")&&i.setAttribute("data-src",i.getAttribute("src")),i.src=f}},t.prototype.stopIFrames=function(){this.iFramesObject&&this.iFramesObject.stop()},t.prototype.stopMedias=function(){this.mediasObject&&this.mediasObject.stop()},t.prototype.stopSliders=function(){this.slidersObject&&this.slidersObject.stop()},t.prototype.stopCopyables=function(){this.copyablesObject&&this.copyablesObject.stop()},t.prototype.getCSSClass=function(t){return t.getAttribute&&t.getAttribute("class")?t.getAttribute("class"):""},t.prototype.processAnimations=function(){var t=this.element.querySelectorAll("._idGenAnimation");t.length>0&&(this.epubPage.pageContainsCPUElement=!0);for(var e,i,n,s=0;s<t.length;s++)e=t[s].getAttribute("data-animationOnPageLoadActions"),e&&(i=t[s],this.isAnimationTriggeredByScroll?this.delayedAnimations.push({element:i,actions:e,trigger:{type:o.Scroll}}):this.evalActions(e,i)),n=this.getCSSClass(t[s]),n.indexOf("_idGenCurrentState")!=-1&&(e=t[s].getAttribute("data-animationOnStateLoadActions"),e&&(i=t[s],this.evalActions(e,i))),e=t[s].getAttribute("data-animationOnSelfClickActions"),e&&(this.addToEventListeners(t[s],this.onTouchEndForAnimations.bind(this,t[s]),"touchend",!1),this.addToEventListeners(t[s],this.onMouseUpForAnimations.bind(this,t[s]),"mouseup",!1)),e=t[s].getAttribute("data-animationOnSelfRolloverActions"),e&&this.addToEventListeners(t[s],this.onMouseOverForAnimations.bind(this,t[s]),"mouseover",!1);this.addToEventListeners(this.element,this.onPageTouchEndForAnimations.bind(this,this.element),"touchend",!1),this.addToEventListeners(this.element,this.onPageMouseUpForAnimations.bind(this,this.element),"mouseup",!1)},t.prototype.onPageTouchEndForAnimations=function(t,e){for(var i,n,s=this.element.querySelectorAll("._idGenAnimation"),o=0;o<s.length;o++)i=s[o].getAttribute("data-animationOnPageClickActions"),i&&(n=s[o],this.evalActions(i,n))},t.prototype.onPageMouseUpForAnimations=function(t,e){for(var i,n,s=this.element.querySelectorAll("._idGenAnimation"),o=0;o<s.length;o++)i=s[o].getAttribute("data-animationOnPageClickActions"),i&&(n=s[o],this.evalActions(i,n))},t.prototype.onTouchEndForAnimations=function(t,e){e.preventDefault();for(var i,n,s="."+t.getAttribute("data-animationObjectType"),o=this.element.querySelectorAll(s),r=0;r<o.length;r++)i=o[r].getAttribute("data-animationOnSelfClickActions"),i&&(n=o[r],this.evalActions(i,n))},t.prototype.onMouseUpForAnimations=function(t,e){for(var i,n,s="."+t.getAttribute("data-animationObjectType"),o=this.element.querySelectorAll(s),r=0;r<o.length;r++)i=o[r].getAttribute("data-animationOnSelfClickActions"),i&&(n=o[r],this.evalActions(i,n))},t.prototype.onMouseOverForAnimations=function(t,e){var i=t.getAttribute("data-idGenAnimationClass"),n=this.getCSSClass(t);if(null===i||n.indexOf(i)==-1)for(var s,o,r="."+t.getAttribute("data-animationObjectType"),a=this.element.querySelectorAll(r),u=0;u<a.length;u++)s=a[u].getAttribute("data-animationOnSelfRolloverActions"),s&&(o=a[u],this.evalActions(s,o))},t.prototype.registerButtonEventHandlers=function(){for(var t=this.element.querySelectorAll("._idGenButton"),e=0;e<t.length;e++)this.addToEventListeners(t[e],this.onTouchStart.bind(this,t[e]),"touchstart",!1),this.addToEventListeners(t[e],this.onTouchMove.bind(this,t[e]),"touchmove",!1),this.addToEventListeners(t[e],this.onTouchEnd.bind(this,t[e]),"touchend",!1),this.addToEventListeners(t[e],this.onClick.bind(this,t[e]),"click",!1),this.addToEventListeners(t[e],this.onMouseUp.bind(this,t[e]),"mouseup",!1),this.addToEventListeners(t[e],this.onMouseOver.bind(this,t[e]),"mouseover",!1),this.addToEventListeners(t[e],this.onMouseOut.bind(this,t[e]),"mouseout",!1)},t.prototype.onScroll=function(){var t=this.verticalScrollUtil.isScrollDown();this.launchVisibleAnimations(t)},t.prototype.registerPublicationEventHandlers=function(){this.verticalScrollUtil=new d["default"](this.scrollableParent);var t=100;this.scrollableParent.addEventListener("scroll",w.Utils.throttle(this.onScroll,t))},t.prototype.launchVisibleAnimations=function(t){void 0===t&&(t=!0);for(var e={top:this.config.paddingTop,bottom:this.config.paddingBottom},i=c.isElementVisible(this.epubPage.element,c.ElementVisibleMode.BOTTOM,e),n=0;n<this.delayedAnimations.length;n++){var s=this.delayedAnimations[n],o=t?c.ElementVisibleMode.TOP:c.ElementVisibleMode.BOTTOM,r=c.isElementVisible(s.element,o,e);(r||i)&&(this.evalActions(s.actions,s.element),this.delayedAnimations.splice(n,1),n--)}},t.prototype.hasAppearance=function(t,e){for(var i,n=t.children,s=0;s<n.length;s++)if(i=this.getCSSClass(n[s]),i.indexOf(e)!=-1)return!0;return!1},t.prototype.isDescendantOf=function(t,e){for(var i=t;i;){if(i==e)return!0;i=i.parentNode}return!1},t.prototype.addClass=function(e,i){if(null!==i&&e.classList.contains(i)!==!0){var n=t.getActionHistoryTemplate();n.func=this.removeClass.bind(this),n.args.push(e),n.args.push(i),this.epubAnimationsHistory.push(n),e.classList.add(i)}},t.prototype.removeClass=function(e,i){if(null!==i&&e.classList.contains(i)!==!1){var n=t.getActionHistoryTemplate();n.func=this.addClass.bind(this),n.args.push(e),n.args.push(i),this.epubAnimationsHistory.push(n),e.classList.remove(i)}},t.prototype.onClick=function(t,e){this.hasAppearance(t,"_idGen-Appearance-Click")&&this.addClass(t,"_idGenStateClick");var i=t.getAttribute("data-clickactions");i&&this.evalActions(i,null)},t.prototype.onMouseUp=function(t,e){this.removeClass(t,"_idGenStateClick");var i=t.getAttribute("data-releaseactions");i&&this.evalActions(i,null)},t.prototype.onMouseOver=function(t,e){if(!e.relatedTarget||!this.isDescendantOf(e.relatedTarget,t)){this.hasAppearance(t,"_idGen-Appearance-Rollover")&&this.addClass(t,"_idGenStateHover");var i=t.getAttribute("data-rolloveractions");i&&this.evalActions(i,null)}},t.prototype.onMouseOut=function(t,e){if(!e.relatedTarget||!this.isDescendantOf(e.relatedTarget,t)){this.removeClass(t,"_idGenStateHover"),this.removeClass(t,"_idGenStateClick");var i=t.getAttribute("data-rolloffactions");i&&this.evalActions(i,null)}},t.prototype.onTouchStart=function(t,e){this.setButtonTouchStartPosition(e.touches[0].clientX,e.touches[0].clientY),this.hasAppearance(t,"_idGen-Appearance-Click")&&this.addClass(t,"_idGenStateClick");var i=t.getAttribute("data-clickactions");i&&this.evalActions(i,null)},t.prototype.setButtonTouchStartPosition=function(t,e){this.buttonTouchPosition.startX=t,
this.buttonTouchPosition.startY=e,this.buttonTouchPosition.moveX=-1,this.buttonTouchPosition.moveY=-1},t.prototype.onTouchMove=function(t,e){this.buttonTouchPosition.moveX=e.touches[0].clientX,this.buttonTouchPosition.moveY=e.touches[0].clientY},t.prototype.onTouchEnd=function(t,e){if(e.preventDefault(),!this.shouldCancelButtonTap()){this.removeClass(t,"_idGenStateClick");var i=t.getAttribute("data-releaseactions");i&&this.evalActions(i,null)}},t.prototype.shouldCancelButtonTap=function(){var t=this.buttonTouchPosition.moveX!==-1&&this.buttonTouchPosition.moveY!==-1,e=Math.abs(this.buttonTouchPosition.startX-this.buttonTouchPosition.moveX)>20,i=Math.abs(this.buttonTouchPosition.startY-this.buttonTouchPosition.moveY)>20,n=e||i;return!(!t||!n)},t.prototype.onHide=function(t){var e=this.element.querySelector("#"+t);null!==e&&(this.handleMSOStateParentOfObject(e),this.addClass(e,"_idGenStateHide"))},t.prototype.onShow=function(t){var e=this.element.querySelector("#"+t);null!==e&&(this.handleMSOStateParentOfObject(e),this.removeClass(e,"_idGenStateHide"))},t.prototype.handleMSOStateParentOfObject=function(t){for(var e,i,n=t,s=n.parentNode;null!==s&&!e;)i=this.getCSSClass(s),i&&i.indexOf("_idGenMSO")!=-1?e=!0:n=s,s=n.parentNode;if(e)for(var o=n,r=s.children,a=0,u=void 0;u=r[a];a++){var l=this.getCSSClass(u).indexOf("_idGenCurrentState")!=-1;if(l&&u!==o)return this.handleMediaInMSOState(u,!1),this.removeClass(u,"_idGenCurrentState"),this.addClass(u,"_idGenStateHide"),this.handleMediaInMSOState(o,!0),this.removeClass(o,"_idGenStateHide"),void this.addClass(o,"_idGenCurrentState")}},t.prototype.goToDestination=function(t){this.callIfClickAuthorized(this.getActionFunction(t))},t.prototype.getActionFunction=function(t){if(t=t.trim(),0===t.indexOf("http"))return this.getEpubDomApiFunction("url",t);if(0===t.indexOf("javascript")||0===t.indexOf("js:")||0===t.indexOf("js :"))return this.getEpubDomApiFunction("javascript",t);if(0===t.indexOf("NIApi"))return this.getEpubDomApiFunction("NIApi",t);var e=/-([0-9]*).xhtml$/gim,i=e.exec(t)||[];return i.length>0?this.getEpubDomApiFunction("gotoPage",~~i[1]):function(){return null}},t.prototype.getEpubDomApiFunction=function(t,e){return function(){return webpublicationNamespace.EpubDomApi(t,[null,e])}},t.prototype.callIfClickAuthorized=function(t){var e=this;w.epubEvent.fire({type:p.EPUB_EVENTS.PAGE_CLICK_PERMISSION,data:{override:!0,action:function(i){return n(e,void 0,void 0,function(){var e;return s(this,function(n){switch(n.label){case 0:return[4,i];case 1:return e=n.sent(),e&&t(),[2]}})})}}})},t.prototype.handleMediaInMSOState=function(t,e){for(var i,n,s=t.getElementsByTagName("*"),o=0;o<s.length;o++)i=s[o],n=i.tagName.toLowerCase(),"video"!=n&&"audio"!=n||(e?i.play():i.pause())},t.prototype.handleAnimationInMSOState=function(t){var e,i,n,s,o=this.getCSSClass(t);o.indexOf("_idGenAnimation")!=-1&&(e=t.getAttribute("data-idGenAnimationStartState"),i=t.getAttribute("data-idGenAnimationEndState"),this.removeClass(t,i),this.addClass(t,e),n=t.getAttribute("data-animationOnStateLoadActions"),n&&(s=t.id,this.evalActions(n,s)));for(var r,a=t.getElementsByTagName("*"),u=0;u<a.length;u++)r=a[u],o=this.getCSSClass(r),o.indexOf("_idGenAnimation")!=-1&&(e=t.getAttribute("data-idGenAnimationStartState"),i=t.getAttribute("data-idGenAnimationEndState"),this.removeClass(t,i),this.addClass(t,e),n=r.getAttribute("data-animationOnStateLoadActions"),n&&(s=r.id,this.evalActions(n,s)))},t.prototype.goToNextState=function(t,e,i){var n=this;this.makeDefaultPreventGesture(),this.createEnrichmentTimeout(function(){n.goToNextStateWrapper(t,e)},1e3*i)},t.prototype.goToNextStateWrapper=function(t,e){var i,n,s,o=this.element.querySelector("#"+t);if(null!==o){this.removeClass(o,"_idGenStateHide"),i=o.children;for(var r=0,a=void 0;a=i[r];r++)if(n=this.getCSSClass(a),n.indexOf("_idGenCurrentState")!=-1)return s=e?r==i.length-1?i[0]:i[r+1]:r==i.length-1?i[r]:i[r+1],this.handleMediaInMSOState(a,!1),this.removeClass(a,"_idGenCurrentState"),this.addClass(a,"_idGenStateHide"),this.handleMediaInMSOState(s,!0),this.removeClass(s,"_idGenStateHide"),this.addClass(s,"_idGenCurrentState"),void this.handleAnimationInMSOState(s)}},t.prototype.goToPreviousState=function(t,e,i){var n=this;this.makeDefaultPreventGesture(),this.createEnrichmentTimeout(function(){n.goToPreviousStateWrapper(t,e)},1e3*i)},t.prototype.goToPreviousStateWrapper=function(t,e){var i,n,s,o=document.getElementById(t);if(o){this.removeClass(o,"_idGenStateHide"),i=o.children;for(var r=0,a=void 0;a=i[r];r++)if(n=this.getCSSClass(a),n.indexOf("_idGenCurrentState")!=-1)return s=e?0==r?i[i.length-1]:i[r-1]:0==r?i[0]:i[r-1],this.handleMediaInMSOState(a,!1),this.removeClass(a,"_idGenCurrentState"),this.addClass(a,"_idGenStateHide"),this.handleMediaInMSOState(s,!0),this.removeClass(s,"_idGenStateHide"),this.addClass(s,"_idGenCurrentState"),void this.handleAnimationInMSOState(s)}},t.prototype.playAnimation=function(t,e,i,n){this.addAnimationToAnimationMap(!1,t,e,i,n)},t.prototype.reverseAnimation=function(t,e,i){this.addAnimationToAnimationMap(!0,t,e,i,"")},t.prototype.pauseAnimation=function(t,e){var i=this.getIdByAnimationId(t),n=this.pendingAnimationMap[i];if(n){for(var s=0;s<n.length;s++)clearTimeout(n[s]);delete this.pendingAnimationMap[i]}},t.prototype.goToState=function(t,e,i,n){var s=this,o=document.querySelectorAll("#"+t);Array.from(o).forEach(function(t){for(var i=t.children,n=0;n<i.length;n++){var o=i[n],r=o.getAttribute("data-idgenobjectstate");r===e?(s.handleMediaInMSOState(o,!0),s.removeClass(o,"_idGenStateHide"),s.addClass(o,"_idGenCurrentState"),s.handleAnimationInMSOState(o)):(s.handleMediaInMSOState(o,!1),s.removeClass(o,"_idGenCurrentState"),s.addClass(o,"_idGenStateHide"))}})},t.prototype.addAnimationToAnimationMap=function(t,e,i,n,s){var o=this,r=this.getIdByAnimationId(e),a=this.createEnrichmentTimeout(function(){var u=o.pendingAnimationMap[r].indexOf(a);o.pendingAnimationMap[r].splice(u,1),o.executeAnimation(t,e,i,n,s)},g);this.pendingAnimationMap[r]=this.pendingAnimationMap[r]||[],this.pendingAnimationMap[r].push(a)},t.prototype.getElementByAnimationId=function(t){return"object"==typeof t?t:this.element.querySelector("#"+t)},t.prototype.getIdByAnimationId=function(t){return"object"==typeof t?t.id:t},t.prototype.animateElement=function(t,e,i,n){var s=this;this.removeClass(e,"_idGenStateHide"),this.removeClass(e,"_idGenPauseAnimation");var o=this.getCSSClass(e),r=e.getAttribute("data-idGenAnimationClass");o.indexOf(i)==-1&&o.indexOf(r)==-1?(this.addClass(e,i),e.setAttribute("data-idGenAnimationClass",i)):(this.removeClass(e,i),this.removeClass(e,r),e.removeEventListener("webkitAnimationEnd",function(i){s.onAnimationEnd(t,e,n,i)}),e.removeEventListener("animationend",function(i){s.onAnimationEnd(t,e,n,i)}),setTimeout(function(){s.addClass(e,i)},10),e.setAttribute("data-idGenAnimationClass",i)),this.addToEventListeners(e,this.onAnimationEnd.bind(this,t,e,n),"webkitAnimationEnd"),this.addToEventListeners(e,this.onAnimationEnd.bind(this,t,e,n),"animationend")},t.prototype.executeAnimation=function(t,e,i,n,s){var o=this,r=this.getElementByAnimationId(e);if(r){this.handleMSOStateParentOfObject(r);var a=r.getAttribute("data-idGenAnimationStartState"),u=r.getAttribute("data-idGenAnimationEndState"),l=r.classList.contains("_idGenStateHide");l&&!r.hasAttribute("data-initially-hidden")&&r.setAttribute("data-initially-hidden","true"),this.removeClass(r,t?a:u),this.addClass(r,t?u:a),this.createEnrichmentTimeout(function(){o.animateElement(t,r,i,s)},1e3*n)}},t.prototype.onAnimationEnd=function(t,e,i,n){var s=e.getAttribute("data-idGenAnimationClass"),o=e.getAttribute("data-idGenAnimationStartState"),r=e.getAttribute("data-idGenAnimationEndState");this.removeClass(e,s),this.removeClass(e,t?r:o);var a=t?o:r;this.addFinishCssClass(e,a),i&&this.addClass(e,"_idGenStateHide"),n.stopPropagation()},t.prototype.addFinishCssClass=function(t,e){var i=this;"safari"===w.Param.userAgent.browser.name&&12===w.Param.userAgent.browser.version?setTimeout(function(){i.addClass(t,e)},0):this.addClass(t,e)},t}();i["default"]=v},{"./EpubEvent":8,"./EpubGesturesEvent":10,"./EpubPageEnrichment/Copyables":49,"./EpubPageEnrichment/IFrames":51,"./EpubPageEnrichment/Medias":53,"./EpubPageEnrichment/Sliders":57,"./utils/ScrollUtil":74,"./utils/isElementVisible":79}],48:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n;!function(t){t.ELEMENT="copyableText",t.BUTTON="copyableTextButton",t.FADE_IN="fadeIn"}(n||(n={}));var s=30,o=function(){function t(t){this.element=t,this.scale=1,this.init(),this.positionButton=this.positionButton.bind(this),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onButtonClick=this.onButtonClick.bind(this)}return t.prototype.init=function(){this.element.classList.add(n.ELEMENT),this.createButton()},t.prototype.start=function(){this.pollUpdateButton(),this.element.addEventListener("mouseenter",this.onMouseEnter),this.element.addEventListener("mouseleave",this.onMouseLeave),this.buttonElement.addEventListener("click",this.onButtonClick)},t.prototype.stop=function(){this.element.removeEventListener("mouseenter",this.onMouseEnter),this.element.removeEventListener("mouseleave",this.onMouseLeave),this.buttonElement.removeEventListener("click",this.onButtonClick),clearInterval(this.updateButtonInterval)},t.prototype.pollUpdateButton=function(){this.updateButtonInterval=setInterval(this.positionButton,100)},t.prototype.onMouseEnter=function(t){this.buttonElement.classList.add(n.FADE_IN)},t.prototype.createButton=function(){this.buttonElement=document.createElement("div"),this.buttonElement.classList.add(n.BUTTON),this.buttonElement.innerHTML=this.getIconHTML(),this.buttonElement.style.width=s+"px",this.buttonElement.style.height=s+"px",this.element.appendChild(this.buttonElement)},t.prototype.getIconHTML=function(){return'<div class="svgicon-new svgicon-copy-v4">\n\t\t\t<svg data-icon="copy-v4">\n\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svgicon-copy-v4"></use>\n\t\t\t</svg>\n\t\t</div>'},t.prototype.positionButton=function(){this.setScale();var t=this.buttonElement.getBoundingClientRect(),e=this.element.getBoundingClientRect();this.buttonElement.style.top=this.getPositionTop(e,t)+"px",this.buttonElement.style.left=this.getPositionLeft(e,t)+"px",this.buttonElement.style.transform="scale("+this.scale+")"},t.prototype.setScale=function(){var t=this.buttonElement.getBoundingClientRect(),e=t.height/this.scale/s;this.scale=1/e},t.prototype.getPositionTop=function(t,e){return this.scale*(t.height-e.height/this.scale/2)},t.prototype.getPositionLeft=function(t,e){return this.scale*(t.width-e.width/this.scale/2)},t.prototype.onMouseLeave=function(){this.buttonElement.classList.remove(n.FADE_IN)},t.prototype.onButtonClick=function(){var t=this.getText();this.copyToClipboard(t)},t.prototype.getText=function(){return this.element.textContent?this.element.textContent.replace(/\n/g," ").replace(/  /g,"\n"):""},t.prototype.copyToClipboard=function(t){var e=new ClipboardItem({"text/plain":new Blob([t],{type:"text/plain"})});navigator.clipboard.write([e])},t}();i.Copyable=o},{}],49:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./Copyable"),s=function(){function t(t){this.htmlCopyables=t,this.copyables=[],this.init()}return t.prototype.init=function(){this.copyables=this.htmlCopyables.map(function(t){return new n.Copyable(t)})},t.prototype.start=function(){for(var t=0,e=this.copyables.length;t<e;t++)this.copyables[t].start()},t.prototype.stop=function(){for(var t=0,e=this.copyables.length;t<e;t++)this.copyables[t].stop()},t}();i.Copyables=s;var o=function(t){var e="div p",i="div, figure",n="DIV",s=Array.from(t.querySelectorAll(e)),o=s.map(function(t){return t.closest(i)}),r=Array.from(new Set(o)),a=r.filter(function(t){return t.tagName===n});return a};i.getCopyableElements=o},{"./Copyable":48}],50:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../EpubPage/shapes/utils/IframeInteractions"),s=t("../utils/enums"),o=t("../utils/youtube"),r=function(){function t(t,e){this.iFrame=t,this.config=e,this.init()}return t.prototype.init=function(){this.element=this.iFrame.parentElement,this.iFrame.style.pointerEvents="none",this.iFrame.dataset.foreground="true",this.iFrame.contentEditable="true",this.iframeInteractions=new n.IframeInteractions(this,this.config,this.iFrame,this.element,(!0)),this.iFrame.addEventListener("load",this.onLoad.bind(this))},t.prototype.onLoad=function(){try{this.iFrameContentWindow=this.iFrame.contentWindow;var t="object"==typeof this.iFrameContentWindow.AdobeAn;if(t)return void this.iframeInteractions.init(this.iFrameContentWindow);this.config.readerPageSrcType===s.READER_TYPES.EPUB_HTML&&this.preventZoomConflict()}catch(e){this.preventZoomConflict()}},t.prototype.preventZoomConflict=function(){this.iFrame.style.pointerEvents="all",this.iframeInteractions.setPreventZoomInteraction(this.iFrameContentWindow)},t.prototype.start=function(){var t=this.iFrame.dataset.src;!this.iFrame.src&&t&&(this.iFrame.src=o.getCorrectYoutubeDomain(t),o.addYoutubeTrackStateChange(this.iFrame))},t.prototype.stop=function(){this.iFrame.removeAttribute("src"),this.iframeInteractions.flush()},t.prototype.updateZoom=function(t){if(!this.iFrame.style.width&&!this.iFrame.style.height){var e=window.getComputedStyle(this.iFrame);this.iFrame.style.width=e.getPropertyValue("width"),this.iFrame.style.height=e.getPropertyValue("height")}this.iFrame.parentElement&&(this.iFrame.style.zoom=""+1/t,this.iFrame.parentElement.style.transform="scale("+t+")",this.iFrame.parentElement.style.transformOrigin="0 0")},t}();i.IFrame=r},{"../EpubPage/shapes/utils/IframeInteractions":31,"../utils/enums":77,"../utils/youtube":81}],51:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./IFrame"),s=function(){function t(t,e){this.htmlIframes=t,this.config=e,this.iFrames=[],this.init()}return t.prototype.init=function(){for(var t=0,e=this.htmlIframes.length;t<e;t++)this.iFrames.push(new n.IFrame(this.htmlIframes[t],this.config))},t.prototype.start=function(){for(var t=0,e=this.iFrames.length;t<e;t++)this.iFrames[t].start()},t.prototype.stop=function(){for(var t=0,e=this.iFrames.length;t<e;t++)this.iFrames[t].stop()},t.prototype.updateZoom=function(t){this.iFrames.forEach(function(e){return e.updateZoom(t)})},t}();i.IFrames=s},{"./IFrame":50}],52:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../EpubGesturesEvent"),s=function(){function t(t,e){this.media=t,this.config=e,this.foreground=!0,this.startableAsyncDate=0,this.status={start:!1},this.init()}return t.prototype.init=function(){this._onMediaChange=this.onMediaChange.bind(this),this.media.setAttribute("controlsList","nodownload"),this.media.addEventListener("volumechange",this._onMediaChange,!0),this.media.addEventListener("seeking",this._onMediaChange,!0)},t.prototype.onMediaChange=function(){n["default"].prototype.preventAllGesture()},t.prototype.onScroll=function(){this.startableAsync()},t.prototype.startableAsync=function(){var t=this;return clearTimeout(this.startableAsyncTimer),Date.now()-this.startableAsyncDate>1e3?(this.startableAsyncDate=Date.now(),void this.startable()):void(this.startableAsyncTimer=setTimeout(function(){t.startableAsyncDate=Date.now(),t.startable()},100))},t.prototype.startable=function(){if(this.status.start===!1)return void this.media.pause();var t=this.media.hasAttribute("autoplay")&&"false"!==this.media.getAttribute("autoplay"),e=this.media.dataset.ignoreAutoplay;t&&!e&&this.media.play()},t.prototype.start=function(){this.status.start=!0,this.startableAsync()},t.prototype.stop=function(){this.media.removeEventListener("volumechange",this._onMediaChange,!0),this.media.removeEventListener("seeking",this._onMediaChange,!0),this.status.start=!1,this.media.pause()},t}();i.Media=s},{"../EpubGesturesEvent":10}],53:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./Media"),s=function(){function t(t,e){this.htmlMedias=t,this.config=e,this.medias=[],this.init()}return t.prototype.init=function(){for(var t=0,e=this.htmlMedias.length;t<e;t++)this.medias.push(new n.Media(this.htmlMedias[t],this.config))},t.prototype.start=function(){for(var t=0,e=this.medias.length;t<e;t++)this.medias[t].start()},t.prototype.stop=function(){for(var t=0,e=this.medias.length;t<e;t++)this.medias[t].stop()},t}();i.Medias=s},{"./Media":52}],54:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=5,s=11,o=3,r={LEVEL_1:1,LEVEL_2:.83,LEVEL_3:.66},a=function(){function t(t,e,i){this.sliderElement=t,this.slidesLength=e,this.prevSlideIndex=i,this.init(),this.update(i)}return t.prototype.init=function(){for(var t=this.sliderElement.querySelector(".webpublication-pswp__dots-line"),e=0;e<this.slidesLength;e++){var i=document.createElement("span");0===e&&i.classList.add("is-active"),this.slidesLength>n?(3===e&&(i.style.transform="scale("+r.LEVEL_2+")"),e>3&&(i.style.transform="scale("+r.LEVEL_3+")")):t.classList.add("is-static"),t.appendChild(i)}},t.prototype.updateActiveDot=function(t){for(var e=[].slice.call(this.sliderElement.querySelectorAll(".webpublication-pswp__dots span")),i=0;i<e.length;i++)e[i].classList.toggle("is-active",i===t)},t.prototype.updateDotsLine=function(t){var e=this.sliderElement.querySelector(".webpublication-pswp__dots-line"),i=t<3,o=t>this.slidesLength-3,r=t===this.slidesLength-1&&0===this.prevSlideIndex;if(i&&(e.style.transform="translateX(0)"),!i&&!o){var a=(t-2)*s;e.style.transform="translateX("+-a+"px)"}if(r||o){var a=(this.slidesLength-n)*s;e.style.transform="translateX("+-a+"px)"}this.prevSlideIndex=t},t.prototype.updateDotsScale=function(t){for(var e=[].slice.call(this.sliderElement.querySelectorAll(".webpublication-pswp__dots span")),i=0;i<e.length;i++)e[i].style.transform="scale("+r.LEVEL_3+")";var n=t<o,s=t>=this.slidesLength-o;if(n){for(var i=0;i<o;i++)e[i].style.transform="scale("+r.LEVEL_1+")";e[o].style.transform="scale("+r.LEVEL_2+")"}else if(s){for(var i=this.slidesLength-1;i>this.slidesLength-1-o;i--)e[i].style.transform="scale("+r.LEVEL_1+")";e[this.slidesLength-1-o].style.transform="scale("+r.LEVEL_2+")"}else e[t].style.transform="scale("+r.LEVEL_1+")",e[t-1].style.transform="scale("+r.LEVEL_1+")",e[t+1].style.transform="scale("+r.LEVEL_1+")",e[t-2].style.transform="scale("+r.LEVEL_2+")",e[t+2].style.transform="scale("+r.LEVEL_2+")"},t.prototype.update=function(t){this.updateActiveDot(t),this.slidesLength>n&&(this.updateDotsLine(t),this.updateDotsScale(t))},t}();i.Pagination=a},{}],55:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n;!function(t){t.LEFT="LEFT",t.CENTER="CENTER",t.RIGHT="RIGHT"}(n||(n={}));var s;!function(t){t.TOP="TOP",t.CENTER="CENTER",t.BOTTOM="BOTTOM",t.ABOVE_SLIDE="ABOVE_SLIDE",t.UNDER_SLIDE="UNDER_SLIDE"}(s||(s={}));var o=function(){function t(t,e){this.parentElement=t,this.isBackground=e,this.insideTextWrapperElement=this.parentElement.querySelector(".webpublication-pswp__text-wrapper.is-inside"),this.insideTextElement=this.parentElement.querySelector(".webpublication-pswp__text.is-inside"),this.outsideTextWrapperElement=this.parentElement.querySelector(".webpublication-pswp__text-wrapper.is-outside"),this.outsideTextElement=this.parentElement.querySelector(".webpublication-pswp__text.is-outside")}return t.prototype.setTextWrapperStyles=function(t,e,i){var o=e.position,r=o.x,a=o.y,u="";switch(r){case n.LEFT:u="flex-start";break;case n.CENTER:u="center";break;case n.RIGHT:u="flex-end"}if(t.style.justifyContent=u,a===s.BOTTOM){var l="0";this.isBackground||(l=i?"50px":"25px"),t.style.bottom=l}else if(a===s.CENTER)t.style.top="50%",t.style.transform="translateY(-50%)";else if(a===s.TOP){var h="45px";t.style.top=this.isBackground?h:"0"}else a===s.ABOVE_SLIDE?t.style.bottom="100%":a===s.UNDER_SLIDE&&(t.style.top="100%")},t.prototype.setTextStyles=function(t,e){t.innerHTML=e.value;var i=e.font,n=i.family,s=i.size,o=i.color,r=i.backgroundColor,a=i.shadowColor,u=e.position;t.style.fontFamily=n,t.style.fontSize=(this.isBackground?this.getBackgroundFontSize(s):s)+"px",t.style.color=o,r&&(t.style.backgroundColor=r),a&&(t.style.textShadow="1px 1px 2px "+a),t.style.textAlign=u.x.toLowerCase()},t.prototype.resetTextElement=function(t,e){t.removeAttribute("style"),e.innerHTML="",e.removeAttribute("style")},t.prototype.getBackgroundFontSize=function(t){var e=1024,i=1.5,n=Math.min(window.innerWidth/e,i);return t*n},t.prototype.removeText=function(){this.resetTextElement(this.insideTextWrapperElement,this.insideTextElement),this.resetTextElement(this.outsideTextWrapperElement,this.outsideTextElement)},t.prototype.updateText=function(t,e){if(!t)return void this.removeText();var i=[s.ABOVE_SLIDE,s.UNDER_SLIDE].includes(t.position.y)||this.isBackground;this.removeText();var n=i?this.outsideTextWrapperElement:this.insideTextWrapperElement,o=i?this.outsideTextElement:this.insideTextElement;this.setTextWrapperStyles(n,t,e),this.setTextStyles(o,t),this.isBackground||this.parentElement.classList.toggle("is-overflow-visible",i)},t}();i.SlideText=o},{}],56:[function(t,e,i){"use strict";var n=this&&this.__assign||Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++){e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t};Object.defineProperty(i,"__esModule",{value:!0});var s,o=t("./Pagination"),r=t("./SlideText"),a=t("../../utils/youtube"),u=t("../../utils/isTouchSupported");!function(t){t.IN_PAGE="IN_PAGE",t.SPREAD_BACKGROUND="SPREAD_BACKGROUND",t.FULLSCREEN_BUTTON="FULLSCREEN_BUTTON"}(s=i.SliderType||(i.SliderType={}));var l;!function(t){t.IMAGE="IMAGE",t.MOVIE="MOVIE"}(l=i.SlideType||(i.SlideType={}));var h;!function(t){t.IFRAME="IFRAME",t.VIDEO="VIDEO"}(h||(h={}));var p=1e3,c=function(){function t(t,e,i,n,s,o){this.fakeFullscreenElementId="webpublication-pswp-fake-fullscreen",this.options={index:0,loop:!0,closeEl:!1,closeOnScroll:!1,closeOnVerticalDrag:!1,pinchToClose:!1,tapToClose:!1,clickToCloseNonZoomable:!1,closeElClasses:[],escKey:!1,zoomEl:!1,counterEl:!1,arrowEl:!1,captionEl:!1,fullscreenEl:!1,shareEl:!1,preloaderEl:!1,history:!1,barsSize:{top:0,bottom:0},timeToIdle:2e3,modal:!1,getDoubleTapZoom:void 0,arrowKeys:!1,isClickableElement:function(t){return"VIDEO"===t.tagName}},this.OPTIMAL_RESOLUTION=w.Param.isPhone?1024:2048,this.IS_PORTRAIT=w.Param.isPortrait,this.handleBeforeSlideChange=this.handleBeforeSlideChange.bind(this),this.handleAfterSlideChange=this.handleAfterSlideChange.bind(this),this.handleSliderResize=this.handleSliderResize.bind(this),this.handleSliderDestroy=this.handleSliderDestroy.bind(this),this.handleFullscreenChange=this.handleFullscreenChange.bind(this),this.closeFakeFullscreen=this.closeFakeFullscreen.bind(this),this.handleCloseFullscreenButtonClick=this.handleCloseFullscreenButtonClick.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handleVideoPlaying=this.handleVideoPlaying.bind(this),this.handleVideoPause=this.handleVideoPause.bind(this),this.handleVideoEnd=this.handleVideoEnd.bind(this),this.handleYoutubeStateChange=this.handleYoutubeStateChange.bind(this),this.pageNumber=n,this.hasFullscreen=w.Main.fullScreenManager.hasFullScreen(),this.parentElement=t,this.data=e,this.settings=s,this.className=i,this.type=o,this.addSpreadWrapperStyleObserver(),this.init(t,e)}return t.prototype.init=function(t,e,i){var n=this,o=this.getPageWrapper();if(this.type===s.IN_PAGE&&!o)return this.addContainerSubtreeObserver(function(){n.init(t,e,i),n.observeSpreadWrapperStyle()});this.observeSpreadWrapperStyle(),t.innerHTML=this.getTemplate(),this.sliderElement=t.querySelector(".pswp");var a=this.getSlides(e);void 0!==i&&(this.options.index=i),this.slider=new PhotoSwipe(this.sliderElement,PhotoSwipeUI_Default,a,this.options),this.slider.init(),this.initControls(),void 0===i&&this.startSlideshowIfNeeded();var u=this.slider.currItem,l=u.videoType,h=u.text;l&&this.handleVideos();var p=this.isFakeFullscreenOpened?document.querySelector("#"+this.fakeFullscreenElementId):this.parentElement;this.slideText=new r.SlideText(p,this.type===s.SPREAD_BACKGROUND),this.slideText.updateText(h,this.isSliderInFullscreen()),this.settings&&this.settings.scaleImage&&this.parentElement.classList.add("scale-image"),this.settings&&this.settings.autoplay&&this.settings.autoZoom&&this.addAutoZoomStyles(this.settings),this.slider.listen("beforeChange",this.handleBeforeSlideChange),this.slider.listen("afterChange",this.handleAfterSlideChange),this.slider.listen("resize",this.handleSliderResize),this.slider.listen("destroy",this.handleSliderDestroy),this.stopSwipeEventsPropogation()},t.prototype.initSlidesController=function(){var t=this.sliderElement.querySelector(".pswp__top-bar"),e=1===this.slider.items.length,i=this.settings&&this.settings.fullscreenIcon;e&&!i&&t.classList.add("no-controls"),i&&t.classList.add("has-fullscreen-button");var n="desktop"===w.Param.userAgent.device.type,s=!e&&n;s&&t.classList.add("has-arrows");var r=!e&&this.settings&&this.settings.arrowsVisible;if(r&&t.classList.add("is-visible-arrows"),u.isTouchSupported()){var a=this.slider.currItem.videoType;if(a){var l=this.sliderElement.querySelector(".pswp__top-bar");l.classList.add("is-video-slide")}}this.setSlidesControllerSize(),e||(this.pagination=new o.Pagination(this.sliderElement,this.slider.items.length,this.slider.getCurrentIndex()))},t.prototype.openInFullscreen=function(){return this.hasFullscreen||this.isFakeFullscreenOpened?void this.openNativeFullscreen():void this.openFakeFullscreen()},t.prototype.initControls=function(){var t=this;this.initSlidesController();var e=this.sliderElement.querySelector(".webpublication-pswp__arrow.is-prev"),i=this.sliderElement.querySelector(".webpublication-pswp__arrow.is-next"),n=this.sliderElement.querySelector(".webpublication-pswp__button-fullscreen"),s=this.settings&&this.settings.fullscreenIcon;e.addEventListener("click",function(){t.changeSlideWithFadeEffect(!1)}),i.addEventListener("click",function(){t.changeSlideWithFadeEffect(!0)}),s&&n.addEventListener("click",function(){t.openInFullscreen()});var o=[].slice.call(this.sliderElement.querySelectorAll(".pswp__item"));o.forEach(function(e){e.addEventListener("click",function(e){if(!t.slider.isMainScrollAnimating())return t.hasFullscreen||t.isFakeFullscreenOpened?void(t.isSliderInFullscreen()||e.target.classList.contains("pswp__img")&&t.openNativeFullscreen()):void t.openFakeFullscreen()})}),["mouseleave","touchend"].forEach(function(e){t.sliderElement.addEventListener(e,function(){var e=t.slider.currItem.videoType;t.isSliderInFullscreen()||e||t.startSlideshowIfNeeded()})}),["mouseenter","touchstart"].forEach(function(e){t.sliderElement.addEventListener(e,function(){var e=t.slider.currItem.videoType;t.isSliderInFullscreen()||e||t.stopSlideshowIfNeeded()})})},t.prototype.changeSlideWithFadeEffect=function(t){var e=this;this.sliderElement.classList.add("isTransitioning"),setTimeout(function(){t?e.slider.next():e.slider.prev()},p/2),setTimeout(function(){e.sliderElement.classList.remove("isTransitioning")},p)},t.prototype.setSlidesControllerSize=function(){var t=this.sliderElement.querySelector(".webpublication-pswp__arrow.is-prev"),e=this.sliderElement.querySelector(".webpublication-pswp__arrow.is-next"),i=this.sliderElement.querySelector(".webpublication-pswp__dots"),n=this.sliderElement.querySelector(".webpublication-pswp__button-fullscreen");if(this.isSliderInFullscreen())return t.style.transform="",e.style.transform="",i.style.transform="",void(n.style.transform="");var s=this.getSpreadWrapper();if(s){var o=+s.style.transform.replace("matrix(","").split(",")[0];t.style.transform="scale("+1/o+")",e.style.transform="scale("+1/o+")",i.style.transform="translateX(-50%) scale("+1/o+")",n.style.transform="scale("+1/o+")"}},t.prototype.startSlideshowIfNeeded=function(t){var e=this;if(this.isAutoplayEnabled()&&void 0===this.slideshowIntervalId&&this.data.length>1){var i=1e3*this.settings.autoplayDelay;this.slideshowIntervalId=setInterval(function(){e.changeSlideWithFadeEffect(!0)},i),t&&this.changeSlideWithFadeEffect(!0)}},t.prototype.stopSlideshowIfNeeded=function(){this.slideshowIntervalId&&(clearInterval(this.slideshowIntervalId),this.slideshowIntervalId=void 0)},t.prototype.addAutoZoomStyles=function(t){var e=this.slider.currItem.videoType;e&&this.sliderElement.classList.add("is-video-slide"),this.sliderElement.classList.add("auto-zoom");var i="\n\t\t\t@keyframes "+this.className+"-zoomSlide {\n\t\t\t\t0% {\n\t\t\t\t\ttransform: scale(1);\n\t\t\t\t}\n\t\t\t\t50% {\n\t\t\t\t\ttransform: scale("+(t.autoZoomLevel||1.5)+");\n\t\t\t\t}\n\t\t\t\t100% {\n\t\t\t\t\ttransform: scale(1);\n\t\t\t\t}\n\t\t\t}\n\t\t",n=w.Param.userAgent,o=n.browser,r=n.BROWSER,a=o.name===r.SAFARI,u=o.name===r.EDGE&&o.version<=18,l=a||u?"-webkit-full-screen":"fullscreen",h=this.type===s.SPREAD_BACKGROUND?"#"+this.className+" .pswp.auto-zoom:not(.is-video-slide)":"."+this.className+" .pswp.auto-zoom:not(.is-video-slide):not(:"+l+") .pswp__scroll-wrap",p=2*(t.autoplayDelay||2.5),c="\n\t\t\t"+i+"\n\t\t\t"+h+" {\n\t\t\t\tanimation: "+this.className+"-zoomSlide "+p+"s ease infinite;\n\t\t\t}\n\t\t",d=this.className+"-styles";this.styleElement=document.querySelector("#"+d),this.styleElement||(this.styleElement=document.createElement("style"),this.styleElement.id=d,document.head.appendChild(this.styleElement)),this.styleElement.innerHTML=c},t.prototype.openNativeFullscreen=function(){var t=this;this.fullscreenSliderId=this.className,this.isDocumentInFullscreen()?(this.exitFullscreen(),setTimeout(function(){t.requestSliderFullscreen()},1e3)):this.requestSliderFullscreen()},t.prototype.openFakeFullscreen=function(){this.isFakeFullscreenOpened=!0;var t=document.createElement("div");t.id=this.fakeFullscreenElementId;var e=this.slider.currItem.videoType;e&&t.classList.add("is-video-slide"),document.body.appendChild(t),this.slider.destroy(),this.init(t,this.data,this.slider.getCurrentIndex());var i=this.sliderElement.querySelector(".webpublication-pswp__button.is-close");i.classList.remove("display-none"),i.addEventListener("click",this.closeFakeFullscreen),this.slider.options.getDoubleTapZoom=function(){return 1},this.slider.options.arrowKeys=!0,document.addEventListener("keyup",this.handleKeyUp),this.addUIElementObserver()},t.prototype.closeFakeFullscreen=function(){this.isFakeFullscreenOpened=!1;var t=document.querySelector("#"+this.fakeFullscreenElementId);document.body.removeChild(t);var e=this.sliderElement.querySelector(".webpublication-pswp__button.is-close");e.classList.add("display-none"),e.removeEventListener("click",this.closeFakeFullscreen),document.removeEventListener("keyup",this.handleKeyUp),this.removeUIElementObserver(),this.slider.destroy(),this.init(this.parentElement,this.data,this.slider.getCurrentIndex());var i=this.slider.currItem.videoType;i||this.startSlideshowIfNeeded(),this.clearAfterFullscreenClose()},t.prototype.clearAfterFullscreenClose=function(){this.type===s.FULLSCREEN_BUTTON&&this.stop()},t.prototype.getFullScreenElement=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement},t.prototype.isDocumentInFullscreen=function(){var t=this.getFullScreenElement();return!!t&&t===document.documentElement},t.prototype.isSliderInFullscreen=function(){var t=this.getFullScreenElement();return!!t&&t===this.sliderElement||this.isFakeFullscreenOpened},t.prototype.requestSliderFullscreen=function(){this.sliderElement.requestFullscreen?this.sliderElement.requestFullscreen():this.sliderElement.webkitRequestFullscreen?this.sliderElement.webkitRequestFullscreen():this.sliderElement.msRequestFullscreen&&this.sliderElement.msRequestFullscreen(),document.addEventListener(this.getFullscreenChangeEventName(),this.handleFullscreenChange);
},t.prototype.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},t.prototype.handleFullscreenChange=function(){this.slider.updateSize(!0);var t=document.fullscreenElement||document.webkitIsFullScreen||document.mozFullScreen;t||(document.removeEventListener(this.getFullscreenChangeEventName(),this.handleFullscreenChange),this.clearAfterFullscreenClose())},t.prototype.getTemplate=function(){return'\n\t\t\t<div class="pswp">\n\t\t\t\t<div class="pswp__bg"></div>\n\t\t\t\t<div class="pswp__scroll-wrap">\n\t\t\t\t\t<div class="pswp__container">\n\t\t\t\t\t\t<div class="pswp__item"></div>\n\t\t\t\t\t\t<div class="pswp__item"></div>\n\t\t\t\t\t\t<div class="pswp__item"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="pswp__ui pswp__ui--hidden"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="webpublication-pswp__text-wrapper is-inside">\n\t\t\t\t\t<span class="webpublication-pswp__text is-inside"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="webpublication-pswp__ui">\n\t\t\t\t\t<div class="pswp__top-bar">\n\t\t\t\t\t\t<button class="webpublication-pswp__button-fullscreen">\n\t\t\t\t\t\t\t<div class="svgicon-new fullscreen-1-v4">\n\t\t\t\t\t\t\t\t<svg data-icon="fullscreen-1-v4">\n\t\t\t\t\t\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svgicon-fullscreen-1-v4"></use>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button type="button" class="webpublication-pswp__arrow is-prev">\n\t\t\t\t\t\t\t<div class="svgicon-new svgicon-back-v4">\n\t\t\t\t\t\t\t\t<svg data-icon="back-v4">\n\t\t\t\t\t\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svgicon-back-v4"></use>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button type="button" class="webpublication-pswp__arrow is-next">\n\t\t\t\t\t\t\t<div class="svgicon-new svgicon-back-v4">\n\t\t\t\t\t\t\t\t<svg data-icon="back-v4">\n\t\t\t\t\t\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svgicon-back-v4"></use>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<div class="webpublication-pswp__dots">\n\t\t\t\t\t\t\t<div class="webpublication-pswp__dots-line"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button type="button" class="webpublication-pswp__button is-close display-none">\n\t\t\t\t\t\t<div class="svgicon-new svgicon-close">\n\t\t\t\t\t\t\t<svg data-icon="close">\n\t\t\t\t\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svgicon-close"></use>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="webpublication-pswp__text-wrapper is-outside">\n\t\t\t\t<span class="webpublication-pswp__text is-outside"></span>\n\t\t\t</div>\n\t\t'},t.prototype.getSlides=function(t){var e=this;return t.map(function(i,n){var s=i.isExternalLink,o=i.relUrl,r=i.externalRelUrl,a=i.type,u=i.resolution,h=i.resolutions,p=i.label,c=i.slideText,d="";return d=s?r:w.Utils.resolveVariable(e.hasMediaParam(o)?o:"${media}"+o.replace(/^\/?\d+\//g,"")),a===l.MOVIE||s?e.getVideoSlide(d,p,n,s,1===t.length,c):e.getImageSlide(d,u,h,c)})},t.prototype.getImageSlide=function(t,e,i,n){var s=[1920,1080],o=e?e.split("x"):s,r=o[0],a=o[1],u={width:+r,height:+a},l={src:t,w:+r,h:+a,text:n};if(void 0===i)return l;var h=r?this.getResolutionDimensionDiff(+r):1/0,p=a?this.getResolutionDimensionDiff(+a):1/0,c=this.getClosestResolution(i,u);if(!c)return l;var d=Math.min(h,p),f=c.realWidth&&c.realHeight?Math.min(this.getResolutionDimensionDiff(c.realWidth),this.getResolutionDimensionDiff(c.realHeight)):1/0,m=w.Utils.getFileExtension(t);if(d<=f||"png"===m&&"jpg"===c.extension)return l;var g=c.box?"box-":"",v=t.split("."),y=v.slice(0,-1).join("."),b=y+"_"+g+c.width+"x"+c.height+"."+c.extension,E=c.realWidth?c.realWidth:c.width,S=c.realHeight?c.realHeight:c.height;return{src:b,w:E,h:S,text:n}},t.prototype.getClosestResolution=function(t,e){var i=this,n=this.getBiggerResolutions(t,e);return n&&0===n.length?null:n.reduce(function(t,e){var n=i.calculateMinResolutionDiff(t),s=i.calculateMinResolutionDiff(e);return s<n?e:t})},t.prototype.getBiggerResolutions=function(t,e){var i=this;return t.map(function(t){var s=t.box?i.getRealBoxResolution(t,e):t,o=i.IS_PORTRAIT,r=o?s.height>=i.OPTIMAL_RESOLUTION:s.width>=i.OPTIMAL_RESOLUTION;if(r){var a=!!t.box&&(s.width>e.width||s.height>e.height),u=t.box&&a?e.width:s.width,l=t.box&&a?e.height:s.height;return n({},t,{realHeight:l,realWidth:u})}return null}).filter(Boolean)},t.prototype.calculateMinResolutionDiff=function(t){var e=this.getResolutionDimensionDiff(t.width),i=this.getResolutionDimensionDiff(t.height);return Math.min(e,i)},t.prototype.getRealBoxResolution=function(t,e){var i=e.width/e.height,n={width:t.width,height:t.height},s=Math.ceil(t.height*i),o=Math.ceil(t.width/i);if(0===t.width)n.width=s;else if(0===t.height)n.height=o;else{var r=t.width/t.height,a=e.width>t.width||e.height>t.height,u=t.width>e.width&&t.height>e.height;a?i>r?n.height=o:n.width=s:u&&(t.width>t.height?n.height=o:t.width<t.height&&(n.width=s))}return n},t.prototype.getResolutionDimensionDiff=function(t){return Math.abs(t-this.OPTIMAL_RESOLUTION)},t.prototype.getVideoSlide=function(t,e,i,n,o,r){var u='\n\t\t\t<iframe\n\t\t\t\tid="'+this.className+"-"+i+'-frame"\n\t\t\t\tsrc="'+a.getCorrectYoutubeDomain(t)+'?enablejsapi=1"\n\t\t\t\twidth="100%"\n\t\t\t\theight="100%"\n\t\t\t\tframeBorder="0"\n\t\t\t\tallowFullscreen\n\t\t\t\tallow="autoplay; encrypted-media"\n\t\t\t/>\n\t\t',l="\n\t\t\t<video\n\t\t\t\t"+(this.type===s.SPREAD_BACKGROUND?"":"controls")+"\n\t\t\t\tplaysinline\n\t\t\t\t"+(this.isAutoplayEnabled()?"muted":"")+"\n\t\t\t\t"+(this.isAutoplayEnabled()&&o?"loop":"")+'\n\t\t\t\tdata-label="'+e+'"\n\t\t\t\tstyle="width:100%;height:100%"\n\t\t\t\tposter="'+(w.Utils.getFilenameWithoutExtension(t)+"/cover.jpg")+'"\n\t\t\t>\n\t\t\t\t<source src="'+t+'" />\n\t\t\t</video>\n\t\t';return{html:n?u:l,videoType:n?h.IFRAME:h.VIDEO,text:r}},t.prototype.hasMediaParam=function(t){var e=/\$media\$|\${media}|\$%7Bmedia%7D/;return!!t.match(e)},t.prototype.handleBeforeSlideChange=function(){var t=this.slider.currItem.videoType;if(u.isTouchSupported()){var e=this.sliderElement.querySelector(".pswp__top-bar");e.classList.toggle("is-video-slide",!!t)}if(this.pagination.update(this.slider.getCurrentIndex()),this.stopVideos(),this.isFakeFullscreenOpened){var i=document.querySelector("#"+this.fakeFullscreenElementId);i.classList.toggle("is-video-slide",!!t)}this.sliderElement.classList.toggle("is-video-slide",!!t)},t.prototype.handleAfterSlideChange=function(){var t=this.slider.currItem,e=t.videoType,i=t.text;e&&this.handleVideos(),!this.isAutoplayEnabled()||void 0!==this.slideshowIntervalId||e||this.isSliderInFullscreen()||this.startSlideshowIfNeeded(),this.slideText.updateText(i,this.isSliderInFullscreen())},t.prototype.addContainerSubtreeObserver=function(t){var e=this.getContainerElement();if(e){var i=new MutationObserver(function(){t(),i.disconnect()});i.observe(e,{childList:!0,subtree:!0})}},t.prototype.addSpreadWrapperStyleObserver=function(){var t=this;this.spreadWrapperStyleObserver=new MutationObserver(function(){t.setSlidesControllerSize()})},t.prototype.observeSpreadWrapperStyle=function(){var t=this.getSpreadWrapper();t&&this.spreadWrapperStyleObserver.observe(t,{attributes:!0,attributeFilter:["style"]})},t.prototype.addUIElementObserver=function(){if(!this.uiElementObserver){var t=this.isFakeFullscreenOpened?document.querySelector("#"+this.fakeFullscreenElementId):this.parentElement,e=t.querySelector(".pswp__ui"),i=t.querySelector(".webpublication-pswp__ui"),n="pswp__ui--idle";this.uiElementObserver=new MutationObserver(function(t){for(var s=0,o=t;s<o.length;s++){var r=o[s];"attributes"===r.type&&"class"===r.attributeName&&i.classList.toggle(n,e.classList.contains(n))}}),this.uiElementObserver.observe(e,{attributes:!0,attributeFilter:["class"]})}},t.prototype.removeUIElementObserver=function(){this.uiElementObserver&&this.uiElementObserver.disconnect(),this.uiElementObserver=void 0},t.prototype.getContainerElement=function(){return document.querySelector(".webpub-viewer__epub-container")},t.prototype.getPageWrapper=function(){return document.querySelector(".webpub-viewer__epub-container-spread-zoomable [class*=spread-page-"+this.pageNumber+"]")},t.prototype.getSpreadWrapper=function(){var t=this.getPageWrapper();return t?t.closest(".spread-is-visible .webpub-viewer__epub-container-spread-zoomable"):null},t.prototype.handleSliderResize=function(){var t=this;if(this.type===s.SPREAD_BACKGROUND)return void this.stop();if(this.setSlidesControllerSize(),this.isSliderInFullscreen()||(this.addContainerSubtreeObserver(function(){return t.observeSpreadWrapperStyle()}),this.observeSpreadWrapperStyle()),this.fullscreenSliderId===this.className){var e=w.Param.userAgent.os.name===w.Param.userAgent.OS.MAC,i=w.Param.userAgent.os.name===w.Param.userAgent.OS.ANDROID,n=w.Param.userAgent.os.name===w.Param.userAgent.OS.WINDOWS,o=e||i||n&&w.Param.isApp,r=this.sliderElement.querySelector(".webpublication-pswp__button.is-close");this.isSliderInFullscreen()?(this.stopSlideshowIfNeeded(),w.Param.viewHtml.classList.add("is-slider-full-screen"),this.slider.options.getDoubleTapZoom=function(){return 1},this.slider.options.arrowKeys=!0,document.addEventListener("keyup",this.handleKeyUp),this.addUIElementObserver(),o&&(r.classList.remove("display-none"),r.addEventListener("click",this.handleCloseFullscreenButtonClick))):(this.fullscreenSliderId=void 0,this.startSlideshowIfNeeded(),w.Param.viewHtml.classList.remove("is-slider-full-screen"),this.slider.options.getDoubleTapZoom=void 0,this.slider.options.arrowKeys=!1,document.removeEventListener("keyup",this.handleKeyUp),this.removeUIElementObserver(),o&&(r.classList.add("display-none"),r.removeEventListener("click",this.handleCloseFullscreenButtonClick)));var a=this.slider.currItem.text;this.slideText.updateText(a,this.isSliderInFullscreen())}},t.prototype.handleCloseFullscreenButtonClick=function(){this.exitFullscreen()},t.prototype.handleSliderDestroy=function(){this.spreadWrapperStyleObserver.disconnect(),this.stopSlideshowIfNeeded()},t.prototype.getFullscreenChangeEventName=function(){return void 0!==document.onfullscreenchange?"fullscreenchange":void 0!==document.onwebkitfullscreenchange?"webkitfullscreenchange":void 0!==document.onmsfullscreenchange?"MSFullscreenChange":"fullscreenchange"},t.prototype.stopSwipeEventsPropogation=function(){var t=this,e=["touchstart","touchmove","mousewheel","wheel","DOMMouseScroll"],i=function(t){return t.stopPropagation()};e.forEach(function(e){t.sliderElement.addEventListener(e,i)})},t.prototype.handleKeyUp=function(t){["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)&&t.stopPropagation()},t.prototype.handleVideos=function(){var t=this.slider.currItem,e=t.videoType,i=t.container;if(e===h.VIDEO){var n=i.querySelector("video");w.Utils.addVideoStats(n),w.Param.userAgent.browser.name===w.Param.userAgent.BROWSER.SAFARI&&(n.setAttribute("autoplay",""),n.pause()),this.isAutoplayEnabled()&&(this.stopSlideshowIfNeeded(),n.play(),n.addEventListener("ended",this.handleVideoEnd),n.addEventListener("playing",this.handleVideoPlaying),n.addEventListener("pause",this.handleVideoPause))}else{var s=i.querySelector("iframe");this.isAutoplayEnabled()&&(this.stopSlideshowIfNeeded(),s.src=s.src+"&autoplay=1&mute=1&playsinline=1",document.addEventListener(a.YOUTUBE_STATE_CHANGE_EVENT,this.handleYoutubeStateChange)),this.type&&(s.src=s.src+"&controls=0"),a.addYoutubeTrackStateChange(s)}},t.prototype.handleVideoPlaying=function(){if(u.isTouchSupported()){var t=this.sliderElement.querySelector(".pswp__top-bar");t.classList.add("is-video-playing")}},t.prototype.handleVideoPause=function(){if(u.isTouchSupported()){var t=this.sliderElement.querySelector(".pswp__top-bar");t.classList.remove("is-video-playing")}},t.prototype.handleVideoEnd=function(){this.isSliderInFullscreen()||this.startSlideshowIfNeeded(!0)},t.prototype.handleYoutubeStateChange=function(t){t.detail.state===a.YoutubePlayerState.PLAYING&&this.handleVideoPlaying(),t.detail.state===a.YoutubePlayerState.PAUSED&&this.handleVideoPause(),t.detail.state===a.YoutubePlayerState.ENDED&&this.handleVideoEnd()},t.prototype.stopVideos=function(){var t=this,e=[].slice.call(this.sliderElement.querySelectorAll("video, iframe"));e.forEach(function(e){e instanceof HTMLVideoElement&&(e.pause(),e.removeEventListener("playing",t.handleVideoPlaying),e.removeEventListener("pause",t.handleVideoPause),e.removeEventListener("ended",t.handleVideoEnd)),e instanceof HTMLIFrameElement&&e.contentWindow&&e.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*")})},t.prototype.isAutoplayEnabled=function(){return!!(this.settings&&this.settings.autoplay&&this.settings.autoplayDelay)},t.prototype.stop=function(){this.slider&&(this.stopVideos(),this.slider.close(),this.stopSlideshowIfNeeded(),document.removeEventListener(a.YOUTUBE_STATE_CHANGE_EVENT,this.handleYoutubeStateChange),this.styleElement&&this.styleElement.remove(),this.sliderElement.remove(),this.slideText.removeText())},t}();i.Slider=c},{"../../utils/isTouchSupported":80,"../../utils/youtube":81,"./Pagination":54,"./SlideText":55}],57:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./Slider/index"),s="plugin-slider";i.SLIDER_CLASSNAME=s;var o=function(){function t(t,e,i){this.htmlSliders=t,this.data=e,this.sliders=[],this.init(i)}return t.prototype.init=function(t){for(var e=0,i=this.htmlSliders.length;e<i;e++){var o=[].slice.call(this.htmlSliders[e].classList),r=o.find(function(t){return t.includes(s)});if(r){var a=this.data[r],u=null;a&&("settings"in a&&(u=a.settings),"slides"in a&&(a=a.slides),a.length>0&&this.sliders.push(new n.Slider(this.htmlSliders[e],a,r,t,u,n.SliderType.IN_PAGE)))}}},t.prototype.stop=function(){for(var t=0,e=this.sliders.length;t<e;t++)this.sliders[t].stop()},t}();i.Sliders=o},{"./Slider/index":56}],58:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./EpubPage"),s=t("./utils/enums"),o=function(){function t(t,e,i){this.epubSpreads=t,this.config=e,this.epubCssManager=i,this.currentPage=0,this.pageQuantity=0,this.imagesMdpi=s.PagesImagesQualities[s.PagesImagesQualities.mdpi],this.imagesHdpi=s.PagesImagesQualities[s.PagesImagesQualities.hdpi],this.parent=this.epubSpreads,this.currentPage=this.config.currentPage,this.pageQuantity=this.config.pageQuantity,this.setPagesObject()}return Object.defineProperty(t.prototype,"readerPageSrcType",{get:function(){return this.config.readerPageSrcType},enumerable:!0,configurable:!0}),t.prototype.setPagesQty=function(){this.epubPages=new Array(this.pageQuantity),this.epubPagesRequested=new Array(this.pageQuantity)},t.prototype.setPageObject=function(t,e){return this.readerPageSrcType===s.READER_TYPES.EPUB_HTML?void(t.src=w.Main.pageManager.getEpubHtml(e)):this.readerPageSrcType===s.READER_TYPES.PDF_HTML?void(t.src=w.Main.pageManager.getPdfHtml(e)):this.readerPageSrcType===s.READER_TYPES.PDF_SVG?void(t.src=w.Main.pageManager.getSvg(e)):this.readerPageSrcType===s.READER_TYPES.PDF_IMG?(t.srcHdpi=w.Main.pageManager.getImage(this.imagesHdpi,e),void(t.src=w.Main.pageManager.getImage(this.imagesMdpi,e))):this.readerPageSrcType===s.READER_TYPES.PDF_PDF?void(t.src=w.Main.pageManager.getPdf(e)):void 0},t.prototype.setPagesObject=function(){this.setPagesQty();for(var t=0;t<this.pageQuantity;t++)this.epubPages[t]=new n["default"](this,this.config,t+1,this.epubCssManager),this.setPageObject(this.epubPages[t],t+1)},t.prototype.pageExist=function(t){return"undefined"!=typeof this.epubPages[t]},t.prototype.pageGetForSpread=function(t){return this.epubPagesRequested[t]=!0,this.epubPages[t]},t.prototype.pageGet=function(t){return this.epubPages[t]},t.prototype.resetRequested=function(){for(var t=0,e=this.pageQuantity;t<e;t++)this.epubPagesRequested[t]=!1},t.prototype.flushNotRequested=function(){for(var t=0,e=this.pageQuantity;t<e;t++)this.epubPagesRequested[t]===!1&&this.epubPages[t].flush()},t}();i["default"]=o},{"./EpubPage":17,"./utils/enums":77}],59:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(t,e,i){this.epubScrollables=t,this.config=e,this.epubSpread=i,this.x=0,this.y=0,this.parent=this.epubScrollables,this.screenSize=this.parent.screenSize,this.mainViewElementSize=this.parent.mainViewElementSize}return t}();i["default"]=n},{}],60:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./EpubScrollable"),s=t("./EpubGesturesEvent"),o=t("./EpubConfig/EpubDefaultConfig"),r=function(){function t(t,e,i,n){this.epubSpreads=t,this.config=e,this.mainViewElement=i,this.clickPermissionManager=n,this.xStart=0,this.yStart=0,this.parent=this.epubSpreads,this.screenSize=this.epubSpreads.screenSize,this.mainViewElementSize=this.epubSpreads.mainViewElementSize,this.element=i,this.scrollables=[],this.epubGesturesEvent=new s["default"](this,this.element),this.spreadDraggable&&(this.epubGesturesEvent.addEventListener(s["default"].GESTURESNAME.SWIPEGESTURE,this.trySwip.bind(this)),this.epubGesturesEvent.addEventListener(s["default"].GESTURESNAME.PANGESTURE,this.tryDrag.bind(this)),this.epubGesturesEvent.addEventListener(s["default"].GESTURESNAME.MOUSEWHEELGESTURE,this.onMouseWheel.bind(this))),this.setEnableScrollElement()}return t.prototype.setEnableScrollElement=function(){this.epubGesturesEvent.setEnableScrollElement(this.config.hasCrossNavPage())},Object.defineProperty(t.prototype,"spreadDraggable",{get:function(){return this.config.spreadDraggable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"navigationAxis",{get:function(){return this.config.navigationAxis},enumerable:!0,configurable:!0}),t.prototype.onMouseWheel=function(e){var i=Date.now(),n=0;this.navigationAxis===o.NavigationAxis.X&&e.gestureData.wheel.isX?n=e.deltaX:this.navigationAxis===o.NavigationAxis.Y&&e.gestureData.wheel.isY&&(n=e.deltaY),n>0?n=1:n<0&&(n=-1),t.mouseWheelLastDelta=n,t.mouseWheelLast=i,n>0?this.epubSpreads.epubManager.pageNext():n<0&&this.epubSpreads.epubManager.pagePrevious()},t.prototype.initDrag=function(t,e){this.xStart=t,this.yStart=e},t.prototype.drag=function(t,e){return[t-this.xStart,e-this.yStart]},t.prototype.updateScrollablesDrop=function(t,e){0===e[0]&&0===e[1]||this.epubSpreads.gotoPageByCoordsDiff(t.gestureData)},t.prototype.updateScrollables=function(t,e){this.epubSpreads.scrollTo(e[0],e[1])},t.prototype.trySwip=function(t){this.clickPermissionManager.resetActions(),t.defaultPreventGesture=!0,this.updateScrollablesDrop(t,this.drag(t.epubClientX,t.epubClientY))},t.prototype.tryDrag=function(t){this.clickPermissionManager.resetActions(),t.defaultPreventGesture=!0,0===t.gestureData.x.pointDiff&&0===t.gestureData.y.pointDiff&&this.initDrag(t.epubClientX,t.epubClientY),this.updateScrollables(t,this.drag(t.epubClientX,t.epubClientY))},t.prototype.addScrollable=function(t){this.scrollables.push(new n["default"](this,this.config,t))},t.mouseWheelLast=0,t.mouseWheelLastDelta=0,t}();i["default"]=r},{"./EpubConfig/EpubDefaultConfig":5,"./EpubGesturesEvent":10,"./EpubScrollable":59}],61:[function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(s,o){function r(t){try{u(n.next(t))}catch(e){o(e)}}function a(t){try{u(n["throw"](t))}catch(e){o(e)}}function u(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(r,a)}u((n=n.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,o=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(r=u.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){u.label=i[1];break}if(6===i[0]&&u.label<r[1]){u.label=r[1],r=i;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(i);break}r[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(n){i=[6,n],o=0}finally{s=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,o,r,a,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(i,"__esModule",{value:!0});var o,r=t("./EpubSpreadZoomable"),a=t("./ProtoHTMLElement"),u=t("./EpubEvent");!function(t){t.LEFT="left",t.CENTER="center",t.RIGHT="right"}(o=i.SpreadAlignment||(i.SpreadAlignment={}));var l=function(){function t(t,e,i,n){var s=this;this.epubSpreads=t,this.config=e,this.spreadIndex=i,this.mainViewElement=n,this.optimizeQuality=!0,this.cssClassSpreadVisible="spread-is-visible",this.lastOffset=0,this.pageIndexes=[],this.spreadOffset=0,this.initSpreadContent=this.initSpreadContent.bind(this),this.parent=this.epubSpreads,this.epubEvent=w.epubEvent,this.screenSize=this.parent.screenSize,this.mainViewElementSize=this.parent.mainViewElementSize,this.pagesInSpread=[],this.elementSize={width:0,height:0},this.epubSpreadZoomable=new r["default"](this,this.config),this.spreadHTMLElement=new a["default"](this.config),this.spreadHTMLElement.initSpread(this,this.config,this.epubSpreadZoomable,this.spreadIndex),this.element=this.spreadHTMLElement.element,this.spreadHTMLElement.optimizeQuality=this.optimizeQuality,this.config.isVerticalOnePage?this.epubEvent.addListener(u.EPUB_EVENTS.VISIBLE_SPREADS_CHANGE,function(t){s.updateContent(t.data.pageNumbers)}):this.epubEvent.addListener(u.EPUB_EVENTS.PAGE_CHANGE,function(t){t.data.pageChanged&&s.updateContent([t.data.pageNumber])});var o="configsJson.pageDataUpdated";document.addEventListener(o,this.onPageDataUpdate.bind(this))}return t.prototype.initSpreadContent=function(t){var e=this;if(this.spreadHTMLElement.setSpreadScrollable(this.config.isCrossNavPage(this.currentPage)),this.element){var i=this.element.querySelector("video.spread-bgVideo");if(i){var n=t.some(function(t){return e.pageIndexes.includes(t-1)});if(n){try{i.paused&&(i.currentTime=0)}catch(s){}i.play()}else i.pause()}}},Object.defineProperty(t.prototype,"width",{get:function(){return this.elementSize.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.elementSize.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPage",{get:function(){return this.config.currentPage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageQuantity",{get:function(){return this.config.pageQuantity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstSpreadSize",{get:function(){return this.config.firstSpreadSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"epubPages",{get:function(){return this.parent.epubPages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pagesBySpread",{get:function(){return this.pageIndexes.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"coverPageCenter",{get:function(){return this.config.coverPageCenter},enumerable:!0,configurable:!0}),t.prototype.getSpreadAlignment=function(t,e){var i=2===e;if(i)return o.CENTER;var n=w.Main.configsJsonManager.getPageData(["showAlone","showAloneSide"],t-1),s=n.showAlone,r=n.showAloneSide;if(s){if("left"===r)return o.LEFT;if("right"===r)return o.RIGHT}var a=1===t&&this.coverPageCenter===!1;return a?o.RIGHT:o.CENTER},t.prototype.updatePages=function(t){return n(this,void 0,void 0,function(){var e,i,n,o,r,a,u=this;return s(this,function(s){if(e=0,i=t.length,n=!1,0===i)return this.epubSpreadZoomable.resetContent(),this.epubSpreadZoomable.element.classList.contains("epub-all-pages-loaded")&&this.epubSpreadZoomable.element.classList.remove("epub-all-pages-loaded"),[2];for(this.config.isVerticalOnePage||this.updateContent([this.currentPage]),this.pagesInSpread=t,this.epubSpreadZoomable.contentLength!==i&&(n=!0);e<i;e++)this.epubSpreadZoomable.lastContentIDs.indexOf(this.pagesInSpread[e].pageNumber)===-1&&(n=!0);for(n===!0&&(this.epubSpreadZoomable.resetContent(),this.epubSpreadZoomable.element.classList.contains("epub-all-pages-loaded")&&this.epubSpreadZoomable.element.classList.remove("epub-all-pages-loaded")),this.epubSpreadZoomable.contentLength=i,o=this.getSpreadAlignment(this.pagesInSpread[0].pageNumber,i),this.epubSpreadZoomable.contentPosition=o,r=[],a=!1,e=0;e<i;e++)this.pagesInSpread[e].atSpreadOffset=this.spreadOffset,n===!0?r.push(this.epubSpreadZoomable.updateContent(this.pagesInSpread[e])):this.pagesInSpread[e].epubPageEnrichmentStat(),this.pagesInSpread[e].pageContainsCPUElement===!0&&(a=!0);return this.epubSpreadZoomable.setContainIframe(a),Promise.all(r).then(function(){0!==i&&u.epubSpreadZoomable.element.classList.contains("epub-all-pages-loaded")===!1&&u.epubSpreadZoomable.element.classList.add("epub-all-pages-loaded")}),[2]})})},t.prototype.displaySpread=function(){this.mainViewElement.appendChild(this.element)},t.prototype.updateSpread=function(t,e){var i;this.lastOffset=this.spreadOffset,this.spreadOffset=t,this.pageIndexes=e,i=this.getPages(this.pageIndexes),this.epubSpreadZoomable.reset(),this.spreadHTMLElement.element.setAttribute("pages",i.length.toString()),this.updatePages(i)},t.prototype.updateSpreadSize=function(){this.elementSize.width=this.element.offsetWidth,this.elementSize.height=this.element.offsetHeight,this.epubSpreadZoomable.updateSize(),this.elementSize.width=this.element.offsetWidth,this.elementSize.height=this.element.offsetHeight},t.prototype.getPages=function(t){var e=this;return t.map(function(t){return e.epubPages.pageGetForSpread(t)})},t.prototype.updateContent=function(t){this.updateVisibility(t),this.initSpreadContent(t)},t.prototype.updateVisibility=function(t){var e=this.isVisibleSpread(t);this.updateVisibleSpreadClass(e),this.setBackgrounds()},t.prototype.isVisibleSpread=function(t){var e=this.getPages(this.pageIndexes),i=e.map(function(t){return t.pageNumber}),n=i.filter(function(e){return t.includes(e)});return n.length>0},t.prototype.updateVisibleSpreadClass=function(t){this.spreadHTMLElement.element.classList.toggle(this.cssClassSpreadVisible,t)},t.prototype.setBackgrounds=function(){var t=this.getPages(this.pageIndexes),e=t.map(function(t){return t.pageNumber});this.spreadHTMLElement.setBackground(e)},t.prototype.onPageDataUpdate=function(){this.setBackgrounds()},t.prototype.updateIframesZoom=function(t){this.pagesInSpread.forEach(function(e){return e.updateIframesZoom(t)})},t}();i["default"]=l},{"./EpubEvent":8,"./EpubSpreadZoomable":62,"./ProtoHTMLElement":69}],62:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./EpubConfig/EpubDefaultConfig"),s=t("./EpubEvent"),o=t("./EpubSpread"),r=t("./ProtoHTMLElement"),a=t("./EpubSpreadZoomableAnimations"),u=t("./EpubZoom"),l=t("./EpubGesturesEvent"),h=t("./utils/functions"),p=function(){function t(t,e){var i,h=this;this.epubSpread=t,this.config=e,this.contentLength=0,this.contentPosition=o.SpreadAlignment.CENTER,this.scale=0,this._x=0,this._y=0,this.widthScaled=0,this.heightScaled=0,this.savedEvent=null,this.paddingLeft=0,this.paddingRight=0,this.paddingTop=0,this.paddingBottom=0,this.epubEvent=w.epubEvent,this.parent=this.epubSpread,this.screenSize=this.epubSpread.screenSize,this.mainViewElementSize=this.epubSpread.mainViewElementSize,this.updateSize=this.updateSize.bind(this),this.lastContentIDs=[],this._pageSizeType=(i={},i[n.PagesSizeTypes.CONTAIN]=this.pageTypeContain.bind(this),i[n.PagesSizeTypes.COVER_HORIZONTALLY]=this.coverHorizontally.bind(this),i),this.elementSize={width:0,height:0},this.epubZoom=new u["default"](this,this.config),this.spreadZoomableHTMLElement=new r["default"](this.config),this.spreadZoomableHTMLElement.initZoomable(this,this.config),this.element=this.spreadZoomableHTMLElement.element,this.epubSpreadZoomableAnimations=new a["default"](this,this.config,this.spreadZoomableHTMLElement),this.epubGesturesEvent=new l["default"](this,this.spreadZoomableHTMLElement.element),this.zoomDoubleClick===!0&&this.epubGesturesEvent.addEventListener(l["default"].GESTURESNAME.DBLTAPGESTURE,this.tryZoom.bind(this)),this.zoomSingleClick===!0&&(this.epubEvent.addListener(s.EPUB_EVENTS.PAGE_CLICK,this.tryZoomOneClick.bind(this)),this.epubGesturesEvent.addEventListener(l["default"].GESTURESNAME.TAPGESTURE,this.saveEvent.bind(this))),this.epubGesturesEvent.addEventListener(l["default"].GESTURESNAME.PANGESTURE,this.tryDrag.bind(this)),this.setEnableScrollElement(),this.epubEvent.addListener(s.EPUB_EVENTS.PAGE_CHANGE,function(){h.setEnableScrollElement(),h.updateSize()})}return t.prototype.setEnableScrollElement=function(){this.epubGesturesEvent.setEnableScrollElement(this.config.isCrossNavPage(this.spreadFirstPage))},Object.defineProperty(t.prototype,"spreadFirstPage",{get:function(){return this.parent.pageIndexes[0]+1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomDoubleClick",{get:function(){return this.config.zoomDoubleClick},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomSingleClick",{get:function(){return this.config.zoomSingleClick},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultPageScaleAt",{get:function(){return this.config.defaultPageScaleAt},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentWidth",{get:function(){return this.parent.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentHeight",{get:function(){return this.parent.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spreadOffset",{get:function(){return this.parent.spreadOffset},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.config.isVerticalOnePage?w.Main.xmlManager.get("common-configuration","contents","epub-HTML","width")*this.epubSpread.pageIndexes.length:this.elementSize.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.config.isVerticalOnePage?w.Main.xmlManager.get("common-configuration","contents","epub-HTML","height"):this.elementSize.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageSizeType",{get:function(){var t=this.config.pageSizeType,e=this.config.isCrossNavPage(this.spreadFirstPage);return e&&(t=n.PagesSizeTypes.COVER_HORIZONTALLY),"function"==typeof this._pageSizeType[t]?this._pageSizeType[t]:this._pageSizeType.contain},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useMatrixTransform",{get:function(){return this.config.useMatrixTransformZoomable},enumerable:!0,configurable:!0}),t.prototype.roundPxDevice=function(t){return~~(100*t)/100},t.prototype.coverHorizontally=function(){return this.updateEpubContainerForCrossNav(),this.updateSpreadPositioning(!0)},t.prototype.pageTypeContain=function(){return this.updateSpreadPositioning(!1)},t.prototype.updateEpubContainerForCrossNav=function(){var t=".webpub-viewer__epub-container-spread-page",e=this.spreadZoomableHTMLElement.element.querySelector(t);if(e){var i=".webpub-viewer__epub-container-spread-page-sub",n=e.querySelector(i);if(n){var s=this.getPageHeight(e,n);n.style.height=s+"px"}}},t.prototype.getPageHeight=function(t,e){var i=t.className,n=i.match(/spread-page-(\d+)/);if(n){var s=Number(n[1])-1,o=w.Main.configsJsonManager.getPageData(["height"],s).height;if(o)return o}return this.calculatePageHeight(e)},t.prototype.calculatePageHeight=function(t){
var e=this.spreadZoomableHTMLElement.scale,i=t.getAttribute("data-original-height");i||(i=t.offsetHeight.toString(),t.setAttribute("data-original-height",i));for(var n=parseInt(i),s=t.children,o=this.spreadZoomableHTMLElement.element.getBoundingClientRect().top,r=0;r<s.length;r++){var a=s[r],u=a.getBoundingClientRect(),l=(u.height+u.top-o)/e;n=Math.max(n,l)}return n},t.prototype.updateSpreadPositioning=function(t){var e=0,i=0,n=0;if(0===this.width||0===this.height)return!1;var s=this.config.isVerticalOnePage;e=Math.min(this.getHorizontalScale(),this.getVerticalScale(t,s));var o=w.Main.startupManager.get("core.maxPageScale");return o&&(e=Math.min(e,o)),this.widthScaled=e*this.width,this.heightScaled=e*this.height,s&&(this.epubSpread.element.style.height=this.heightScaled+"px"),i=this.getSpreadXCoordinate(),n=this.getSpreadYCoordinate(s),this.scale!==e&&(this.scale=e,this._x=i,this._y=n,this.updateSizeFromPoint([e,0,0,i,n])),!0},t.prototype.getHorizontalScale=function(){return(this.parentWidth-this.paddingLeft-this.paddingRight)/this.width},t.prototype.getVerticalScale=function(t,e){return t||e?1:(this.parentHeight-this.paddingTop-this.paddingBottom)/this.height},t.prototype.getSpreadXCoordinate=function(){var t=.5*(this.parentWidth+this.paddingLeft-this.paddingRight);if(this.contentPosition===o.SpreadAlignment.LEFT){var e=t-this.widthScaled,i=this.paddingLeft,n=Math.max(i,e);return this.roundPxDevice(n)}if(this.contentPosition===o.SpreadAlignment.RIGHT){var s=this.parentWidth-this.paddingRight-this.widthScaled,n=Math.min(s,t);return this.roundPxDevice(n)}var r=t-.5*this.widthScaled;return this.roundPxDevice(r)},t.prototype.getSpreadYCoordinate=function(t){if(t)return 0;var e=.5*(this.parentHeight+this.paddingTop-this.paddingBottom),i=this.heightScaled+this.paddingTop+this.paddingBottom>=this.parentHeight;if(i)return this.paddingTop;var n=e-.5*this.heightScaled;return this.roundPxDevice(n)},t.prototype.updateSizeFromPointAnimation=function(t){this.epubSpreadZoomableAnimations.animateScale(t,this.spreadOffset)},t.prototype.updateSizeFromPoint=function(t){this.epubSpreadZoomableAnimations.scaleDrag(t,this.spreadOffset)},t.prototype.saveEvent=function(t){if(t.target.classList.contains("epub-link-type_iframe")!==!0||t.target.classList.contains("epub-link-visible")!==!0){var e=t.target;return l["default"].preventAllGestureStatus()===!0||h.isMediaElement(e)?void(this.savedEvent=null):void(this.savedEvent=t)}},t.prototype.tryZoomOneClick=function(t){var e=this.savedEvent;return null===e||l["default"].preventAllGestureStatus()===!0?void(this.savedEvent=null):(this.savedEvent=null,void this.tryZoom(e))},t.prototype.tryZoom=function(t){var e=h.getBoundingClientRect(this.spreadZoomableHTMLElement.element,this.useMatrixTransform?1:this.scale),i=this.epubZoom.scale;return t.defaultPreventGesture=!0,0!==i?(this.updateSizeFromPointAnimation(this.epubZoom.resetZoom()),void this.epubEvent.fire({type:s.EPUB_EVENTS.PAGE_ZOOM,data:{status:!1,scale:this.epubZoom.scale}})):void(0===this.spreadOffset&&(this.updateSizeFromPointAnimation(this.epubZoom.getZoom(t,this.defaultPageScaleAt,t.epubClientX,t.epubClientY,e)),0===i&&this.epubEvent.fire({type:s.EPUB_EVENTS.PAGE_ZOOM,data:{status:!0,scale:this.epubZoom.scale}})))},t.prototype.getBoundingClientRect=function(t){return void 0===t&&(t=this.spreadZoomableHTMLElement.element),h.getBoundingClientRect(t,this.useMatrixTransform?1:this.scale)},t.prototype.zoomToggle=function(t){var e=this.getBoundingClientRect(),i=e.left+e.width*t.x,n=e.top+e.height*t.y,o=t.scale;return 0===o?(t.animate===!0?this.updateSizeFromPointAnimation(this.epubZoom.resetZoom()):this.updateSizeFromPoint(this.epubZoom.resetZoom()),void this.epubEvent.fire({type:s.EPUB_EVENTS.PAGE_ZOOM,data:{status:!1,scale:this.epubZoom.scale}})):(t.animate===!0?this.updateSizeFromPointAnimation(this.epubZoom.getZoomNoEvent(o,i,n,e)):this.updateSizeFromPoint(this.epubZoom.getZoomNoEvent(o,i,n,e)),void this.epubEvent.fire({type:s.EPUB_EVENTS.PAGE_ZOOM,data:{status:!0,scale:this.epubZoom.scale}}))},t.prototype.zoomByStep=function(t){var e={x:t.x,y:t.y,scale:this.epubZoom.scale+t.step,animate:t.animate};this.zoomToggle(e)},t.prototype.zoomProgress=function(t){this.zoomToggle(t)},t.prototype.tryDrag=function(t){var e,i;this.config.isVerticalOnePage||0===this.epubZoom.scale&&0===t.gestureData.pinchZoomDiff||(e=this.getBoundingClientRect(),t.defaultPreventGesture=!0,0===t.gestureData.x.pointDiff&&0===t.gestureData.y.pointDiff?this.epubZoom.initdrag(t,t.epubClientX,t.epubClientY,e):(0===t.gestureData.x.pointDiff&&this.epubZoom.initdragX(t,t.epubClientX,e),0===t.gestureData.y.pointDiff&&this.epubZoom.initdragY(t,t.epubClientY,e)),i=this.epubZoom.scale+t.gestureData.pinchZoomDiff*this.config.zoomFactor,this.epubZoom.getZoom(t,i,t.epubClientX,t.epubClientY,e),this.updateSizeFromPoint(this.epubZoom.drag(t,t.epubClientX,t.epubClientY)))},t.prototype.reset=function(){var t=this.epubZoom.scale;this.updateSizeFromPoint(this.epubZoom.resetZoom()),0===t&&this.epubEvent.fire({type:s.EPUB_EVENTS.PAGE_ZOOM,data:{status:!1,scale:this.epubZoom.scale}})},t.prototype.resetContent=function(){this.lastContentIDs=[],this.spreadZoomableHTMLElement.removeChilren()},t.prototype.updateContent=function(t){var e=this;this.lastContentIDs.push(t.pageNumber);var i=t.syncElemWithSpread(this.spreadZoomableHTMLElement.element);return this.spreadZoomableHTMLElement.element.appendChild(i.element),this.config.isCrossNavPage(this.parent.currentPage)&&(clearTimeout(this.timeoutId2),this.timeoutId2=setTimeout(function(){e.spreadZoomableHTMLElement.scrollToTop()},0)),t.onload=this.updateSize,i.loaded},t.prototype.setContainIframe=function(t){var e=this;this.spreadZoomableHTMLElement.element.setAttribute("contains-iframe",t?"yes":"no"),setTimeout(function(){return e.updateIframesZoomIfNeeded(e.scale)},100)},t.prototype.getElement=function(){return this.spreadZoomableHTMLElement.element},t.prototype.updateSize=function(){var t=this;this.scale=0,this.paddingLeft=this.config.paddingLeft,this.paddingRight=this.config.paddingRight,this.paddingTop=this.config.paddingTop,this.paddingBottom=this.config.paddingBottom,this.elementSize.width=this.spreadZoomableHTMLElement.element.offsetWidth,this.elementSize.height=this.spreadZoomableHTMLElement.element.offsetHeight,this.pageSizeType()===!1?(clearTimeout(this.timeoutId),this.timeoutId=setTimeout(this.updateSize,16)):setTimeout(function(){return t.updateIframesZoomIfNeeded(t.scale)},100)},t.prototype.updateIframesZoomIfNeeded=function(t){this.config.useMatrixTransformZoomable||this.epubSpread.updateIframesZoom(t)},t}();i["default"]=p},{"./EpubConfig/EpubDefaultConfig":5,"./EpubEvent":8,"./EpubGesturesEvent":10,"./EpubSpread":61,"./EpubSpreadZoomableAnimations":63,"./EpubZoom":67,"./ProtoHTMLElement":69,"./utils/functions":78}],63:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./utils/cssAnimations"),s=1e-4,o=.3,r=function(){function t(t,e,i){this.epubSpreadZoomable=t,this.config=e,this.spreadZoomableHTMLElement=i,this.fromPosition={x:0,y:0,scale:0},this.toPosition={x:0,y:0,scale:0},this.elementData={prc:0},this.epubTweens=new Tween(this.elementData,"prc",Tween.regularEaseInOut,0,0,s),this.epubTweens.onMotionChanged=this.tweenUpdate.bind(this)}return t.prototype.animationDomAsync=function(t,e,i,s,o){this.config.useMatrixTransformZoomable?n.matrixAsync(this.config.use3DMatrixTransform,t,e,i,s,o):n.positionDomAsync(t,e,i,s,o),this.epubSpreadZoomable.updateIframesZoomIfNeeded(e)},t.prototype.tweenUpdate=function(t){this.fromPosition.scale+=(this.toPosition.scale-this.fromPosition.scale)*t.target._pos,this.fromPosition.x+=(this.toPosition.x-this.fromPosition.x)*t.target._pos,this.fromPosition.y+=(this.toPosition.y-this.fromPosition.y)*t.target._pos,this.animationDomAsync(this.spreadZoomableHTMLElement,this.fromPosition.scale,this.fromPosition.x,this.fromPosition.y,0)},t.prototype.tweenUpdateZero=function(){this.animationDomAsync(this.spreadZoomableHTMLElement,this.toPosition.scale,this.toPosition.x,this.toPosition.y,0)},t.prototype.setOptimizequality=function(t){return 0===t?void(this.spreadZoomableHTMLElement.optimizeQuality=!0):void(this.spreadZoomableHTMLElement.optimizeQuality=!1)},t.prototype.animateScale=function(t,e){this.setOptimizequality(e),this.toPosition.scale=t[0],this.toPosition.x=t[3],this.toPosition.y=t[4],this.epubTweens.stop(),this.epubTweens._pos=0,this.epubTweens.continueTo(1,o)},t.prototype.scaleDrag=function(t,e){this.setOptimizequality(e),this.fromPosition.scale=this.toPosition.scale=t[0],this.fromPosition.x=this.toPosition.x=t[3],this.fromPosition.y=this.toPosition.y=t[4],this.epubTweens.stop(),this.epubTweens._pos=1,this.tweenUpdateZero()},t}();i["default"]=r},{"./utils/cssAnimations":76}],64:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./EpubEvent"),s=t("./EpubSpread"),o=t("./EpubSpreadsAnimations"),r=t("./EpubPages"),a=t("./EpubScrollables"),u=t("./utils/functions"),l=t("./utils/isElementVisible"),h=t("./EpubConfig/EpubDefaultConfig"),p=t("./utils/ScrollUtil"),c=t("./EpubClickPermission"),d=function(){function t(t,e,i,n){this.epubManager=t,this.config=e,this.viewMain=i,this.epubCssManager=n,this.onPublicationScroll=this.onPublicationScroll.bind(this),this.onPageChange=this.onPageChange.bind(this),this.parent=this.epubManager,this.epubEvent=w.epubEvent,this.screenSize=this.epubManager.screenSize,this.mainViewElementSize={width:0,height:0},this.mainViewElementClassName=this.config.mainViewElementClassName,this.epubPages=new r["default"](this,this.config,this.epubCssManager),this.setMainViewElement(),this.generatePublicationSpreads(),this.appendMainViewElementToViewMain();var s=new c["default"](this.mainViewElement);this.config.isVerticalOnePage?this.handleVerticalOnePage():this.epubScrollables=new a["default"](this,this.config,this.mainViewElement,s)}return Object.defineProperty(t.prototype,"currentPage",{get:function(){return this.config.currentPage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastPage",{get:function(){return this.config.lastPage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstSpreadSize",{get:function(){return this.config.firstSpreadSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageQuantity",{get:function(){return this.config.pageQuantity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spreadsLength",{get:function(){return void 0==this.publicationSpreads?-1:this.config.isVerticalOnePage?this.publicationSpreads.length:Math.min(this.publicationSpreads.length,this.config.maxSpreadsLength)},enumerable:!0,configurable:!0}),t.prototype.setVisibleSpreadPages=function(t){var e=this.visibleSpreadsPages,i=!this.areArrayEquals(e,t);i&&(this.visibleSpreadsPages=t,this.epubEvent.fire({type:n.EPUB_EVENTS.VISIBLE_SPREADS_CHANGE,data:{pageNumbers:t}}))},t.prototype.areArrayEquals=function(t,e){return!t&&!e||!(!t||!e)&&(t.length===e.length&&t.every(function(t){return!!e.includes(t)}))},t.prototype.onPageChange=function(t){var e=t.data,i=e.pageNumber,n=e.source;n!==h.PageChangeSource.VERTICAL_ONE_PAGE&&this.scrollToPageNumber(i)},t.prototype.scrollToPageNumber=function(t){var e=this.getSpreadByPageNumber(t);e.element.scrollIntoView()},t.prototype.handleVerticalOnePage=function(){this.verticalScrollUtil=new p["default"](this.mainViewElement);var t=100;this.mainViewElement.addEventListener("scroll",w.Utils.throttle(this.onPublicationScroll,t)),this.epubEvent.addListener(n.EPUB_EVENTS.PAGE_CHANGE,this.onPageChange),this.updateVisibleSpreads(),this.setVerticalOnePageCSS()},t.prototype.setVerticalOnePageCSS=function(){for(var t=0;t<this.epubSpreads.length;t++){var e=this.epubSpreads[t].element;e.style.top="-"+t+"px"}},t.prototype.onPublicationScroll=function(){var t=this.updateVisibleSpreads(),e=!this.verticalScrollUtil.isScrollDown(),i=this.getCurrentSpreadOnScroll(t,e);this.epubManager.goToPage(i.pageIndexes[0]+1,!0,h.PageChangeSource.VERTICAL_ONE_PAGE)},t.prototype.updateVisibleSpreads=function(){var t={top:this.config.paddingTop,bottom:this.config.paddingBottom},e=this.epubSpreads.filter(function(e){return l.isElementVisible(e.element,l.ElementVisibleMode.ANY,t)});return this.setVisibleSpreadPages(e.reduce(function(t,e){return t.concat(e.pageIndexes)},[]).map(function(t){return t+1})),e},t.prototype.getCurrentSpreadOnScroll=function(t,e){var i=Math.floor(t.length/2),n=t.length%2===0;return n&&e&&(i-=1),t[i]},t.prototype.initSpreads=function(t,e){this.clearSpreadsElements();for(var i=0,n=t.length;i<n;i++)t[i]=new s["default"](this,this.config,i,e),this.epubScrollables&&this.epubScrollables.addScrollable(t[i]);this.updateSpreads(0),this.displaySpreads(t)},t.prototype.clearSpreadsElements=function(){for(;this.mainViewElement.lastChild;)this.mainViewElement.removeChild(this.mainViewElement.lastChild)},t.prototype.displaySpreads=function(t){for(var e=0,i=t.length;e<i;e++)t[e].displaySpread()},t.prototype.getMainViewElement=function(){return this.mainViewElement},t.prototype.setMainViewElement=function(){this.mainViewElement=document.createElement("div"),this.mainViewElement.classList.add(this.mainViewElementClassName)},t.prototype.updateMainViewElementSize=function(){this.mainViewElementSize.width=this.mainViewElement.offsetWidth,this.mainViewElementSize.height=this.mainViewElement.offsetHeight,this.mainViewElementSize.rect=u.getBoundingClientRect(this.mainViewElement)},t.prototype.appendMainViewElementToViewMain=function(){this.viewMain.appendChild(this.mainViewElement)},t.prototype.getSpreadByPageNumber=function(t){var e=this.spreadsPageIndexes.findIndex(function(e){return e&&e.includes(t-1)});return this.epubSpreads[e]},t.prototype.getPagesFromSpreadByPageIndex=function(t){return this.publicationSpreads.find(function(e){return e.includes(t)})},t.prototype.getScaleFromCurrentSpread=function(){return this.getSpreadByPageNumber(this.currentPage).epubSpreadZoomable.epubZoom.scale},t.prototype.zoomToggle=function(t){this.getSpreadByPageNumber(this.currentPage).epubSpreadZoomable.zoomToggle(t)},t.prototype.zoomByStep=function(t){this.getSpreadByPageNumber(this.currentPage).epubSpreadZoomable.zoomByStep(t)},t.prototype.updateSpreads=function(t){var e=this;this.epubPages.resetRequested();var i=this.publicationSpreads.findIndex(function(t){return t.includes(e.currentPage-1)}),n=this.lastSpreadIndex;this.lastSpreadIndex=i,this.updateSpreadOffsets(i,n),this.updateSpreadsPageIndexes(i);for(var s=this.epubSpreads.length,o=0;o<s;o++){var r=this.spreadOffsets[o],a=this.spreadsPageIndexes[o];a&&this.epubSpreads[o].updateSpread(r,a)}this.epubSpreadsAnimations&&(Math.abs(i-this.lastSpreadIndex)>1?this.epubSpreadsAnimations.updatePositionSizeOffset():this.epubSpreadsAnimations.animatePositionOffset(t)),this.epubPages.flushNotRequested()},t.prototype.updateSpreadOffsets=function(t,e){if(this.config.isVerticalOnePage)return void(this.spreadOffsets=this.publicationSpreads.map(function(e,i){return i-t}));if(1===this.spreadsLength)return void(this.spreadOffsets=[0]);if(2===this.spreadsLength)return 0===t?void(this.spreadOffsets=[0,1]):void(this.spreadOffsets=[-1,0]);var i=this.getThreeSpreadOffsets(t),n=this.spreadOffsets.map(function(t){return e+t}),s=i.map(function(e){return t+e}),o=[void 0,void 0,void 0];o=this.fillWithLoadedSpreads(o,i,n,s),o=this.fillWithNeededSpreads(o,i),this.spreadOffsets=o},t.prototype.getThreeSpreadOffsets=function(t){return 0===t?[0,1,2]:t===this.publicationSpreads.length-1?[-2,-1,0]:[-1,0,1]},t.prototype.fillWithLoadedSpreads=function(t,e,i,n){for(var s=function(s){var o=i[s],r=n.findIndex(function(t){return o===t});r!==-1&&(t[s]=e[r])},o=0;o<i.length;o++)s(o);return t},t.prototype.fillWithNeededSpreads=function(t,e){for(var i=0;i<t.length;i++){var n=t[i];if(void 0===n)for(var s=0;s<e.length;s++){var o=e[s];t.includes(o)||(t[i]=o)}}return t},t.prototype.updateSpreadsPageIndexes=function(t){var e=this;this.spreadsPageIndexes=this.spreadOffsets.map(function(i){return e.publicationSpreads[t+i]})},t.prototype.updateSpreadsSize=function(){var t=0,e=0;for(this.updateMainViewElementSize(),this.epubSpreadsAnimations&&this.epubSpreadsAnimations.updatePositionSizeOffset(),this.generatePublicationSpreads(),this.spreadsPageIndexes=this.publicationSpreads.slice(0,this.config.maxSpreadsLength),this.goToPage(this.currentPage,!1),t=0,e=this.epubSpreads.length;t<e;t++)this.epubSpreads[t].updateSpreadSize()},t.prototype.generatePublicationSpreads=function(){var t=this.isWideScreen();if(this.lastIsWideScreen!==t){this.lastIsWideScreen=t,this.publicationSpreads=[];for(var e=0;e<this.pageQuantity;){var i=this.getSpreadPageIndexes(e);this.publicationSpreads.push(i),e+=i.length}this.initLoadedSpreads()}},t.prototype.getSpreadPageIndexes=function(t){var e=[t,t+1],i=this.getSpreadPageNumber(e);return 1===i?[t]:e},t.prototype.getSpreadPageNumber=function(t){var e=w.Main.xmlManager.get("common-configuration","contents","zoom","width"),i=w.Main.xmlManager.get("common-configuration","contents","zoom","height"),n=e>i,s=this.parent.epubNavigationTypeManager.pageLayout,o=["best","auto"].indexOf(s)!==-1,r="single"===s,a="double"===s,u=this.isWideScreen(),l=t[0]<0||t[1]>=this.pageQuantity,h=1===this.config.firstSpreadSize&&t.includes(0),p=w.Main.xmlManager.get("comboPages","forcedSinglePages").map(function(t){return t-1}),c=w.Main.configsJsonManager.getPagesData(["showAlone"]),d=c.map(function(t,e){return e}).filter(function(t){return c[t].showAlone}),f=p.some(function(e){return t.includes(e)}),m=d.some(function(e){return t.includes(e)}),g=f||m;return r||l||h||g?1:a?2:o===!0&&n?1:o===!0&&u?2:1},t.prototype.initLoadedSpreads=function(){var t=this.config.isVerticalOnePage;this.epubSpreads=new Array(this.spreadsLength),this.spreadOffsets=[];for(var e=0;e<this.spreadsLength;e++)this.spreadOffsets.push(e);t||(this.epubSpreadsAnimations=new o["default"](this,this.config,this.epubSpreads,this.mainViewElement)),this.initSpreads(this.epubSpreads,this.mainViewElement)},t.prototype.scrollTo=function(t,e){this.epubSpreadsAnimations&&this.epubSpreadsAnimations.updatePosition(t,e)},t.prototype.gotoPageByCoordsDiff=function(t){this.epubManager.gotoPageByCoordsDiff(t)},t.prototype.goToPage=function(t,e){void 0===e&&(e=!0),this.epubManager.goToPage(t,e)},t.prototype.getSpreadPageNumberByOffset=function(t){var e=this.spreadOffsets.findIndex(function(e){return e===t});return e!==-1?this.spreadsPageIndexes[e].length:0},t.prototype.getSpreadPageIndexesByPageIndex=function(t){return this.publicationSpreads.find(function(e){return e.includes(t)})||[1]},t.prototype.getNumberOfPageToNextSpread=function(t){return this.getNumberOfPageToChangeSpread(t,!0)},t.prototype.getNumberOfPageToPreviousSpread=function(t){return this.getNumberOfPageToChangeSpread(t,!1)},t.prototype.getNumberOfPageToChangeSpread=function(t,e){var i=this.getSpreadPageIndexesByPageIndex(t),n=i.indexOf(t);return e?i.length-n:n+1},t.prototype.isWideScreen=function(){var t=window.parent!==window;if(!w.Param.isDesktop&&!t){var e=screen;if(e.orientation)return e.orientation.type.includes("landscape");if(e.msOrientation)return e.msOrientation.type.includes("landscape")}return this.screenSize.width>this.screenSize.height},t}();i["default"]=d},{"./EpubClickPermission":3,"./EpubConfig/EpubDefaultConfig":5,"./EpubEvent":8,"./EpubPages":58,"./EpubScrollables":60,"./EpubSpread":61,"./EpubSpreadsAnimations":65,"./utils/ScrollUtil":74,"./utils/functions":78,"./utils/isElementVisible":79}],65:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./utils/cssAnimations"),s=t("./EpubConfig/EpubDefaultConfig"),o=1,r=function(){function t(t,e,i,n){this.parent=t,this.config=e,this.epubSpreads=i,this.mainViewElement=n,this.epubSpreadsLength=i.length,this.screenSize=this.parent.screenSize,this.mainViewElementSize=this.parent.mainViewElementSize,this.epubSpreadsData=new Array(this.epubSpreads.length),this.makeSpreadData(this.epubSpreadsData),this.pixelTimeData={x:0,w:0,y:0,h:0,date:0,time:0},this.currentPosition={width:0,height:0,inX:0,inY:0,diffCoord:0}}return Object.defineProperty(t.prototype,"navigationAxis",{get:function(){return this.config.navigationAxis},enumerable:!0,configurable:!0}),t.prototype.setPixelTime=function(t,e){var i=t-this.pixelTimeData.x,n=e-this.pixelTimeData.y,s=Date.now(),o=s-this.pixelTimeData.date;this.pixelTimeData.x=t,this.pixelTimeData.w=i,this.pixelTimeData.y=e,this.pixelTimeData.h=n,this.pixelTimeData.date=s,this.pixelTimeData.time=o},t.prototype.getPixelTime=function(t,e){var i={w:~~Math.abs(t/this.pixelTimeData.w*this.pixelTimeData.time),h:~~Math.abs(e/this.pixelTimeData.y*this.pixelTimeData.time)};return this.pixelTimeData.x=0,this.pixelTimeData.w=0,this.pixelTimeData.y=0,this.pixelTimeData.h=0,this.pixelTimeData.date=0,this.pixelTimeData.time=0,i},t.prototype.makeSpreadData=function(t){for(var e=0,i=t.length;e<i;e++)t[e]={spreadOffset:0}},t.prototype.animationDomAsyncZero=function(t,e,i,s){this.config.useMatrixTransformScrollable?n.matrixAsync(this.config.use3DMatrixTransform,t,o,e,i,s):n.positionDomAsync(t,o,e,i,s)},t.prototype.animateSpreads=function(t,e,i,n,s,o,r){for(var a,u=0,l=this.epubSpreadsLength,h=0,p=0,c=0,d=0,f=0,m=0,g=0;u<l;u++)g=r,m=o,a=this.epubSpreads[u],0!==a.spreadOffset&&0!==a.lastOffset&&(m=1,g=0),f=a.spreadOffset-a.lastOffset,c=a.lastOffset*t+f*t*m+s*(1-m),d=a.lastOffset*e+f*e*m+s*(1-m),h=i*c,p=n*d,this.animationDomAsyncZero(a.spreadHTMLElement,h,p,g)},t.prototype.updatePositionSizeOffset=function(){this.updatePosition(0,0)},t.prototype.animatePositionOffset=function(t){var e=0,i=0,n=0,o=0;t=t||0,this.navigationAxis===s.NavigationAxis.X?(e=1,i=0):(e=0,i=1),n=this.mainViewElementSize.width,o=this.mainViewElementSize.height,this.currentPosition.width=n,this.currentPosition.height=o,this.currentPosition.inX=e,this.currentPosition.inY=i,this.animateSpreads(this.currentPosition.width,this.currentPosition.height,this.currentPosition.inX,this.currentPosition.inY,this.currentPosition.diffCoord,1,1e3*t)},t.prototype.updatePosition=function(t,e){var i,n=0,o=0,r=0,a=0,u=0,l=0,h=0,p=this.epubSpreadsLength;for(u=this.mainViewElementSize.width,l=this.mainViewElementSize.height,this.navigationAxis===s.NavigationAxis.X?(n=1,o=0,this.currentPosition.diffCoord=t):(n=0,o=1,this.currentPosition.diffCoord=e);h<p;h++)i=this.epubSpreads[h],this.epubSpreadsData[h].spreadOffset=i.spreadOffset,r=n*(i.spreadOffset*u+t),a=o*(i.spreadOffset*l+e),0!==i.spreadOffset&&((i.spreadOffset>0&&r>i.spreadOffset*u||i.spreadOffset<0&&r<i.spreadOffset*u)&&(r=i.spreadOffset*u),(i.spreadOffset>0&&a>i.spreadOffset*l||i.spreadOffset<0&&a<i.spreadOffset*l)&&(a=i.spreadOffset*l)),this.animationDomAsyncZero(i.spreadHTMLElement,r,a,0)},t}();i["default"]=r},{"./EpubConfig/EpubDefaultConfig":5,"./utils/cssAnimations":76}],66:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./EpubEvent"),s=function(){function t(t){this.epubManager=t,this.trackDateMaxTime=500,this.trackPageDate=0,this.previousPages=[],this.epubEvent=w.epubEvent,this.epubEvent.addListener(n.EPUB_EVENTS.PAGE_CHANGE,this.trackPages.bind(this)),this.epubEvent.addListener(n.EPUB_EVENTS.PAGE_ZOOM,this.trackPagesZoom.bind(this)),this.epubEvent.addListener(n.EPUB_EVENTS.ACTION_LINK_SUCCESS,this.trackLinks.bind(this))}return t.prototype.trackPages=function(t){var e=this.epubManager.getCurrentPages(t.data.pageNumber);if(JSON.stringify(e)!==JSON.stringify(this.previousPages)){if(Date.now()-this.trackPageDate<this.trackDateMaxTime)return void(this.trackPageDate=Date.now());this.trackPageDate=Date.now(),this.previousPages=e,w.Main.trackerManager.trackPage({name:"page",variables:{1:e}}),e.forEach(function(t){return w.Main.trackerManager.trackEvent({name:"pageView",variables:{1:t}})})}},t.prototype.trackPagesZoom=function(t){var e=this.epubManager.getCurrentPages(),i="zoomIn",n={1:""};n[1]=e.join("-"),t.data.status!==!0&&(i="zoomOut"),this.lastZoomScale===t.data.scale&&this.lastZoomedPages===n[1]||0===t.data.scale&&this.lastZoomedPages!==n[1]||(this.lastZoomedPages=n[1],this.lastZoomScale=t.data.scale,w.Main.trackerManager.trackEvent({name:i,variables:n}))},t.prototype.trackLinks=function(t){var e=t.data.userAct;w.Main.trackerManager.trackEvent({name:"link",variables:{1:e.type,2:e.param}})},t}();i.EpubStatistics=s},{"./EpubEvent":8}],67:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./EpubZoomDraggable"),s=function(){function t(t,e){this.epubSpreadZoomable=t,this.config=e,this.totalScale=0,this.totalWidth=0,this.totalHeight=0,this.totalX=0,this.totalY=0,this._scale=0,this._x=0,this._y=0,this.xLimited=!1,this.yLimited=!1,this.xLimit=0,this.yLimit=0,this.elastic={axisMax:100,coef:10},this.parent=this.epubSpreadZoomable,this.maxTotalScale=this.config.maxPageTotalScale,this.screenSize=this.parent.screenSize,this.mainViewElementSize=this.parent.mainViewElementSize,this.epubZoomDraggable=new n["default"](this,this.config)}return Object.defineProperty(t.prototype,"element",{get:function(){return this.parent.element},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleOrig",{get:function(){return this.parent.scale},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xOrig",{get:function(){return this.parent._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yOrig",{get:function(){return this.parent._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"widthOrig",{get:function(){return this.parent.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heightOrig",{get:function(){return this.parent.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingLeft",{get:function(){return this.parent.paddingLeft},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingTop",{get:function(){return this.parent.paddingTop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingRight",{get:function(){return this.parent.paddingRight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingBottom",{get:function(){return this.parent.paddingBottom},enumerable:!0,configurable:!0}),t.prototype.getBoundingClientRect=function(){return this.parent.getBoundingClientRect()},t.prototype.calcMaxCoord=function(t,e,i,n,s,o){return void 0===s&&(s=0),void 0===o&&(o=0),n.status=!1,e+s+o<i?(n.status=!0,i/2-(e+s+o)/2):t},t.prototype.setMaxX=function(){var t={status:!0},e=this.paddingLeft,i=this.paddingRight;return this.totalX=this.calcMaxCoord(this.totalX,this.totalWidth,this.mainViewElementSize.width,t,e,i),t.status},t.prototype.setMaxY=function(){var t={status:!0},e=this.paddingTop,i=this.paddingBottom;return this.totalY=this.calcMaxCoord(this.totalY,this.totalHeight,this.mainViewElementSize.height,t,e,i),t.status},t.prototype.calcMaxOnDragCoord=function(t,e,i,n,s,o,r){var a=e+i-o>-1,u=e+i+n+r<s+1;if(1===t)a===!0&&u===!0||(a===!0?i=o-e:u===!0&&(i=s-(e+n+r)));else{var l=n/2-(o/2-r/2);i=s/2-l}return i},t.prototype.getZoomNoEvent=function(t,e,i,n){return this.getZoom(null,t,e,i,n)},t.prototype.setZoomY=function(t,e,i){var n=this.paddingTop,s=this.paddingBottom,o=this.y,r=e-i.top||0,a=r/(this.heightOrig*t),u=this.heightOrig*this.totalScale;this.y=(this.heightOrig*t-u)*a+o,this.totalY=this.yOrig+this.y,this.totalHeight=u,this.yLimited=this.setMaxY(),this.yLimit=this.yLimited?0:1,this.totalY=this.calcMaxOnDragCoord(this.yLimit,this.epubZoomDraggable.y,this.totalY,u,this.mainViewElementSize.height,n,s)},t.prototype.setZoomX=function(t,e,i){var n=this.paddingLeft,s=this.paddingRight,o=this.x,r=e-i.left||0,a=r/(this.widthOrig*t),u=this.widthOrig*this.totalScale;this.x=(this.widthOrig*t-u)*a+o,this.totalX=this.xOrig+this.x,this.totalWidth=u,this.xLimited=this.setMaxX(),this.xLimit=this.xLimited?0:1,this.totalX=this.calcMaxOnDragCoord(this.xLimit,this.epubZoomDraggable.x,this.totalX,u,this.mainViewElementSize.width,n,s)},t.prototype.makeScale_=function(t){var e=this.scale;return t=t||1,this.scale=t,this.scale>this.maxTotalScale?this.scale=this.maxTotalScale:this.scale<1&&(this.scale=1),this.totalScale=this.scaleOrig*this.scale,this.scaleOrig*e},t.prototype.makeScale=function(t){var e=this.scale;return t=t||0,this.scale=t,this.scale+this.scaleOrig<this.scaleOrig?this.scale=0:this.scale+this.scaleOrig>this.maxTotalScale+this.scaleOrig&&(this.scale=this.maxTotalScale),this.totalScale=this.scale+this.scaleOrig,this.scaleOrig+e},t.prototype.getZoom=function(t,e,i,n,s){var o=0;this.paddingTop,this.paddingBottom;return o=this.makeScale(e),this.setZoomX(o,i,s),this.setZoomY(o,n,s),[this.totalScale,0,0,this.epubZoomDraggable.x+this.totalX,this.epubZoomDraggable.y+this.totalY]},t.prototype.resetZoom=function(){return this.epubZoomDraggable.resetdrag(),this.scale=0,this.x=0,this.y=0,this.totalX=0,this.totalY=0,this.totalScale=0,[this.scaleOrig,0,0,this.xOrig,this.yOrig]},t.prototype.initdrag=function(t,e,i,n){return this.epubZoomDraggable.initdrag(e,i,n)},t.prototype.initdragX=function(t,e,i){return this.epubZoomDraggable.initdragX(e,i.left)},t.prototype.initdragY=function(t,e,i){return this.epubZoomDraggable.initdragY(e,i.top)},t.prototype.drag=function(t,e,i){return this.epubZoomDraggable.drag(t,e,i)},t.prototype.resetdrag=function(){this.epubZoomDraggable.resetdrag()},t}();i["default"]=s},{"./EpubZoomDraggable":68}],68:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(t,e){this.epubZoom=t,this.config=e,this.xRect=0,this.yRect=0,this.xStart=0,this.yStart=0,this._x=0,this._y=0,this.correctionX=0,this.correctionY=0,this.parent=this.epubZoom,this.screenSize=this.parent.screenSize,this.mainViewElementSize=this.parent.mainViewElementSize,this.dragedData=[1,0,0,0,0]}return Object.defineProperty(t.prototype,"element",{get:function(){return this.parent.element},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingLeft",{get:function(){return this.parent.paddingLeft},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingTop",{get:function(){return this.parent.paddingTop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingRight",{get:function(){return this.parent.paddingRight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingBottom",{get:function(){return this.parent.paddingBottom},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleOrig",{get:function(){return this.parent.scale},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xOrig",{get:function(){return this.parent.xOrig},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yOrig",{get:function(){return this.parent.yOrig},enumerable:!0,configurable:!0}),t.prototype.calcMaxOnDragCoord=function(t,e,i,n,s,o,r){if(1===t){var a=e+i-o>0,u=e+i+n+r<s;a===!0?i=o-e:u===!0&&(i=s-(e+n+r))}return i},t.prototype.initdragX=function(t,e){this.correctionX=0,this.xRect=e,this.xStart=t-this.xRect-this.x},t.prototype.initdragY=function(t,e){this.correctionY=0,this.yRect=e,this.yStart=t-this.yRect-this.y},t.prototype.getBoundingClientRect=function(){return this.parent.getBoundingClientRect()},t.prototype.initdrag=function(t,e,i){this.initdragX(t,i.left),this.initdragY(e,i.top)},t.prototype.dragY=function(t,e){
var i=this.paddingTop,n=this.paddingBottom,s=0,o=this.parent.yLimited?0:1;this.y=(e-this.yRect-this.yStart)*o,s=this.epubZoom.totalY||this.yOrig;var r=this.calcMaxOnDragCoord(o,s,this.y,this.parent.totalHeight,this.mainViewElementSize.height,i,n);return r!==this.y&&(this.y>0&&this.y<this.correctionY?(this.correctionY=this.y-1,t.gestureData.resetAxis("y")):this.y<0&&this.y>this.correctionY?(this.correctionY=this.y+1,t.gestureData.resetAxis("y")):this.correctionY=this.y),this.y=r,s+this.y},t.prototype.dragX=function(t,e){var i=this.paddingLeft,n=this.paddingRight,s=0,o=this.parent.xLimited?0:1;this.x=(e-this.xRect-this.xStart)*o,s=this.epubZoom.totalX||this.xOrig;var r=this.calcMaxOnDragCoord(o,s,this.x,this.parent.totalWidth,this.mainViewElementSize.width,i,n);return r!==this.x&&(this.x>0&&this.x<this.correctionX?(this.correctionX=this.x-1,t.gestureData.resetAxis("x")):this.x<0&&this.x>this.correctionX?(this.correctionX=this.x+1,t.gestureData.resetAxis("x")):this.correctionX=this.x),this.x=r,s+this.x},t.prototype.drag=function(t,e,i){return this.dragedData=[this.epubZoom.totalScale||this.epubZoom.scaleOrig,0,0,this.dragX(t,e),this.dragY(t,i)],this.dragedData},t.prototype.resetdragY=function(){this.yStart=0,this.y=0},t.prototype.resetdragX=function(){this.xStart=0,this.x=0},t.prototype.resetdrag=function(){this.resetdragX(),this.resetdragY()},t}();i["default"]=n},{}],69:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,s=t("./EpubPageEnrichment/Slider/index"),o=t("./utils/functions"),r=t("./utils/youtube");!function(t){t.IMAGE="IMAGE",t.MOVIE="MOVIE",t.SLIDER="SLIDER"}(n||(n={}));var a=function(){function t(t){this.config=t,this.optimizeQuality=!1,this.optimizeQualityStat=!1,this.scale=1,this.scaleLastMax=1,this.x=0,this.y=0,this.backgroundSlider=null}return Object.defineProperty(t.prototype,"spreadViewElementClassName",{get:function(){return this.config.spreadViewElementClassName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomableViewElementClassName",{get:function(){return this.config.zoomableViewElementClassName},enumerable:!0,configurable:!0}),t.prototype.getBackgroundColor=function(t){return t&&t.backgroundColor?t.backgroundColor:"transparent"},t.prototype.getBackgroundImageUrl=function(t){return t&&t.backgroundImage&&t.backgroundImage.relUrl?w.Utils.resolveVariable(t.backgroundImage.relUrl):""},t.prototype.getBackgroundMediaUrl=function(t,e){return t&&t.backgroundMedia&&t.backgroundMedia.type===e&&"relUrl"in t.backgroundMedia?w.Utils.resolveVariable(t.backgroundMedia.relUrl):null},t.prototype.getBackgroundSliderPreviewUrl=function(t){var e=t.slides[0],i=e.relUrl,n=e.iconName,o=e.type,a=e.isExternalLink,u=e.externalRelUrl,l="";return o===s.SlideType.IMAGE?l=w.Utils.resolveVariable(i):o===s.SlideType.MOVIE&&n?l=w.Utils.resolveVariable(n):a&&(l=r.getYoutubeVideoCover(u)),l},t.prototype.getBackgroundPosition=function(t){return t&&t.backgroundMedia&&"position"in t.backgroundMedia&&t.backgroundMedia.position},t.prototype.getGeneralBackgroundStyle=function(){return w.Main.configsJsonManager.get("generalData.bgStyle.epubStyle")},t.prototype.getPageBackgroundStyle=function(t){var e=t-1,i=w.Main.configsJsonManager.getPageData(["bgStyle"],e).bgStyle;return i&&i.epubStyle?i.epubStyle:null},t.prototype.getEpubBackgroundStyle=function(t){var e=this.getPageBackgroundStyle(t),i=e&&(e.backgroundMedia||e.backgroundColor||e.backgroundImage);return i?this.getPageBackgroundStyle(t):this.getGeneralBackgroundStyle()},t.prototype.getBackgroundElement=function(){var t=this.element.querySelector(".spread-background");return t||(t=document.createElement("div"),t.id="spread-background-"+this.spreadIndex,t.className="spread-background",this.element.appendChild(t)),t},t.prototype.getBackgroundColors=function(t){var e=this.getEpubBackgroundStyle(t[0]),i=e?this.getBackgroundColor(e):w.Main.pageManager.getBackgroundColor(t[0]),n=i;if(t.length>1){var s=this.getEpubBackgroundStyle(t[1]);n=s?this.getBackgroundColor(s):w.Main.pageManager.getBackgroundColor(t[1])}return{left:i,right:n}},t.prototype.isBackgroundSlider=function(t){return t&&t.backgroundMedia&&t.backgroundMedia.type===n.SLIDER},t.prototype.setBackgroundSlider=function(t,e,i){var n=this.isBackgroundSlider(t),o=this.element.classList.contains("spread-is-visible"),r=this.backgroundSlider&&this.backgroundSlider.page===e[0];if(!this.backgroundSlider||o&&r||this.clearBackgroundSliders(),n&&o&&(!this.backgroundSlider||!r)){var a="spread-background-"+this.spreadIndex,u=t.backgroundMedia,l=u.slides,h=u.settings;this.backgroundSlider={instance:new s.Slider(i,l,a,e[0],h,s.SliderType.SPREAD_BACKGROUND),page:e[0]}}},t.prototype.setBackgroundCSSStyle=function(t,e,i){var n=this.getCSSBackground(t,e);this.background!==n&&(this.background=n,i.style.backgroundImage=n)},t.prototype.getVideoCover=function(t){return w.Utils.getFilenameWithoutExtension(t)+"/cover.jpg"},t.prototype.getCSSBackground=function(t,e){var i=this.isBackgroundSlider(t);if(i)return"url("+this.getBackgroundSliderPreviewUrl(t.backgroundMedia)+")";var s=this.getBackgroundMediaUrl(t,n.MOVIE);if(s){var o=this.getVideoCover(s);return"url("+o+")"}var r=this.getBackgroundImageUrl(t),a=this.getBackgroundMediaUrl(t,n.IMAGE),u=r||a;if(u)return"url("+u+")";var l=this.getBackgroundColors(e),h=l.left,p=l.right;return"linear-gradient(90deg,"+h+" 50%, "+p+" 50%)"},t.prototype.setBackgroundVideo=function(t){var e=this.getBackgroundMediaUrl(t,n.MOVIE),i=this.element.querySelector("video.spread-bgVideo"),s=!this.config.isVerticalOnePage||this.element.classList.contains("spread-is-visible");if(null===i&&s&&e&&(i=document.createElement("video"),i.id="spread-background-"+this.spreadIndex,i.classList.add("spread-bgVideo"),i.autoplay=!1,i.muted=!0,i.setAttribute("playsinline",""),i.loop=!0,this.element.insertBefore(i,this.element.firstChild)),i)if(s&&e){var o=i.src.split("/"),r=o[o.length-1],a=e.split("/"),u=a[a.length-1],l=r===u;l||(i.src=e,i.poster=this.getVideoCover(e))}else i.parentNode&&i.parentNode.removeChild(i)},t.prototype.setBackgroundPosition=function(t){var e=this.getBackgroundPosition(t),i="spread-background-styles-"+this.spreadIndex,s=this.element.querySelector("#"+i),o=this.getBackgroundMediaUrl(t,n.MOVIE);if(e){s||(s=document.createElement("style"),s.id=i);var r=1,a=50,u=50,l=992,h=o?"object-position":"background-position",p=function(t,e){return void 0===t?e:t},c=p(e.phone&&e.phone.left,u),d=p(e.phone&&e.phone.top,a),f=p(e.phone&&e.phone.scale,r),m=p(e.desktop&&e.desktop.left,u),g=p(e.desktop&&e.desktop.top,a),v=p(e.desktop&&e.desktop.scale,r),y="\n\t\t\t\t#spread-background-"+this.spreadIndex+" {\n\t\t\t\t\t"+h+": "+c+"% "+d+"%;\n\t\t\t\t\ttransform: scale("+f+");\n\t\t\t\t}\n\n\t\t\t\t@media screen and (min-width: "+l+"px) {\n\t\t\t\t\t#spread-background-"+this.spreadIndex+" {\n\t\t\t\t\t\t"+h+": "+m+"% "+g+"%;\n\t\t\t\t\t\ttransform: scale("+v+");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t",b=w.Param.userAgent,E=b.browser,S=b.BROWSER,P=E.name===S.IE||E.name===S.EDGE&&E.version<=18;o&&P&&(y+="\n\t\t\t\t\t#spread-background-"+this.spreadIndex+".spread-bgVideo {\n\t\t\t\t\t\ttop: "+d+"%;\n\t\t\t\t\t\tleft: "+c+"%;\n\t\t\t\t\t\ttransform: translate(-"+c+"%, -"+d+"%) scale("+f+");\n\t\t\t\t\t}\n\n\t\t\t\t\t@media screen and (min-width: "+l+"px) {\n\t\t\t\t\t\t#spread-background-"+this.spreadIndex+".spread-bgVideo {\n\t\t\t\t\t\t\ttop: "+g+"%;\n\t\t\t\t\t\t\tleft: "+m+"%;\n\t\t\t\t\t\t\ttransform: translate(-"+m+"%, -"+g+"%) scale("+v+");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t"),s.innerHTML=y,this.element.appendChild(s)}else s&&this.element.removeChild(s)},t.prototype.setBackground=function(t){if(0!==t.length){var e=this.getEpubBackgroundStyle(t[0]),i=this.getBackgroundElement();this.setBackgroundSlider(e,t,i),this.setBackgroundCSSStyle(e,t,i),this.setBackgroundVideo(e),this.setBackgroundPosition(e)}},t.prototype.clearBackgroundSliders=function(){this.backgroundSlider&&(this.backgroundSlider.instance.stop(),this.backgroundSlider=null)},t.prototype.initSpread=function(t,e,i,n){this.config=e,this.epubSpreadZoomable=i,this.spreadIndex=n,this.element=document.createElement("div"),this.element.classList.add(this.spreadViewElementClassName),this.element.classList.add(this.spreadViewElementClassName+"-"+this.spreadIndex),this.element.innerHTML="",this.element.appendChild(this.epubSpreadZoomable.getElement())},t.prototype.initZoomable=function(t,e){this.element=document.createElement("div"),this.element.classList.add(this.zoomableViewElementClassName)},t.prototype.removeChilren=function(){o.htmlSecureRemoveChildren(this.element)},t.prototype.scrollToTop=function(){this.element.scrollTop=0},t.prototype.setSpreadScrollable=function(t){return t===!0?(this.element.style["overflow-y"]="auto",void(this.element.style.webkitOverflowScrolling="touch")):(this.element.style["overflow-y"]="hidden",void(this.element.style.webkitOverflowScrolling="auto"))},t}();i["default"]=a},{"./EpubPageEnrichment/Slider/index":56,"./utils/functions":78,"./utils/youtube":81}],70:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../EpubEvent"),s=t("./View"),o=function(){function t(t){this.epubManager=t,this.didPageChange=!1,this.isMouseNearEdge=!1,this.hasFocus=!1,this.hasMouseOver=!1,this.userAgent=w.Param.userAgent,this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this),this.onInputChange=this.onInputChange.bind(this),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onPageChange=this.onPageChange.bind(this),this.updateMousePosition=this.updateMousePosition.bind(this),this.config=this.epubManager.config,this.epubEvent=w.epubEvent,this.viewPageToastParams={parentElement:this.epubManager.viewMain,values:{currentPage:this.currentPage,pageQuantity:this.config.pageQuantity},listeners:{onFocus:this.onFocus,onBlur:this.onBlur,onInputChange:this.onInputChange,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave}},this.init()}return Object.defineProperty(t.prototype,"currentPage",{get:function(){return this.epubManager.currentPage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVisible",{get:function(){return this.didPageChange||this.isMouseNearEdge||this.hasFocus||this.hasMouseOver},enumerable:!0,configurable:!0}),t.prototype.updateVisiblity=function(){this.panel.updateVisibility(this.isVisible)},t.prototype.updateFocus=function(){this.panel.updateFocus(this.hasFocus)},t.prototype.setDidPageChange=function(t){this.didPageChange=t,this.updateVisiblity()},t.prototype.init=function(){var t=this;this.panel=new s.View(this.viewPageToastParams),this.panel.init().then(function(){if(t.epubEvent.addListener(n.EPUB_EVENTS.PAGE_CHANGE,t.onPageChange),t.userAgent.isDesktop()){var e=100;document.addEventListener("mousemove",w.Utils.throttle(t.updateMousePosition,e))}})},t.prototype.onPageChange=function(t){var e=this,i=t.data,n=i.pageNumber,s=i.pageChanged;s&&(this.panel.updateCurrentPage(n),1!==n&&(this.setDidPageChange(!0),clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(function(){return e.setDidPageChange(!1)},2e3)))},t.prototype.updateMousePosition=function(t){var e=10,i=.45,n=t.y>=document.body.offsetHeight-e,s=document.body.offsetWidth*(1-i)/2,o=t.x>s&&t.x<document.body.offsetWidth-s;this.isMouseNearEdge=n&&o,this.updateVisiblity()},t.prototype.onMouseEnter=function(){this.hasMouseOver=!0,this.updateFocus()},t.prototype.onMouseLeave=function(){this.hasMouseOver=!1,this.updateFocus()},t.prototype.onFocus=function(){this.hasFocus=!0,this.updateFocus()},t.prototype.onBlur=function(){this.hasFocus=!1,this.updateFocus()},t.prototype.onInputChange=function(t){t.currentTarget&&(this.epubManager.currentPage=w.Utils.byOffsetIndex(t.currentTarget.value,!0))},t}();i.Controller=o},{"../../EpubEvent":8,"./View":71}],71:[function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(i,"__esModule",{value:!0});var s=t("../panel/View"),o=function(t){function e(e){var i=t.call(this,e)||this;return i.params=e,i.classElement="epub-page-toast",i.pageToastPath=w.Param.pathTemplate+"epub/component/pageToast/index.html",i.userAgent=w.Param.userAgent,i}return n(e,t),e.prototype.updateCurrentPage=function(t){this.updateCurrentPageElement(t),this.updateInputElement(t)},e.prototype.updateVisibility=function(t){this.pageToastElement.classList.toggle("visible",t)},e.prototype.updateFocus=function(t){this.pageToastElement.classList.toggle("focused",t)},e.prototype.setView=function(){var e=this,i=this.params.values,n=i.currentPage,s=i.pageQuantity,o=[];o.push(t.prototype.setView.call(this)),o.push(this.loadTemplate(this.pageToastPath,{currentPage:w.Utils.byOffsetIndex(n),pageQuantity:w.Utils.byOffsetIndex(s),hasInput:this.userAgent.isDesktop()})),o[1].then(function(t){e.pageToastElement=t});var r=Promise.all(o);return r.then(function(){e.setElements()}),r},e.prototype.createCurrentPageElement=function(){this.currentPageElement=this.pageToastElement.querySelector(".current_page")},e.prototype.createInputElement=function(){var t=this.params.listeners,e=t.onFocus,i=t.onBlur,n=t.onInputChange;this.inputElement=this.pageToastElement.querySelector("input#page_toast-page"),this.inputElement&&(this.inputElement.addEventListener("focus",e),this.inputElement.addEventListener("blur",i),this.inputElement.addEventListener("change",n))},e.prototype.updateCurrentPageElement=function(t){this.currentPageElement.innerHTML=w.Utils.byOffsetIndex(t)},e.prototype.updateInputElement=function(t){this.inputElement&&(this.inputElement.value=w.Utils.byOffsetIndex(t))},e.prototype.setElements=function(){var t=this.params.listeners,e=t.onMouseEnter,i=t.onMouseLeave;this.view.appendChild(this.pageToastElement),this.createCurrentPageElement(),this.createInputElement(),this.pageToastElement.addEventListener("mouseenter",e),this.pageToastElement.addEventListener("mouseleave",i)},e}(s.View);i.View=o},{"../panel/View":72}],72:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(t){this.params=t,this.classElement="epub-page_control-button",this.shown=!1,this.opened=!1,this.panelTemplatePath=w.Param.pathTemplate+"epub/component/panel/index.html",this.htmlPlaceHolder=document.createElement("div"),this.htmlPlaceHolder.style.display="none",this.params.parentElement.appendChild(this.htmlPlaceHolder)}return t.prototype.init=function(){var t=this,e=this.setView();return e.then(function(){t.addView()}),e},t.prototype.addToView=function(t){this.view.replaceChild(this.htmlPlaceHolder,t)},t.prototype.loadTemplate=function(t,e){var i=document.createElement("div"),n=new Promise(function(n,s){w.Main.templateManager.load(t,i,e).then(function(t){n(t[0])})});return n},t.prototype.setView=function(){var t=this,e=this.loadTemplate(this.panelTemplatePath,{});return e.then(function(e){t.view=e,t.view.classList.add.apply(t.view.classList,t.classElement.split(" "))}),e},t.prototype.addView=function(){this.params.parentElement.replaceChild(this.view,this.htmlPlaceHolder)},t.prototype.show=function(t){t===!0&&this.shown===!1||t===!1&&this.shown===!0},t.prototype.open=function(t){t===!0&&this.opened===!1||t===!1&&this.opened===!0},t}();i.View=n},{}],73:[function(t,e,i){"use strict";function n(){function t(t,e){var n=i.prototype,s=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||function(t){return[].indexOf.call(document.querySelectorAll(t),this)!==-1};return s.call(t,e)}function e(e){for(var i;i=this.parentElement;)if(t(i,e))return i}var i=window.Element;i&&!i.prototype.closest&&(i.prototype.closest=e)}Object.defineProperty(i,"__esModule",{value:!0}),i["default"]=n},{}],74:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(t){this.element=t,this.lastScrollTop=this.element.scrollTop}return t.prototype.isScrollDown=function(){var t=this.element.scrollTop,e=t>this.lastScrollTop;return this.lastScrollTop=t,e},t}();i["default"]=n},{}],75:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),t("es6-promise");var n=function(){function t(){}return t.GET="GET",t.get="GET",t.POST="POST",t.post="POST",t}();i.Protocol=n;var s=function(){function t(t,e,i){void 0===t&&(t=n.GET),void 0===e&&(e=""),void 0===i&&(i=null),this.protocol=t,this.url=e,this.data=i,this.xhr=new XMLHttpRequest}return t.prototype.onreadystatechange=function(){if(4===this.xhr.readyState)return 404===this.xhr.status?void this.reject(this):void this.resolve(this.xhr)},t.prototype.executeur=function(t,e){this.resolve=t,this.reject=e,this.xhr.open(this.protocol,this.url,!0),this.xhr.onreadystatechange=this.onreadystatechange.bind(this),this.xhr.send(this.data)},t.prototype.init=function(){return new Promise(this.executeur.bind(this))},t}();i["default"]=s},{"es6-promise":1}],76:[function(t,e,i){"use strict";function n(t){if(t.element.style.transitionDuration="0",t.optimizeQualityStat!==!0){var e=t.scale;t.optimizeQualityStat=!0,u[0]=e,u[3]=e,u[4]=t.x,u[5]=t.y,t.frameTimer2d=r.styleTransform(t.element,"matrix("+u.join(",")+")")}}function s(t,e,i,s,o,l){if(i=~~(1e3*i)/1e3,s=~~s,o=~~o,e.scale!==i||e.x!==s||e.y!==o||e.optimizeQualityStat!==!0){e.scale=i,e.x=s,e.y=o,e.matrix2d=e.matrix2d||n.bind(null,e);var h;t?(a[0]=i,a[5]=i,a[12]=s,a[13]=o,h="matrix3d("+a.join(",")+")"):(u[0]=i,u[3]=i,u[4]=s,u[5]=o,h="matrix("+u.join(",")+")"),cancelAnimationFrame(e.frameTimer3d),e.frameTimer3d=r.styleTransform(e.element,h,function(){e.element.style.transitionDuration=(l||"0")+"ms"}),e.optimizeQualityStat=!1,cancelAnimationFrame(e.frameTimer2d),clearTimeout(e.timer)}}function o(t,e,i,n,s){t.scale===e&&t.x===i&&t.y===n||(t.scale=e,t.x=i,t.y=n,t.element.style.cssText+="transition-duration:"+(s+"ms"||"0")+" ;transform: none; left: "+i/e+"px; top: "+n/e+"px; zoom: "+e+";",t.optimizeQualityStat=!1)}Object.defineProperty(i,"__esModule",{value:!0});var r=t("./functions"),a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[1,0,0,1,0,0];i.matrixAsync=s,i.positionDomAsync=o},{"./functions":78}],77:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n;!function(t){t[t.EPUB_HTML=0]="EPUB_HTML",t[t.PDF_HTML=1]="PDF_HTML",t[t.PDF_SVG=2]="PDF_SVG",t[t.PDF_IMG=3]="PDF_IMG",t[t.PDF_PDF=4]="PDF_PDF"}(n=i.READER_TYPES||(i.READER_TYPES={}));var s;!function(t){t[t.INIT=0]="INIT",t[t.START=1]="START",t[t.STOP=2]="STOP",t[t.FLUSH=3]="FLUSH"}(s=i.ShapeActivityStatus||(i.ShapeActivityStatus={}));var o;!function(t){t[t.blink=0]="blink",t[t["static"]=1]="static",t[t.none=2]="none",t[t.revealOnTap=3]="revealOnTap"}(o=i.LinksBehaviors||(i.LinksBehaviors={}));var r;!function(t){t[t.hdpi=0]="hdpi",t[t.mdpi=1]="mdpi",t[t.ldpi=2]="ldpi",t[t.svg=3]="svg"}(r=i.PagesImagesQualities||(i.PagesImagesQualities={}))},{}],78:[function(t,e,i){"use strict";function n(t,e){void 0===e&&(e=1);var i=t.getBoundingClientRect();return{bottom:i.bottom*e,height:i.height*e,left:i.left*e,top:i.top*e,width:i.width*e}}function s(t){for(var e;e=t.lastChild;)t.removeChild(e)}function o(t){var e=t.tagName.toLowerCase();return"video"===e||"audio"===e}function r(){return w.Param.isPortrait=window.innerWidth<=window.innerHeight,!w.Param.isPortrait}function a(){var t=window.innerHeight/document.documentElement.clientHeight*100;document.documentElement.style.height=t+"%"}function u(){var t={promise:null,resolve:null,reject:null,then:function(){}};t.promise=new Promise(function(e,i){t.resolve=e,t.reject=i});var e=t.promise;return t.then=e.then.bind(e),t}function l(t){var e=/[+-]?\d+(\.\d+)?/g,i=t.match(e);return i?+i[0]:0}Object.defineProperty(i,"__esModule",{value:!0}),i.getBoundingClientRect=n;var h=function(){var t="transform";return"transform"in document.body.style?t="transform":"webkitTransform"in document.body.style?t="webkitTransform":"msTransform"in document.body.style&&(t="msTransform"),function(e,i,n){return window.requestAnimationFrame(function(){n&&n(),e.style[t]=i})}}();i.styleTransform=h,i.htmlSecureRemoveChildren=s,i.isMediaElement=o,i.isWindowLandscape=r,i.resizeHTMLTagElement=a,i.getSplitedPromise=u,i.getNumberFromString=l},{}],79:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n;!function(t){t.ANY="any",t.BOTTOM="bottom",t.TOP="top"}(n||(n={})),i.ElementVisibleMode=n;var s=function(t,e,i){var s=t.getBoundingClientRect(),o=s.bottom,r=s.top,a=i&&i.bottom||0,u=i&&i.top||0,l=window.innerHeight,h=r<u,p=r>l-a,c=o<u,d=o>l-a;switch(e){case n.ANY:var f=h&&c,m=p&&d;return!(f||m);case n.BOTTOM:return!(c||d);case n.TOP:return!(h||p)}};i.isElementVisible=s},{}],80:[function(t,e,i){"use strict";function n(){return"ontouchstart"in window||navigator.maxTouchPoints>0}Object.defineProperty(i,"__esModule",{value:!0}),i.isTouchSupported=n},{}],81:[function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(s,o){function r(t){try{u(n.next(t))}catch(e){o(e)}}function a(t){try{u(n["throw"](t))}catch(e){o(e)}}function u(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(r,a)}u((n=n.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,o=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(r=u.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){u.label=i[1];break}if(6===i[0]&&u.label<r[1]){u.label=r[1],r=i;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(i);break}r[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(n){i=[6,n],o=0}finally{s=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,o,r,a,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},o=this;Object.defineProperty(i,"__esModule",{value:!0});var r;!function(t){t[t.UNSTARTED=-1]="UNSTARTED",t[t.ENDED=0]="ENDED",t[t.PLAYING=1]="PLAYING",t[t.PAUSED=2]="PAUSED",t[t.BUFFERING=3]="BUFFERING",t[t.VIDEO_CUED=5]="VIDEO_CUED"}(r||(r={})),i.YoutubePlayerState=r;var a="youtubeStateChange";i.YOUTUBE_STATE_CHANGE_EVENT=a;var u=function(t,e){return e?e.video_id+"-"+e.title:t},l=function(t){return function(e){var i=e.target.getVideoData&&e.target.getVideoData(),n=u(t,i);document.dispatchEvent(new CustomEvent(a,{detail:{state:e.data}})),e.data===r.PLAYING?w.Main.trackerManager.trackEvent({name:"videoPlay",variables:{1:n,2:e.target.playerInfo&&e.target.playerInfo.currentTime}}):e.data===r.PAUSED?w.Main.trackerManager.trackEvent({name:"videoPause",variables:{1:n,2:e.target.playerInfo&&e.target.playerInfo.currentTime}}):e.data===r.ENDED&&w.Main.trackerManager.trackEvent({name:"videoEnd",variables:{1:n}})}},h=function(t){return n(o,void 0,void 0,function(){var e;return s(this,function(i){switch(i.label){case 0:return t.dataset.isTracked?[2]:(t.dataset.isTracked="true",e=t.closest("[id]").id,[4,loadYouTubePlayerAPI()]);case 1:return i.sent(),YT_ready(function(){var i=getFrameID(e);i&&new YT.Player(i,{events:{onStateChange:l(t.src)}})}),[2]}})})};i.addYoutubeTrackStateChange=h;var p=function(t){return w.Main.consentManager&&w.Main.consentManager.getServiceConsent("webpublicationYoutube")===!0?t:t.replace("www.youtube.com","www.youtube-nocookie.com")};i.getCorrectYoutubeDomain=p;var c=function(t){var e="https://i.ytimg.com/vi/",i=d(t);return""+e+i+"/maxresdefault.jpg"};i.getYoutubeVideoCover=c;var d=function(t){var e=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,i=t.match(e);return i?i[2].split('" ')[0]:""}},{}]},{},[14]);